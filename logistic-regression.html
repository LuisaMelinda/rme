<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regression Models for Epidemiology - 3&nbsp; Models for Binary Outcomes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./count-regression.html" rel="next">
<link href="./Linear-models-overview.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-W625DGE908"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-W625DGE908', { 'anonymize_ip': true});
</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false,
  "enableExperimentalNewNoteButton": true
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="custom.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glms.html">Generalized Linear Models</a></li><li class="breadcrumb-item"><a href="./logistic-regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression Models for Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/d-morrison/rme" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Regression-Models-for-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-GLMs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Linear-models-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic-regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Models for Count Outcomes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./time-to-event-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time to Event Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./proportional-hazards-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Proportional Hazards Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coxph-model-building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building Cox Proportional Hazards models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parametric-survival-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Parametric survival models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-MLEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Introduction to Maximum Likelihood Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./common-mistakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Common Mistakes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Notation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Statistical computing in R</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link active" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#configuring-r" id="toc-configuring-r" class="nav-link" data-scroll-target="#configuring-r">Configuring R</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">3.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#what-is-logistic-regression" id="toc-what-is-logistic-regression" class="nav-link" data-scroll-target="#what-is-logistic-regression"><span class="header-section-number">3.1.1</span> What is logistic regression?</a></li>
  <li><a href="#logistic-regression-versus-linear-regression" id="toc-logistic-regression-versus-linear-regression" class="nav-link" data-scroll-target="#logistic-regression-versus-linear-regression"><span class="header-section-number">3.1.2</span> Logistic regression versus linear regression</a></li>
  </ul></li>
  <li><a href="#risk-estimation-and-prediction" id="toc-risk-estimation-and-prediction" class="nav-link" data-scroll-target="#risk-estimation-and-prediction"><span class="header-section-number">3.2</span> Risk Estimation and Prediction</a>
  <ul class="collapse">
  <li><a href="#comparing-probabilities" id="toc-comparing-probabilities" class="nav-link" data-scroll-target="#comparing-probabilities"><span class="header-section-number">3.2.1</span> Comparing probabilities</a></li>
  <li><a href="#odds-and-probabilities" id="toc-odds-and-probabilities" class="nav-link" data-scroll-target="#odds-and-probabilities"><span class="header-section-number">3.2.2</span> Odds and probabilities</a></li>
  <li><a href="#the-inverse-odds-function" id="toc-the-inverse-odds-function" class="nav-link" data-scroll-target="#the-inverse-odds-function"><span class="header-section-number">3.2.3</span> The inverse odds function</a></li>
  <li><a href="#odds-ratios" id="toc-odds-ratios" class="nav-link" data-scroll-target="#odds-ratios"><span class="header-section-number">3.2.4</span> Odds ratios</a></li>
  <li><a href="#effect-of-study-design" id="toc-effect-of-study-design" class="nav-link" data-scroll-target="#effect-of-study-design"><span class="header-section-number">3.2.5</span> Effect of study design</a></li>
  </ul></li>
  <li><a href="#introduction-to-logistic-regression" id="toc-introduction-to-logistic-regression" class="nav-link" data-scroll-target="#introduction-to-logistic-regression"><span class="header-section-number">3.3</span> Introduction to logistic regression</a>
  <ul class="collapse">
  <li><a href="#binary-outcomes-models---one-group-no-covariates" id="toc-binary-outcomes-models---one-group-no-covariates" class="nav-link" data-scroll-target="#binary-outcomes-models---one-group-no-covariates"><span class="header-section-number">3.3.1</span> Binary outcomes models - one group, no covariates</a></li>
  <li><a href="#binary-outcomes---general" id="toc-binary-outcomes---general" class="nav-link" data-scroll-target="#binary-outcomes---general"><span class="header-section-number">3.3.2</span> Binary outcomes - general</a></li>
  <li><a href="#modeling-pi_i-as-a-function-of-x_i" id="toc-modeling-pi_i-as-a-function-of-x_i" class="nav-link" data-scroll-target="#modeling-pi_i-as-a-function-of-x_i"><span class="header-section-number">3.3.3</span> Modeling <span class="math inline">\(\pi_i\)</span> as a function of <span class="math inline">\(X_i\)</span></a></li>
  <li><a href="#sec-expit-logit-diagram" id="toc-sec-expit-logit-diagram" class="nav-link" data-scroll-target="#sec-expit-logit-diagram"><span class="header-section-number">3.3.4</span> Diagram of expit and logit</a></li>
  <li><a href="#meet-the-beetles" id="toc-meet-the-beetles" class="nav-link" data-scroll-target="#meet-the-beetles"><span class="header-section-number">3.3.5</span> Meet the beetles</a></li>
  <li><a href="#why-dont-we-use-linear-regression" id="toc-why-dont-we-use-linear-regression" class="nav-link" data-scroll-target="#why-dont-we-use-linear-regression"><span class="header-section-number">3.3.6</span> Why don’t we use linear regression?</a></li>
  <li><a href="#zoom-out" id="toc-zoom-out" class="nav-link" data-scroll-target="#zoom-out"><span class="header-section-number">3.3.7</span> Zoom out</a></li>
  <li><a href="#log-transformation-of-dose" id="toc-log-transformation-of-dose" class="nav-link" data-scroll-target="#log-transformation-of-dose"><span class="header-section-number">3.3.8</span> log transformation of dose?</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">3.3.9</span> Logistic regression</a></li>
  <li><a href="#three-parts-to-regression-models" id="toc-three-parts-to-regression-models" class="nav-link" data-scroll-target="#three-parts-to-regression-models"><span class="header-section-number">3.3.10</span> Three parts to regression models</a></li>
  <li><a href="#logistic-regression-in-r" id="toc-logistic-regression-in-r" class="nav-link" data-scroll-target="#logistic-regression-in-r"><span class="header-section-number">3.3.11</span> Logistic regression in R</a></li>
  <li><a href="#individual-observations" id="toc-individual-observations" class="nav-link" data-scroll-target="#individual-observations"><span class="header-section-number">3.3.12</span> Individual observations</a></li>
  </ul></li>
  <li><a href="#multiple-logistic-regression" id="toc-multiple-logistic-regression" class="nav-link" data-scroll-target="#multiple-logistic-regression"><span class="header-section-number">3.4</span> Multiple logistic regression</a>
  <ul class="collapse">
  <li><a href="#coronary-heart-disease-wcgs-study-data" id="toc-coronary-heart-disease-wcgs-study-data" class="nav-link" data-scroll-target="#coronary-heart-disease-wcgs-study-data"><span class="header-section-number">3.4.1</span> Coronary heart disease (WCGS) study data</a></li>
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data"><span class="header-section-number">3.4.2</span> Load the data</a></li>
  <li><a href="#now-lets-do-some-data-cleaning" id="toc-now-lets-do-some-data-cleaning" class="nav-link" data-scroll-target="#now-lets-do-some-data-cleaning"><span class="header-section-number">3.4.3</span> Now let’s do some data cleaning</a></li>
  <li><a href="#whats-in-the-data" id="toc-whats-in-the-data" class="nav-link" data-scroll-target="#whats-in-the-data"><span class="header-section-number">3.4.4</span> What’s in the data</a></li>
  <li><a href="#data-by-age-and-personality-type" id="toc-data-by-age-and-personality-type" class="nav-link" data-scroll-target="#data-by-age-and-personality-type"><span class="header-section-number">3.4.5</span> Data by age and personality type</a></li>
  <li><a href="#graphical-exploration" id="toc-graphical-exploration" class="nav-link" data-scroll-target="#graphical-exploration"><span class="header-section-number">3.4.6</span> Graphical exploration</a></li>
  <li><a href="#logistic-regression-models-for-chd-data" id="toc-logistic-regression-models-for-chd-data" class="nav-link" data-scroll-target="#logistic-regression-models-for-chd-data"><span class="header-section-number">3.4.7</span> Logistic regression models for CHD data</a></li>
  <li><a href="#models-superimposed-on-data" id="toc-models-superimposed-on-data" class="nav-link" data-scroll-target="#models-superimposed-on-data"><span class="header-section-number">3.4.8</span> Models superimposed on data</a></li>
  <li><a href="#reference-group-and-contrast-parametrization" id="toc-reference-group-and-contrast-parametrization" class="nav-link" data-scroll-target="#reference-group-and-contrast-parametrization"><span class="header-section-number">3.4.9</span> reference-group and contrast parametrization</a></li>
  </ul></li>
  <li><a href="#fitting-logistic-regression-models" id="toc-fitting-logistic-regression-models" class="nav-link" data-scroll-target="#fitting-logistic-regression-models"><span class="header-section-number">3.5</span> Fitting logistic regression models</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">3.5.1</span> </a></li>
  </ul></li>
  <li><a href="#sec-gof" id="toc-sec-gof" class="nav-link" data-scroll-target="#sec-gof"><span class="header-section-number">3.6</span> Model comparisons for logistic models</a>
  <ul class="collapse">
  <li><a href="#deviance-test" id="toc-deviance-test" class="nav-link" data-scroll-target="#deviance-test"><span class="header-section-number">3.6.1</span> Deviance test</a></li>
  <li><a href="#hosmer-lemeshow-test" id="toc-hosmer-lemeshow-test" class="nav-link" data-scroll-target="#hosmer-lemeshow-test"><span class="header-section-number">3.6.2</span> Hosmer-Lemeshow test</a></li>
  <li><a href="#comparing-models" id="toc-comparing-models" class="nav-link" data-scroll-target="#comparing-models"><span class="header-section-number">3.6.3</span> Comparing models</a></li>
  </ul></li>
  <li><a href="#residual-based-diagnostics" id="toc-residual-based-diagnostics" class="nav-link" data-scroll-target="#residual-based-diagnostics"><span class="header-section-number">3.7</span> Residual-based diagnostics</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-residuals-only-work-for-grouped-data" id="toc-logistic-regression-residuals-only-work-for-grouped-data" class="nav-link" data-scroll-target="#logistic-regression-residuals-only-work-for-grouped-data"><span class="header-section-number">3.7.1</span> Logistic regression residuals only work for grouped data</a></li>
  <li><a href="#response-residuals" id="toc-response-residuals" class="nav-link" data-scroll-target="#response-residuals"><span class="header-section-number">3.7.2</span> (Response) residuals</a></li>
  <li><a href="#pearson-residuals" id="toc-pearson-residuals" class="nav-link" data-scroll-target="#pearson-residuals"><span class="header-section-number">3.7.3</span> Pearson residuals</a></li>
  <li><a href="#pearson-chi-squared-goodness-of-fit-test" id="toc-pearson-chi-squared-goodness-of-fit-test" class="nav-link" data-scroll-target="#pearson-chi-squared-goodness-of-fit-test"><span class="header-section-number">3.7.4</span> Pearson chi-squared goodness of fit test</a></li>
  <li><a href="#deviance-residuals" id="toc-deviance-residuals" class="nav-link" data-scroll-target="#deviance-residuals"><span class="header-section-number">3.7.5</span> Deviance residuals</a></li>
  <li><a href="#diagnostic-plots" id="toc-diagnostic-plots" class="nav-link" data-scroll-target="#diagnostic-plots"><span class="header-section-number">3.7.6</span> Diagnostic plots</a></li>
  </ul></li>
  <li><a href="#sec-OR-RR" id="toc-sec-OR-RR" class="nav-link" data-scroll-target="#sec-OR-RR"><span class="header-section-number">3.8</span> Odds Ratios vs Probability (Risk) Ratios</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/d-morrison/rme/edit/main/logistic-regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/rme/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glms.html">Generalized Linear Models</a></li><li class="breadcrumb-item"><a href="./logistic-regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Logistic regression and variations</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Last modified: 2024-04-22: 11:48:17 (AM)</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="acknowledgements" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="acknowledgements">Acknowledgements</h3>
<p>This content is adapted from:</p>
<ul>
<li><span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span>, Chapter 7</li>
<li><span class="citation" data-cites="vittinghoff2012regression">Vittinghoff et al. (<a href="references.html#ref-vittinghoff2012regression" role="doc-biblioref">2012</a>)</span>, Chapter 5</li>
<li><a href="https://dmrocke.ucdavis.edu/Class/EPI204-Spring-2021/EPI204-Spring-2021.html" class="uri">https://dmrocke.ucdavis.edu/Class/EPI204-Spring-2021/EPI204-Spring-2021.html</a></li>
</ul>
</section>
<section id="configuring-r" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="configuring-r">Configuring R</h3>
<p>Functions from these packages will be used throughout this document:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander) <span class="co"># format tables for markdown</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># graphics</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeasy) <span class="co"># help with graphics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># manipulate data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># import Stata files</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) <span class="co"># format R output for markdown</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># Tools to help to create tidy data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly) <span class="co"># interactive graphics</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dobson) <span class="co"># datasets from Dobson and Barnett 2018</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters) <span class="co"># format model output tables for markdown</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted) <span class="co"># check for conflicting function definitions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are some R settings I use in this document:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># delete any data that's already loaded into R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'digits'</span> <span class="ot">=</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="introduction" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">3.1</span> Introduction</h2>
<section id="what-is-logistic-regression" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="what-is-logistic-regression"><span class="header-section-number">3.1.1</span> What is logistic regression?</h3>
<p><strong>Logistic regression</strong> is a framework for modeling <a href="./probability.html#def-binary">binary</a> outcomes, conditional on one or more <em>predictors</em> (a.k.a. <em>covariates</em>).</p>
<div id="exr-binary-examples" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.1 (Examples of binary outcomes)</strong></span> What are some examples of binary outcomes in the health sciences?</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>Examples of binary outcomes include:</p>
<ul>
<li>exposure (exposed vs unexposed)</li>
<li>disease (diseased vs healthy)</li>
<li>recovery (recovered vs unrecovered)</li>
<li>relapse (relapse vs remission)</li>
<li>return to hospital (returned vs not)</li>
<li>vital status (dead vs alive)</li>
</ul>
</div>
</div>
<p>Logistic regression uses the <a href="./probability.html#def-bernoulli">Bernoulli</a> distribution to model the outcome variable, conditional on one or more covariates.</p>
<div id="exr-def-bernoulli" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.2</strong></span> Write down a mathematical definition of the Bernoulli distribution.</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>See <a href="probability.html#def-bernoulli" class="quarto-xref">Definition&nbsp;<span>A.8</span></a>.</p>
</div>
</div>
</section>
<section id="logistic-regression-versus-linear-regression" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="logistic-regression-versus-linear-regression"><span class="header-section-number">3.1.2</span> Logistic regression versus linear regression</h3>
<p>Logistic regression differs from linear regression, which uses the Gaussian (“normal”) distribution to model the outcome variable, conditional on the covariates.</p>
<div id="exr-linear" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.3</strong></span> Recall: what kinds of outcomes is linear regression used for?</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>Linear regression is typically used for numerical outcomes that aren’t event counts or waiting times for an event. Examples of outcomes that are often analyzed using linear regression include include weight, height, and income.</p>
</div>
</div>
</section>
</section>
<section id="risk-estimation-and-prediction" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="risk-estimation-and-prediction"><span class="header-section-number">3.2</span> Risk Estimation and Prediction</h2>
<p>In Epi 203, you have already seen methods for modeling binary outcomes using one covariate that is also binary (such as exposure/non-exposure). In this section, we review one-covariate analyses, with a special focus on risk ratios and odds ratios, which are important concepts for interpreting logistic regression.</p>
<div id="exm-oc-mi" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.1 (Oral Contraceptive Use and Heart Attack)</strong></span> &nbsp;</p>
<ul>
<li>Research question: how does oral contraceptive (OC) use affect the risk of myocardial infarction (MI; a.k.a. heart attack)?</li>
</ul>
<div class="note">
<p>This was an issue when oral contraceptives were first developed, because the original formulations used higher concentrations of hormones. Modern OCs don’t have this issue.</p>
</div>
<p><a href="#tbl-oc-mi" class="quarto-xref">Table&nbsp;<span>3.1</span></a> contains simulated data for an imaginary follow-up (a.k.a. <em>prospective</em>) study in which two groups are identified, one using OCs and another not using OCs, and both groups are tracked for three years to determine how many in each groups have MIs.</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>oc_mi <span class="ot">=</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tribble</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>OC, <span class="sc">~</span>MI, <span class="sc">~</span>Total,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OC use"</span>, <span class="dv">13</span>, <span class="dv">5000</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"No OC use"</span>, <span class="dv">7</span>, <span class="dv">10000</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span> <span class="ot">=</span> Total <span class="sc">-</span> MI) <span class="sc">|&gt;</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, <span class="at">.after =</span> MI)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">=</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  oc_mi <span class="sc">|&gt;</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(MI, <span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, Total), sum)) <span class="sc">|&gt;</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OC =</span> <span class="st">"Total"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>oc_mi <span class="ot">=</span> <span class="fu">bind_rows</span>(oc_mi, totals)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">pander</span>(oc_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-oc-mi" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-oc-mi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: Simulated data from study of oral contraceptive use and heart attack risk
</figcaption>
<div aria-describedby="tbl-oc-mi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 16%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">OC</th>
<th style="text-align: center;">MI</th>
<th style="text-align: center;">No MI</th>
<th style="text-align: center;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">OC use</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">4987</td>
<td style="text-align: center;">5000</td>
</tr>
<tr class="even">
<td style="text-align: center;">No OC use</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">9993</td>
<td style="text-align: center;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Total</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">14980</td>
<td style="text-align: center;">15000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div>
<div id="exr-probs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.4</strong></span> Review: estimate the probabilities of MI for OC users and non-OC users in <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>.</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[\hat{p}(MI|OC) = \frac{13}{5000} = 0.0026\]</span></p>
<p><span class="math display">\[\hat{p}(MI|\neg OC) = \frac{7}{10000} = 7\times 10^{-4}\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Two meanings of “controls”
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on context, “controls” can mean either individuals who don’t experience an <em>exposure</em> of interest, or individuals who don’t experience an <em>outcome</em> of interest.</p>
<div id="def-cases-retrospective" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.1 (cases and controls in retrospective studies)</strong></span> In <em>retrospective studies</em>, participants who experience the outcome of interest are called <strong>cases</strong>, while participants who don’t experience that outcome are called <strong>controls</strong>.</p>
</div>
<div id="def-cases-prospective" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.2 (treatment groups and control groups in prospective studies)</strong></span> In <em>prospective studies</em>, the group of participants who experience the treatment or exposure of interest is called the <strong>treatment group</strong>, while the participants who receive the baseline or comparison treatment (for example, clinical trial participants who receive a placebo or a standard-of-care treatment rather than an experimental treatment) are called <strong>controls</strong>.</p>
</div>
</div>
</div>
<section id="comparing-probabilities" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="comparing-probabilities"><span class="header-section-number">3.2.1</span> Comparing probabilities</h3>
<section id="risk-differences" class="level4">
<h4 class="anchored" data-anchor-id="risk-differences">Risk differences</h4>
<p>The simplest comparison of two probabilities, <span class="math inline">\(\pi_1\)</span>, and <span class="math inline">\(\pi_2\)</span>, is the difference of their values:</p>
<div class="columns">
<div id="def-RD" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.3 (Risk difference)</strong></span> The <strong>risk difference</strong> of two probabilities, <span class="math inline">\(\pi_1\)</span>, and <span class="math inline">\(\pi_2\)</span>, is the difference of their values: <span class="math display">\[\delta(\pi_1,\pi_2) \stackrel{\text{def}}{=}\pi_1 - \pi_2\]</span></p>
</div><div id="exm-RD" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.2</strong></span> In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, the estimated risk difference in MI risk between OC users and OC non-users is:</p>
<p><span class="math display">\[
\begin{aligned}
\hat\delta(\pi(OC), \pi(\neg OC))
&amp;= \delta(\hat\pi(OC), \hat\pi(\neg OC))\\
&amp;= \hat\pi(OC) - \hat\pi(\neg OC)\\
&amp;= 0.0026 - 7\times 10^{-4}\\
&amp;= 0.0019
\end{aligned}
\]</span></p>
</div>
</div>
</section>
<section id="risk-ratios" class="level4">
<h4 class="anchored" data-anchor-id="risk-ratios">Risk ratios</h4>
<div class="columns">
<div id="def-RR" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.4 (Relative risk ratios)</strong></span> The <strong>relative risk</strong> of probability <span class="math inline">\(\pi_1\)</span> compared to another probability <span class="math inline">\(\pi_2\)</span>, also called the <strong>risk ratio</strong>, <strong>relative risk ratio</strong>, <strong>probability ratio</strong>, or <strong>rate ratio</strong>, is the ratio of those probabilities:</p>
<p><span class="math display">\[\rho(\pi_1,\pi_2) = \frac{\pi_1}{\pi_2}\]</span></p>
</div><div id="exm-RR" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.3</strong></span> Above, we estimated that: <span class="math display">\[\hat{p}(MI|OC) = 0.0026\]</span></p>
<p><span class="math display">\[\hat{p}(MI|\neg OC) = 7\times 10^{-4}\]</span></p>
<p>So we might estimate that the <em>relative risk</em> of MI for OC versus non-OC is:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">=</span> (<span class="dv">13</span><span class="sc">/</span><span class="dv">5000</span>)<span class="sc">/</span>(<span class="dv">7</span><span class="sc">/</span><span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{aligned}
\hat\rho(OC, \neg OC)
&amp;=\frac{\hat{p}(MI|OC)}{\hat{p}(MI|\neg OC)}\\
&amp;= \frac{0.0026}{7\times 10^{-4}}\\
&amp;= 3.71428571
\end{aligned}
\]</span></p>
<p>We might summarize this result by saying that “the estimated probability of MI among OC users was 3.71428571 as high as the estimated probability among OC non-users.</p>
</div>
</div>
<p>Sometimes, we divide the risk difference by the comparison probability, or equivalently, subtract 1 from the risk ratio; the result is called the <strong>relative risk difference</strong>:</p>
<p><span class="math display">\[
\begin{aligned}
\xi(\pi_1,\pi_2)
&amp;= \frac{\pi_1-\pi_2}{\pi_2}\\
&amp;= \frac{\pi_1}{\pi_2} - 1
\end{aligned}\]</span></p>
<p>Risk differences, risk ratios, and relative risk differences are defined by two probabilities, plus a choice of which probability is the <strong>baseline</strong> or <strong>reference</strong> probability (i.e., which probability is the subtrahend of the risk difference or the denominator of the risk ratio). To switch which one is the reference probability, invert the ratio and multiply the difference by -1.</p>
<div id="exm-ref" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.4</strong></span> Above, we estimated that the risk ratio of OC versus non-OC is:</p>
<p><span class="math display">\[
\begin{aligned}
\rho(OC, \neg OC)
&amp;= 3.71428571
\end{aligned}
\]</span></p>
<p>In comparison, the risk ratio for non-OC versus OC is:</p>
<p><span class="math display">\[
\begin{aligned}
\rho(\neg OC, OC)
&amp;=\frac{\hat{p}(MI|\neg OC)}{\hat{p}(MI|OC)}\\
&amp;= \frac{7\times 10^{-4}}{0.0026}\\
&amp;= 0.26923077\\
&amp;= \frac{1}{\rho(OC, \neg OC)}
\end{aligned}
\]</span></p>
</div>
</section>
</section>
<section id="odds-and-probabilities" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="odds-and-probabilities"><span class="header-section-number">3.2.2</span> Odds and probabilities</h3>
<p>In logistic regression, we will make use of a transformation (rescaling) of probability, called <em>odds</em>.</p>
<div id="def-odds" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.5 (Odds)</strong></span> The <strong>odds</strong> of an outcome, denoted <span class="math inline">\(\omega\)</span> (“omega”), is the probability that the outcome occurs, divided by the probability that it doesn’t occur.</p>
<p>That is, if the probability of an outcome is <span class="math inline">\(\pi\)</span>, then the corresponding odds of that outcome is</p>
<p><span class="math display">\[\omega(\pi) \stackrel{\text{def}}{=}\frac{\pi}{1-\pi}\]</span></p>
<p>This function, which transforms probabilities into odds, is called the <strong>odds function</strong> (see <span class="quarto-unresolved-ref">?fig-odds-probs</span>).</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">=</span> <span class="cf">function</span>(pi) pi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>pi)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>odds_plot <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> odds, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"odds function"</span>)) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Odds"</span>) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"y=x"</span>)) <span class="sc">+</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(odds_plot) <span class="sc">|&gt;</span>  </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(<span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">'h'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d7a75187fc00fae6c81b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d7a75187fc00fae6c81b">{"x":{"data":[{"x":[0,0.0050000000000000001,0.01,0.014999999999999999,0.02,0.025000000000000001,0.029999999999999999,0.035000000000000003,0.040000000000000001,0.044999999999999998,0.050000000000000003,0.055,0.059999999999999998,0.065000000000000002,0.070000000000000007,0.074999999999999997,0.080000000000000002,0.085000000000000006,0.089999999999999997,0.095000000000000001,0.10000000000000001,0.105,0.11,0.115,0.12,0.125,0.13,0.13500000000000001,0.14000000000000001,0.14499999999999999,0.14999999999999999,0.155,0.16,0.16500000000000001,0.17000000000000001,0.17500000000000002,0.17999999999999999,0.185,0.19,0.19500000000000001,0.20000000000000001,0.20500000000000002,0.20999999999999999,0.215,0.22,0.22500000000000001,0.23000000000000001,0.23500000000000001,0.23999999999999999,0.245,0.25,0.255,0.26000000000000001,0.26500000000000001,0.27000000000000002,0.27500000000000002,0.28000000000000003,0.28500000000000003,0.28999999999999998,0.29499999999999998,0.29999999999999999,0.30499999999999999,0.31,0.315,0.32000000000000001,0.32500000000000001,0.33000000000000002,0.33500000000000002,0.34000000000000002,0.34500000000000003,0.35000000000000003,0.35499999999999998,0.35999999999999999,0.36499999999999999,0.37,0.375,0.38,0.38500000000000001,0.39000000000000001,0.39500000000000002,0.40000000000000002,0.40500000000000003,0.41000000000000003,0.41500000000000004,0.41999999999999998,0.42499999999999999,0.42999999999999999,0.435,0.44,0.44500000000000001,0.45000000000000001,0.45500000000000002,0.46000000000000002,0.46500000000000002,0.47000000000000003,0.47500000000000003,0.47999999999999998,0.48499999999999999,0.48999999999999999,0.495,0.5],"y":[0,0.0050251256281407036,0.010101010101010102,0.015228426395939085,0.020408163265306124,0.025641025641025644,0.030927835051546393,0.036269430051813475,0.041666666666666671,0.04712041884816754,0.052631578947368425,0.058201058201058205,0.063829787234042548,0.069518716577540107,0.075268817204301092,0.081081081081081072,0.086956521739130432,0.092896174863387984,0.098901098901098897,0.10497237569060773,0.11111111111111112,0.11731843575418993,0.12359550561797752,0.12994350282485875,0.13636363636363635,0.14285714285714285,0.14942528735632185,0.15606936416184972,0.16279069767441862,0.16959064327485379,0.17647058823529413,0.18343195266272189,0.19047619047619049,0.19760479041916171,0.20481927710843376,0.21212121212121215,0.21951219512195119,0.22699386503067487,0.23456790123456789,0.24223602484472054,0.25,0.25786163522012584,0.26582278481012656,0.27388535031847133,0.28205128205128205,0.29032258064516131,0.29870129870129869,0.30718954248366015,0.31578947368421051,0.32450331125827814,0.33333333333333331,0.34228187919463088,0.35135135135135137,0.36054421768707484,0.36986301369863017,0.37931034482758624,0.38888888888888895,0.39860139860139865,0.40845070422535212,0.41843971631205668,0.4285714285714286,0.43884892086330929,0.44927536231884063,0.45985401459854014,0.4705882352941177,0.48148148148148145,0.49253731343283591,0.50375939849624063,0.51515151515151525,0.52671755725190839,0.53846153846153855,0.55038759689922478,0.5625,0.57480314960629919,0.58730158730158732,0.59999999999999998,0.61290322580645162,0.6260162601626017,0.63934426229508201,0.65289256198347112,0.66666666666666674,0.68067226890756305,0.69491525423728817,0.70940170940170955,0.72413793103448265,0.73913043478260876,0.7543859649122806,0.76991150442477885,0.7857142857142857,0.80180180180180194,0.81818181818181812,0.83486238532110102,0.85185185185185186,0.8691588785046731,0.8867924528301887,0.90476190476190499,0.92307692307692302,0.9417475728155339,0.96078431372549011,0.98019801980198018,1],"text":"colour: odds function","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"odds function","legendgroup":"odds function","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-0.025000000000000001,0.52500000000000002],"y":[-0.025000000000000001,0.52500000000000002],"text":"intercept: 0<br />slope: 1<br />colour: y=x","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"y=x","legendgroup":"y=x","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":48.949771689497723},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.025000000000000001,0.52500000000000002],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3","0.4","0.5"],"tickvals":[0,0.10000000000000001,0.20000000000000001,0.30000000000000004,0.40000000000000002,0.5],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3","0.4","0.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Probability","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.050000000000000003,1.05],"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.00","0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Odds","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"orientation":"h"},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"74995e92436":{"colour":{},"type":"scatter"},"7499d485842":{"intercept":{},"slope":{},"colour":{}}},"cur_data":"74995e92436","visdat":{"74995e92436":["function (y) ","x"],"7499d485842":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="exm-odds" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.5 (Calculating odds)</strong></span> In <a href="#exr-probs" class="quarto-xref">Exercise&nbsp;<span>3.4</span></a>, we estimated that the probability of MI, given OC use, is <span class="math inline">\(\pi(OC) \stackrel{\text{def}}{=}\Pr(MI|OC) = 0.0026\)</span>. If this estimate is correct, then the odds of MI, given OC use, is:</p>
<p><span class="math display">\[
\begin{aligned}
\omega(OC)
&amp;\stackrel{\text{def}}{=}\frac{\Pr(MI|OC)}{\Pr(\neg MI|OC)}\\
&amp;=\frac{\Pr(MI|OC)}{1-\Pr(MI|OC)}\\
&amp;=\frac{\pi(OC)}{1-\pi(OC)}\\
&amp;=\frac{0.0026}{1-0.0026}\\
&amp;=0.00260678
\end{aligned}
\]</span></p>
</div>
<div id="exr-odds" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.5 (Calculating odds)</strong></span> Estimate the odds of MI, for non-OC users.</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\omega_(\neg OC) = 7.00490343\times 10^{-4}
\]</span></p>
</div>
</div>
<section id="a-shortcut-for-calculating-odds" class="level4">
<h4 class="anchored" data-anchor-id="a-shortcut-for-calculating-odds">A shortcut for calculating odds</h4>
<p>The usual estimate for a probability of an event is “# events/# observations”. We often denote # events as <span class="math inline">\(x\)</span> and # observations as <span class="math inline">\(n\)</span>. So: <span class="math display">\[\hat\pi = \frac{x}{n}\]</span> Thus, the usual estimate for the probability of a nonevent is:</p>
<p><span class="math display">\[
\begin{aligned}
1-\hat\pi
&amp;= 1-\frac{x}{n}\\
&amp;= \frac{n}{n} - \frac{x}{n}\\
&amp;= \frac{n - x}{n}
\end{aligned}
\]</span></p>
<p>Thus, the estimated odds is: <span class="math display">\[
\begin{aligned}
\frac{\hat\pi}{1-\hat\pi}
&amp;= \frac{\left(\frac{x}{n}\right)}{\left(\frac{n-x}{n}\right)}\\
&amp;= \frac{x}{n-x}
\end{aligned}
\]</span> That is, odds can be calculated directly as “# events” divided by “# nonevents” (without needing to calculate <span class="math inline">\(\hat\pi\)</span> and <span class="math inline">\(1-\hat\pi\)</span> first).</p>
<div id="exm-odds-shortcut" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.6 (calculating odds using the shortcut)</strong></span> In <a href="#exm-odds" class="quarto-xref">Example&nbsp;<span>3.5</span></a>, we calculated <span class="math display">\[
\begin{aligned}
\omega(OC)
&amp;=0.00260678
\end{aligned}
\]</span> Let’s recalculate this result using our shortcut:</p>
<p><span class="math display">\[
\begin{aligned}
\omega(OC)
&amp;=\frac{13}{5000-13}\\
&amp;=0.00260678
\end{aligned}
\]</span></p>
<p>Same answer!</p>
</div>
</section>
<section id="odds-of-rare-events" class="level4">
<h4 class="anchored" data-anchor-id="odds-of-rare-events">Odds of rare events</h4>
<p>For rare events (small <span class="math inline">\(\pi\)</span>), odds and probabilities are nearly equal, because <span class="math inline">\(1-\pi \approx 1\)</span> (see <span class="quarto-unresolved-ref">?fig-odds-probs</span>).</p>
<p>For example, in <a href="#exm-odds" class="quarto-xref">Example&nbsp;<span>3.5</span></a>, the probability and odds differ by <span class="math inline">\(6.77762182\times 10^{-6}\)</span>.</p>
<div id="exr-odds-probs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.6</strong></span> What odds value corresponds to the probability <span class="math inline">\(\pi = 0.2\)</span>, and what is the numerical difference between these two values?</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\omega = \frac{\pi}{1-\pi}
=\frac{.2}{.8}
= .25
\]</span></p>
</div>
</div>
</section>
</section>
<section id="the-inverse-odds-function" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="the-inverse-odds-function"><span class="header-section-number">3.2.3</span> The inverse odds function</h3>
<div id="def-inv-odds" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.6 (inverse odds function)</strong></span> The <strong>inverse odds function</strong>, <span class="math display">\[\pi(\omega)\stackrel{\text{def}}{=}\frac{\omega}{1+\omega}\]</span> converts odds into their corresponding probabilities (<a href="#fig-inv-odds" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>).</p>
</div>
<p>The inverse-odds function takes an odds as input and produces a probability as output. Its domain of inputs is <span class="math inline">\([0,\infty)\)</span> and its range of outputs is <span class="math inline">\([0,1]\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>odds_inv <span class="ot">=</span> <span class="cf">function</span>(omega) (<span class="dv">1</span> <span class="sc">+</span> omega<span class="sc">^-</span><span class="dv">1</span>)<span class="sc">^-</span><span class="dv">1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> odds_inv, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"inverse-odds"</span>)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Odds"</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"x=y"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-inv-odds" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-inv-odds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: The inverse odds function, <span class="math inline">\(\pi(\omega)\)</span>
</figcaption>
<div aria-describedby="fig-inv-odds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-inv-odds-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>An equivalent expression for the inverse odds function is <span id="eq-inv-odds-reduced"><span class="math display">\[\pi(\omega) = (1-\omega^{-1})^{-1} \tag{3.1}\]</span></span></p>
</div>
</div>
<div id="exr-inv-odds2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.7</strong></span> Prove that <a href="#eq-inv-odds-reduced" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> is equivalent to <a href="#def-inv-odds" class="quarto-xref">Definition&nbsp;<span>3.6</span></a>.</p>
</div>
<div id="exr-odds-probs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.8</strong></span> What probability corresponds to an odds of <span class="math inline">\(\omega = 1\)</span>, and what is the numerical difference between these two values?</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\pi(1) = \frac{1}{1+1}
=\frac{1}{2}
= .5
\]</span> <span class="math display">\[
1 - \pi(1) = 1 - .5 = .5
\]</span></p>
</div>
</div>
</section>
<section id="odds-ratios" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="odds-ratios"><span class="header-section-number">3.2.4</span> Odds ratios</h3>
<p>Now that we have defined odds, we can introduce another way of comparing event probabilities: odds ratios.</p>
<div id="def-OR" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.7 (Odds ratio)</strong></span> The <strong>odds ratio</strong> for two odds <span class="math inline">\(\omega_1\)</span>, <span class="math inline">\(\omega_2\)</span> is their ratio:</p>
<p><span class="math display">\[\theta(\omega_1, \omega_2) = \frac{\omega_1}{\omega_2}\]</span></p>
</div>
<div id="exm-OR" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.7 (Calculating odds ratios)</strong></span> In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, the odds ratio for OC users versus OC-non-users is:</p>
<p><span class="math display">\[
\begin{aligned}
\theta(\omega(OC), \omega(\neg OC))
&amp;= \frac{\omega(OC)}{\omega(\neg OC)}\\
&amp;= \frac{0.0026}{7\times 10^{-4}}\\
&amp;= 3.71428571\\
\end{aligned}
\]</span></p>
</div>
<p>When the outcome is rare (i.e., its probability is small) for both groups being compared in an odds ratio, the odds of the outcome will be similar to the probability of the outcome, and thus the risk ratio will be similar to the odds ratio.</p>
<p>For example, in <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, the outcome is rare for both OC and non-OC participants, so the odds for both groups are similar to the corresponding probabilities, and the odds ratio is similar the risk ratio.</p>
<section id="a-shortcut-for-calculating-odds-ratio-estimates" class="level4">
<h4 class="anchored" data-anchor-id="a-shortcut-for-calculating-odds-ratio-estimates">A shortcut for calculating odds ratio estimates</h4>
<p>The general form of a two-by-two table is shown in <a href="#tbl-2x2-generic" class="quarto-xref">Table&nbsp;<span>3.2</span></a>.</p>
<div id="tbl-2x2-generic" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-2x2-generic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.2: A generic 2x2 table
</figcaption>
<div aria-describedby="tbl-2x2-generic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Event</th>
<th>Non-Event</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Exposed</td>
<td>a</td>
<td>b</td>
<td>a+b</td>
</tr>
<tr class="even">
<td>Non-exposed</td>
<td>c</td>
<td>d</td>
<td>c+d</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>a+c</td>
<td>b+d</td>
<td>a+b+c+d</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>From this table, we have:</p>
<ul>
<li><p><span class="math inline">\(\hat\pi(Event|Exposed) = a/(a+b)\)</span></p></li>
<li><p><span class="math inline">\(\hat\pi(\neg Event|Exposed) = b/(a+b)\)</span></p></li>
<li><p><span class="math inline">\(\hat\omega(Event|Exposed) = \frac{\left(\frac{a}{a+b}\right)}{\left(\frac{b}{a+b}\right)}=\frac{a}{b}\)</span></p></li>
<li><p><span class="math inline">\(\hat\omega(Event|\neg Exposed) = \frac{c}{d}\)</span> (see <a href="#exr-odds-generic" class="quarto-xref">Exercise&nbsp;<span>3.9</span></a>)</p></li>
<li><p><span class="math inline">\(\theta(Exposed,\neg Exposed) = \frac{\frac{a}{b}}{\frac{c}{d}} = \frac{ad}{bc}\)</span></p></li>
</ul>
<div id="exr-odds-generic" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.9</strong></span> Given <a href="#tbl-2x2-generic" class="quarto-xref">Table&nbsp;<span>3.2</span></a>, show that <span class="math inline">\(\hat\omega(Event|\neg Exposed) = \frac{c}{d}\)</span>.</p>
</div>
</section>
<section id="sec-OR-props" class="level4">
<h4 class="anchored" data-anchor-id="sec-OR-props">Properties of odds ratios</h4>
<p>Odds ratios have a special property: we can swap a covariate with the outcome, and the odds ratio remains the same.</p>
<div id="exm-or-inv-MI" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.8</strong></span> In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, we have:</p>
<p><span class="math display">\[
\begin{aligned}
\theta(MI; OC)
&amp;\stackrel{\text{def}}{=}
\frac{\omega(MI|OC)}{\omega(MI|\neg OC)}\\
&amp;\stackrel{\text{def}}{=}\frac
{\left(\frac{\Pr(MI|OC)}{\Pr(\neg MI|OC)}\right)}
{\left(\frac{\Pr(MI|\neg OC)}{\Pr(\neg MI|\neg OC)}\right)}\\
&amp;= \frac
{\left(\frac{\Pr(MI,OC)}{\Pr(\neg MI,OC)}\right)}
{\left(\frac{\Pr(MI,\neg OC)}{\Pr(\neg MI,\neg OC)}\right)}\\
&amp;= \left(\frac{\Pr(MI,OC)}{\Pr(\neg MI,OC)}\right)
\left(\frac{\Pr(\neg MI,\neg OC)}{\Pr(MI,\neg OC)}\right)\\
&amp;= \left(\frac{\Pr(MI,OC)}{\Pr(MI,\neg OC)}\right)
\left(\frac{\Pr(\neg MI,\neg OC)}{\Pr(\neg MI,OC)}\right)\\
&amp;= \left(\frac{\Pr(OC,MI)}{\Pr(\neg OC,MI)}\right)
\left(\frac{\Pr(\neg OC,\neg MI)}{\Pr(OC,\neg MI)}\right)\\
&amp;= \left(\frac{\Pr(OC|MI)}{\Pr(\neg OC|MI)}\right)
\left(\frac{\Pr(\neg OC|\neg MI)}{\Pr(OC|\neg MI)}\right)\\
&amp;= \frac{\left(\frac{\Pr(OC|MI)}{\Pr(\neg OC|MI)}\right)}
{\left(\frac{\Pr(OC|\neg MI)}{\Pr(\neg OC|\neg MI)}\right)}\\
&amp;\stackrel{\text{def}}{=}\frac{\omega(OC|MI)}
{\omega(OC|\neg MI)}\\
&amp;\stackrel{\text{def}}{=}\theta(OC; MI)
\end{aligned}
\]</span></p>
</div>
<div id="exr-2x2-generic" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.10</strong></span> For <a href="#tbl-2x2-generic" class="quarto-xref">Table&nbsp;<span>3.2</span></a>, show that <span class="math inline">\(\hat\theta(Exposed, Unexposed) = \hat\theta(Event, \neg Event)\)</span>.</p>
</div>
</section>
</section>
<section id="effect-of-study-design" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="effect-of-study-design"><span class="header-section-number">3.2.5</span> Effect of study design</h3>
<p><a href="#tbl-oc-mi" class="quarto-xref">Table&nbsp;<span>3.1</span></a> simulates a follow-up study in which two populations were followed and the number of MI’s was observed. The risks are <span class="math inline">\(P(MI|OC)\)</span> and <span class="math inline">\(P(MI|\neg OC)\)</span> and we can estimate these risks from the data.</p>
<p>But suppose we had a case-control study in which we had 100 women with MI and selected a comparison group of 100 women without MI (matched as groups on age, etc.). Then MI is not random, and we cannot compute P(MI|OC) and we cannot compute the risk ratio. However, the odds ratio however can be computed.</p>
<p>The disease odds ratio is the odds for the disease in the exposed group divided by the odds for the disease in the unexposed group, and we cannot validly compute and use these separate parts.</p>
<p>But we can validly compute and use the exposure odds ratio, which is the odds for exposure in the disease group divided by the odds for exposure in the non-diseased group (because exposure can be treated as random):</p>
<p><span class="math display">\[
\hat\theta(OC|MI) =
\frac{\hat{\omega}(OC|MI)}{\hat{\omega}(OC|\neg MI)}
\]</span></p>
<p>And these two odds ratios, <span class="math inline">\(\hat\theta(MI|OC)\)</span> and <span class="math inline">\(\hat\theta(OC|MI)\)</span> are mathematically equivalent, as we saw in <a href="#sec-OR-props" class="quarto-xref"><span>Section 3.2.4.2</span></a>.</p>
<div id="exr-or-rev" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.11</strong></span> Calculate the odds ratio of MI with respect to OC use, assuming that <a href="#tbl-oc-mi" class="quarto-xref">Table&nbsp;<span>3.1</span></a> comes from a case-control study. Confirm that the result is the same as in <a href="#exm-OR" class="quarto-xref">Example&nbsp;<span>3.7</span></a>.</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span></p>
<ul>
<li><p><span class="math inline">\(\omega(OC|MI) = P(OC|MI)/(1 – P(OC|MI) = \frac{13}{7} = 1.85714286\)</span></p></li>
<li><p><span class="math inline">\(\omega(OC|\neg MI) = P(OC|\neg MI)/(1 – P(OC|\neg MI) = \frac{4987}{9993} = 0.49904933\)</span></p></li>
<li><p><span class="math inline">\(\theta(OC,MI) = \frac{\omega(OC|MI)}{\omega(OC|\neg MI)} = \frac{13/7}{4987/9993} = 3.72136125\)</span></p></li>
</ul>
<p>This is the same estimate we calculated in <a href="#exm-OR" class="quarto-xref">Example&nbsp;<span>3.7</span></a>.</p>
</div>
</div>
<section id="cross-sectional-studies" class="level4">
<h4 class="anchored" data-anchor-id="cross-sectional-studies">Cross-Sectional Studies</h4>
<ul>
<li><p>If a cross-sectional study is a probability sample of a population (which it rarely is) then we can estimate risks.</p></li>
<li><p>If it is a sample, but not an unbiased probability sample, then we need to treat it in the same way as a case-control study.</p></li>
<li><p>We can validly estimate odds ratios in either case.</p></li>
<li><p>But we can usually not validly estimate risks and risk ratios.</p></li>
</ul>
</section>
</section>
</section>
<section id="introduction-to-logistic-regression" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="introduction-to-logistic-regression"><span class="header-section-number">3.3</span> Introduction to logistic regression</h2>
<ul>
<li><p>In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, we estimated the risk and the odds of MI for two discrete cases, as to whether of not the individual used oral contraceptives.</p></li>
<li><p>If the predictor is quantitative (dose) or there is more than one predictor, the task becomes more difficult.</p></li>
<li><p>In this case, we will use logistic regression, which is a generalization of the linear regression models you have been using that can account for a binary response instead of a continuous one.</p></li>
</ul>
<section id="binary-outcomes-models---one-group-no-covariates" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="binary-outcomes-models---one-group-no-covariates"><span class="header-section-number">3.3.1</span> Binary outcomes models - one group, no covariates</h3>
<p><span class="math display">\[
\begin{aligned}
p(Y=1) &amp;= \pi\\
p(Y=0) &amp;= 1-\pi\\
p(Y=y) &amp;= \pi^y (1-\pi)^{1-y}\\
\mathbf y  &amp;= (y_1, ..., y_n)\\
\mathcal L(\pi;\mathbf y) &amp;= \pi^{\sum y_i} (1-\pi)^{n - \sum y_i}\\
\ell(\pi, \mathbf y) &amp;= \left({\sum y_i}\right) \text{log}\left\{\pi\right\} + \left(n - \sum y_i\right) \text{log}\left\{1-\pi\right\}\\
&amp;= \left({\sum y_i}\right) \left(\text{log}\left\{\pi\right\} - \text{log}\left\{1-\pi\right\}\right) + n \cdot \text{log}\left\{1-\pi\right\}\\
&amp;= \left({\sum y_i}\right) \text{log}\left\{\frac{\pi}{ 1-\pi}\right\} + n \cdot \text{log}\left\{1-\pi\right\}
\end{aligned}
\]</span></p>
</section>
<section id="binary-outcomes---general" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="binary-outcomes---general"><span class="header-section-number">3.3.2</span> Binary outcomes - general</h3>
<p><span class="math display">\[
\begin{aligned}
p(Y_i=1) &amp;= \pi_i\\
p(Y_i=0) &amp;= 1-\pi_i\\
p(Y_i=y) &amp;= (\pi_i)^y (1-\pi_i)^{1-y}\\
\mathbf y  &amp;= (y_1, ..., y_n)\\
\mathcal L(\pi;\mathbf y) &amp;= \prod_{i=1}^n
(\pi_i)^{y_i} (1-\pi_i)^{1 - y_i}\\
\ell(\pi, \mathbf y) &amp;=
\sum_{i=1}^n
y_i \text{log}\left\{\pi_i\right\} + (1 - y_i) \text{log}\left\{1-\pi_i\right\}
\end{aligned}
\]</span></p>
</section>
<section id="modeling-pi_i-as-a-function-of-x_i" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="modeling-pi_i-as-a-function-of-x_i"><span class="header-section-number">3.3.3</span> Modeling <span class="math inline">\(\pi_i\)</span> as a function of <span class="math inline">\(X_i\)</span></h3>
<p>If there are only a few distinct <span class="math inline">\(X_i\)</span> values, we can model each one separately.</p>
<p>Otherwise, we need regression.</p>
<p><span class="math display">\[
\begin{aligned}
\pi(x) &amp;\equiv \text{E}(Y=1|X=x)\\
&amp;= f(x^\top\beta)
\end{aligned}
\]</span></p>
<p>Typically, we use <span class="math inline">\(f(\eta) = \text{expit}(\eta)\)</span>.</p>
<div id="def-expit" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.8 (expit function)</strong></span> The <strong>expit</strong> function (<a href="#fig-expit-plot" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>), also known as the <strong>inverse-logit</strong> or <strong>logistic</strong> function, is:</p>
<p><span class="math display">\[
\begin{aligned}
\text{expit}(\eta)
&amp;\stackrel{\text{def}}{=}\frac{\text{exp}\left\{\eta\right\}}{1+\text{exp}\left\{\eta\right\}}\\
&amp;= (1 + \text{exp}\left\{-\eta\right\})^{-1}
\end{aligned}
\]</span></p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>expit <span class="ot">=</span> <span class="cf">function</span>(eta) <span class="fu">exp</span>(eta)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(eta))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>expit_plot <span class="ot">=</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> expit) <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">expit</span>(eta))) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(eta)) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expit_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-expit-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-expit-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: The expit function
</figcaption>
<div aria-describedby="fig-expit-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-expit-plot-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
<div id="def-logit" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.9 (logit function)</strong></span> The inverse of the <code>expit</code> function is the <code>logit</code> function:</p>
<p><span class="math display">\[g(p) = f^{-1}(p) = \text{logit}(p) = \text{log}\left\{\frac{p}{1-p}\right\}\]</span></p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">=</span> <span class="cf">function</span>(p) <span class="fu">log</span>(<span class="fu">odds</span>(p))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>logit_plot <span class="ot">=</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> logit) <span class="sc">+</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(.<span class="dv">01</span>, .<span class="dv">99</span>) <span class="sc">+</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"logit(p)"</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"p"</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(logit_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-logit" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: the logit function
</figcaption>
<div aria-describedby="fig-logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-logit-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-expit-logit-diagram" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="sec-expit-logit-diagram"><span class="header-section-number">3.3.4</span> Diagram of expit and logit</h3>
<p><span class="math display">\[
\underbrace{\pi}_{\atop{\Pr(Y=1)} }
\overbrace{
\underbrace{
\underset{
\xleftarrow[\frac{\omega}{1+\omega}]{}
}
{
\xrightarrow{\frac{\pi}{1-\pi}}
}
\underbrace{\omega}_{\text{odds}(Y=1)}
\underset{
\xleftarrow[\text{exp}\left\{\eta\right\}]{}
}
{
\xrightarrow{\text{log}\left\{\omega\right\}}
}
}_{\text{expit}(\eta)}
}^{\text{logit}(\pi)}
\underbrace{\eta}_{\atop{\text{log-odds}(Y=1)}}
\]</span></p>
</section>
<section id="meet-the-beetles" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="meet-the-beetles"><span class="header-section-number">3.3.5</span> Meet the beetles</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmx)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(BeetleMortality, <span class="at">package =</span> <span class="st">"glmx"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>beetles <span class="ot">=</span> BeetleMortality <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct =</span> died<span class="sc">/</span>n,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">survived =</span> n <span class="sc">-</span> died</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">=</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Dose (log mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mortality rate (%)"</span>) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Mortality rates of adult flour beetles after five hours’ exposure to gaseous carbon disulphide (Bliss 1935)</p>
</section>
<section id="why-dont-we-use-linear-regression" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="why-dont-we-use-linear-regression"><span class="header-section-number">3.3.6</span> Why don’t we use linear regression?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">=</span> beetles <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(<span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">=</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  beetles  <span class="sc">|&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died), </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived))</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> dose, </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">=</span> </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  beetles  <span class="sc">|&gt;</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died), </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> <span class="fu">log</span>(dose), </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>range1 <span class="ot">=</span> <span class="fu">range</span>(beetles<span class="sc">$</span>dose) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, .<span class="dv">2</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(beetles_glm_grouped, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>f.linear <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>f.linearlog <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">=</span> </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">+</span> </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> f.linear, </span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Straight line"</span>)) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">"Model"</span>, <span class="at">size =</span> <span class="st">""</span>)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>plot2 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="zoom-out" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="zoom-out"><span class="header-section-number">3.3.7</span> Zoom out</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(plot2 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="log-transformation-of-dose" class="level3" data-number="3.3.8">
<h3 data-number="3.3.8" class="anchored" data-anchor-id="log-transformation-of-dose"><span class="header-section-number">3.3.8</span> log transformation of dose?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">=</span> plot2 <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> f.linearlog, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Log-transform dose"</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>(plot3 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="logistic-regression" class="level3" data-number="3.3.9">
<h3 data-number="3.3.9" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">3.3.9</span> Logistic regression</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">=</span> plot3 <span class="sc">+</span> <span class="fu">geom_function</span>(<span class="at">fun =</span> f, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Logistic regression"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="three-parts-to-regression-models" class="level3" data-number="3.3.10">
<h3 data-number="3.3.10" class="anchored" data-anchor-id="three-parts-to-regression-models"><span class="header-section-number">3.3.10</span> Three parts to regression models</h3>
<ul>
<li><p>What distribution does the outcome have for a specific subpopulation defined by covariates? (outcome model)</p></li>
<li><p>How does the combination of covariates relate to the mean? (link function)</p></li>
<li><p>How do the covariates combine? (linear predictor, interactions)</p></li>
</ul>
</section>
<section id="logistic-regression-in-r" class="level3" data-number="3.3.11">
<h3 data-number="3.3.11" class="anchored" data-anchor-id="logistic-regression-in-r"><span class="header-section-number">3.3.11</span> Logistic regression in R</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">=</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-60.72</td>
<td style="text-align: center;">5.18</td>
<td style="text-align: center;">(-71.44, -51.08)</td>
<td style="text-align: center;">-11.72</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dose</td>
<td style="text-align: center;">34.27</td>
<td style="text-align: center;">2.91</td>
<td style="text-align: center;">(28.85, 40.30)</td>
<td style="text-align: center;">11.77</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Fitted values:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted.values</span>(beetles_glm_grouped)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1      2      3      4      5      6      7      8 </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.0586 0.1640 0.3621 0.6053 0.7952 0.9032 0.9552 0.9790</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1      2      3      4      5      6      7      8 </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.0586 0.1640 0.3621 0.6053 0.7952 0.9032 0.9552 0.9790</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"link"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       1       2       3       4       5       6       7       8 </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -2.7766 -1.6286 -0.5662  0.4277  1.3564  2.2337  3.0596  3.8444</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>fit_y <span class="ot">=</span> beetles<span class="sc">$</span>n <span class="sc">*</span> <span class="fu">fitted.values</span>(beetles_glm_grouped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="individual-observations" class="level3" data-number="3.3.12">
<h3 data-number="3.3.12" class="anchored" data-anchor-id="individual-observations"><span class="header-section-number">3.3.12</span> Individual observations</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>beetles_long <span class="ot">=</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  beetles  <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died), </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>beetles_long <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 481 × 6</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     dose  died     n   pct survived outcome</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;    &lt;int&gt;   &lt;dbl&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  1.69     6    59 0.102       53       1</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  1.69     6    59 0.102       53       1</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  1.69     6    59 0.102       53       1</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  1.69     6    59 0.102       53       1</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  1.69     6    59 0.102       53       1</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  1.69     6    59 0.102       53       1</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  1.69     6    59 0.102       53       0</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  1.69     6    59 0.102       53       0</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  1.69     6    59 0.102       53       0</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  1.69     6    59 0.102       53       0</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 471 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here’s the model with individual data</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="ot">=</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  beetles_long <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> dose, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-60.72</td>
<td style="text-align: center;">5.18</td>
<td style="text-align: center;">(-71.44, -51.08)</td>
<td style="text-align: center;">-11.72</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dose</td>
<td style="text-align: center;">34.27</td>
<td style="text-align: center;">2.91</td>
<td style="text-align: center;">(28.85, 40.30)</td>
<td style="text-align: center;">11.77</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here’s the previous version again:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-60.72</td>
<td style="text-align: center;">5.18</td>
<td style="text-align: center;">(-71.44, -51.08)</td>
<td style="text-align: center;">-11.72</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dose</td>
<td style="text-align: center;">34.27</td>
<td style="text-align: center;">2.91</td>
<td style="text-align: center;">(28.85, 40.30)</td>
<td style="text-align: center;">11.77</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>They seem the same! But not quite:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_grouped)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 'log Lik.' -18.72 (df=2)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_ungrouped)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 'log Lik.' -186.2 (df=2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The difference is due to the binomial coefficient <span class="math inline">\(\left(n\atop x \right)\)</span> which isn’t included in the individual-observations (Bernoulli) version of the model.</p>
</section>
</section>
<section id="multiple-logistic-regression" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="multiple-logistic-regression"><span class="header-section-number">3.4</span> Multiple logistic regression</h2>
<section id="coronary-heart-disease-wcgs-study-data" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="coronary-heart-disease-wcgs-study-data"><span class="header-section-number">3.4.1</span> Coronary heart disease (WCGS) study data</h3>
<p>Let’s use the data from the following study to explore multiple logistic regression:</p>
<section id="summary-of-study" class="level4">
<h4 class="anchored" data-anchor-id="summary-of-study">Summary of study</h4>
<p><em>From <span class="citation" data-cites="vittinghoff2012regression">Vittinghoff et al. (<a href="references.html#ref-vittinghoff2012regression" role="doc-biblioref">2012</a>)</span>:</em></p>
<p>“The <strong>Western Collaborative Group Study (WCGS)</strong> was a large epidemiological study designed to investigate the association between the”type A” behavior pattern and coronary heart disease (CHD) (Rosenman et al.&nbsp;1964).”</p>
<p><em>From Wikipedia, “Type A and Type B personality theory”:</em></p>
<p>“The hypothesis describes Type A individuals as outgoing, ambitious, rigidly organized, highly status-conscious, impatient, anxious, proactive, and concerned with time management….</p>
<p>The hypothesis describes Type B individuals as a contrast to those of Type A. Type B personalities, by definition, are noted to live at lower stress levels. They typically work steadily and may enjoy achievement, although they have a greater tendency to disregard physical or mental stress when they do not achieve.”</p>
</section>
<section id="study-design" class="level4">
<h4 class="anchored" data-anchor-id="study-design">Study design</h4>
<p><em>from <code>?faraway::wcgs</code>:</em></p>
<p>3154 healthy young men aged 39-59 from the San Francisco area were assessed for their personality type. All were free from coronary heart disease at the start of the research. Eight and a half years later change in CHD status was recorded.</p>
<p><em>Details (from <code>faraway::wcgs</code>)</em></p>
<p>The WCGS began in 1960 with 3,524 male volunteers who were employed by 11 California companies. Subjects were 39 to 59 years old and free of heart disease as determined by electrocardiogram. After the initial screening, the study population dropped to 3,154 and the number of companies to 10 because of various exclusions. The cohort comprised both blue- and white-collar employees.</p>
<p>At baseline the following information was collected:</p>
<ul>
<li>socio-demographic including:</li>
<li>age</li>
<li>education</li>
<li>marital status</li>
<li>income</li>
<li>occupation</li>
<li>physical and physiological including:</li>
<li>height</li>
<li>weight</li>
<li>blood pressure</li>
<li>electrocardiogram</li>
<li>corneal arcus;</li>
<li>biochemical including:</li>
<li>cholesterol and lipoprotein fractions;</li>
<li>medical and family history and use of medications;</li>
<li>behavioral data including</li>
<li>Type A interview,</li>
<li>smoking,</li>
<li>exercise</li>
<li>alcohol use.</li>
</ul>
<p>Later surveys added data on:</p>
<ul>
<li>anthropometry</li>
<li>triglycerides</li>
<li>Jenkins Activity Survey</li>
<li>caffeine use</li>
</ul>
<p>Average follow-up continued for 8.5 years with repeat examinations.</p>
<p>Reference: Coronary Heart Disease in the Western Collaborative Group Study Final Follow-up Experience of 8 1/2 Years Ray H. Rosenman, MD; Richard J. Brand, PhD; C. David Jenkins, PhD; Meyer Friedman, MD; Reuben Straus, MD; Moses Wurm, MD JAMA. 1975;233(8):872-877. doi:10.1001/jama.1975.03260080034016.</p>
</section>
</section>
<section id="load-the-data" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="load-the-data"><span class="header-section-number">3.4.2</span> Load the data</h3>
<p>Here, I load the data:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">### load the data directly from a UCSF website:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(haven)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># url = paste0( </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     # I'm breaking up the url into two chunks for readability</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     "https://regression.ucsf.edu/sites/g/files/",</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     "tkssra6706/f/wysiwyg/home/data/wcgs.dta")</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># wcgs = haven::read_dta(url)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># I presaved the data in my project's `data` folder</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># provides the `here()` function</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs) <span class="co"># provides the `path()` function</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">here</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  fs<span class="sc">::</span><span class="fu">path</span>(<span class="st">'data/wcgs.rda'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="now-lets-do-some-data-cleaning" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="now-lets-do-some-data-cleaning"><span class="header-section-number">3.4.3</span> Now let’s do some data cleaning</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arsenal) <span class="co"># provides `set_labels()`</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">=</span> wcgs <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> age <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Age (years)"</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">arcus =</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      arcus <span class="sc">|&gt;</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.logical</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Arcus Senilis"</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">time169 =</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      time169 <span class="sc">|&gt;</span> </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Observation (follow up) time (days)"</span>),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">dibpat =</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      dibpat <span class="sc">|&gt;</span> </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_factor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">relevel</span>(<span class="at">ref =</span> <span class="st">"Type A"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Behavioral Pattern"</span>),</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">typchd69 =</span> typchd69 <span class="sc">|&gt;</span> </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Type of CHD Event"</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"None"</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infdeath"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"silent"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"angina"</span> <span class="ot">=</span> <span class="dv">3</span>)),</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># turn stata-style labelled variables in to R-style factors:</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">where</span>(is.labelled), </span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>      haven<span class="sc">::</span>as_factor)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="whats-in-the-data" class="level3 smaller" data-number="3.4.4">
<h3 class="smaller anchored" data-number="3.4.4" data-anchor-id="whats-in-the-data"><span class="header-section-number">3.4.4</span> What’s in the data</h3>
<p>Here’s a table of the data:</p>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(id, uni, t1)) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tableby</span>(chd69 <span class="sc">~</span> ., <span class="at">data =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfootnote =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Baseline characteristics by CHD status at end of follow-up"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table">
<caption>Baseline characteristics by CHD status at end of follow-up</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">No (N=2897)</th>
<th style="text-align: center;">Yes (N=257)</th>
<th style="text-align: center;">Total (N=3154)</th>
<th style="text-align: right;">p value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Age (years)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">46.082 (5.457)</td>
<td style="text-align: center;">48.490 (5.801)</td>
<td style="text-align: center;">46.279 (5.524)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">39.000 - 59.000</td>
<td style="text-align: center;">39.000 - 59.000</td>
<td style="text-align: center;">39.000 - 59.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Arcus Senilis</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;N-Miss</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;FALSE</td>
<td style="text-align: center;">2058 (71.0%)</td>
<td style="text-align: center;">153 (60.0%)</td>
<td style="text-align: center;">2211 (70.1%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;TRUE</td>
<td style="text-align: center;">839 (29.0%)</td>
<td style="text-align: center;">102 (40.0%)</td>
<td style="text-align: center;">941 (29.9%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Behavioral Pattern</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;A1</td>
<td style="text-align: center;">234 (8.1%)</td>
<td style="text-align: center;">30 (11.7%)</td>
<td style="text-align: center;">264 (8.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;A2</td>
<td style="text-align: center;">1177 (40.6%)</td>
<td style="text-align: center;">148 (57.6%)</td>
<td style="text-align: center;">1325 (42.0%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;B3</td>
<td style="text-align: center;">1155 (39.9%)</td>
<td style="text-align: center;">61 (23.7%)</td>
<td style="text-align: center;">1216 (38.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;B4</td>
<td style="text-align: center;">331 (11.4%)</td>
<td style="text-align: center;">18 (7.0%)</td>
<td style="text-align: center;">349 (11.1%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Body Mass Index (kg/m2)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">24.471 (2.561)</td>
<td style="text-align: center;">25.055 (2.579)</td>
<td style="text-align: center;">24.518 (2.567)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">11.191 - 37.653</td>
<td style="text-align: center;">19.225 - 38.947</td>
<td style="text-align: center;">11.191 - 38.947</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total Cholesterol</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;N-Miss</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">12</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">224.261 (42.217)</td>
<td style="text-align: center;">250.070 (49.396)</td>
<td style="text-align: center;">226.372 (43.420)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">103.000 - 400.000</td>
<td style="text-align: center;">155.000 - 645.000</td>
<td style="text-align: center;">103.000 - 645.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Diastolic Blood Pressure</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">81.723 (9.621)</td>
<td style="text-align: center;">85.315 (10.311)</td>
<td style="text-align: center;">82.016 (9.727)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">58.000 - 150.000</td>
<td style="text-align: center;">64.000 - 122.000</td>
<td style="text-align: center;">58.000 - 150.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Behavioral Pattern</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Type A</td>
<td style="text-align: center;">1411 (48.7%)</td>
<td style="text-align: center;">178 (69.3%)</td>
<td style="text-align: center;">1589 (50.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Type B</td>
<td style="text-align: center;">1486 (51.3%)</td>
<td style="text-align: center;">79 (30.7%)</td>
<td style="text-align: center;">1565 (49.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Height (inches)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">0.290<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">69.764 (2.539)</td>
<td style="text-align: center;">69.938 (2.410)</td>
<td style="text-align: center;">69.778 (2.529)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">60.000 - 78.000</td>
<td style="text-align: center;">63.000 - 77.000</td>
<td style="text-align: center;">60.000 - 78.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Ln of Systolic Blood Pressure</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">4.846 (0.110)</td>
<td style="text-align: center;">4.900 (0.125)</td>
<td style="text-align: center;">4.850 (0.112)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">4.585 - 5.438</td>
<td style="text-align: center;">4.605 - 5.298</td>
<td style="text-align: center;">4.585 - 5.438</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Ln of Weight</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">5.126 (0.123)</td>
<td style="text-align: center;">5.155 (0.118)</td>
<td style="text-align: center;">5.128 (0.123)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">4.357 - 5.670</td>
<td style="text-align: center;">4.868 - 5.768</td>
<td style="text-align: center;">4.357 - 5.768</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Cigarettes per day</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">11.151 (14.329)</td>
<td style="text-align: center;">16.665 (15.657)</td>
<td style="text-align: center;">11.601 (14.518)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">0.000 - 99.000</td>
<td style="text-align: center;">0.000 - 60.000</td>
<td style="text-align: center;">0.000 - 99.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Systolic Blood Pressure</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">128.034 (14.746)</td>
<td style="text-align: center;">135.385 (17.473)</td>
<td style="text-align: center;">128.633 (15.118)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">98.000 - 230.000</td>
<td style="text-align: center;">100.000 - 200.000</td>
<td style="text-align: center;">98.000 - 230.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Current smoking</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;No</td>
<td style="text-align: center;">1554 (53.6%)</td>
<td style="text-align: center;">98 (38.1%)</td>
<td style="text-align: center;">1652 (52.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Yes</td>
<td style="text-align: center;">1343 (46.4%)</td>
<td style="text-align: center;">159 (61.9%)</td>
<td style="text-align: center;">1502 (47.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Observation (follow up) time (days)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">2775.158 (562.205)</td>
<td style="text-align: center;">1654.700 (859.297)</td>
<td style="text-align: center;">2683.859 (666.524)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">238.000 - 3430.000</td>
<td style="text-align: center;">18.000 - 3229.000</td>
<td style="text-align: center;">18.000 - 3430.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Type of CHD Event</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;None</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;infdeath</td>
<td style="text-align: center;">2897 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">2897 (91.9%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;silent</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">135 (52.5%)</td>
<td style="text-align: center;">135 (4.3%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;angina</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">71 (27.6%)</td>
<td style="text-align: center;">71 (2.3%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;4</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">51 (19.8%)</td>
<td style="text-align: center;">51 (1.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Weight (lbs)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">169.554 (21.010)</td>
<td style="text-align: center;">174.463 (21.573)</td>
<td style="text-align: center;">169.954 (21.096)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">78.000 - 290.000</td>
<td style="text-align: center;">130.000 - 320.000</td>
<td style="text-align: center;">78.000 - 320.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Weight Category</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;&lt; 140</td>
<td style="text-align: center;">217 (7.5%)</td>
<td style="text-align: center;">15 (5.8%)</td>
<td style="text-align: center;">232 (7.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;140-170</td>
<td style="text-align: center;">1440 (49.7%)</td>
<td style="text-align: center;">98 (38.1%)</td>
<td style="text-align: center;">1538 (48.8%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;170-200</td>
<td style="text-align: center;">1049 (36.2%)</td>
<td style="text-align: center;">122 (47.5%)</td>
<td style="text-align: center;">1171 (37.1%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;&gt; 200</td>
<td style="text-align: center;">191 (6.6%)</td>
<td style="text-align: center;">22 (8.6%)</td>
<td style="text-align: center;">213 (6.8%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>RECODE of age (Age)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;35-40</td>
<td style="text-align: center;">512 (17.7%)</td>
<td style="text-align: center;">31 (12.1%)</td>
<td style="text-align: center;">543 (17.2%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;41-45</td>
<td style="text-align: center;">1036 (35.8%)</td>
<td style="text-align: center;">55 (21.4%)</td>
<td style="text-align: center;">1091 (34.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;46-50</td>
<td style="text-align: center;">680 (23.5%)</td>
<td style="text-align: center;">70 (27.2%)</td>
<td style="text-align: center;">750 (23.8%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;51-55</td>
<td style="text-align: center;">463 (16.0%)</td>
<td style="text-align: center;">65 (25.3%)</td>
<td style="text-align: center;">528 (16.7%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;56-60</td>
<td style="text-align: center;">206 (7.1%)</td>
<td style="text-align: center;">36 (14.0%)</td>
<td style="text-align: center;">242 (7.7%)</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
<ol type="1">
<li>Linear Model ANOVA</li>
<li>Pearson’s Chi-squared test</li>
</ol>
</section>
<section id="data-by-age-and-personality-type" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="data-by-age-and-personality-type"><span class="header-section-number">3.4.5</span> Data by age and personality type</h3>
<p>For now, we will look at the interaction between age and personality type (<code>dibpat</code>). To make it easier to visualize the data, we summarize the event rates for each combination of age:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>chd_grouped_data <span class="ot">=</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(age, dibpat),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(<span class="at">label =</span> <span class="st">"CHD Event by 1969"</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">logit(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>chd_grouped_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">dibpat</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">p(chd)</th>
<th style="text-align: right;">odds(chd)</th>
<th style="text-align: right;">logit(chd)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">0.105263</td>
<td style="text-align: right;">0.1176</td>
<td style="text-align: right;">-2.140</td>
</tr>
<tr class="even">
<td style="text-align: right;">51</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0.164179</td>
<td style="text-align: right;">0.1964</td>
<td style="text-align: right;">-1.627</td>
</tr>
<tr class="odd">
<td style="text-align: right;">59</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0.233333</td>
<td style="text-align: right;">0.3043</td>
<td style="text-align: right;">-1.190</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">0.079646</td>
<td style="text-align: right;">0.0865</td>
<td style="text-align: right;">-2.447</td>
</tr>
<tr class="odd">
<td style="text-align: right;">47</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">0.097222</td>
<td style="text-align: right;">0.1077</td>
<td style="text-align: right;">-2.228</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">133</td>
<td style="text-align: right;">0.067669</td>
<td style="text-align: right;">0.0726</td>
<td style="text-align: right;">-2.623</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0.064815</td>
<td style="text-align: right;">0.0693</td>
<td style="text-align: right;">-2.669</td>
</tr>
<tr class="even">
<td style="text-align: right;">43</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">0.072165</td>
<td style="text-align: right;">0.0778</td>
<td style="text-align: right;">-2.554</td>
</tr>
<tr class="odd">
<td style="text-align: right;">54</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">0.132075</td>
<td style="text-align: right;">0.1522</td>
<td style="text-align: right;">-1.883</td>
</tr>
<tr class="even">
<td style="text-align: right;">48</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">0.150000</td>
<td style="text-align: right;">0.1765</td>
<td style="text-align: right;">-1.735</td>
</tr>
<tr class="odd">
<td style="text-align: right;">39</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">128</td>
<td style="text-align: right;">0.085938</td>
<td style="text-align: right;">0.0940</td>
<td style="text-align: right;">-2.364</td>
</tr>
<tr class="even">
<td style="text-align: right;">49</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0.238806</td>
<td style="text-align: right;">0.3137</td>
<td style="text-align: right;">-1.159</td>
</tr>
<tr class="odd">
<td style="text-align: right;">55</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">0.163636</td>
<td style="text-align: right;">0.1957</td>
<td style="text-align: right;">-1.631</td>
</tr>
<tr class="even">
<td style="text-align: right;">56</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">0.244898</td>
<td style="text-align: right;">0.3243</td>
<td style="text-align: right;">-1.126</td>
</tr>
<tr class="odd">
<td style="text-align: right;">42</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">0.039604</td>
<td style="text-align: right;">0.0412</td>
<td style="text-align: right;">-3.188</td>
</tr>
<tr class="even">
<td style="text-align: right;">45</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">0.090909</td>
<td style="text-align: right;">0.1000</td>
<td style="text-align: right;">-2.303</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">0.065934</td>
<td style="text-align: right;">0.0706</td>
<td style="text-align: right;">-2.651</td>
</tr>
<tr class="even">
<td style="text-align: right;">57</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">0.129032</td>
<td style="text-align: right;">0.1481</td>
<td style="text-align: right;">-1.909</td>
</tr>
<tr class="odd">
<td style="text-align: right;">53</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">0.112903</td>
<td style="text-align: right;">0.1273</td>
<td style="text-align: right;">-2.061</td>
</tr>
<tr class="even">
<td style="text-align: right;">52</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">0.200000</td>
<td style="text-align: right;">0.2500</td>
<td style="text-align: right;">-1.386</td>
</tr>
<tr class="odd">
<td style="text-align: right;">58</td>
<td style="text-align: left;">Type A</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0.147059</td>
<td style="text-align: right;">0.1724</td>
<td style="text-align: right;">-1.758</td>
</tr>
<tr class="even">
<td style="text-align: right;">45</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">0.045872</td>
<td style="text-align: right;">0.0481</td>
<td style="text-align: right;">-3.035</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">0.040000</td>
<td style="text-align: right;">0.0417</td>
<td style="text-align: right;">-3.178</td>
</tr>
<tr class="even">
<td style="text-align: right;">47</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">0.013333</td>
<td style="text-align: right;">0.0135</td>
<td style="text-align: right;">-4.304</td>
</tr>
<tr class="odd">
<td style="text-align: right;">39</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">0.057971</td>
<td style="text-align: right;">0.0615</td>
<td style="text-align: right;">-2.788</td>
</tr>
<tr class="even">
<td style="text-align: right;">49</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0.074627</td>
<td style="text-align: right;">0.0806</td>
<td style="text-align: right;">-2.518</td>
</tr>
<tr class="odd">
<td style="text-align: right;">51</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0.107143</td>
<td style="text-align: right;">0.1200</td>
<td style="text-align: right;">-2.120</td>
</tr>
<tr class="even">
<td style="text-align: right;">42</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">0.008264</td>
<td style="text-align: right;">0.0083</td>
<td style="text-align: right;">-4.787</td>
</tr>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">0.050847</td>
<td style="text-align: right;">0.0536</td>
<td style="text-align: right;">-2.927</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0.032787</td>
<td style="text-align: right;">0.0339</td>
<td style="text-align: right;">-3.384</td>
</tr>
<tr class="odd">
<td style="text-align: right;">56</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0.000000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">-Inf</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">0.020833</td>
<td style="text-align: right;">0.0213</td>
<td style="text-align: right;">-3.850</td>
</tr>
<tr class="odd">
<td style="text-align: right;">58</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.045455</td>
<td style="text-align: right;">0.0476</td>
<td style="text-align: right;">-3.045</td>
</tr>
<tr class="even">
<td style="text-align: right;">48</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">0.083333</td>
<td style="text-align: right;">0.0909</td>
<td style="text-align: right;">-2.398</td>
</tr>
<tr class="odd">
<td style="text-align: right;">43</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">118</td>
<td style="text-align: right;">0.050847</td>
<td style="text-align: right;">0.0536</td>
<td style="text-align: right;">-2.927</td>
</tr>
<tr class="even">
<td style="text-align: right;">53</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">0.116279</td>
<td style="text-align: right;">0.1316</td>
<td style="text-align: right;">-2.028</td>
</tr>
<tr class="odd">
<td style="text-align: right;">54</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">0.074074</td>
<td style="text-align: right;">0.0800</td>
<td style="text-align: right;">-2.526</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">0.063291</td>
<td style="text-align: right;">0.0676</td>
<td style="text-align: right;">-2.695</td>
</tr>
<tr class="odd">
<td style="text-align: right;">52</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">0.041667</td>
<td style="text-align: right;">0.0435</td>
<td style="text-align: right;">-3.135</td>
</tr>
<tr class="even">
<td style="text-align: right;">55</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.040000</td>
<td style="text-align: right;">0.0417</td>
<td style="text-align: right;">-3.178</td>
</tr>
<tr class="odd">
<td style="text-align: right;">57</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">0.093750</td>
<td style="text-align: right;">0.1034</td>
<td style="text-align: right;">-2.269</td>
</tr>
<tr class="even">
<td style="text-align: right;">59</td>
<td style="text-align: left;">Type B</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.235294</td>
<td style="text-align: right;">0.3077</td>
<td style="text-align: right;">-1.179</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="graphical-exploration" class="level3" data-number="3.4.6">
<h3 data-number="3.4.6" class="anchored" data-anchor-id="graphical-exploration"><span class="header-section-number">3.4.6</span> Graphical exploration</h3>
<section id="probability-scale" class="level4">
<h4 class="anchored" data-anchor-id="probability-scale">Probability scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeasy)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>chd_plot_probs <span class="ot">=</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> age, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span>, </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> dibpat)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"P(CHD Event by 1969)"</span>) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">odds</span>(.),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"odds(CHD Event by 1969)"</span>)) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  ggeasy<span class="sc">::</span><span class="fu">easy_labs</span>() <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-chd-graph-prob-scale-interactive" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chd-graph-prob-scale-interactive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: CHD rates by age group, probability scale
</figcaption>
<div aria-describedby="fig-chd-graph-prob-scale-interactive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-a012e4318221b2f7ad09" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a012e4318221b2f7ad09">{"x":{"data":[{"x":[50,51,59,44,47,40,41,43,54,48,39,49,55,56,42,45,46,57,53,52,58],"y":[0.10526315789473684,0.16417910447761194,0.23333333333333334,0.079646017699115043,0.097222222222222224,0.067669172932330823,0.064814814814814811,0.072164948453608241,0.13207547169811321,0.14999999999999999,0.0859375,0.23880597014925373,0.16363636363636364,0.24489795918367346,0.039603960396039604,0.090909090909090912,0.065934065934065936,0.12903225806451613,0.11290322580645161,0.20000000000000001,0.14705882352941177],"text":["age: 50<br />p(chd): 0.105263<br />dibpat: Type A<br />n:  76","age: 51<br />p(chd): 0.164179<br />dibpat: Type A<br />n:  67","age: 59<br />p(chd): 0.233333<br />dibpat: Type A<br />n:  30","age: 44<br />p(chd): 0.079646<br />dibpat: Type A<br />n: 113","age: 47<br />p(chd): 0.097222<br />dibpat: Type A<br />n:  72","age: 40<br />p(chd): 0.067669<br />dibpat: Type A<br />n: 133","age: 41<br />p(chd): 0.064815<br />dibpat: Type A<br />n: 108","age: 43<br />p(chd): 0.072165<br />dibpat: Type A<br />n:  97","age: 54<br />p(chd): 0.132075<br />dibpat: Type A<br />n:  53","age: 48<br />p(chd): 0.150000<br />dibpat: Type A<br />n:  80","age: 39<br />p(chd): 0.085938<br />dibpat: Type A<br />n: 128","age: 49<br />p(chd): 0.238806<br />dibpat: Type A<br />n:  67","age: 55<br />p(chd): 0.163636<br />dibpat: Type A<br />n:  55","age: 56<br />p(chd): 0.244898<br />dibpat: Type A<br />n:  49","age: 42<br />p(chd): 0.039604<br />dibpat: Type A<br />n: 101","age: 45<br />p(chd): 0.090909<br />dibpat: Type A<br />n:  77","age: 46<br />p(chd): 0.065934<br />dibpat: Type A<br />n:  91","age: 57<br />p(chd): 0.129032<br />dibpat: Type A<br />n:  31","age: 53<br />p(chd): 0.112903<br />dibpat: Type A<br />n:  62","age: 52<br />p(chd): 0.200000<br />dibpat: Type A<br />n:  65","age: 58<br />p(chd): 0.147059<br />dibpat: Type A<br />n:  34"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":[11.507808770054302,10.893987081881484,7.4072043526108828,13.637611848597116,11.241235656543804,14.615949458394798,13.377458191723871,12.778686124337518,9.8163466467363971,11.765488567001361,14.379833505125502,10.893987081881484,9.9817695786372642,9.4710951773162115,13.000921034406357,11.573027489273997,12.434641120809431,7.5441456810618819,10.52889648301692,10.750245809698832,7.9279346825975772],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[45,41,47,39,49,51,42,50,44,56,40,58,48,43,53,54,46,52,55,57,59],"y":[0.045871559633027525,0.040000000000000001,0.013333333333333334,0.057971014492753624,0.074626865671641784,0.10714285714285714,0.0082644628099173556,0.050847457627118647,0.032786885245901641,0,0.020833333333333332,0.045454545454545456,0.083333333333333329,0.050847457627118647,0.11627906976744186,0.07407407407407407,0.063291139240506333,0.041666666666666664,0.040000000000000001,0.09375,0.23529411764705882],"text":["age: 45<br />p(chd): 0.045872<br />dibpat: Type B<br />n: 109","age: 41<br />p(chd): 0.040000<br />dibpat: Type B<br />n: 125","age: 47<br />p(chd): 0.013333<br />dibpat: Type B<br />n:  75","age: 39<br />p(chd): 0.057971<br />dibpat: Type B<br />n: 138","age: 49<br />p(chd): 0.074627<br />dibpat: Type B<br />n:  67","age: 51<br />p(chd): 0.107143<br />dibpat: Type B<br />n:  56","age: 42<br />p(chd): 0.008264<br />dibpat: Type B<br />n: 121","age: 50<br />p(chd): 0.050847<br />dibpat: Type B<br />n:  59","age: 44<br />p(chd): 0.032787<br />dibpat: Type B<br />n: 122","age: 56<br />p(chd): 0.000000<br />dibpat: Type B<br />n:  27","age: 40<br />p(chd): 0.020833<br />dibpat: Type B<br />n: 144","age: 58<br />p(chd): 0.045455<br />dibpat: Type B<br />n:  22","age: 48<br />p(chd): 0.083333<br />dibpat: Type B<br />n:  84","age: 43<br />p(chd): 0.050847<br />dibpat: Type B<br />n: 118","age: 53<br />p(chd): 0.116279<br />dibpat: Type B<br />n:  43","age: 54<br />p(chd): 0.074074<br />dibpat: Type B<br />n:  54","age: 46<br />p(chd): 0.063291<br />dibpat: Type B<br />n:  79","age: 52<br />p(chd): 0.041667<br />dibpat: Type B<br />n:  48","age: 55<br />p(chd): 0.040000<br />dibpat: Type B<br />n:  25","age: 57<br />p(chd): 0.093750<br />dibpat: Type B<br />n:  32","age: 59<br />p(chd): 0.235294<br />dibpat: Type B<br />n:  17"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":[13.430049986134389,14.235604935020691,11.442034967876614,14.847029219804128,10.893987081881484,10.062848078932257,14.040147001760529,10.300037417465363,14.089358888134319,6.9612105822972117,15.118110236220474,6.0293172003757194,12.015109867829196,13.89107438878934,8.9098372804078227,9.8996170505112442,11.701854397452983,9.3814585892624311,6.6253113681856641,7.6762775241645578,3.7795275590551185],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.0859375,0.067669172932330823,0.064814814814814811,0.039603960396039604,0.072164948453608241,0.079646017699115043,0.090909090909090912,0.065934065934065936,0.097222222222222224,0.14999999999999999,0.23880597014925373,0.10526315789473684,0.16417910447761194,0.20000000000000001,0.11290322580645161,0.13207547169811321,0.16363636363636364,0.24489795918367346,0.12903225806451613,0.14705882352941177,0.23333333333333334],"text":["age: 39<br />p(chd): 0.085938<br />dibpat: Type A","age: 40<br />p(chd): 0.067669<br />dibpat: Type A","age: 41<br />p(chd): 0.064815<br />dibpat: Type A","age: 42<br />p(chd): 0.039604<br />dibpat: Type A","age: 43<br />p(chd): 0.072165<br />dibpat: Type A","age: 44<br />p(chd): 0.079646<br />dibpat: Type A","age: 45<br />p(chd): 0.090909<br />dibpat: Type A","age: 46<br />p(chd): 0.065934<br />dibpat: Type A","age: 47<br />p(chd): 0.097222<br />dibpat: Type A","age: 48<br />p(chd): 0.150000<br />dibpat: Type A","age: 49<br />p(chd): 0.238806<br />dibpat: Type A","age: 50<br />p(chd): 0.105263<br />dibpat: Type A","age: 51<br />p(chd): 0.164179<br />dibpat: Type A","age: 52<br />p(chd): 0.200000<br />dibpat: Type A","age: 53<br />p(chd): 0.112903<br />dibpat: Type A","age: 54<br />p(chd): 0.132075<br />dibpat: Type A","age: 55<br />p(chd): 0.163636<br />dibpat: Type A","age: 56<br />p(chd): 0.244898<br />dibpat: Type A","age: 57<br />p(chd): 0.129032<br />dibpat: Type A","age: 58<br />p(chd): 0.147059<br />dibpat: Type A","age: 59<br />p(chd): 0.233333<br />dibpat: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.057971014492753624,0.020833333333333332,0.040000000000000001,0.0082644628099173556,0.050847457627118647,0.032786885245901641,0.045871559633027525,0.063291139240506333,0.013333333333333334,0.083333333333333329,0.074626865671641784,0.050847457627118647,0.10714285714285714,0.041666666666666664,0.11627906976744186,0.07407407407407407,0.040000000000000001,0,0.09375,0.045454545454545456,0.23529411764705882],"text":["age: 39<br />p(chd): 0.057971<br />dibpat: Type B","age: 40<br />p(chd): 0.020833<br />dibpat: Type B","age: 41<br />p(chd): 0.040000<br />dibpat: Type B","age: 42<br />p(chd): 0.008264<br />dibpat: Type B","age: 43<br />p(chd): 0.050847<br />dibpat: Type B","age: 44<br />p(chd): 0.032787<br />dibpat: Type B","age: 45<br />p(chd): 0.045872<br />dibpat: Type B","age: 46<br />p(chd): 0.063291<br />dibpat: Type B","age: 47<br />p(chd): 0.013333<br />dibpat: Type B","age: 48<br />p(chd): 0.083333<br />dibpat: Type B","age: 49<br />p(chd): 0.074627<br />dibpat: Type B","age: 50<br />p(chd): 0.050847<br />dibpat: Type B","age: 51<br />p(chd): 0.107143<br />dibpat: Type B","age: 52<br />p(chd): 0.041667<br />dibpat: Type B","age: 53<br />p(chd): 0.116279<br />dibpat: Type B","age: 54<br />p(chd): 0.074074<br />dibpat: Type B","age: 55<br />p(chd): 0.040000<br />dibpat: Type B","age: 56<br />p(chd): 0.000000<br />dibpat: Type B","age: 57<br />p(chd): 0.093750<br />dibpat: Type B","age: 58<br />p(chd): 0.045455<br />dibpat: Type B","age: 59<br />p(chd): 0.235294<br />dibpat: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[38,60],"tickmode":"array","ticktext":["40","45","50","55","60"],"tickvals":[40,45,50,55,60],"categoryorder":"array","categoryarray":["40","45","50","55","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Age (years)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.012244897959183675,0.25714285714285712],"tickmode":"array","ticktext":["0%","5%","10%","15%","20%","25%"],"tickvals":[1.7347234759768071e-18,0.050000000000000003,0.10000000000000001,0.15000000000000002,0.20000000000000001,0.24999999999999997],"categoryorder":"array","categoryarray":["0%","5%","10%","15%","20%","25%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"P(CHD Event by 1969)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Behavioral Pattern<br />n","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"749923ca807a":{"x":{},"y":{},"colour":{},"size":{},"type":"scatter"},"749943b8dbf1":{"x":{},"y":{},"colour":{}}},"cur_data":"749923ca807a","visdat":{"749923ca807a":["function (y) ","x"],"749943b8dbf1":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</figure>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print(chd_plot_probs)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="odds-scale" class="level4">
<h4 class="anchored" data-anchor-id="odds-scale">Odds scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>trans_odds <span class="ot">=</span> <span class="fu">trans_new</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"odds"</span>, </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> odds, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> odds_inv)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>chd_plot_probs <span class="sc">+</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> trans_odds, </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">paste</span>(chd_plot_probs<span class="sc">$</span>labels<span class="sc">$</span>y, <span class="st">"(odds spacing)"</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">odds</span>(.),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"odds(CHD Event by 1969)"</span>))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>chd_plot_odds <span class="ot">=</span> </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span> </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> age, </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span>, </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> dibpat)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"odds(CHD Event by 1969)"</span>) <span class="sc">+</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  ggeasy<span class="sc">::</span><span class="fu">easy_labs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-chd-odds-scale" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chd-odds-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: CHD rates by age group, odds scale
</figcaption>
<div aria-describedby="fig-chd-odds-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-chd-odds-scale-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_odds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-14f5150d4db2e5a443b9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-14f5150d4db2e5a443b9">{"x":{"data":[{"x":[50,51,59,44,47,40,41,43,54,48,39,49,55,56,42,45,46,57,53,52,58],"y":[0.11764705882352941,0.19642857142857142,0.30434782608695654,0.086538461538461536,0.1076923076923077,0.072580645161290328,0.069306930693069299,0.077777777777777765,0.15217391304347824,0.17647058823529413,0.094017094017094016,0.31372549019607843,0.19565217391304346,0.32432432432432434,0.041237113402061855,0.10000000000000001,0.070588235294117646,0.14814814814814814,0.12727272727272726,0.25,0.17241379310344829],"text":["age: 50<br />odds(chd): 0.117647<br />dibpat: Type A<br />n:  76","age: 51<br />odds(chd): 0.196429<br />dibpat: Type A<br />n:  67","age: 59<br />odds(chd): 0.304348<br />dibpat: Type A<br />n:  30","age: 44<br />odds(chd): 0.086538<br />dibpat: Type A<br />n: 113","age: 47<br />odds(chd): 0.107692<br />dibpat: Type A<br />n:  72","age: 40<br />odds(chd): 0.072581<br />dibpat: Type A<br />n: 133","age: 41<br />odds(chd): 0.069307<br />dibpat: Type A<br />n: 108","age: 43<br />odds(chd): 0.077778<br />dibpat: Type A<br />n:  97","age: 54<br />odds(chd): 0.152174<br />dibpat: Type A<br />n:  53","age: 48<br />odds(chd): 0.176471<br />dibpat: Type A<br />n:  80","age: 39<br />odds(chd): 0.094017<br />dibpat: Type A<br />n: 128","age: 49<br />odds(chd): 0.313725<br />dibpat: Type A<br />n:  67","age: 55<br />odds(chd): 0.195652<br />dibpat: Type A<br />n:  55","age: 56<br />odds(chd): 0.324324<br />dibpat: Type A<br />n:  49","age: 42<br />odds(chd): 0.041237<br />dibpat: Type A<br />n: 101","age: 45<br />odds(chd): 0.100000<br />dibpat: Type A<br />n:  77","age: 46<br />odds(chd): 0.070588<br />dibpat: Type A<br />n:  91","age: 57<br />odds(chd): 0.148148<br />dibpat: Type A<br />n:  31","age: 53<br />odds(chd): 0.127273<br />dibpat: Type A<br />n:  62","age: 52<br />odds(chd): 0.250000<br />dibpat: Type A<br />n:  65","age: 58<br />odds(chd): 0.172414<br />dibpat: Type A<br />n:  34"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":[11.507808770054302,10.893987081881484,7.4072043526108828,13.637611848597116,11.241235656543804,14.615949458394798,13.377458191723871,12.778686124337518,9.8163466467363971,11.765488567001361,14.379833505125502,10.893987081881484,9.9817695786372642,9.4710951773162115,13.000921034406357,11.573027489273997,12.434641120809431,7.5441456810618819,10.52889648301692,10.750245809698832,7.9279346825975772],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[45,41,47,39,49,51,42,50,44,56,40,58,48,43,53,54,46,52,55,57,59],"y":[0.04807692307692308,0.041666666666666671,0.013513513513513514,0.061538461538461542,0.080645161290322578,0.11999999999999998,0.0083333333333333332,0.053571428571428575,0.033898305084745763,0,0.021276595744680851,0.047619047619047616,0.090909090909090912,0.053571428571428575,0.13157894736842105,0.080000000000000002,0.067567567567567571,0.043478260869565216,0.041666666666666671,0.10344827586206896,0.30769230769230771],"text":["age: 45<br />odds(chd): 0.048077<br />dibpat: Type B<br />n: 109","age: 41<br />odds(chd): 0.041667<br />dibpat: Type B<br />n: 125","age: 47<br />odds(chd): 0.013514<br />dibpat: Type B<br />n:  75","age: 39<br />odds(chd): 0.061538<br />dibpat: Type B<br />n: 138","age: 49<br />odds(chd): 0.080645<br />dibpat: Type B<br />n:  67","age: 51<br />odds(chd): 0.120000<br />dibpat: Type B<br />n:  56","age: 42<br />odds(chd): 0.008333<br />dibpat: Type B<br />n: 121","age: 50<br />odds(chd): 0.053571<br />dibpat: Type B<br />n:  59","age: 44<br />odds(chd): 0.033898<br />dibpat: Type B<br />n: 122","age: 56<br />odds(chd): 0.000000<br />dibpat: Type B<br />n:  27","age: 40<br />odds(chd): 0.021277<br />dibpat: Type B<br />n: 144","age: 58<br />odds(chd): 0.047619<br />dibpat: Type B<br />n:  22","age: 48<br />odds(chd): 0.090909<br />dibpat: Type B<br />n:  84","age: 43<br />odds(chd): 0.053571<br />dibpat: Type B<br />n: 118","age: 53<br />odds(chd): 0.131579<br />dibpat: Type B<br />n:  43","age: 54<br />odds(chd): 0.080000<br />dibpat: Type B<br />n:  54","age: 46<br />odds(chd): 0.067568<br />dibpat: Type B<br />n:  79","age: 52<br />odds(chd): 0.043478<br />dibpat: Type B<br />n:  48","age: 55<br />odds(chd): 0.041667<br />dibpat: Type B<br />n:  25","age: 57<br />odds(chd): 0.103448<br />dibpat: Type B<br />n:  32","age: 59<br />odds(chd): 0.307692<br />dibpat: Type B<br />n:  17"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":[13.430049986134389,14.235604935020691,11.442034967876614,14.847029219804128,10.893987081881484,10.062848078932257,14.040147001760529,10.300037417465363,14.089358888134319,6.9612105822972117,15.118110236220474,6.0293172003757194,12.015109867829196,13.89107438878934,8.9098372804078227,9.8996170505112442,11.701854397452983,9.3814585892624311,6.6253113681856641,7.6762775241645578,3.7795275590551185],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.094017094017094016,0.072580645161290328,0.069306930693069299,0.041237113402061855,0.077777777777777765,0.086538461538461536,0.10000000000000001,0.070588235294117646,0.1076923076923077,0.17647058823529413,0.31372549019607843,0.11764705882352941,0.19642857142857142,0.25,0.12727272727272726,0.15217391304347824,0.19565217391304346,0.32432432432432434,0.14814814814814814,0.17241379310344829,0.30434782608695654],"text":["age: 39<br />odds(chd): 0.094017<br />dibpat: Type A","age: 40<br />odds(chd): 0.072581<br />dibpat: Type A","age: 41<br />odds(chd): 0.069307<br />dibpat: Type A","age: 42<br />odds(chd): 0.041237<br />dibpat: Type A","age: 43<br />odds(chd): 0.077778<br />dibpat: Type A","age: 44<br />odds(chd): 0.086538<br />dibpat: Type A","age: 45<br />odds(chd): 0.100000<br />dibpat: Type A","age: 46<br />odds(chd): 0.070588<br />dibpat: Type A","age: 47<br />odds(chd): 0.107692<br />dibpat: Type A","age: 48<br />odds(chd): 0.176471<br />dibpat: Type A","age: 49<br />odds(chd): 0.313725<br />dibpat: Type A","age: 50<br />odds(chd): 0.117647<br />dibpat: Type A","age: 51<br />odds(chd): 0.196429<br />dibpat: Type A","age: 52<br />odds(chd): 0.250000<br />dibpat: Type A","age: 53<br />odds(chd): 0.127273<br />dibpat: Type A","age: 54<br />odds(chd): 0.152174<br />dibpat: Type A","age: 55<br />odds(chd): 0.195652<br />dibpat: Type A","age: 56<br />odds(chd): 0.324324<br />dibpat: Type A","age: 57<br />odds(chd): 0.148148<br />dibpat: Type A","age: 58<br />odds(chd): 0.172414<br />dibpat: Type A","age: 59<br />odds(chd): 0.304348<br />dibpat: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.061538461538461542,0.021276595744680851,0.041666666666666671,0.0083333333333333332,0.053571428571428575,0.033898305084745763,0.04807692307692308,0.067567567567567571,0.013513513513513514,0.090909090909090912,0.080645161290322578,0.053571428571428575,0.11999999999999998,0.043478260869565216,0.13157894736842105,0.080000000000000002,0.041666666666666671,0,0.10344827586206896,0.047619047619047616,0.30769230769230771],"text":["age: 39<br />odds(chd): 0.061538<br />dibpat: Type B","age: 40<br />odds(chd): 0.021277<br />dibpat: Type B","age: 41<br />odds(chd): 0.041667<br />dibpat: Type B","age: 42<br />odds(chd): 0.008333<br />dibpat: Type B","age: 43<br />odds(chd): 0.053571<br />dibpat: Type B","age: 44<br />odds(chd): 0.033898<br />dibpat: Type B","age: 45<br />odds(chd): 0.048077<br />dibpat: Type B","age: 46<br />odds(chd): 0.067568<br />dibpat: Type B","age: 47<br />odds(chd): 0.013514<br />dibpat: Type B","age: 48<br />odds(chd): 0.090909<br />dibpat: Type B","age: 49<br />odds(chd): 0.080645<br />dibpat: Type B","age: 50<br />odds(chd): 0.053571<br />dibpat: Type B","age: 51<br />odds(chd): 0.120000<br />dibpat: Type B","age: 52<br />odds(chd): 0.043478<br />dibpat: Type B","age: 53<br />odds(chd): 0.131579<br />dibpat: Type B","age: 54<br />odds(chd): 0.080000<br />dibpat: Type B","age: 55<br />odds(chd): 0.041667<br />dibpat: Type B","age: 56<br />odds(chd): 0.000000<br />dibpat: Type B","age: 57<br />odds(chd): 0.103448<br />dibpat: Type B","age: 58<br />odds(chd): 0.047619<br />dibpat: Type B","age: 59<br />odds(chd): 0.307692<br />dibpat: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[38,60],"tickmode":"array","ticktext":["40","45","50","55","60"],"tickvals":[40,45,50,55,60],"categoryorder":"array","categoryarray":["40","45","50","55","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Age (years)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.016216216216216217,0.34054054054054056],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3"],"tickvals":[0,0.10000000000000001,0.20000000000000001,0.30000000000000004],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"odds(CHD Event by 1969)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Behavioral Pattern<br />n","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"749922dddc73":{"x":{},"y":{},"colour":{},"size":{},"type":"scatter"},"749913b413e7":{"x":{},"y":{},"colour":{}}},"cur_data":"749922dddc73","visdat":{"749922dddc73":["function (y) ","x"],"749913b413e7":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="log-odds-logit-scale" class="level4">
<h4 class="anchored" data-anchor-id="log-odds-logit-scale">Log-odds (logit) scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chd_plot_logit <span class="ot">=</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> age, </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">logit(chd)</span><span class="st">`</span>, </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> dibpat)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"log{odds(CHD Event by 1969)}"</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  ggeasy<span class="sc">::</span><span class="fu">easy_labs</span>()</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_logit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-chd_plot_logit" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chd_plot_logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6: CHD data (logit-scale)
</figcaption>
<div aria-describedby="fig-chd_plot_logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-chd_plot_logit-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="logistic-regression-models-for-chd-data" class="level3 smaller" data-number="3.4.7">
<h3 class="smaller anchored" data-number="3.4.7" data-anchor-id="logistic-regression-models-for-chd-data"><span class="header-section-number">3.4.7</span> Logistic regression models for CHD data</h3>
<p>Here, we fit stratified models for CHD by personality type.</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">-5.50</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">(-6.83, -4.19)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">-5.80</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">(-7.73, -3.90)</td>
<td style="text-align: center;">-5.95</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A) × age</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(0.05, 0.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(0.02, 0.10)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can get the corresponding odds ratios (<span class="math inline">\(e^{\beta}\)</span>s) by passing <code>exponentiate = TRUE</code> to <code>parameters()</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-chd-glm-strat-OR" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-chd-glm-strat-OR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.3: Odds ratio estimates for CHD model
</figcaption>
<div aria-describedby="tbl-chd-glm-strat-OR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 28%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 23%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Odds Ratio</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">4.09e-03</td>
<td style="text-align: center;">2.75e-03</td>
<td style="text-align: center;">(1.08e-03, 0.02)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">3.02e-03</td>
<td style="text-align: center;">2.94e-03</td>
<td style="text-align: center;">(4.40e-04, 0.02)</td>
<td style="text-align: center;">-5.95</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A) × age</td>
<td style="text-align: center;">1.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(1.05, 1.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">1.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(1.02, 1.11)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="models-superimposed-on-data" class="level3" data-number="3.4.8">
<h3 data-number="3.4.8" class="anchored" data-anchor-id="models-superimposed-on-data"><span class="header-section-number">3.4.8</span> Models superimposed on data</h3>
<p>We can graph our fitted models on each scale (probability, odds, log-odds).</p>
<section id="probability-scale-1" class="level4">
<h4 class="anchored" data-anchor-id="probability-scale-1">probability scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>chd_plot_probs_2 <span class="ot">=</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  chd_plot_probs <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_probs_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d7a75187fc00fae6c81b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d7a75187fc00fae6c81b">{"x":{"data":[{"x":[50,51,59,44,47,40,41,43,54,48,39,49,55,56,42,45,46,57,53,52,58],"y":[0.10526315789473684,0.16417910447761194,0.23333333333333334,0.079646017699115043,0.097222222222222224,0.067669172932330823,0.064814814814814811,0.072164948453608241,0.13207547169811321,0.14999999999999999,0.0859375,0.23880597014925373,0.16363636363636364,0.24489795918367346,0.039603960396039604,0.090909090909090912,0.065934065934065936,0.12903225806451613,0.11290322580645161,0.20000000000000001,0.14705882352941177],"text":["age: 50<br />p(chd): 0.1052631579<br />dibpat: Type A<br />n:  76","age: 51<br />p(chd): 0.1641791045<br />dibpat: Type A<br />n:  67","age: 59<br />p(chd): 0.2333333333<br />dibpat: Type A<br />n:  30","age: 44<br />p(chd): 0.0796460177<br />dibpat: Type A<br />n: 113","age: 47<br />p(chd): 0.0972222222<br />dibpat: Type A<br />n:  72","age: 40<br />p(chd): 0.0676691729<br />dibpat: Type A<br />n: 133","age: 41<br />p(chd): 0.0648148148<br />dibpat: Type A<br />n: 108","age: 43<br />p(chd): 0.0721649485<br />dibpat: Type A<br />n:  97","age: 54<br />p(chd): 0.1320754717<br />dibpat: Type A<br />n:  53","age: 48<br />p(chd): 0.1500000000<br />dibpat: Type A<br />n:  80","age: 39<br />p(chd): 0.0859375000<br />dibpat: Type A<br />n: 128","age: 49<br />p(chd): 0.2388059701<br />dibpat: Type A<br />n:  67","age: 55<br />p(chd): 0.1636363636<br />dibpat: Type A<br />n:  55","age: 56<br />p(chd): 0.2448979592<br />dibpat: Type A<br />n:  49","age: 42<br />p(chd): 0.0396039604<br />dibpat: Type A<br />n: 101","age: 45<br />p(chd): 0.0909090909<br />dibpat: Type A<br />n:  77","age: 46<br />p(chd): 0.0659340659<br />dibpat: Type A<br />n:  91","age: 57<br />p(chd): 0.1290322581<br />dibpat: Type A<br />n:  31","age: 53<br />p(chd): 0.1129032258<br />dibpat: Type A<br />n:  62","age: 52<br />p(chd): 0.2000000000<br />dibpat: Type A<br />n:  65","age: 58<br />p(chd): 0.1470588235<br />dibpat: Type A<br />n:  34"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":[11.507808770054302,10.893987081881484,7.4072043526108828,13.637611848597116,11.241235656543804,14.615949458394798,13.377458191723871,12.778686124337518,9.8163466467363971,11.765488567001361,14.379833505125502,10.893987081881484,9.9817695786372642,9.4710951773162115,13.000921034406357,11.573027489273997,12.434641120809431,7.5441456810618819,10.52889648301692,10.750245809698832,7.9279346825975772],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[45,41,47,39,49,51,42,50,44,56,40,58,48,43,53,54,46,52,55,57,59],"y":[0.045871559633027525,0.040000000000000001,0.013333333333333334,0.057971014492753624,0.074626865671641784,0.10714285714285714,0.0082644628099173556,0.050847457627118647,0.032786885245901641,0,0.020833333333333332,0.045454545454545456,0.083333333333333329,0.050847457627118647,0.11627906976744186,0.07407407407407407,0.063291139240506333,0.041666666666666664,0.040000000000000001,0.09375,0.23529411764705882],"text":["age: 45<br />p(chd): 0.0458715596<br />dibpat: Type B<br />n: 109","age: 41<br />p(chd): 0.0400000000<br />dibpat: Type B<br />n: 125","age: 47<br />p(chd): 0.0133333333<br />dibpat: Type B<br />n:  75","age: 39<br />p(chd): 0.0579710145<br />dibpat: Type B<br />n: 138","age: 49<br />p(chd): 0.0746268657<br />dibpat: Type B<br />n:  67","age: 51<br />p(chd): 0.1071428571<br />dibpat: Type B<br />n:  56","age: 42<br />p(chd): 0.0082644628<br />dibpat: Type B<br />n: 121","age: 50<br />p(chd): 0.0508474576<br />dibpat: Type B<br />n:  59","age: 44<br />p(chd): 0.0327868852<br />dibpat: Type B<br />n: 122","age: 56<br />p(chd): 0.0000000000<br />dibpat: Type B<br />n:  27","age: 40<br />p(chd): 0.0208333333<br />dibpat: Type B<br />n: 144","age: 58<br />p(chd): 0.0454545455<br />dibpat: Type B<br />n:  22","age: 48<br />p(chd): 0.0833333333<br />dibpat: Type B<br />n:  84","age: 43<br />p(chd): 0.0508474576<br />dibpat: Type B<br />n: 118","age: 53<br />p(chd): 0.1162790698<br />dibpat: Type B<br />n:  43","age: 54<br />p(chd): 0.0740740741<br />dibpat: Type B<br />n:  54","age: 46<br />p(chd): 0.0632911392<br />dibpat: Type B<br />n:  79","age: 52<br />p(chd): 0.0416666667<br />dibpat: Type B<br />n:  48","age: 55<br />p(chd): 0.0400000000<br />dibpat: Type B<br />n:  25","age: 57<br />p(chd): 0.0937500000<br />dibpat: Type B<br />n:  32","age: 59<br />p(chd): 0.2352941176<br />dibpat: Type B<br />n:  17"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":[13.430049986134389,14.235604935020691,11.442034967876614,14.847029219804128,10.893987081881484,10.062848078932257,14.040147001760529,10.300037417465363,14.089358888134319,6.9612105822972117,15.118110236220474,6.0293172003757194,12.015109867829196,13.89107438878934,8.9098372804078227,9.8996170505112442,11.701854397452983,9.3814585892624311,6.6253113681856641,7.6762775241645578,3.7795275590551185],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.0859375,0.067669172932330823,0.064814814814814811,0.039603960396039604,0.072164948453608241,0.079646017699115043,0.090909090909090912,0.065934065934065936,0.097222222222222224,0.14999999999999999,0.23880597014925373,0.10526315789473684,0.16417910447761194,0.20000000000000001,0.11290322580645161,0.13207547169811321,0.16363636363636364,0.24489795918367346,0.12903225806451613,0.14705882352941177,0.23333333333333334],"text":["age: 39<br />p(chd): 0.0859375000<br />dibpat: Type A","age: 40<br />p(chd): 0.0676691729<br />dibpat: Type A","age: 41<br />p(chd): 0.0648148148<br />dibpat: Type A","age: 42<br />p(chd): 0.0396039604<br />dibpat: Type A","age: 43<br />p(chd): 0.0721649485<br />dibpat: Type A","age: 44<br />p(chd): 0.0796460177<br />dibpat: Type A","age: 45<br />p(chd): 0.0909090909<br />dibpat: Type A","age: 46<br />p(chd): 0.0659340659<br />dibpat: Type A","age: 47<br />p(chd): 0.0972222222<br />dibpat: Type A","age: 48<br />p(chd): 0.1500000000<br />dibpat: Type A","age: 49<br />p(chd): 0.2388059701<br />dibpat: Type A","age: 50<br />p(chd): 0.1052631579<br />dibpat: Type A","age: 51<br />p(chd): 0.1641791045<br />dibpat: Type A","age: 52<br />p(chd): 0.2000000000<br />dibpat: Type A","age: 53<br />p(chd): 0.1129032258<br />dibpat: Type A","age: 54<br />p(chd): 0.1320754717<br />dibpat: Type A","age: 55<br />p(chd): 0.1636363636<br />dibpat: Type A","age: 56<br />p(chd): 0.2448979592<br />dibpat: Type A","age: 57<br />p(chd): 0.1290322581<br />dibpat: Type A","age: 58<br />p(chd): 0.1470588235<br />dibpat: Type A","age: 59<br />p(chd): 0.2333333333<br />dibpat: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.057971014492753624,0.020833333333333332,0.040000000000000001,0.0082644628099173556,0.050847457627118647,0.032786885245901641,0.045871559633027525,0.063291139240506333,0.013333333333333334,0.083333333333333329,0.074626865671641784,0.050847457627118647,0.10714285714285714,0.041666666666666664,0.11627906976744186,0.07407407407407407,0.040000000000000001,0,0.09375,0.045454545454545456,0.23529411764705882],"text":["age: 39<br />p(chd): 0.0579710145<br />dibpat: Type B","age: 40<br />p(chd): 0.0208333333<br />dibpat: Type B","age: 41<br />p(chd): 0.0400000000<br />dibpat: Type B","age: 42<br />p(chd): 0.0082644628<br />dibpat: Type B","age: 43<br />p(chd): 0.0508474576<br />dibpat: Type B","age: 44<br />p(chd): 0.0327868852<br />dibpat: Type B","age: 45<br />p(chd): 0.0458715596<br />dibpat: Type B","age: 46<br />p(chd): 0.0632911392<br />dibpat: Type B","age: 47<br />p(chd): 0.0133333333<br />dibpat: Type B","age: 48<br />p(chd): 0.0833333333<br />dibpat: Type B","age: 49<br />p(chd): 0.0746268657<br />dibpat: Type B","age: 50<br />p(chd): 0.0508474576<br />dibpat: Type B","age: 51<br />p(chd): 0.1071428571<br />dibpat: Type B","age: 52<br />p(chd): 0.0416666667<br />dibpat: Type B","age: 53<br />p(chd): 0.1162790698<br />dibpat: Type B","age: 54<br />p(chd): 0.0740740741<br />dibpat: Type B","age: 55<br />p(chd): 0.0400000000<br />dibpat: Type B","age: 56<br />p(chd): 0.0000000000<br />dibpat: Type B","age: 57<br />p(chd): 0.0937500000<br />dibpat: Type B","age: 58<br />p(chd): 0.0454545455<br />dibpat: Type B","age: 59<br />p(chd): 0.2352941176<br />dibpat: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,39.200000000000003,39.399999999999999,39.600000000000001,39.799999999999997,40,40.200000000000003,40.399999999999999,40.600000000000001,40.799999999999997,41,41.200000000000003,41.399999999999999,41.600000000000001,41.799999999999997,42,42.200000000000003,42.399999999999999,42.600000000000001,42.799999999999997,43,43.200000000000003,43.399999999999999,43.600000000000001,43.799999999999997,44,44.200000000000003,44.399999999999999,44.600000000000001,44.799999999999997,45,45.200000000000003,45.399999999999999,45.600000000000001,45.799999999999997,46,46.200000000000003,46.399999999999999,46.600000000000001,46.799999999999997,47,47.200000000000003,47.399999999999999,47.600000000000001,47.799999999999997,48,48.200000000000003,48.399999999999999,48.600000000000001,48.799999999999997,49,49.200000000000003,49.399999999999999,49.600000000000001,49.799999999999997,50,50.200000000000003,50.399999999999999,50.600000000000001,50.799999999999997,51,51.200000000000003,51.399999999999999,51.600000000000001,51.799999999999997,52,52.200000000000003,52.399999999999999,52.600000000000001,52.799999999999997,53,53.200000000000003,53.399999999999999,53.600000000000001,53.799999999999997,54,54.200000000000003,54.399999999999999,54.600000000000001,54.799999999999997,55,55.200000000000003,55.400000000000006,55.600000000000001,55.799999999999997,56,56.200000000000003,56.400000000000006,56.600000000000001,56.799999999999997,57,57.200000000000003,57.400000000000006,57.600000000000001,57.799999999999997,58,58.200000000000003,58.400000000000006,58.600000000000001,58.799999999999997,59],"y":[0.063299679011381407,0.064157768966082412,0.065026683658208267,0.065906537650489649,0.066797446117387055,0.067699524830551763,0.068612890143657901,0.069537658976593461,0.070473948798998626,0.071421877613138104,0.072381563936096224,0.073353126781282127,0.074336685639232666,0.075332360457701641,0.076340271621022637,0.077360539928733915,0.078393286573453236,0.079438633117991528,0.080496701471693008,0.081567613865990832,0.082651492829166978,0.083748461160305016,0.084858641902425355,0.085982158314791959,0.087119133844379804,0.088269692096494268,0.089433956804530507,0.090612051798865223,0.091804100974870753,0.093010228260041794,0.094230557580228233,0.095465212824963577,0.096714317811883277,0.097977996250224728,0.099256371703401514,0.10054956755064762,0.10185770694772306,0.10318091278667818,0.10451930765467071,0.10587301379183077,0.10724215304817256,0.1086268468395476,0.11002721610263864,0.11144338124899295,0.11287546211809343,0.11432357792946839,0.11578784723384046,0.11726838786331695,0.11876531688062326,0.12027875052738381,0.12180880417145425,0.12335559225331046,0.12491922823150074,0.12649982452716882,0.12809749246765489,0.12971234222918615,0.13134448277866476,0.13299402181456763,0.13466106570696912,0.13634571943670093,0.13804808653366488,0.13976826901431511,0.14150636731832664,0.14326248024447075,0.14503670488571579,0.14682913656357735,0.14863986876173854,0.15046899305896672,0.15231659906135214,0.15418277433389502,0.15606760433147135,0.15797117232920621,0.15989355935228763,0.16183484410525412,0.16379510290078922,0.16577440958806228,0.16777283548065003,0.16979044928408141,0.17182731702304496,0.17388350196830099,0.1759590645633447,0.17805406235086355,0.18016854989903766,0.18230257872773176,0.1844561972346285,0.18662945062135569,0.18882238081965988,0.19103502641768266,0.19326742258639434,0.19551960100624449,0.19779158979408687,0.20008341343044042,0.202395092687149,0.20472664455550102,0.20707808217487633,0.20944941476198384,0.21184064754075824,0.21425178167298387,0.21668281418971538,0.21913373792356453,0.22160454144192571],"text":["age: 39.0<br />p(chd): 0.063299679<br />colour: Type A","age: 39.2<br />p(chd): 0.064157769<br />colour: Type A","age: 39.4<br />p(chd): 0.065026684<br />colour: Type A","age: 39.6<br />p(chd): 0.065906538<br />colour: Type A","age: 39.8<br />p(chd): 0.066797446<br />colour: Type A","age: 40.0<br />p(chd): 0.067699525<br />colour: Type A","age: 40.2<br />p(chd): 0.068612890<br />colour: Type A","age: 40.4<br />p(chd): 0.069537659<br />colour: Type A","age: 40.6<br />p(chd): 0.070473949<br />colour: Type A","age: 40.8<br />p(chd): 0.071421878<br />colour: Type A","age: 41.0<br />p(chd): 0.072381564<br />colour: Type A","age: 41.2<br />p(chd): 0.073353127<br />colour: Type A","age: 41.4<br />p(chd): 0.074336686<br />colour: Type A","age: 41.6<br />p(chd): 0.075332360<br />colour: Type A","age: 41.8<br />p(chd): 0.076340272<br />colour: Type A","age: 42.0<br />p(chd): 0.077360540<br />colour: Type A","age: 42.2<br />p(chd): 0.078393287<br />colour: Type A","age: 42.4<br />p(chd): 0.079438633<br />colour: Type A","age: 42.6<br />p(chd): 0.080496701<br />colour: Type A","age: 42.8<br />p(chd): 0.081567614<br />colour: Type A","age: 43.0<br />p(chd): 0.082651493<br />colour: Type A","age: 43.2<br />p(chd): 0.083748461<br />colour: Type A","age: 43.4<br />p(chd): 0.084858642<br />colour: Type A","age: 43.6<br />p(chd): 0.085982158<br />colour: Type A","age: 43.8<br />p(chd): 0.087119134<br />colour: Type A","age: 44.0<br />p(chd): 0.088269692<br />colour: Type A","age: 44.2<br />p(chd): 0.089433957<br />colour: Type A","age: 44.4<br />p(chd): 0.090612052<br />colour: Type A","age: 44.6<br />p(chd): 0.091804101<br />colour: Type A","age: 44.8<br />p(chd): 0.093010228<br />colour: Type A","age: 45.0<br />p(chd): 0.094230558<br />colour: Type A","age: 45.2<br />p(chd): 0.095465213<br />colour: Type A","age: 45.4<br />p(chd): 0.096714318<br />colour: Type A","age: 45.6<br />p(chd): 0.097977996<br />colour: Type A","age: 45.8<br />p(chd): 0.099256372<br />colour: Type A","age: 46.0<br />p(chd): 0.100549568<br />colour: Type A","age: 46.2<br />p(chd): 0.101857707<br />colour: Type A","age: 46.4<br />p(chd): 0.103180913<br />colour: Type A","age: 46.6<br />p(chd): 0.104519308<br />colour: Type A","age: 46.8<br />p(chd): 0.105873014<br />colour: Type A","age: 47.0<br />p(chd): 0.107242153<br />colour: Type A","age: 47.2<br />p(chd): 0.108626847<br />colour: Type A","age: 47.4<br />p(chd): 0.110027216<br />colour: Type A","age: 47.6<br />p(chd): 0.111443381<br />colour: Type A","age: 47.8<br />p(chd): 0.112875462<br />colour: Type A","age: 48.0<br />p(chd): 0.114323578<br />colour: Type A","age: 48.2<br />p(chd): 0.115787847<br />colour: Type A","age: 48.4<br />p(chd): 0.117268388<br />colour: Type A","age: 48.6<br />p(chd): 0.118765317<br />colour: Type A","age: 48.8<br />p(chd): 0.120278751<br />colour: Type A","age: 49.0<br />p(chd): 0.121808804<br />colour: Type A","age: 49.2<br />p(chd): 0.123355592<br />colour: Type A","age: 49.4<br />p(chd): 0.124919228<br />colour: Type A","age: 49.6<br />p(chd): 0.126499825<br />colour: Type A","age: 49.8<br />p(chd): 0.128097492<br />colour: Type A","age: 50.0<br />p(chd): 0.129712342<br />colour: Type A","age: 50.2<br />p(chd): 0.131344483<br />colour: Type A","age: 50.4<br />p(chd): 0.132994022<br />colour: Type A","age: 50.6<br />p(chd): 0.134661066<br />colour: Type A","age: 50.8<br />p(chd): 0.136345719<br />colour: Type A","age: 51.0<br />p(chd): 0.138048087<br />colour: Type A","age: 51.2<br />p(chd): 0.139768269<br />colour: Type A","age: 51.4<br />p(chd): 0.141506367<br />colour: Type A","age: 51.6<br />p(chd): 0.143262480<br />colour: Type A","age: 51.8<br />p(chd): 0.145036705<br />colour: Type A","age: 52.0<br />p(chd): 0.146829137<br />colour: Type A","age: 52.2<br />p(chd): 0.148639869<br />colour: Type A","age: 52.4<br />p(chd): 0.150468993<br />colour: Type A","age: 52.6<br />p(chd): 0.152316599<br />colour: Type A","age: 52.8<br />p(chd): 0.154182774<br />colour: Type A","age: 53.0<br />p(chd): 0.156067604<br />colour: Type A","age: 53.2<br />p(chd): 0.157971172<br />colour: Type A","age: 53.4<br />p(chd): 0.159893559<br />colour: Type A","age: 53.6<br />p(chd): 0.161834844<br />colour: Type A","age: 53.8<br />p(chd): 0.163795103<br />colour: Type A","age: 54.0<br />p(chd): 0.165774410<br />colour: Type A","age: 54.2<br />p(chd): 0.167772835<br />colour: Type A","age: 54.4<br />p(chd): 0.169790449<br />colour: Type A","age: 54.6<br />p(chd): 0.171827317<br />colour: Type A","age: 54.8<br />p(chd): 0.173883502<br />colour: Type A","age: 55.0<br />p(chd): 0.175959065<br />colour: Type A","age: 55.2<br />p(chd): 0.178054062<br />colour: Type A","age: 55.4<br />p(chd): 0.180168550<br />colour: Type A","age: 55.6<br />p(chd): 0.182302579<br />colour: Type A","age: 55.8<br />p(chd): 0.184456197<br />colour: Type A","age: 56.0<br />p(chd): 0.186629451<br />colour: Type A","age: 56.2<br />p(chd): 0.188822381<br />colour: Type A","age: 56.4<br />p(chd): 0.191035026<br />colour: Type A","age: 56.6<br />p(chd): 0.193267423<br />colour: Type A","age: 56.8<br />p(chd): 0.195519601<br />colour: Type A","age: 57.0<br />p(chd): 0.197791590<br />colour: Type A","age: 57.2<br />p(chd): 0.200083413<br />colour: Type A","age: 57.4<br />p(chd): 0.202395093<br />colour: Type A","age: 57.6<br />p(chd): 0.204726645<br />colour: Type A","age: 57.8<br />p(chd): 0.207078082<br />colour: Type A","age: 58.0<br />p(chd): 0.209449415<br />colour: Type A","age: 58.2<br />p(chd): 0.211840648<br />colour: Type A","age: 58.4<br />p(chd): 0.214251782<br />colour: Type A","age: 58.6<br />p(chd): 0.216682814<br />colour: Type A","age: 58.8<br />p(chd): 0.219133738<br />colour: Type A","age: 59.0<br />p(chd): 0.221604541<br />colour: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,39.200000000000003,39.399999999999999,39.600000000000001,39.799999999999997,40,40.200000000000003,40.399999999999999,40.600000000000001,40.799999999999997,41,41.200000000000003,41.399999999999999,41.600000000000001,41.799999999999997,42,42.200000000000003,42.399999999999999,42.600000000000001,42.799999999999997,43,43.200000000000003,43.399999999999999,43.600000000000001,43.799999999999997,44,44.200000000000003,44.399999999999999,44.600000000000001,44.799999999999997,45,45.200000000000003,45.399999999999999,45.600000000000001,45.799999999999997,46,46.200000000000003,46.399999999999999,46.600000000000001,46.799999999999997,47,47.200000000000003,47.399999999999999,47.600000000000001,47.799999999999997,48,48.200000000000003,48.399999999999999,48.600000000000001,48.799999999999997,49,49.200000000000003,49.399999999999999,49.600000000000001,49.799999999999997,50,50.200000000000003,50.399999999999999,50.600000000000001,50.799999999999997,51,51.200000000000003,51.399999999999999,51.600000000000001,51.799999999999997,52,52.200000000000003,52.399999999999999,52.600000000000001,52.799999999999997,53,53.200000000000003,53.399999999999999,53.600000000000001,53.799999999999997,54,54.200000000000003,54.399999999999999,54.600000000000001,54.799999999999997,55,55.200000000000003,55.400000000000006,55.600000000000001,55.799999999999997,56,56.200000000000003,56.400000000000006,56.600000000000001,56.799999999999997,57,57.200000000000003,57.400000000000006,57.600000000000001,57.799999999999997,58,58.200000000000003,58.400000000000006,58.600000000000001,58.799999999999997,59],"y":[0.032224234433006586,0.032610434922715571,0.033001106109252679,0.033396295943880931,0.03379605280055574,0.034200425477384527,0.034609463198027199,0.035023215613035591,0.035441732801129965,0.03586506527040971,0.036293263959497085,0.036726380238610717,0.037164465910567192,0.037607573211708448,0.038055754812751939,0.038509063819562213,0.038967553773840161,0.039431278653728745,0.039900292874331666,0.040374651288142716,0.040854409185383488,0.041339622294246113,0.041830346781038981,0.042326639250232161,0.042828556744399948,0.043336156744057719,0.043849497167389888,0.044368636369866488,0.044893633143745011,0.045424546717454523,0.045961436754859135,0.046504363354397553,0.047053387048095661,0.047608568800448704,0.048169970007170146,0.04873765249380356,0.04931167851419449,0.049892110748818615,0.050479012302963248,0.051072446704758086,0.051672477903052176,0.052279170265133415,0.052892588574286914,0.053512798027188807,0.054139864231131429,0.054773853201076868,0.055414831356534189,0.056062865518257614,0.056718022904761099,0.057380371128645538,0.058049978192735434,0.058726912486019897,0.059411242779395468,0.060103038221205586,0.060802368332573527,0.061509303002524461,0.062223912482892406,0.062946267383008875,0.063676438664167972,0.064414497633864823,0.065160515939802752,0.065914565563665206,0.066676718814648414,0.067447048322750447,0.068225627031812799,0.069012528192310144,0.069807825353884162,0.070611592357617381,0.071423903328043034,0.072244832664886377,0.073074455034533747,0.073912845361225249,0.074760078817966577,0.075616230817156821,0.076481377000926679,0.077355593231185169,0.078238955579368663,0.079131540315889898,0.080033423899282655,0.080944682965037457,0.081865394314125983,0.082795634901208781,0.083735481822523966,0.084685012303452378,0.085644303685756012,0.086613433414486241,0.087592479024557857,0.088581518126986794,0.089580628394786505,0.090589887548521847,0.091609373341515601,0.092639163544705388,0.093679335931148827,0.094729968260172603,0.095791138261164574,0.096862923617004701,0.097945401947133665,0.09903865079025663,0.1001427475866794,0.10125776966027636,0.10238379420008667],"text":["age: 39.0<br />p(chd): 0.032224234<br />colour: Type B","age: 39.2<br />p(chd): 0.032610435<br />colour: Type B","age: 39.4<br />p(chd): 0.033001106<br />colour: Type B","age: 39.6<br />p(chd): 0.033396296<br />colour: Type B","age: 39.8<br />p(chd): 0.033796053<br />colour: Type B","age: 40.0<br />p(chd): 0.034200425<br />colour: Type B","age: 40.2<br />p(chd): 0.034609463<br />colour: Type B","age: 40.4<br />p(chd): 0.035023216<br />colour: Type B","age: 40.6<br />p(chd): 0.035441733<br />colour: Type B","age: 40.8<br />p(chd): 0.035865065<br />colour: Type B","age: 41.0<br />p(chd): 0.036293264<br />colour: Type B","age: 41.2<br />p(chd): 0.036726380<br />colour: Type B","age: 41.4<br />p(chd): 0.037164466<br />colour: Type B","age: 41.6<br />p(chd): 0.037607573<br />colour: Type B","age: 41.8<br />p(chd): 0.038055755<br />colour: Type B","age: 42.0<br />p(chd): 0.038509064<br />colour: Type B","age: 42.2<br />p(chd): 0.038967554<br />colour: Type B","age: 42.4<br />p(chd): 0.039431279<br />colour: Type B","age: 42.6<br />p(chd): 0.039900293<br />colour: Type B","age: 42.8<br />p(chd): 0.040374651<br />colour: Type B","age: 43.0<br />p(chd): 0.040854409<br />colour: Type B","age: 43.2<br />p(chd): 0.041339622<br />colour: Type B","age: 43.4<br />p(chd): 0.041830347<br />colour: Type B","age: 43.6<br />p(chd): 0.042326639<br />colour: Type B","age: 43.8<br />p(chd): 0.042828557<br />colour: Type B","age: 44.0<br />p(chd): 0.043336157<br />colour: Type B","age: 44.2<br />p(chd): 0.043849497<br />colour: Type B","age: 44.4<br />p(chd): 0.044368636<br />colour: Type B","age: 44.6<br />p(chd): 0.044893633<br />colour: Type B","age: 44.8<br />p(chd): 0.045424547<br />colour: Type B","age: 45.0<br />p(chd): 0.045961437<br />colour: Type B","age: 45.2<br />p(chd): 0.046504363<br />colour: Type B","age: 45.4<br />p(chd): 0.047053387<br />colour: Type B","age: 45.6<br />p(chd): 0.047608569<br />colour: Type B","age: 45.8<br />p(chd): 0.048169970<br />colour: Type B","age: 46.0<br />p(chd): 0.048737652<br />colour: Type B","age: 46.2<br />p(chd): 0.049311679<br />colour: Type B","age: 46.4<br />p(chd): 0.049892111<br />colour: Type B","age: 46.6<br />p(chd): 0.050479012<br />colour: Type B","age: 46.8<br />p(chd): 0.051072447<br />colour: Type B","age: 47.0<br />p(chd): 0.051672478<br />colour: Type B","age: 47.2<br />p(chd): 0.052279170<br />colour: Type B","age: 47.4<br />p(chd): 0.052892589<br />colour: Type B","age: 47.6<br />p(chd): 0.053512798<br />colour: Type B","age: 47.8<br />p(chd): 0.054139864<br />colour: Type B","age: 48.0<br />p(chd): 0.054773853<br />colour: Type B","age: 48.2<br />p(chd): 0.055414831<br />colour: Type B","age: 48.4<br />p(chd): 0.056062866<br />colour: Type B","age: 48.6<br />p(chd): 0.056718023<br />colour: Type B","age: 48.8<br />p(chd): 0.057380371<br />colour: Type B","age: 49.0<br />p(chd): 0.058049978<br />colour: Type B","age: 49.2<br />p(chd): 0.058726912<br />colour: Type B","age: 49.4<br />p(chd): 0.059411243<br />colour: Type B","age: 49.6<br />p(chd): 0.060103038<br />colour: Type B","age: 49.8<br />p(chd): 0.060802368<br />colour: Type B","age: 50.0<br />p(chd): 0.061509303<br />colour: Type B","age: 50.2<br />p(chd): 0.062223912<br />colour: Type B","age: 50.4<br />p(chd): 0.062946267<br />colour: Type B","age: 50.6<br />p(chd): 0.063676439<br />colour: Type B","age: 50.8<br />p(chd): 0.064414498<br />colour: Type B","age: 51.0<br />p(chd): 0.065160516<br />colour: Type B","age: 51.2<br />p(chd): 0.065914566<br />colour: Type B","age: 51.4<br />p(chd): 0.066676719<br />colour: Type B","age: 51.6<br />p(chd): 0.067447048<br />colour: Type B","age: 51.8<br />p(chd): 0.068225627<br />colour: Type B","age: 52.0<br />p(chd): 0.069012528<br />colour: Type B","age: 52.2<br />p(chd): 0.069807825<br />colour: Type B","age: 52.4<br />p(chd): 0.070611592<br />colour: Type B","age: 52.6<br />p(chd): 0.071423903<br />colour: Type B","age: 52.8<br />p(chd): 0.072244833<br />colour: Type B","age: 53.0<br />p(chd): 0.073074455<br />colour: Type B","age: 53.2<br />p(chd): 0.073912845<br />colour: Type B","age: 53.4<br />p(chd): 0.074760079<br />colour: Type B","age: 53.6<br />p(chd): 0.075616231<br />colour: Type B","age: 53.8<br />p(chd): 0.076481377<br />colour: Type B","age: 54.0<br />p(chd): 0.077355593<br />colour: Type B","age: 54.2<br />p(chd): 0.078238956<br />colour: Type B","age: 54.4<br />p(chd): 0.079131540<br />colour: Type B","age: 54.6<br />p(chd): 0.080033424<br />colour: Type B","age: 54.8<br />p(chd): 0.080944683<br />colour: Type B","age: 55.0<br />p(chd): 0.081865394<br />colour: Type B","age: 55.2<br />p(chd): 0.082795635<br />colour: Type B","age: 55.4<br />p(chd): 0.083735482<br />colour: Type B","age: 55.6<br />p(chd): 0.084685012<br />colour: Type B","age: 55.8<br />p(chd): 0.085644304<br />colour: Type B","age: 56.0<br />p(chd): 0.086613433<br />colour: Type B","age: 56.2<br />p(chd): 0.087592479<br />colour: Type B","age: 56.4<br />p(chd): 0.088581518<br />colour: Type B","age: 56.6<br />p(chd): 0.089580628<br />colour: Type B","age: 56.8<br />p(chd): 0.090589888<br />colour: Type B","age: 57.0<br />p(chd): 0.091609373<br />colour: Type B","age: 57.2<br />p(chd): 0.092639164<br />colour: Type B","age: 57.4<br />p(chd): 0.093679336<br />colour: Type B","age: 57.6<br />p(chd): 0.094729968<br />colour: Type B","age: 57.8<br />p(chd): 0.095791138<br />colour: Type B","age: 58.0<br />p(chd): 0.096862924<br />colour: Type B","age: 58.2<br />p(chd): 0.097945402<br />colour: Type B","age: 58.4<br />p(chd): 0.099038651<br />colour: Type B","age: 58.6<br />p(chd): 0.100142748<br />colour: Type B","age: 58.8<br />p(chd): 0.101257770<br />colour: Type B","age: 59.0<br />p(chd): 0.102383794<br />colour: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[38,60],"tickmode":"array","ticktext":["40","45","50","55","60"],"tickvals":[40,45,50,55,60],"categoryorder":"array","categoryarray":["40","45","50","55","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Age (years)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.012244897959183675,0.25714285714285712],"tickmode":"array","ticktext":["0%","5%","10%","15%","20%","25%"],"tickvals":[1.7347234759768071e-18,0.050000000000000003,0.10000000000000001,0.15000000000000002,0.20000000000000001,0.24999999999999997],"categoryorder":"array","categoryarray":["0%","5%","10%","15%","20%","25%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"P(CHD Event by 1969)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Behavioral Pattern<br />n","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"77a44815b300":{"x":{},"y":{},"colour":{},"size":{},"type":"scatter"},"77a489ae9f9":{"x":{},"y":{},"colour":{}},"77a47276ded8":{"x":{},"y":{},"colour":{}},"77a45a20719d":{"x":{},"y":{},"colour":{}}},"cur_data":"77a44815b300","visdat":{"77a44815b300":["function (y) ","x"],"77a489ae9f9":["function (y) ","x"],"77a47276ded8":["function (y) ","x"],"77a45a20719d":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="odds-scale-1" class="level4">
<h4 class="anchored" data-anchor-id="odds-scale-1">odds scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>)) <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>)) <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>chd_plot_odds_2 <span class="ot">=</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  chd_plot_odds <span class="sc">+</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_odds_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-a012e4318221b2f7ad09" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a012e4318221b2f7ad09">{"x":{"data":[{"x":[50,51,59,44,47,40,41,43,54,48,39,49,55,56,42,45,46,57,53,52,58],"y":[0.11764705882352941,0.19642857142857142,0.30434782608695654,0.086538461538461536,0.1076923076923077,0.072580645161290328,0.069306930693069299,0.077777777777777765,0.15217391304347824,0.17647058823529413,0.094017094017094016,0.31372549019607843,0.19565217391304346,0.32432432432432434,0.041237113402061855,0.10000000000000001,0.070588235294117646,0.14814814814814814,0.12727272727272726,0.25,0.17241379310344829],"text":["age: 50<br />odds(chd): 0.1176470588<br />dibpat: Type A<br />n:  76","age: 51<br />odds(chd): 0.1964285714<br />dibpat: Type A<br />n:  67","age: 59<br />odds(chd): 0.3043478261<br />dibpat: Type A<br />n:  30","age: 44<br />odds(chd): 0.0865384615<br />dibpat: Type A<br />n: 113","age: 47<br />odds(chd): 0.1076923077<br />dibpat: Type A<br />n:  72","age: 40<br />odds(chd): 0.0725806452<br />dibpat: Type A<br />n: 133","age: 41<br />odds(chd): 0.0693069307<br />dibpat: Type A<br />n: 108","age: 43<br />odds(chd): 0.0777777778<br />dibpat: Type A<br />n:  97","age: 54<br />odds(chd): 0.1521739130<br />dibpat: Type A<br />n:  53","age: 48<br />odds(chd): 0.1764705882<br />dibpat: Type A<br />n:  80","age: 39<br />odds(chd): 0.0940170940<br />dibpat: Type A<br />n: 128","age: 49<br />odds(chd): 0.3137254902<br />dibpat: Type A<br />n:  67","age: 55<br />odds(chd): 0.1956521739<br />dibpat: Type A<br />n:  55","age: 56<br />odds(chd): 0.3243243243<br />dibpat: Type A<br />n:  49","age: 42<br />odds(chd): 0.0412371134<br />dibpat: Type A<br />n: 101","age: 45<br />odds(chd): 0.1000000000<br />dibpat: Type A<br />n:  77","age: 46<br />odds(chd): 0.0705882353<br />dibpat: Type A<br />n:  91","age: 57<br />odds(chd): 0.1481481481<br />dibpat: Type A<br />n:  31","age: 53<br />odds(chd): 0.1272727273<br />dibpat: Type A<br />n:  62","age: 52<br />odds(chd): 0.2500000000<br />dibpat: Type A<br />n:  65","age: 58<br />odds(chd): 0.1724137931<br />dibpat: Type A<br />n:  34"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":[11.507808770054302,10.893987081881484,7.4072043526108828,13.637611848597116,11.241235656543804,14.615949458394798,13.377458191723871,12.778686124337518,9.8163466467363971,11.765488567001361,14.379833505125502,10.893987081881484,9.9817695786372642,9.4710951773162115,13.000921034406357,11.573027489273997,12.434641120809431,7.5441456810618819,10.52889648301692,10.750245809698832,7.9279346825975772],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[45,41,47,39,49,51,42,50,44,56,40,58,48,43,53,54,46,52,55,57,59],"y":[0.04807692307692308,0.041666666666666671,0.013513513513513514,0.061538461538461542,0.080645161290322578,0.11999999999999998,0.0083333333333333332,0.053571428571428575,0.033898305084745763,0,0.021276595744680851,0.047619047619047616,0.090909090909090912,0.053571428571428575,0.13157894736842105,0.080000000000000002,0.067567567567567571,0.043478260869565216,0.041666666666666671,0.10344827586206896,0.30769230769230771],"text":["age: 45<br />odds(chd): 0.0480769231<br />dibpat: Type B<br />n: 109","age: 41<br />odds(chd): 0.0416666667<br />dibpat: Type B<br />n: 125","age: 47<br />odds(chd): 0.0135135135<br />dibpat: Type B<br />n:  75","age: 39<br />odds(chd): 0.0615384615<br />dibpat: Type B<br />n: 138","age: 49<br />odds(chd): 0.0806451613<br />dibpat: Type B<br />n:  67","age: 51<br />odds(chd): 0.1200000000<br />dibpat: Type B<br />n:  56","age: 42<br />odds(chd): 0.0083333333<br />dibpat: Type B<br />n: 121","age: 50<br />odds(chd): 0.0535714286<br />dibpat: Type B<br />n:  59","age: 44<br />odds(chd): 0.0338983051<br />dibpat: Type B<br />n: 122","age: 56<br />odds(chd): 0.0000000000<br />dibpat: Type B<br />n:  27","age: 40<br />odds(chd): 0.0212765957<br />dibpat: Type B<br />n: 144","age: 58<br />odds(chd): 0.0476190476<br />dibpat: Type B<br />n:  22","age: 48<br />odds(chd): 0.0909090909<br />dibpat: Type B<br />n:  84","age: 43<br />odds(chd): 0.0535714286<br />dibpat: Type B<br />n: 118","age: 53<br />odds(chd): 0.1315789474<br />dibpat: Type B<br />n:  43","age: 54<br />odds(chd): 0.0800000000<br />dibpat: Type B<br />n:  54","age: 46<br />odds(chd): 0.0675675676<br />dibpat: Type B<br />n:  79","age: 52<br />odds(chd): 0.0434782609<br />dibpat: Type B<br />n:  48","age: 55<br />odds(chd): 0.0416666667<br />dibpat: Type B<br />n:  25","age: 57<br />odds(chd): 0.1034482759<br />dibpat: Type B<br />n:  32","age: 59<br />odds(chd): 0.3076923077<br />dibpat: Type B<br />n:  17"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":[13.430049986134389,14.235604935020691,11.442034967876614,14.847029219804128,10.893987081881484,10.062848078932257,14.040147001760529,10.300037417465363,14.089358888134319,6.9612105822972117,15.118110236220474,6.0293172003757194,12.015109867829196,13.89107438878934,8.9098372804078227,9.8996170505112442,11.701854397452983,9.3814585892624311,6.6253113681856641,7.6762775241645578,3.7795275590551185],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.094017094017094016,0.072580645161290328,0.069306930693069299,0.041237113402061855,0.077777777777777765,0.086538461538461536,0.10000000000000001,0.070588235294117646,0.1076923076923077,0.17647058823529413,0.31372549019607843,0.11764705882352941,0.19642857142857142,0.25,0.12727272727272726,0.15217391304347824,0.19565217391304346,0.32432432432432434,0.14814814814814814,0.17241379310344829,0.30434782608695654],"text":["age: 39<br />odds(chd): 0.0940170940<br />dibpat: Type A","age: 40<br />odds(chd): 0.0725806452<br />dibpat: Type A","age: 41<br />odds(chd): 0.0693069307<br />dibpat: Type A","age: 42<br />odds(chd): 0.0412371134<br />dibpat: Type A","age: 43<br />odds(chd): 0.0777777778<br />dibpat: Type A","age: 44<br />odds(chd): 0.0865384615<br />dibpat: Type A","age: 45<br />odds(chd): 0.1000000000<br />dibpat: Type A","age: 46<br />odds(chd): 0.0705882353<br />dibpat: Type A","age: 47<br />odds(chd): 0.1076923077<br />dibpat: Type A","age: 48<br />odds(chd): 0.1764705882<br />dibpat: Type A","age: 49<br />odds(chd): 0.3137254902<br />dibpat: Type A","age: 50<br />odds(chd): 0.1176470588<br />dibpat: Type A","age: 51<br />odds(chd): 0.1964285714<br />dibpat: Type A","age: 52<br />odds(chd): 0.2500000000<br />dibpat: Type A","age: 53<br />odds(chd): 0.1272727273<br />dibpat: Type A","age: 54<br />odds(chd): 0.1521739130<br />dibpat: Type A","age: 55<br />odds(chd): 0.1956521739<br />dibpat: Type A","age: 56<br />odds(chd): 0.3243243243<br />dibpat: Type A","age: 57<br />odds(chd): 0.1481481481<br />dibpat: Type A","age: 58<br />odds(chd): 0.1724137931<br />dibpat: Type A","age: 59<br />odds(chd): 0.3043478261<br />dibpat: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[0.061538461538461542,0.021276595744680851,0.041666666666666671,0.0083333333333333332,0.053571428571428575,0.033898305084745763,0.04807692307692308,0.067567567567567571,0.013513513513513514,0.090909090909090912,0.080645161290322578,0.053571428571428575,0.11999999999999998,0.043478260869565216,0.13157894736842105,0.080000000000000002,0.041666666666666671,0,0.10344827586206896,0.047619047619047616,0.30769230769230771],"text":["age: 39<br />odds(chd): 0.0615384615<br />dibpat: Type B","age: 40<br />odds(chd): 0.0212765957<br />dibpat: Type B","age: 41<br />odds(chd): 0.0416666667<br />dibpat: Type B","age: 42<br />odds(chd): 0.0083333333<br />dibpat: Type B","age: 43<br />odds(chd): 0.0535714286<br />dibpat: Type B","age: 44<br />odds(chd): 0.0338983051<br />dibpat: Type B","age: 45<br />odds(chd): 0.0480769231<br />dibpat: Type B","age: 46<br />odds(chd): 0.0675675676<br />dibpat: Type B","age: 47<br />odds(chd): 0.0135135135<br />dibpat: Type B","age: 48<br />odds(chd): 0.0909090909<br />dibpat: Type B","age: 49<br />odds(chd): 0.0806451613<br />dibpat: Type B","age: 50<br />odds(chd): 0.0535714286<br />dibpat: Type B","age: 51<br />odds(chd): 0.1200000000<br />dibpat: Type B","age: 52<br />odds(chd): 0.0434782609<br />dibpat: Type B","age: 53<br />odds(chd): 0.1315789474<br />dibpat: Type B","age: 54<br />odds(chd): 0.0800000000<br />dibpat: Type B","age: 55<br />odds(chd): 0.0416666667<br />dibpat: Type B","age: 56<br />odds(chd): 0.0000000000<br />dibpat: Type B","age: 57<br />odds(chd): 0.1034482759<br />dibpat: Type B","age: 58<br />odds(chd): 0.0476190476<br />dibpat: Type B","age: 59<br />odds(chd): 0.3076923077<br />dibpat: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,39.200000000000003,39.399999999999999,39.600000000000001,39.799999999999997,40,40.200000000000003,40.399999999999999,40.600000000000001,40.799999999999997,41,41.200000000000003,41.399999999999999,41.600000000000001,41.799999999999997,42,42.200000000000003,42.399999999999999,42.600000000000001,42.799999999999997,43,43.200000000000003,43.399999999999999,43.600000000000001,43.799999999999997,44,44.200000000000003,44.399999999999999,44.600000000000001,44.799999999999997,45,45.200000000000003,45.399999999999999,45.600000000000001,45.799999999999997,46,46.200000000000003,46.399999999999999,46.600000000000001,46.799999999999997,47,47.200000000000003,47.399999999999999,47.600000000000001,47.799999999999997,48,48.200000000000003,48.399999999999999,48.600000000000001,48.799999999999997,49,49.200000000000003,49.399999999999999,49.600000000000001,49.799999999999997,50,50.200000000000003,50.399999999999999,50.600000000000001,50.799999999999997,51,51.200000000000003,51.399999999999999,51.600000000000001,51.799999999999997,52,52.200000000000003,52.399999999999999,52.600000000000001,52.799999999999997,53,53.200000000000003,53.399999999999999,53.600000000000001,53.799999999999997,54,54.200000000000003,54.399999999999999,54.600000000000001,54.799999999999997,55,55.200000000000003,55.400000000000006,55.600000000000001,55.799999999999997,56,56.200000000000003,56.400000000000006,56.600000000000001,56.799999999999997,57,57.200000000000003,57.400000000000006,57.600000000000001,57.799999999999997,58,58.200000000000003,58.400000000000006,58.600000000000001,58.799999999999997,59],"y":[0.067577300437532919,0.068556180559623786,0.069549240092363143,0.070556684429324654,0.071578721939277362,0.072615564009282721,0.073667425088415506,0.074734522732117947,0.07581707764719689,0.076915313737471944,0.078029458150085593,0.079159741322483781,0.080306397030076887,0.081469662434591569,0.082649778133122478,0.083846988207894851,0.085061540276747644,0.086293685544348353,0.087543678854149223,0.0888117787410964,0.090098247485102437,0.091403351165293287,0.092727359715041452,0.094070546977795877,0.095433190763720616,0.096815572907154493,0.098217979324902074,0.099640700075369834,0.10108402941855894,0.10254826587692614,0.1040337122971276,0.10554067591265577,0.10706946840738446,0.10862040598003443,0.11019380940957176,0.1117900041215551,0.1134093202554424,0.11505209273287365,0.11671866132694275,0.11840937073247176,0.12012457063730438,0.12186461579463131,0.12362986609636351,0.12542068664756839,0.12723744784198421,0.12908052543862811,0.13095030063951399,0.13284716016849638,0.13477149635125593,0.13672370719644397,0.13870419647800211,0.14071337381867452,0.14275165477472959,0.14481946092190956,0.14691721994262399,0.1490453657144076,0.15120433839965802,0.15339458453667468,0.15561655713201583,0.15787071575419331,0.16015752662872484,0.16247746273456284,0.16483100390192029,0.16721863691151381,0.16964085559524344,0.17209816093833225,0.17459106118294401,0.17712007193330251,0.17968571626233396,0.18228852481985305,0.18492903594231741,0.1876077957641705,0.19032535833079861,0.19308228571312361,0.19587914812385498,0.19871652403542719,0.20159500029964372,0.20451517226905569,0.2074776439200981,0.21048302797800908,0.21353194604356013,0.21662502872162057,0.21976291575158516,0.22294625613969077,0.22617570829325004,0.22945194015682885,0.23277562935039645,0.23614746330947742,0.23956813942733296,0.24303836519920252,0.24655885836863409,0.25013034707593412,0.25375357000876869,0.25742927655494502,0.26115822695740731,0.26494119247147679,0.26877895552436926,0.27267230987702429,0.27662206078827795,0.28062902518141386,0.28469403181312664],"text":["age: 39.0<br />odds(chd): 0.067577300<br />colour: Type A","age: 39.2<br />odds(chd): 0.068556181<br />colour: Type A","age: 39.4<br />odds(chd): 0.069549240<br />colour: Type A","age: 39.6<br />odds(chd): 0.070556684<br />colour: Type A","age: 39.8<br />odds(chd): 0.071578722<br />colour: Type A","age: 40.0<br />odds(chd): 0.072615564<br />colour: Type A","age: 40.2<br />odds(chd): 0.073667425<br />colour: Type A","age: 40.4<br />odds(chd): 0.074734523<br />colour: Type A","age: 40.6<br />odds(chd): 0.075817078<br />colour: Type A","age: 40.8<br />odds(chd): 0.076915314<br />colour: Type A","age: 41.0<br />odds(chd): 0.078029458<br />colour: Type A","age: 41.2<br />odds(chd): 0.079159741<br />colour: Type A","age: 41.4<br />odds(chd): 0.080306397<br />colour: Type A","age: 41.6<br />odds(chd): 0.081469662<br />colour: Type A","age: 41.8<br />odds(chd): 0.082649778<br />colour: Type A","age: 42.0<br />odds(chd): 0.083846988<br />colour: Type A","age: 42.2<br />odds(chd): 0.085061540<br />colour: Type A","age: 42.4<br />odds(chd): 0.086293686<br />colour: Type A","age: 42.6<br />odds(chd): 0.087543679<br />colour: Type A","age: 42.8<br />odds(chd): 0.088811779<br />colour: Type A","age: 43.0<br />odds(chd): 0.090098247<br />colour: Type A","age: 43.2<br />odds(chd): 0.091403351<br />colour: Type A","age: 43.4<br />odds(chd): 0.092727360<br />colour: Type A","age: 43.6<br />odds(chd): 0.094070547<br />colour: Type A","age: 43.8<br />odds(chd): 0.095433191<br />colour: Type A","age: 44.0<br />odds(chd): 0.096815573<br />colour: Type A","age: 44.2<br />odds(chd): 0.098217979<br />colour: Type A","age: 44.4<br />odds(chd): 0.099640700<br />colour: Type A","age: 44.6<br />odds(chd): 0.101084029<br />colour: Type A","age: 44.8<br />odds(chd): 0.102548266<br />colour: Type A","age: 45.0<br />odds(chd): 0.104033712<br />colour: Type A","age: 45.2<br />odds(chd): 0.105540676<br />colour: Type A","age: 45.4<br />odds(chd): 0.107069468<br />colour: Type A","age: 45.6<br />odds(chd): 0.108620406<br />colour: Type A","age: 45.8<br />odds(chd): 0.110193809<br />colour: Type A","age: 46.0<br />odds(chd): 0.111790004<br />colour: Type A","age: 46.2<br />odds(chd): 0.113409320<br />colour: Type A","age: 46.4<br />odds(chd): 0.115052093<br />colour: Type A","age: 46.6<br />odds(chd): 0.116718661<br />colour: Type A","age: 46.8<br />odds(chd): 0.118409371<br />colour: Type A","age: 47.0<br />odds(chd): 0.120124571<br />colour: Type A","age: 47.2<br />odds(chd): 0.121864616<br />colour: Type A","age: 47.4<br />odds(chd): 0.123629866<br />colour: Type A","age: 47.6<br />odds(chd): 0.125420687<br />colour: Type A","age: 47.8<br />odds(chd): 0.127237448<br />colour: Type A","age: 48.0<br />odds(chd): 0.129080525<br />colour: Type A","age: 48.2<br />odds(chd): 0.130950301<br />colour: Type A","age: 48.4<br />odds(chd): 0.132847160<br />colour: Type A","age: 48.6<br />odds(chd): 0.134771496<br />colour: Type A","age: 48.8<br />odds(chd): 0.136723707<br />colour: Type A","age: 49.0<br />odds(chd): 0.138704196<br />colour: Type A","age: 49.2<br />odds(chd): 0.140713374<br />colour: Type A","age: 49.4<br />odds(chd): 0.142751655<br />colour: Type A","age: 49.6<br />odds(chd): 0.144819461<br />colour: Type A","age: 49.8<br />odds(chd): 0.146917220<br />colour: Type A","age: 50.0<br />odds(chd): 0.149045366<br />colour: Type A","age: 50.2<br />odds(chd): 0.151204338<br />colour: Type A","age: 50.4<br />odds(chd): 0.153394585<br />colour: Type A","age: 50.6<br />odds(chd): 0.155616557<br />colour: Type A","age: 50.8<br />odds(chd): 0.157870716<br />colour: Type A","age: 51.0<br />odds(chd): 0.160157527<br />colour: Type A","age: 51.2<br />odds(chd): 0.162477463<br />colour: Type A","age: 51.4<br />odds(chd): 0.164831004<br />colour: Type A","age: 51.6<br />odds(chd): 0.167218637<br />colour: Type A","age: 51.8<br />odds(chd): 0.169640856<br />colour: Type A","age: 52.0<br />odds(chd): 0.172098161<br />colour: Type A","age: 52.2<br />odds(chd): 0.174591061<br />colour: Type A","age: 52.4<br />odds(chd): 0.177120072<br />colour: Type A","age: 52.6<br />odds(chd): 0.179685716<br />colour: Type A","age: 52.8<br />odds(chd): 0.182288525<br />colour: Type A","age: 53.0<br />odds(chd): 0.184929036<br />colour: Type A","age: 53.2<br />odds(chd): 0.187607796<br />colour: Type A","age: 53.4<br />odds(chd): 0.190325358<br />colour: Type A","age: 53.6<br />odds(chd): 0.193082286<br />colour: Type A","age: 53.8<br />odds(chd): 0.195879148<br />colour: Type A","age: 54.0<br />odds(chd): 0.198716524<br />colour: Type A","age: 54.2<br />odds(chd): 0.201595000<br />colour: Type A","age: 54.4<br />odds(chd): 0.204515172<br />colour: Type A","age: 54.6<br />odds(chd): 0.207477644<br />colour: Type A","age: 54.8<br />odds(chd): 0.210483028<br />colour: Type A","age: 55.0<br />odds(chd): 0.213531946<br />colour: Type A","age: 55.2<br />odds(chd): 0.216625029<br />colour: Type A","age: 55.4<br />odds(chd): 0.219762916<br />colour: Type A","age: 55.6<br />odds(chd): 0.222946256<br />colour: Type A","age: 55.8<br />odds(chd): 0.226175708<br />colour: Type A","age: 56.0<br />odds(chd): 0.229451940<br />colour: Type A","age: 56.2<br />odds(chd): 0.232775629<br />colour: Type A","age: 56.4<br />odds(chd): 0.236147463<br />colour: Type A","age: 56.6<br />odds(chd): 0.239568139<br />colour: Type A","age: 56.8<br />odds(chd): 0.243038365<br />colour: Type A","age: 57.0<br />odds(chd): 0.246558858<br />colour: Type A","age: 57.2<br />odds(chd): 0.250130347<br />colour: Type A","age: 57.4<br />odds(chd): 0.253753570<br />colour: Type A","age: 57.6<br />odds(chd): 0.257429277<br />colour: Type A","age: 57.8<br />odds(chd): 0.261158227<br />colour: Type A","age: 58.0<br />odds(chd): 0.264941192<br />colour: Type A","age: 58.2<br />odds(chd): 0.268778956<br />colour: Type A","age: 58.4<br />odds(chd): 0.272672310<br />colour: Type A","age: 58.6<br />odds(chd): 0.276622061<br />colour: Type A","age: 58.8<br />odds(chd): 0.280629025<br />colour: Type A","age: 59.0<br />odds(chd): 0.284694032<br />colour: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,39.200000000000003,39.399999999999999,39.600000000000001,39.799999999999997,40,40.200000000000003,40.399999999999999,40.600000000000001,40.799999999999997,41,41.200000000000003,41.399999999999999,41.600000000000001,41.799999999999997,42,42.200000000000003,42.399999999999999,42.600000000000001,42.799999999999997,43,43.200000000000003,43.399999999999999,43.600000000000001,43.799999999999997,44,44.200000000000003,44.399999999999999,44.600000000000001,44.799999999999997,45,45.200000000000003,45.399999999999999,45.600000000000001,45.799999999999997,46,46.200000000000003,46.399999999999999,46.600000000000001,46.799999999999997,47,47.200000000000003,47.399999999999999,47.600000000000001,47.799999999999997,48,48.200000000000003,48.399999999999999,48.600000000000001,48.799999999999997,49,49.200000000000003,49.399999999999999,49.600000000000001,49.799999999999997,50,50.200000000000003,50.399999999999999,50.600000000000001,50.799999999999997,51,51.200000000000003,51.399999999999999,51.600000000000001,51.799999999999997,52,52.200000000000003,52.399999999999999,52.600000000000001,52.799999999999997,53,53.200000000000003,53.399999999999999,53.600000000000001,53.799999999999997,54,54.200000000000003,54.399999999999999,54.600000000000001,54.799999999999997,55,55.200000000000003,55.400000000000006,55.600000000000001,55.799999999999997,56,56.200000000000003,56.400000000000006,56.600000000000001,56.799999999999997,57,57.200000000000003,57.400000000000006,57.600000000000001,57.799999999999997,58,58.200000000000003,58.400000000000006,58.600000000000001,58.799999999999997,59],"y":[0.033297211585089949,0.033709723672810485,0.034127346285239064,0.034550142735581747,0.034978177121418388,0.035411514334420198,0.035850220070187531,0.03629436083820952,0.036744003971947381,0.037199217639042131,0.037660070851649359,0.038126633476901546,0.038598976247500208,0.039077170772439392,0.039561289547861651,0.040051405968049007,0.04054759433654951,0.041049929877442194,0.041558488746741264,0.042073348043941514,0.042594585823707155,0.043122281107704941,0.043656513896584349,0.04419736518210593,0.044744916959419928,0.045299252239497177,0.045860455061713712,0.046428610506591618,0.047003804708697514,0.047586124869700874,0.048175659271594146,0.048772497290076648,0.049376729408104274,0.049988447229607054,0.050607743493376663,0.051234712087125982,0.051869448061722875,0.052512047645600128,0.05316260825934431,0.053821228530464858,0.054488008308346533,0.055163048679386935,0.055846451982321507,0.056538321823738739,0.057238763093786948,0.057947881982076448,0.058665785993777912,0.059392583965920856,0.060128386083893703,0.060873303898148108,0.0616274503411108,0.062390939744304187,0.063163887855679765,0.063946411857165777,0.064738630382432522,0.065540663534877752,0.066352632905834541,0.067174661593005322,0.068006874219123797,0.068849396950848268,0.069702357517888988,0.070565885232372491,0.071440111008445814,0.072325167382123537,0.073221188531380849,0.074128310296495345,0.075046670200641069,0.07597640747073732,0.076917663058556351,0.077870579662091918,0.078835301747192901,0.07981197556946501,0.08080074919644345,0.081801772530040964,0.082815197329272949,0.083841177233265354,0.084879867784546495,0.085931426452627954,0.086996012657877958,0.088073787795689515,0.089164915260949218,0.090269560472807972,0.091387890899759586,0.092520076085029448,0.09366628767227797,0.094826699431622571,0.096001487285981554,0.09719082933774513,0.098394905895776,0.099613899502745309,0.10084799496280665,0.10209737936961277,0.10336224213468029,0.10464277501610457,0.10593917214763168,0.10725163006808927,0.10858034775118282,0.10992552663566091,0.11128737065585381,0.11266608627259123,0.11406188250450208],"text":["age: 39.0<br />odds(chd): 0.033297212<br />colour: Type B","age: 39.2<br />odds(chd): 0.033709724<br />colour: Type B","age: 39.4<br />odds(chd): 0.034127346<br />colour: Type B","age: 39.6<br />odds(chd): 0.034550143<br />colour: Type B","age: 39.8<br />odds(chd): 0.034978177<br />colour: Type B","age: 40.0<br />odds(chd): 0.035411514<br />colour: Type B","age: 40.2<br />odds(chd): 0.035850220<br />colour: Type B","age: 40.4<br />odds(chd): 0.036294361<br />colour: Type B","age: 40.6<br />odds(chd): 0.036744004<br />colour: Type B","age: 40.8<br />odds(chd): 0.037199218<br />colour: Type B","age: 41.0<br />odds(chd): 0.037660071<br />colour: Type B","age: 41.2<br />odds(chd): 0.038126633<br />colour: Type B","age: 41.4<br />odds(chd): 0.038598976<br />colour: Type B","age: 41.6<br />odds(chd): 0.039077171<br />colour: Type B","age: 41.8<br />odds(chd): 0.039561290<br />colour: Type B","age: 42.0<br />odds(chd): 0.040051406<br />colour: Type B","age: 42.2<br />odds(chd): 0.040547594<br />colour: Type B","age: 42.4<br />odds(chd): 0.041049930<br />colour: Type B","age: 42.6<br />odds(chd): 0.041558489<br />colour: Type B","age: 42.8<br />odds(chd): 0.042073348<br />colour: Type B","age: 43.0<br />odds(chd): 0.042594586<br />colour: Type B","age: 43.2<br />odds(chd): 0.043122281<br />colour: Type B","age: 43.4<br />odds(chd): 0.043656514<br />colour: Type B","age: 43.6<br />odds(chd): 0.044197365<br />colour: Type B","age: 43.8<br />odds(chd): 0.044744917<br />colour: Type B","age: 44.0<br />odds(chd): 0.045299252<br />colour: Type B","age: 44.2<br />odds(chd): 0.045860455<br />colour: Type B","age: 44.4<br />odds(chd): 0.046428611<br />colour: Type B","age: 44.6<br />odds(chd): 0.047003805<br />colour: Type B","age: 44.8<br />odds(chd): 0.047586125<br />colour: Type B","age: 45.0<br />odds(chd): 0.048175659<br />colour: Type B","age: 45.2<br />odds(chd): 0.048772497<br />colour: Type B","age: 45.4<br />odds(chd): 0.049376729<br />colour: Type B","age: 45.6<br />odds(chd): 0.049988447<br />colour: Type B","age: 45.8<br />odds(chd): 0.050607743<br />colour: Type B","age: 46.0<br />odds(chd): 0.051234712<br />colour: Type B","age: 46.2<br />odds(chd): 0.051869448<br />colour: Type B","age: 46.4<br />odds(chd): 0.052512048<br />colour: Type B","age: 46.6<br />odds(chd): 0.053162608<br />colour: Type B","age: 46.8<br />odds(chd): 0.053821229<br />colour: Type B","age: 47.0<br />odds(chd): 0.054488008<br />colour: Type B","age: 47.2<br />odds(chd): 0.055163049<br />colour: Type B","age: 47.4<br />odds(chd): 0.055846452<br />colour: Type B","age: 47.6<br />odds(chd): 0.056538322<br />colour: Type B","age: 47.8<br />odds(chd): 0.057238763<br />colour: Type B","age: 48.0<br />odds(chd): 0.057947882<br />colour: Type B","age: 48.2<br />odds(chd): 0.058665786<br />colour: Type B","age: 48.4<br />odds(chd): 0.059392584<br />colour: Type B","age: 48.6<br />odds(chd): 0.060128386<br />colour: Type B","age: 48.8<br />odds(chd): 0.060873304<br />colour: Type B","age: 49.0<br />odds(chd): 0.061627450<br />colour: Type B","age: 49.2<br />odds(chd): 0.062390940<br />colour: Type B","age: 49.4<br />odds(chd): 0.063163888<br />colour: Type B","age: 49.6<br />odds(chd): 0.063946412<br />colour: Type B","age: 49.8<br />odds(chd): 0.064738630<br />colour: Type B","age: 50.0<br />odds(chd): 0.065540664<br />colour: Type B","age: 50.2<br />odds(chd): 0.066352633<br />colour: Type B","age: 50.4<br />odds(chd): 0.067174662<br />colour: Type B","age: 50.6<br />odds(chd): 0.068006874<br />colour: Type B","age: 50.8<br />odds(chd): 0.068849397<br />colour: Type B","age: 51.0<br />odds(chd): 0.069702358<br />colour: Type B","age: 51.2<br />odds(chd): 0.070565885<br />colour: Type B","age: 51.4<br />odds(chd): 0.071440111<br />colour: Type B","age: 51.6<br />odds(chd): 0.072325167<br />colour: Type B","age: 51.8<br />odds(chd): 0.073221189<br />colour: Type B","age: 52.0<br />odds(chd): 0.074128310<br />colour: Type B","age: 52.2<br />odds(chd): 0.075046670<br />colour: Type B","age: 52.4<br />odds(chd): 0.075976407<br />colour: Type B","age: 52.6<br />odds(chd): 0.076917663<br />colour: Type B","age: 52.8<br />odds(chd): 0.077870580<br />colour: Type B","age: 53.0<br />odds(chd): 0.078835302<br />colour: Type B","age: 53.2<br />odds(chd): 0.079811976<br />colour: Type B","age: 53.4<br />odds(chd): 0.080800749<br />colour: Type B","age: 53.6<br />odds(chd): 0.081801773<br />colour: Type B","age: 53.8<br />odds(chd): 0.082815197<br />colour: Type B","age: 54.0<br />odds(chd): 0.083841177<br />colour: Type B","age: 54.2<br />odds(chd): 0.084879868<br />colour: Type B","age: 54.4<br />odds(chd): 0.085931426<br />colour: Type B","age: 54.6<br />odds(chd): 0.086996013<br />colour: Type B","age: 54.8<br />odds(chd): 0.088073788<br />colour: Type B","age: 55.0<br />odds(chd): 0.089164915<br />colour: Type B","age: 55.2<br />odds(chd): 0.090269560<br />colour: Type B","age: 55.4<br />odds(chd): 0.091387891<br />colour: Type B","age: 55.6<br />odds(chd): 0.092520076<br />colour: Type B","age: 55.8<br />odds(chd): 0.093666288<br />colour: Type B","age: 56.0<br />odds(chd): 0.094826699<br />colour: Type B","age: 56.2<br />odds(chd): 0.096001487<br />colour: Type B","age: 56.4<br />odds(chd): 0.097190829<br />colour: Type B","age: 56.6<br />odds(chd): 0.098394906<br />colour: Type B","age: 56.8<br />odds(chd): 0.099613900<br />colour: Type B","age: 57.0<br />odds(chd): 0.100847995<br />colour: Type B","age: 57.2<br />odds(chd): 0.102097379<br />colour: Type B","age: 57.4<br />odds(chd): 0.103362242<br />colour: Type B","age: 57.6<br />odds(chd): 0.104642775<br />colour: Type B","age: 57.8<br />odds(chd): 0.105939172<br />colour: Type B","age: 58.0<br />odds(chd): 0.107251630<br />colour: Type B","age: 58.2<br />odds(chd): 0.108580348<br />colour: Type B","age: 58.4<br />odds(chd): 0.109925527<br />colour: Type B","age: 58.6<br />odds(chd): 0.111287371<br />colour: Type B","age: 58.8<br />odds(chd): 0.112666086<br />colour: Type B","age: 59.0<br />odds(chd): 0.114061883<br />colour: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[38,60],"tickmode":"array","ticktext":["40","45","50","55","60"],"tickvals":[40,45,50,55,60],"categoryorder":"array","categoryarray":["40","45","50","55","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Age (years)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.016216216216216217,0.34054054054054056],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3"],"tickvals":[0,0.10000000000000001,0.20000000000000001,0.30000000000000004],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"odds(CHD Event by 1969)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Behavioral Pattern<br />n","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"77a45e99964b":{"x":{},"y":{},"colour":{},"size":{},"type":"scatter"},"77a4355a4672":{"x":{},"y":{},"colour":{}},"77a439c701bb":{"x":{},"y":{},"colour":{}},"77a43842b99f":{"x":{},"y":{},"colour":{}}},"cur_data":"77a45e99964b","visdat":{"77a45e99964b":["function (y) ","x"],"77a4355a4672":["function (y) ","x"],"77a439c701bb":["function (y) ","x"],"77a43842b99f":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="log-odds-logit-scale-1" class="level4">
<h4 class="anchored" data-anchor-id="log-odds-logit-scale-1">log-odds (logit) scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>chd_plot_logit_2 <span class="ot">=</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  chd_plot_logit <span class="sc">+</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_logit_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-14f5150d4db2e5a443b9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-14f5150d4db2e5a443b9">{"x":{"data":[{"x":[50,51,59,44,47,40,41,43,54,48,39,49,55,56,42,45,46,57,53,52,58],"y":[-2.1400661634962708,-1.6274564179367788,-1.1895840668738362,-2.4471663218051534,-2.2284771208403238,-2.6230569882688175,-2.6692103677859462,-2.553899521274952,-1.8827312474337818,-1.7346010553881064,-2.3642786619993856,-1.1592369104845446,-1.6314168191528757,-1.126011262856224,-3.188416617383492,-2.3025850929940455,-2.6508917872622613,-1.9095425048844386,-2.0614230361771577,-1.3862943611198906,-1.7578579175523736],"text":["age: 50<br />logit(chd): -2.1400662<br />dibpat: Type A<br />n:  76","age: 51<br />logit(chd): -1.6274564<br />dibpat: Type A<br />n:  67","age: 59<br />logit(chd): -1.1895841<br />dibpat: Type A<br />n:  30","age: 44<br />logit(chd): -2.4471663<br />dibpat: Type A<br />n: 113","age: 47<br />logit(chd): -2.2284771<br />dibpat: Type A<br />n:  72","age: 40<br />logit(chd): -2.6230570<br />dibpat: Type A<br />n: 133","age: 41<br />logit(chd): -2.6692104<br />dibpat: Type A<br />n: 108","age: 43<br />logit(chd): -2.5538995<br />dibpat: Type A<br />n:  97","age: 54<br />logit(chd): -1.8827312<br />dibpat: Type A<br />n:  53","age: 48<br />logit(chd): -1.7346011<br />dibpat: Type A<br />n:  80","age: 39<br />logit(chd): -2.3642787<br />dibpat: Type A<br />n: 128","age: 49<br />logit(chd): -1.1592369<br />dibpat: Type A<br />n:  67","age: 55<br />logit(chd): -1.6314168<br />dibpat: Type A<br />n:  55","age: 56<br />logit(chd): -1.1260113<br />dibpat: Type A<br />n:  49","age: 42<br />logit(chd): -3.1884166<br />dibpat: Type A<br />n: 101","age: 45<br />logit(chd): -2.3025851<br />dibpat: Type A<br />n:  77","age: 46<br />logit(chd): -2.6508918<br />dibpat: Type A<br />n:  91","age: 57<br />logit(chd): -1.9095425<br />dibpat: Type A<br />n:  31","age: 53<br />logit(chd): -2.0614230<br />dibpat: Type A<br />n:  62","age: 52<br />logit(chd): -1.3862944<br />dibpat: Type A<br />n:  65","age: 58<br />logit(chd): -1.7578579<br />dibpat: Type A<br />n:  34"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":[11.507808770054302,10.893987081881484,7.4072043526108828,13.637611848597116,11.241235656543804,14.615949458394798,13.377458191723871,12.778686124337518,9.8163466467363971,11.765488567001361,14.379833505125502,10.893987081881484,9.9817695786372642,9.4710951773162115,13.000921034406357,11.573027489273997,12.434641120809431,7.5441456810618819,10.52889648301692,10.750245809698832,7.9279346825975772],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[45,41,47,39,49,51,42,50,44,56,40,58,48,43,53,54,46,52,55,57,59],"y":[-3.0349529867072724,-3.1780538303479453,-4.3040650932041693,-2.7880929087757464,-2.5176964726109912,-2.120263536200091,-4.7874917427820458,-2.9267394020670396,-3.3843902633457743,null,-3.8501476017100584,-3.044522437723423,-2.3978952727983707,-2.9267394020670396,-2.0281482472922856,-2.5257286443082556,-2.6946271807700692,-3.1354942159291497,-3.1780538303479453,-2.2686835413183641,-1.1786549963416462],"text":["age: 45<br />logit(chd): -3.0349530<br />dibpat: Type B<br />n: 109","age: 41<br />logit(chd): -3.1780538<br />dibpat: Type B<br />n: 125","age: 47<br />logit(chd): -4.3040651<br />dibpat: Type B<br />n:  75","age: 39<br />logit(chd): -2.7880929<br />dibpat: Type B<br />n: 138","age: 49<br />logit(chd): -2.5176965<br />dibpat: Type B<br />n:  67","age: 51<br />logit(chd): -2.1202635<br />dibpat: Type B<br />n:  56","age: 42<br />logit(chd): -4.7874917<br />dibpat: Type B<br />n: 121","age: 50<br />logit(chd): -2.9267394<br />dibpat: Type B<br />n:  59","age: 44<br />logit(chd): -3.3843903<br />dibpat: Type B<br />n: 122","age: 56<br />logit(chd):       -Inf<br />dibpat: Type B<br />n:  27","age: 40<br />logit(chd): -3.8501476<br />dibpat: Type B<br />n: 144","age: 58<br />logit(chd): -3.0445224<br />dibpat: Type B<br />n:  22","age: 48<br />logit(chd): -2.3978953<br />dibpat: Type B<br />n:  84","age: 43<br />logit(chd): -2.9267394<br />dibpat: Type B<br />n: 118","age: 53<br />logit(chd): -2.0281482<br />dibpat: Type B<br />n:  43","age: 54<br />logit(chd): -2.5257286<br />dibpat: Type B<br />n:  54","age: 46<br />logit(chd): -2.6946272<br />dibpat: Type B<br />n:  79","age: 52<br />logit(chd): -3.1354942<br />dibpat: Type B<br />n:  48","age: 55<br />logit(chd): -3.1780538<br />dibpat: Type B<br />n:  25","age: 57<br />logit(chd): -2.2686835<br />dibpat: Type B<br />n:  32","age: 59<br />logit(chd): -1.1786550<br />dibpat: Type B<br />n:  17"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":[13.430049986134389,14.235604935020691,11.442034967876614,14.847029219804128,10.893987081881484,10.062848078932257,14.040147001760529,10.300037417465363,14.089358888134319,6.9612105822972117,15.118110236220474,6.0293172003757194,12.015109867829196,13.89107438878934,8.9098372804078227,9.8996170505112442,11.701854397452983,9.3814585892624311,6.6253113681856641,7.6762775241645578,3.7795275590551185],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[-2.3642786619993856,-2.6230569882688175,-2.6692103677859462,-3.188416617383492,-2.553899521274952,-2.4471663218051534,-2.3025850929940455,-2.6508917872622613,-2.2284771208403238,-1.7346010553881064,-1.1592369104845446,-2.1400661634962708,-1.6274564179367788,-1.3862943611198906,-2.0614230361771577,-1.8827312474337818,-1.6314168191528757,-1.126011262856224,-1.9095425048844386,-1.7578579175523736,-1.1895840668738362],"text":["age: 39<br />logit(chd): -2.3642787<br />dibpat: Type A","age: 40<br />logit(chd): -2.6230570<br />dibpat: Type A","age: 41<br />logit(chd): -2.6692104<br />dibpat: Type A","age: 42<br />logit(chd): -3.1884166<br />dibpat: Type A","age: 43<br />logit(chd): -2.5538995<br />dibpat: Type A","age: 44<br />logit(chd): -2.4471663<br />dibpat: Type A","age: 45<br />logit(chd): -2.3025851<br />dibpat: Type A","age: 46<br />logit(chd): -2.6508918<br />dibpat: Type A","age: 47<br />logit(chd): -2.2284771<br />dibpat: Type A","age: 48<br />logit(chd): -1.7346011<br />dibpat: Type A","age: 49<br />logit(chd): -1.1592369<br />dibpat: Type A","age: 50<br />logit(chd): -2.1400662<br />dibpat: Type A","age: 51<br />logit(chd): -1.6274564<br />dibpat: Type A","age: 52<br />logit(chd): -1.3862944<br />dibpat: Type A","age: 53<br />logit(chd): -2.0614230<br />dibpat: Type A","age: 54<br />logit(chd): -1.8827312<br />dibpat: Type A","age: 55<br />logit(chd): -1.6314168<br />dibpat: Type A","age: 56<br />logit(chd): -1.1260113<br />dibpat: Type A","age: 57<br />logit(chd): -1.9095425<br />dibpat: Type A","age: 58<br />logit(chd): -1.7578579<br />dibpat: Type A","age: 59<br />logit(chd): -1.1895841<br />dibpat: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],"y":[-2.7880929087757464,-3.8501476017100584,-3.1780538303479453,-4.7874917427820458,-2.9267394020670396,-3.3843902633457743,-3.0349529867072724,-2.6946271807700692,-4.3040650932041693,-2.3978952727983707,-2.5176964726109912,-2.9267394020670396,-2.120263536200091,-3.1354942159291497,-2.0281482472922856,-2.5257286443082556,-3.1780538303479453,null,-2.2686835413183641,-3.044522437723423,-1.1786549963416462],"text":["age: 39<br />logit(chd): -2.7880929<br />dibpat: Type B","age: 40<br />logit(chd): -3.8501476<br />dibpat: Type B","age: 41<br />logit(chd): -3.1780538<br />dibpat: Type B","age: 42<br />logit(chd): -4.7874917<br />dibpat: Type B","age: 43<br />logit(chd): -2.9267394<br />dibpat: Type B","age: 44<br />logit(chd): -3.3843903<br />dibpat: Type B","age: 45<br />logit(chd): -3.0349530<br />dibpat: Type B","age: 46<br />logit(chd): -2.6946272<br />dibpat: Type B","age: 47<br />logit(chd): -4.3040651<br />dibpat: Type B","age: 48<br />logit(chd): -2.3978953<br />dibpat: Type B","age: 49<br />logit(chd): -2.5176965<br />dibpat: Type B","age: 50<br />logit(chd): -2.9267394<br />dibpat: Type B","age: 51<br />logit(chd): -2.1202635<br />dibpat: Type B","age: 52<br />logit(chd): -3.1354942<br />dibpat: Type B","age: 53<br />logit(chd): -2.0281482<br />dibpat: Type B","age: 54<br />logit(chd): -2.5257286<br />dibpat: Type B","age: 55<br />logit(chd): -3.1780538<br />dibpat: Type B","age: 56<br />logit(chd):       -Inf<br />dibpat: Type B","age: 57<br />logit(chd): -2.2686835<br />dibpat: Type B","age: 58<br />logit(chd): -3.0445224<br />dibpat: Type B","age: 59<br />logit(chd): -1.1786550<br />dibpat: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,39.200000000000003,39.399999999999999,39.600000000000001,39.799999999999997,40,40.200000000000003,40.399999999999999,40.600000000000001,40.799999999999997,41,41.200000000000003,41.399999999999999,41.600000000000001,41.799999999999997,42,42.200000000000003,42.399999999999999,42.600000000000001,42.799999999999997,43,43.200000000000003,43.399999999999999,43.600000000000001,43.799999999999997,44,44.200000000000003,44.399999999999999,44.600000000000001,44.799999999999997,45,45.200000000000003,45.399999999999999,45.600000000000001,45.799999999999997,46,46.200000000000003,46.399999999999999,46.600000000000001,46.799999999999997,47,47.200000000000003,47.399999999999999,47.600000000000001,47.799999999999997,48,48.200000000000003,48.399999999999999,48.600000000000001,48.799999999999997,49,49.200000000000003,49.399999999999999,49.600000000000001,49.799999999999997,50,50.200000000000003,50.399999999999999,50.600000000000001,50.799999999999997,51,51.200000000000003,51.399999999999999,51.600000000000001,51.799999999999997,52,52.200000000000003,52.399999999999999,52.600000000000001,52.799999999999997,53,53.200000000000003,53.399999999999999,53.600000000000001,53.799999999999997,54,54.200000000000003,54.399999999999999,54.600000000000001,54.799999999999997,55,55.200000000000003,55.400000000000006,55.600000000000001,55.799999999999997,56,56.200000000000003,56.400000000000006,56.600000000000001,56.799999999999997,57,57.200000000000003,57.400000000000006,57.600000000000001,57.799999999999997,58,58.200000000000003,58.400000000000006,58.600000000000001,58.799999999999997,59],"y":[-2.6944831446682795,-2.6801017157015048,-2.6657202867347309,-2.6513388577679562,-2.6369574288011819,-2.6225759998344076,-2.6081945708676328,-2.593813141900859,-2.5794317129340842,-2.5650502839673099,-2.5506688550005356,-2.5362874260337609,-2.5219059970669866,-2.5075245681002123,-2.493143139133438,-2.4787617101666632,-2.4643802811998889,-2.4499988522331146,-2.4356174232663403,-2.421235994299566,-2.4068545653327913,-2.392473136366017,-2.3780917073992427,-2.3637102784324679,-2.3493288494656941,-2.3349474204989193,-2.3205659915321446,-2.3061845625653707,-2.291803133598596,-2.2774217046318221,-2.2630402756650474,-2.2486588466982727,-2.2342774177314988,-2.219895988764724,-2.2055145597979502,-2.1911331308311754,-2.1767517018644007,-2.1623702728976268,-2.1479888439308521,-2.1336074149640778,-2.1192259859973035,-2.1048445570305288,-2.0904631280637544,-2.0760816990969801,-2.0617002701302058,-2.0473188411634311,-2.0329374121966568,-2.0185559832298825,-2.0041745542631082,-1.9897931252963339,-1.9754116963295594,-1.9610302673627846,-1.9466488383960106,-1.932267409429236,-1.9178859804624619,-1.9035045514956872,-1.8891231225289127,-1.8747416935621386,-1.8603602645953641,-1.8459788356285898,-1.8315974066618153,-1.8172159776950407,-1.8028345487282667,-1.7884531197614919,-1.7740716907947178,-1.7596902618279433,-1.7453088328611686,-1.7309274038943945,-1.71654597492762,-1.7021645459608459,-1.6877831169940711,-1.6734016880272966,-1.6590202590605225,-1.644638830093748,-1.6302574011269739,-1.6158759721601992,-1.6014945431934247,-1.5871131142266506,-1.5727316852598758,-1.5583502562931018,-1.5439688273263272,-1.5295873983595525,-1.515205969392778,-1.5008245404260039,-1.4864431114592298,-1.4720616824924551,-1.4576802535256805,-1.443298824558906,-1.4289173955921319,-1.4145359666253579,-1.4001545376585831,-1.3857731086918086,-1.3713916797250338,-1.3570102507582598,-1.3426288217914857,-1.3282473928247112,-1.3138659638579364,-1.2994845348911619,-1.2851031059243878,-1.2707216769576137,-1.2563402479908392],"text":["age: 39.0<br />logit(chd): -2.6944831<br />colour: Type A","age: 39.2<br />logit(chd): -2.6801017<br />colour: Type A","age: 39.4<br />logit(chd): -2.6657203<br />colour: Type A","age: 39.6<br />logit(chd): -2.6513389<br />colour: Type A","age: 39.8<br />logit(chd): -2.6369574<br />colour: Type A","age: 40.0<br />logit(chd): -2.6225760<br />colour: Type A","age: 40.2<br />logit(chd): -2.6081946<br />colour: Type A","age: 40.4<br />logit(chd): -2.5938131<br />colour: Type A","age: 40.6<br />logit(chd): -2.5794317<br />colour: Type A","age: 40.8<br />logit(chd): -2.5650503<br />colour: Type A","age: 41.0<br />logit(chd): -2.5506689<br />colour: Type A","age: 41.2<br />logit(chd): -2.5362874<br />colour: Type A","age: 41.4<br />logit(chd): -2.5219060<br />colour: Type A","age: 41.6<br />logit(chd): -2.5075246<br />colour: Type A","age: 41.8<br />logit(chd): -2.4931431<br />colour: Type A","age: 42.0<br />logit(chd): -2.4787617<br />colour: Type A","age: 42.2<br />logit(chd): -2.4643803<br />colour: Type A","age: 42.4<br />logit(chd): -2.4499989<br />colour: Type A","age: 42.6<br />logit(chd): -2.4356174<br />colour: Type A","age: 42.8<br />logit(chd): -2.4212360<br />colour: Type A","age: 43.0<br />logit(chd): -2.4068546<br />colour: Type A","age: 43.2<br />logit(chd): -2.3924731<br />colour: Type A","age: 43.4<br />logit(chd): -2.3780917<br />colour: Type A","age: 43.6<br />logit(chd): -2.3637103<br />colour: Type A","age: 43.8<br />logit(chd): -2.3493288<br />colour: Type A","age: 44.0<br />logit(chd): -2.3349474<br />colour: Type A","age: 44.2<br />logit(chd): -2.3205660<br />colour: Type A","age: 44.4<br />logit(chd): -2.3061846<br />colour: Type A","age: 44.6<br />logit(chd): -2.2918031<br />colour: Type A","age: 44.8<br />logit(chd): -2.2774217<br />colour: Type A","age: 45.0<br />logit(chd): -2.2630403<br />colour: Type A","age: 45.2<br />logit(chd): -2.2486588<br />colour: Type A","age: 45.4<br />logit(chd): -2.2342774<br />colour: Type A","age: 45.6<br />logit(chd): -2.2198960<br />colour: Type A","age: 45.8<br />logit(chd): -2.2055146<br />colour: Type A","age: 46.0<br />logit(chd): -2.1911331<br />colour: Type A","age: 46.2<br />logit(chd): -2.1767517<br />colour: Type A","age: 46.4<br />logit(chd): -2.1623703<br />colour: Type A","age: 46.6<br />logit(chd): -2.1479888<br />colour: Type A","age: 46.8<br />logit(chd): -2.1336074<br />colour: Type A","age: 47.0<br />logit(chd): -2.1192260<br />colour: Type A","age: 47.2<br />logit(chd): -2.1048446<br />colour: Type A","age: 47.4<br />logit(chd): -2.0904631<br />colour: Type A","age: 47.6<br />logit(chd): -2.0760817<br />colour: Type A","age: 47.8<br />logit(chd): -2.0617003<br />colour: Type A","age: 48.0<br />logit(chd): -2.0473188<br />colour: Type A","age: 48.2<br />logit(chd): -2.0329374<br />colour: Type A","age: 48.4<br />logit(chd): -2.0185560<br />colour: Type A","age: 48.6<br />logit(chd): -2.0041746<br />colour: Type A","age: 48.8<br />logit(chd): -1.9897931<br />colour: Type A","age: 49.0<br />logit(chd): -1.9754117<br />colour: Type A","age: 49.2<br />logit(chd): -1.9610303<br />colour: Type A","age: 49.4<br />logit(chd): -1.9466488<br />colour: Type A","age: 49.6<br />logit(chd): -1.9322674<br />colour: Type A","age: 49.8<br />logit(chd): -1.9178860<br />colour: Type A","age: 50.0<br />logit(chd): -1.9035046<br />colour: Type A","age: 50.2<br />logit(chd): -1.8891231<br />colour: Type A","age: 50.4<br />logit(chd): -1.8747417<br />colour: Type A","age: 50.6<br />logit(chd): -1.8603603<br />colour: Type A","age: 50.8<br />logit(chd): -1.8459788<br />colour: Type A","age: 51.0<br />logit(chd): -1.8315974<br />colour: Type A","age: 51.2<br />logit(chd): -1.8172160<br />colour: Type A","age: 51.4<br />logit(chd): -1.8028345<br />colour: Type A","age: 51.6<br />logit(chd): -1.7884531<br />colour: Type A","age: 51.8<br />logit(chd): -1.7740717<br />colour: Type A","age: 52.0<br />logit(chd): -1.7596903<br />colour: Type A","age: 52.2<br />logit(chd): -1.7453088<br />colour: Type A","age: 52.4<br />logit(chd): -1.7309274<br />colour: Type A","age: 52.6<br />logit(chd): -1.7165460<br />colour: Type A","age: 52.8<br />logit(chd): -1.7021645<br />colour: Type A","age: 53.0<br />logit(chd): -1.6877831<br />colour: Type A","age: 53.2<br />logit(chd): -1.6734017<br />colour: Type A","age: 53.4<br />logit(chd): -1.6590203<br />colour: Type A","age: 53.6<br />logit(chd): -1.6446388<br />colour: Type A","age: 53.8<br />logit(chd): -1.6302574<br />colour: Type A","age: 54.0<br />logit(chd): -1.6158760<br />colour: Type A","age: 54.2<br />logit(chd): -1.6014945<br />colour: Type A","age: 54.4<br />logit(chd): -1.5871131<br />colour: Type A","age: 54.6<br />logit(chd): -1.5727317<br />colour: Type A","age: 54.8<br />logit(chd): -1.5583503<br />colour: Type A","age: 55.0<br />logit(chd): -1.5439688<br />colour: Type A","age: 55.2<br />logit(chd): -1.5295874<br />colour: Type A","age: 55.4<br />logit(chd): -1.5152060<br />colour: Type A","age: 55.6<br />logit(chd): -1.5008245<br />colour: Type A","age: 55.8<br />logit(chd): -1.4864431<br />colour: Type A","age: 56.0<br />logit(chd): -1.4720617<br />colour: Type A","age: 56.2<br />logit(chd): -1.4576803<br />colour: Type A","age: 56.4<br />logit(chd): -1.4432988<br />colour: Type A","age: 56.6<br />logit(chd): -1.4289174<br />colour: Type A","age: 56.8<br />logit(chd): -1.4145360<br />colour: Type A","age: 57.0<br />logit(chd): -1.4001545<br />colour: Type A","age: 57.2<br />logit(chd): -1.3857731<br />colour: Type A","age: 57.4<br />logit(chd): -1.3713917<br />colour: Type A","age: 57.6<br />logit(chd): -1.3570103<br />colour: Type A","age: 57.8<br />logit(chd): -1.3426288<br />colour: Type A","age: 58.0<br />logit(chd): -1.3282474<br />colour: Type A","age: 58.2<br />logit(chd): -1.3138660<br />colour: Type A","age: 58.4<br />logit(chd): -1.2994845<br />colour: Type A","age: 58.6<br />logit(chd): -1.2851031<br />colour: Type A","age: 58.8<br />logit(chd): -1.2707217<br />colour: Type A","age: 59.0<br />logit(chd): -1.2563402<br />colour: Type A"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[39,39.200000000000003,39.399999999999999,39.600000000000001,39.799999999999997,40,40.200000000000003,40.399999999999999,40.600000000000001,40.799999999999997,41,41.200000000000003,41.399999999999999,41.600000000000001,41.799999999999997,42,42.200000000000003,42.399999999999999,42.600000000000001,42.799999999999997,43,43.200000000000003,43.399999999999999,43.600000000000001,43.799999999999997,44,44.200000000000003,44.399999999999999,44.600000000000001,44.799999999999997,45,45.200000000000003,45.399999999999999,45.600000000000001,45.799999999999997,46,46.200000000000003,46.399999999999999,46.600000000000001,46.799999999999997,47,47.200000000000003,47.399999999999999,47.600000000000001,47.799999999999997,48,48.200000000000003,48.399999999999999,48.600000000000001,48.799999999999997,49,49.200000000000003,49.399999999999999,49.600000000000001,49.799999999999997,50,50.200000000000003,50.399999999999999,50.600000000000001,50.799999999999997,51,51.200000000000003,51.399999999999999,51.600000000000001,51.799999999999997,52,52.200000000000003,52.399999999999999,52.600000000000001,52.799999999999997,53,53.200000000000003,53.399999999999999,53.600000000000001,53.799999999999997,54,54.200000000000003,54.399999999999999,54.600000000000001,54.799999999999997,55,55.200000000000003,55.400000000000006,55.600000000000001,55.799999999999997,56,56.200000000000003,56.400000000000006,56.600000000000001,56.799999999999997,57,57.200000000000003,57.400000000000006,57.600000000000001,57.799999999999997,58,58.200000000000003,58.400000000000006,58.600000000000001,58.799999999999997,59],"y":[-3.4022816216852938,-3.3899689469572318,-3.3776562722291708,-3.3653435975011092,-3.3530309227730477,-3.3407182480449862,-3.3284055733169242,-3.3160928985888631,-3.3037802238608012,-3.2914675491327401,-3.2791548744046786,-3.2668421996766166,-3.2545295249485555,-3.2422168502204936,-3.2299041754924325,-3.2175915007643705,-3.205278826036309,-3.1929661513082479,-3.1806534765801859,-3.1683408018521249,-3.1560281271240629,-3.1437154523960014,-3.1314027776679398,-3.1190901029398783,-3.1067774282118172,-3.0944647534837553,-3.0821520787556937,-3.0698394040276322,-3.0575267292995707,-3.0452140545715092,-3.0329013798434477,-3.0205887051153861,-3.0082760303873246,-2.9959633556592631,-2.9836506809312016,-2.97133800620314,-2.9590253314750781,-2.946712656747017,-2.9343999820189555,-2.9220873072908939,-2.9097746325628324,-2.8974619578347705,-2.8851492831067094,-2.8728366083786474,-2.8605239336505863,-2.8482112589225244,-2.8358985841944628,-2.8235859094664018,-2.8112732347383398,-2.7989605600102787,-2.7866478852822167,-2.7743352105541552,-2.7620225358260937,-2.7497098610980322,-2.7373971863699711,-2.7250845116419091,-2.7127718369138476,-2.7004591621857861,-2.6881464874577246,-2.675833812729663,-2.6635211380016015,-2.65120846327354,-2.6388957885454785,-2.6265831138174169,-2.6142704390893554,-2.6019577643612939,-2.5896450896332319,-2.5773324149051708,-2.5650197401771093,-2.5527070654490478,-2.5403943907209863,-2.5280817159929243,-2.5157690412648632,-2.5034563665368013,-2.4911436918087402,-2.4788310170806787,-2.4665183423526167,-2.4542056676245556,-2.4418929928964936,-2.4295803181684326,-2.4172676434403706,-2.4049549687123091,-2.3926422939842475,-2.380329619256186,-2.3680169445281249,-2.355704269800063,-2.3433915950720015,-2.3310789203439395,-2.3187662456158784,-2.3064535708878173,-2.2941408961597554,-2.2818282214316938,-2.2695155467036319,-2.2572028719755708,-2.2448901972475093,-2.2325775225194477,-2.2202648477913862,-2.2079521730633243,-2.1956394983352632,-2.1833268236072016,-2.1710141488791401],"text":["age: 39.0<br />logit(chd): -3.4022816<br />colour: Type B","age: 39.2<br />logit(chd): -3.3899689<br />colour: Type B","age: 39.4<br />logit(chd): -3.3776563<br />colour: Type B","age: 39.6<br />logit(chd): -3.3653436<br />colour: Type B","age: 39.8<br />logit(chd): -3.3530309<br />colour: Type B","age: 40.0<br />logit(chd): -3.3407182<br />colour: Type B","age: 40.2<br />logit(chd): -3.3284056<br />colour: Type B","age: 40.4<br />logit(chd): -3.3160929<br />colour: Type B","age: 40.6<br />logit(chd): -3.3037802<br />colour: Type B","age: 40.8<br />logit(chd): -3.2914675<br />colour: Type B","age: 41.0<br />logit(chd): -3.2791549<br />colour: Type B","age: 41.2<br />logit(chd): -3.2668422<br />colour: Type B","age: 41.4<br />logit(chd): -3.2545295<br />colour: Type B","age: 41.6<br />logit(chd): -3.2422169<br />colour: Type B","age: 41.8<br />logit(chd): -3.2299042<br />colour: Type B","age: 42.0<br />logit(chd): -3.2175915<br />colour: Type B","age: 42.2<br />logit(chd): -3.2052788<br />colour: Type B","age: 42.4<br />logit(chd): -3.1929662<br />colour: Type B","age: 42.6<br />logit(chd): -3.1806535<br />colour: Type B","age: 42.8<br />logit(chd): -3.1683408<br />colour: Type B","age: 43.0<br />logit(chd): -3.1560281<br />colour: Type B","age: 43.2<br />logit(chd): -3.1437155<br />colour: Type B","age: 43.4<br />logit(chd): -3.1314028<br />colour: Type B","age: 43.6<br />logit(chd): -3.1190901<br />colour: Type B","age: 43.8<br />logit(chd): -3.1067774<br />colour: Type B","age: 44.0<br />logit(chd): -3.0944648<br />colour: Type B","age: 44.2<br />logit(chd): -3.0821521<br />colour: Type B","age: 44.4<br />logit(chd): -3.0698394<br />colour: Type B","age: 44.6<br />logit(chd): -3.0575267<br />colour: Type B","age: 44.8<br />logit(chd): -3.0452141<br />colour: Type B","age: 45.0<br />logit(chd): -3.0329014<br />colour: Type B","age: 45.2<br />logit(chd): -3.0205887<br />colour: Type B","age: 45.4<br />logit(chd): -3.0082760<br />colour: Type B","age: 45.6<br />logit(chd): -2.9959634<br />colour: Type B","age: 45.8<br />logit(chd): -2.9836507<br />colour: Type B","age: 46.0<br />logit(chd): -2.9713380<br />colour: Type B","age: 46.2<br />logit(chd): -2.9590253<br />colour: Type B","age: 46.4<br />logit(chd): -2.9467127<br />colour: Type B","age: 46.6<br />logit(chd): -2.9344000<br />colour: Type B","age: 46.8<br />logit(chd): -2.9220873<br />colour: Type B","age: 47.0<br />logit(chd): -2.9097746<br />colour: Type B","age: 47.2<br />logit(chd): -2.8974620<br />colour: Type B","age: 47.4<br />logit(chd): -2.8851493<br />colour: Type B","age: 47.6<br />logit(chd): -2.8728366<br />colour: Type B","age: 47.8<br />logit(chd): -2.8605239<br />colour: Type B","age: 48.0<br />logit(chd): -2.8482113<br />colour: Type B","age: 48.2<br />logit(chd): -2.8358986<br />colour: Type B","age: 48.4<br />logit(chd): -2.8235859<br />colour: Type B","age: 48.6<br />logit(chd): -2.8112732<br />colour: Type B","age: 48.8<br />logit(chd): -2.7989606<br />colour: Type B","age: 49.0<br />logit(chd): -2.7866479<br />colour: Type B","age: 49.2<br />logit(chd): -2.7743352<br />colour: Type B","age: 49.4<br />logit(chd): -2.7620225<br />colour: Type B","age: 49.6<br />logit(chd): -2.7497099<br />colour: Type B","age: 49.8<br />logit(chd): -2.7373972<br />colour: Type B","age: 50.0<br />logit(chd): -2.7250845<br />colour: Type B","age: 50.2<br />logit(chd): -2.7127718<br />colour: Type B","age: 50.4<br />logit(chd): -2.7004592<br />colour: Type B","age: 50.6<br />logit(chd): -2.6881465<br />colour: Type B","age: 50.8<br />logit(chd): -2.6758338<br />colour: Type B","age: 51.0<br />logit(chd): -2.6635211<br />colour: Type B","age: 51.2<br />logit(chd): -2.6512085<br />colour: Type B","age: 51.4<br />logit(chd): -2.6388958<br />colour: Type B","age: 51.6<br />logit(chd): -2.6265831<br />colour: Type B","age: 51.8<br />logit(chd): -2.6142704<br />colour: Type B","age: 52.0<br />logit(chd): -2.6019578<br />colour: Type B","age: 52.2<br />logit(chd): -2.5896451<br />colour: Type B","age: 52.4<br />logit(chd): -2.5773324<br />colour: Type B","age: 52.6<br />logit(chd): -2.5650197<br />colour: Type B","age: 52.8<br />logit(chd): -2.5527071<br />colour: Type B","age: 53.0<br />logit(chd): -2.5403944<br />colour: Type B","age: 53.2<br />logit(chd): -2.5280817<br />colour: Type B","age: 53.4<br />logit(chd): -2.5157690<br />colour: Type B","age: 53.6<br />logit(chd): -2.5034564<br />colour: Type B","age: 53.8<br />logit(chd): -2.4911437<br />colour: Type B","age: 54.0<br />logit(chd): -2.4788310<br />colour: Type B","age: 54.2<br />logit(chd): -2.4665183<br />colour: Type B","age: 54.4<br />logit(chd): -2.4542057<br />colour: Type B","age: 54.6<br />logit(chd): -2.4418930<br />colour: Type B","age: 54.8<br />logit(chd): -2.4295803<br />colour: Type B","age: 55.0<br />logit(chd): -2.4172676<br />colour: Type B","age: 55.2<br />logit(chd): -2.4049550<br />colour: Type B","age: 55.4<br />logit(chd): -2.3926423<br />colour: Type B","age: 55.6<br />logit(chd): -2.3803296<br />colour: Type B","age: 55.8<br />logit(chd): -2.3680169<br />colour: Type B","age: 56.0<br />logit(chd): -2.3557043<br />colour: Type B","age: 56.2<br />logit(chd): -2.3433916<br />colour: Type B","age: 56.4<br />logit(chd): -2.3310789<br />colour: Type B","age: 56.6<br />logit(chd): -2.3187662<br />colour: Type B","age: 56.8<br />logit(chd): -2.3064536<br />colour: Type B","age: 57.0<br />logit(chd): -2.2941409<br />colour: Type B","age: 57.2<br />logit(chd): -2.2818282<br />colour: Type B","age: 57.4<br />logit(chd): -2.2695155<br />colour: Type B","age: 57.6<br />logit(chd): -2.2572029<br />colour: Type B","age: 57.8<br />logit(chd): -2.2448902<br />colour: Type B","age: 58.0<br />logit(chd): -2.2325775<br />colour: Type B","age: 58.2<br />logit(chd): -2.2202648<br />colour: Type B","age: 58.4<br />logit(chd): -2.2079522<br />colour: Type B","age: 58.6<br />logit(chd): -2.1956395<br />colour: Type B","age: 58.8<br />logit(chd): -2.1833268<br />colour: Type B","age: 59.0<br />logit(chd): -2.1710141<br />colour: Type B"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[38,60],"tickmode":"array","ticktext":["40","45","50","55","60"],"tickvals":[40,45,50,55,60],"categoryorder":"array","categoryarray":["40","45","50","55","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Age (years)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-4.9705657667783365,-0.94293723885993286],"tickmode":"array","ticktext":["-4","-3","-2","-1"],"tickvals":[-4,-3,-2,-1],"categoryorder":"array","categoryarray":["-4","-3","-2","-1"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"log{odds(CHD Event by 1969)}","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Behavioral Pattern<br />n","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"77a43baf7dc6":{"x":{},"y":{},"colour":{},"size":{},"type":"scatter"},"77a47e6a70c6":{"x":{},"y":{},"colour":{}},"77a47e121800":{"x":{},"y":{},"colour":{}},"77a455e5e8a9":{"x":{},"y":{},"colour":{}}},"cur_data":"77a43baf7dc6","visdat":{"77a43baf7dc6":["function (y) ","x"],"77a47e6a70c6":["function (y) ","x"],"77a47e121800":["function (y) ","x"],"77a455e5e8a9":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="reference-group-and-contrast-parametrization" class="level3" data-number="3.4.9">
<h3 data-number="3.4.9" class="anchored" data-anchor-id="reference-group-and-contrast-parametrization"><span class="header-section-number">3.4.9</span> reference-group and contrast parametrization</h3>
<p>We can also use the corner-point parametrization (with reference groups and contrasts):</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="ot">=</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat<span class="sc">*</span>age, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="sc">|&gt;</span> </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-5.50</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">(-6.83, -4.19)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">-0.30</td>
<td style="text-align: center;">1.18</td>
<td style="text-align: center;">(-2.63, 2.02)</td>
<td style="text-align: center;">-0.26</td>
<td style="text-align: center;">0.797</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(0.05, 0.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">-0.01</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(-0.06, 0.04)</td>
<td style="text-align: center;">-0.42</td>
<td style="text-align: center;">0.674</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Compare with what we had before:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">-5.50</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">(-6.83, -4.19)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">-5.80</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">(-7.73, -3.90)</td>
<td style="text-align: center;">-5.95</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A) × age</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(0.05, 0.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(0.02, 0.10)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="exr-strat-to-contrast" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.12</strong></span> If I give you model 1, how would you get the coefficients of model 2?</p>
</div>
</section>
</section>
<section id="fitting-logistic-regression-models" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="fitting-logistic-regression-models"><span class="header-section-number">3.5</span> Fitting logistic regression models</h2>
<section id="section" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="section"><span class="header-section-number">3.5.1</span> </h3>
<p>In general, the estimating equation <span class="math inline">\(\ell'(\beta; \mathbf x) = 0\)</span> cannot be solved analytically.</p>
<p>Instead, we have to use a variant of the Newton-Raphson method, which was discussed briefly in Epi 203. We won’t go over it in this class; if you need to learn it, see <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span>, Chapter 4.</p>
<p>For now, all you need to know is that we make an iterative series of guesses, and each guess helps us make the next guess better (higher log-likelihood).</p>
<p>You can see some information about this process like so:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">8</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">glm.control</span>(<span class="at">trace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat<span class="sc">*</span>age, </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1775.7899 Iterations - 1</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1708.5396 Iterations - 2</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1704.0434 Iterations - 3</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1703.9833 Iterations - 4</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1703.9832 Iterations - 5</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1703.9832 Iterations - 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After each iteration of the fitting procedure, the deviance (<span class="math inline">\(2(\ell_{\text{full}} - \ell(\hat\beta))\)</span> ) is printed. You can see that the algorithm took six iterations to converge to a solution where the likelihood wasn’t changing much anymore.</p>
</section>
</section>
<section id="sec-gof" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-gof"><span class="header-section-number">3.6</span> Model comparisons for logistic models</h2>
<section id="deviance-test" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="deviance-test"><span class="header-section-number">3.6.1</span> Deviance test</h3>
<p>We can compare the maximized log-likelihood of our model, <span class="math inline">\(\ell(\hat\beta; \mathbf x)\)</span>, versus the log-likelihood of the full model (aka saturated model aka maximal model), <span class="math inline">\(\ell_{\text{full}}\)</span>, which has one parameter per covariate pattern. With enough data, <span class="math inline">\(2(\ell_{\text{full}} - \ell(\hat\beta; \mathbf x)) \dot \sim \chi^2(N - p)\)</span>, where <span class="math inline">\(N\)</span> is the number of distinct covariate patterns and <span class="math inline">\(p\)</span> is the number of <span class="math inline">\(\beta\)</span> parameters in our model. A significant p-value for this <strong>deviance</strong> statistic indicates that there’s some detectable pattern in the data that our model isn’t flexible enough to catch.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The deviance statistic needs to have a large amount of data <strong>for each covariate pattern</strong> for the <span class="math inline">\(\chi^2\)</span> approximation to hold. A guideline from Dobson is that if there are <span class="math inline">\(q\)</span> distinct covariate patterns <span class="math inline">\(x_1...,x_q\)</span>, with <span class="math inline">\(n_1,...,n_q\)</span> observations per pattern, then the expected frequencies <span class="math inline">\(n_k \cdot \pi(x_k)\)</span> should be at least 1 for every pattern <span class="math inline">\(k\in 1:q\)</span>.</p>
</div>
</div>
<p>If you have covariates measured on a continuous scale, you may not be able to use the deviance tests to assess goodness of fit.</p>
</section>
<section id="hosmer-lemeshow-test" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="hosmer-lemeshow-test"><span class="header-section-number">3.6.2</span> Hosmer-Lemeshow test</h3>
<p>If our covariate patterns produce groups that are too small, a reasonable solution is to make bigger groups by merging some of the covariate-pattern groups together.</p>
<p>Hosmer and Lemeshow (1980) proposed that we group the patterns by their predicted probabilities according to the model of interest. For example, you could group all of the observations with predicted probabilities of 10% or less together, then group the observations with 11%-20% probability together, and so on; <span class="math inline">\(g=10\)</span> categories in all.</p>
<p>Then we can construct a statistic <span class="math display">\[X^2 = \sum_{c=1}^g \frac{(o_c - e_c)^2}{e_c}\]</span> where <span class="math inline">\(o_c\)</span> is the number of events <em>observed</em> in group <span class="math inline">\(c\)</span>, and <span class="math inline">\(e_c\)</span> is the number of events expected in group <span class="math inline">\(c\)</span> (based on the sum of the fitted values <span class="math inline">\(\hat\pi_i\)</span> for observations in group <span class="math inline">\(c\)</span>).</p>
<p>If each group has enough observations in it, you can compare <span class="math inline">\(X^2\)</span> to a <span class="math inline">\(\chi^2\)</span> distribution; by simulation, the degrees of freedom has been found to be approximately <span class="math inline">\(g-2\)</span>.</p>
<p>For our CHD model, this procedure would be:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">=</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>      pred_probs_glm1 <span class="sc">|&gt;</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>), </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">=</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">pred_prob_cats1</th>
<th style="text-align: center;">n</th>
<th style="text-align: center;">o</th>
<th style="text-align: center;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(0.1,0.2]</td>
<td style="text-align: center;">785</td>
<td style="text-align: center;">116</td>
<td style="text-align: center;">108</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.2,0.3]</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">13.77</td>
</tr>
<tr class="odd">
<td style="text-align: center;">[0,0.1]</td>
<td style="text-align: center;">2305</td>
<td style="text-align: center;">129</td>
<td style="text-align: center;">135.2</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> HL_table <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o<span class="sc">-</span>e)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>e)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1102871</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">=</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our statistic is <span class="math inline">\(X^2 = 1.11028711\)</span>; <span class="math inline">\(p(\chi^2(1) &gt; 1.11028711) = 0.29201955\)</span>, which is our p-value for detecting a lack of goodness of fit.</p>
<p>Unfortunately that grouping plan left us with just three categories with any observations, so instead of grouping by 10% increments of predicted probability, typically analysts use deciles of the predicted probabilities:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">=</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>      pred_probs_glm1 <span class="sc">|&gt;</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(<span class="at">breaks =</span> <span class="fu">quantile</span>(pred_probs_glm1, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>)), </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">=</span> </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">pred_prob_cats1</th>
<th style="text-align: center;">n</th>
<th style="text-align: center;">o</th>
<th style="text-align: center;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(0.114,0.147]</td>
<td style="text-align: center;">275</td>
<td style="text-align: center;">48</td>
<td style="text-align: center;">36.81</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.147,0.222]</td>
<td style="text-align: center;">314</td>
<td style="text-align: center;">51</td>
<td style="text-align: center;">57.19</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(0.0774,0.0942]</td>
<td style="text-align: center;">371</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">32.56</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.0942,0.114]</td>
<td style="text-align: center;">282</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">29.89</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(0.0633,0.069]</td>
<td style="text-align: center;">237</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">15.97</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.069,0.0774]</td>
<td style="text-align: center;">306</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">22.95</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(0.0487,0.0633]</td>
<td style="text-align: center;">413</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">24.1</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.0409,0.0487]</td>
<td style="text-align: center;">310</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">14.15</td>
</tr>
<tr class="odd">
<td style="text-align: center;">[0.0322,0.0363]</td>
<td style="text-align: center;">407</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">13.91</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.0363,0.0409]</td>
<td style="text-align: center;">239</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">9.48</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> HL_table <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o<span class="sc">-</span>e)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>e)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 6.7811383</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">=</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we have more evenly split categories. The p-value is <span class="math inline">\(0.56041994\)</span>, still not significant.</p>
<p>Graphically, we have compared:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>HL_plot <span class="ot">=</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  HL_table <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_prob_cats1)) <span class="sc">+</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">x =</span> pred_prob_cats1, <span class="at">group =</span> <span class="st">"Expected"</span>, <span class="at">col =</span> <span class="st">"Expected"</span>)) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Expected"</span>)) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">col =</span> <span class="st">"Observed"</span>, <span class="at">group =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"number of CHD events"</span>) <span class="sc">+</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(HL_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ee89a819a07223c8a8ae" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ee89a819a07223c8a8ae">{"x":{"data":[{"x":[1,2,3,4,5,6,7,8,9,10],"y":[13.908463615435355,9.4804170060423125,14.147082276065232,24.097195841138305,15.965627048323254,22.950027038869429,32.564120451983392,29.888840721910363,36.81244356329367,57.18578243693068],"text":["pred_prob_cats1: [0.0322,0.0363]<br />e: 13.908464<br />colour: Expected","pred_prob_cats1: (0.0363,0.0409]<br />e:  9.480417<br />colour: Expected","pred_prob_cats1: (0.0409,0.0487]<br />e: 14.147082<br />colour: Expected","pred_prob_cats1: (0.0487,0.0633]<br />e: 24.097196<br />colour: Expected","pred_prob_cats1: (0.0633,0.069]<br />e: 15.965627<br />colour: Expected","pred_prob_cats1: (0.069,0.0774]<br />e: 22.950027<br />colour: Expected","pred_prob_cats1: (0.0774,0.0942]<br />e: 32.564120<br />colour: Expected","pred_prob_cats1: (0.0942,0.114]<br />e: 29.888841<br />colour: Expected","pred_prob_cats1: (0.114,0.147]<br />e: 36.812444<br />colour: Expected","pred_prob_cats1: (0.147,0.222]<br />e: 57.185782<br />colour: Expected"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Expected","legendgroup":"Expected","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,10,7,8,5,6,4,3,1,2],"y":[36.81244356329367,57.18578243693068,32.564120451983392,29.888840721910363,15.965627048323254,22.950027038869429,24.097195841138305,14.147082276065232,13.908463615435355,9.4804170060423125],"text":["pred_prob_cats1: (0.114,0.147]<br />e: 36.812444<br />n: 275<br />colour: Expected","pred_prob_cats1: (0.147,0.222]<br />e: 57.185782<br />n: 314<br />colour: Expected","pred_prob_cats1: (0.0774,0.0942]<br />e: 32.564120<br />n: 371<br />colour: Expected","pred_prob_cats1: (0.0942,0.114]<br />e: 29.888841<br />n: 282<br />colour: Expected","pred_prob_cats1: (0.0633,0.069]<br />e: 15.965627<br />n: 237<br />colour: Expected","pred_prob_cats1: (0.069,0.0774]<br />e: 22.950027<br />n: 306<br />colour: Expected","pred_prob_cats1: (0.0487,0.0633]<br />e: 24.097196<br />n: 413<br />colour: Expected","pred_prob_cats1: (0.0409,0.0487]<br />e: 14.147082<br />n: 310<br />colour: Expected","pred_prob_cats1: [0.0322,0.0363]<br />e: 13.908464<br />n: 407<br />colour: Expected","pred_prob_cats1: (0.0363,0.0409]<br />e:  9.480417<br />n: 239<br />colour: Expected"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":[9.0481155247630038,11.279295054986243,13.673138690569633,9.5128807201598544,3.7795275590551185,10.879014793162673,15.118110236220474,11.081898115260863,14.923163051908769,4.9882245336696025],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Expected","legendgroup":"Expected","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,10,7,8,5,6,4,3,1,2],"y":[48,51,27,30,17,20,27,14,16,7],"text":["pred_prob_cats1: (0.114,0.147]<br />o: 48<br />n: 275<br />colour: Observed","pred_prob_cats1: (0.147,0.222]<br />o: 51<br />n: 314<br />colour: Observed","pred_prob_cats1: (0.0774,0.0942]<br />o: 27<br />n: 371<br />colour: Observed","pred_prob_cats1: (0.0942,0.114]<br />o: 30<br />n: 282<br />colour: Observed","pred_prob_cats1: (0.0633,0.069]<br />o: 17<br />n: 237<br />colour: Observed","pred_prob_cats1: (0.069,0.0774]<br />o: 20<br />n: 306<br />colour: Observed","pred_prob_cats1: (0.0487,0.0633]<br />o: 27<br />n: 413<br />colour: Observed","pred_prob_cats1: (0.0409,0.0487]<br />o: 14<br />n: 310<br />colour: Observed","pred_prob_cats1: [0.0322,0.0363]<br />o: 16<br />n: 407<br />colour: Observed","pred_prob_cats1: (0.0363,0.0409]<br />o:  7<br />n: 239<br />colour: Observed"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":[9.0481155247630038,11.279295054986243,13.673138690569633,9.5128807201598544,3.7795275590551185,10.879014793162673,15.118110236220474,11.081898115260863,14.923163051908769,4.9882245336696025],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Observed","legendgroup":"Observed","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[16,7,14,27,17,20,27,30,48,51],"text":["pred_prob_cats1: [0.0322,0.0363]<br />o: 16<br />colour: Observed","pred_prob_cats1: (0.0363,0.0409]<br />o:  7<br />colour: Observed","pred_prob_cats1: (0.0409,0.0487]<br />o: 14<br />colour: Observed","pred_prob_cats1: (0.0487,0.0633]<br />o: 27<br />colour: Observed","pred_prob_cats1: (0.0633,0.069]<br />o: 17<br />colour: Observed","pred_prob_cats1: (0.069,0.0774]<br />o: 20<br />colour: Observed","pred_prob_cats1: (0.0774,0.0942]<br />o: 27<br />colour: Observed","pred_prob_cats1: (0.0942,0.114]<br />o: 30<br />colour: Observed","pred_prob_cats1: (0.114,0.147]<br />o: 48<br />colour: Observed","pred_prob_cats1: (0.147,0.222]<br />o: 51<br />colour: Observed"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Observed","legendgroup":"Observed","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":74.956356961893121,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,10.6],"tickmode":"array","ticktext":["[0.0322,0.0363]","(0.0363,0.0409]","(0.0409,0.0487]","(0.0487,0.0633]","(0.0633,0.069]","(0.069,0.0774]","(0.0774,0.0942]","(0.0942,0.114]","(0.114,0.147]","(0.147,0.222]"],"tickvals":[1,2,3,4,5,6.0000000000000009,7,8,9,10],"categoryorder":"array","categoryarray":["[0.0322,0.0363]","(0.0363,0.0409]","(0.0409,0.0487]","(0.0487,0.0633]","(0.0633,0.069]","(0.069,0.0774]","(0.0774,0.0942]","(0.0942,0.114]","(0.114,0.147]","(0.147,0.222]"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-45,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"pred_prob_cats1","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.4907108781534664,59.695071558777215],"tickmode":"array","ticktext":["10","20","30","40","50"],"tickvals":[10,20,30,40,50],"categoryorder":"array","categoryarray":["10","20","30","40","50"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"number of CHD events","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"n<br />colour","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"77a451443502":{"x":{},"y":{},"colour":{},"type":"scatter"},"77a454f43ffc":{"x":{},"y":{},"size":{},"colour":{}},"77a46f94e4f6":{"x":{},"y":{},"size":{},"colour":{}},"77a418440bb5":{"x":{},"y":{},"colour":{}}},"cur_data":"77a451443502","visdat":{"77a451443502":["function (y) ","x"],"77a454f43ffc":["function (y) ","x"],"77a46f94e4f6":["function (y) ","x"],"77a418440bb5":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="comparing-models" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="comparing-models"><span class="header-section-number">3.6.3</span> Comparing models</h3>
<ul>
<li>AIC = <span class="math inline">\(-2 * \ell(\hat\theta) + 2 * p\)</span> [lower is better]</li>
<li>BIC = <span class="math inline">\(-2 * \ell(\hat\theta) + p * \text{log}(n)\)</span> [lower is better]</li>
<li>likelihood ratio [higher is better]</li>
</ul>
</section>
</section>
<section id="residual-based-diagnostics" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="residual-based-diagnostics"><span class="header-section-number">3.7</span> Residual-based diagnostics</h2>
<section id="logistic-regression-residuals-only-work-for-grouped-data" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="logistic-regression-residuals-only-work-for-grouped-data"><span class="header-section-number">3.7.1</span> Logistic regression residuals only work for grouped data</h3>
<p>Residuals only work if there is more than one observation for most covariate patterns.</p>
<p>Here we will create the grouped-data version of our CHD model from the WCGS study:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">=</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(dibpat, age),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">chd =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">!chd</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"No"</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(chd, <span class="st">`</span><span class="at">!chd</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs_grouped,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">-5.50</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">(-6.83, -4.19)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">-5.80</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">(-7.73, -3.90)</td>
<td style="text-align: center;">-5.95</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dibpat (Type A) × age</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(0.05, 0.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(0.02, 0.10)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="response-residuals" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="response-residuals"><span class="header-section-number">3.7.2</span> (Response) residuals</h3>
<p><span class="math display">\[e_k \stackrel{\text{def}}{=}\bar y_k - \hat{\pi}(x_k)\]</span></p>
<p>(<span class="math inline">\(k\)</span> indexes the covariate patterns)</p>
<p>We can graph these residuals <span class="math inline">\(e_k\)</span> against the fitted values <span class="math inline">\(\hat\pi(x_k)\)</span>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="annotated-cell-37"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-37-1"><a href="#annotated-cell-37-1" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">=</span> </span>
<span id="annotated-cell-37-2"><a href="#annotated-cell-37-2" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-37-3"><a href="#annotated-cell-37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="annotated-cell-37-4"><a href="#annotated-cell-37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="annotated-cell-37-5"><a href="#annotated-cell-37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="annotated-cell-37-6"><a href="#annotated-cell-37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">response_resids =</span> </span>
<span id="annotated-cell-37-7"><a href="#annotated-cell-37-7" aria-hidden="true" tabindex="-1"></a>      chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="annotated-cell-37-8"><a href="#annotated-cell-37-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="annotated-cell-37-9"><a href="#annotated-cell-37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-37-10"><a href="#annotated-cell-37-10" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="ot">=</span> </span>
<span id="annotated-cell-37-11"><a href="#annotated-cell-37-11" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-37-12"><a href="#annotated-cell-37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="annotated-cell-37-13"><a href="#annotated-cell-37-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="annotated-cell-37-14"><a href="#annotated-cell-37-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted,</span>
<span id="annotated-cell-37-15"><a href="#annotated-cell-37-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> response_resids</span>
<span id="annotated-cell-37-16"><a href="#annotated-cell-37-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-37-17"><a href="#annotated-cell-37-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="annotated-cell-37-18"><a href="#annotated-cell-37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="annotated-cell-37-19"><a href="#annotated-cell-37-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="annotated-cell-37-20"><a href="#annotated-cell-37-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="annotated-cell-37-21"><a href="#annotated-cell-37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-37-22" class="code-annotation-target"><a href="#annotated-cell-37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="annotated-cell-37-23"><a href="#annotated-cell-37-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-37-24"><a href="#annotated-cell-37-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-37-25"><a href="#annotated-cell-37-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">span=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="annotated-cell-37-26"><a href="#annotated-cell-37-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree=</span><span class="dv">1</span>,</span>
<span id="annotated-cell-37-27"><a href="#annotated-cell-37-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">family=</span><span class="st">"symmetric"</span>,</span>
<span id="annotated-cell-37-28"><a href="#annotated-cell-37-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations=</span><span class="dv">3</span>),</span>
<span id="annotated-cell-37-29"><a href="#annotated-cell-37-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> stats<span class="sc">::</span>loess)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-37" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="22,23,24,25,26,27,28,29" data-code-annotation="1">Don’t worry about these options for now; I chose them to match <code>autoplot()</code> as closely as I can. <code>plot.glm</code> and <code>autoplot</code> use <code>stats::lowess</code> instead of <code>stats::loess</code>; <code>stats::lowess</code> is older, hard to use with <code>geom_smooth</code>, and hard to match exactly with <code>stats::loess</code>; see https://support.bioconductor.org/p/2323/.]</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-fde9f835df1d4939864c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-fde9f835df1d4939864c">{"x":{"data":[{"x":[0.12971234222919328,0.13804808653367218,0.22160454144193314,0.088269692096500443,0.10724215304817927,0.067699524830557176,0.072381563936101831,0.082651492829172932,0.16577440958806977,0.11432357792947521,0.063299679011386611,0.12180880417146124,0.17595906456335225,0.18662945062136324,0.077360539928739688,0.094230557580234589,0.10054956755065417,0.19779158979409439,0.15606760433147879,0.14682913656358473,0.20944941476199133],"y":[-0.024449184334456447,0.026131017943939766,0.011728791891400192,-0.0086236743973854002,-0.010019930825957049,-3.0351898226352314e-05,-0.0075667491212870197,-0.010486544375564691,-0.033698937889956565,0.03567642207052478,0.022637820988613389,0.11699716597779249,-0.012322700926988617,0.058268508562310223,-0.037756579532700084,-0.0033214666711436774,-0.034615501616588232,-0.068759331729578266,-0.043164378525027178,0.053170863436415278,-0.062390591232579562],"text":["fitted: 0.129712342<br />response_resids: -2.4449184e-02<br />dibpat: Type A","fitted: 0.138048087<br />response_resids:  2.6131018e-02<br />dibpat: Type A","fitted: 0.221604541<br />response_resids:  1.1728792e-02<br />dibpat: Type A","fitted: 0.088269692<br />response_resids: -8.6236744e-03<br />dibpat: Type A","fitted: 0.107242153<br />response_resids: -1.0019931e-02<br />dibpat: Type A","fitted: 0.067699525<br />response_resids: -3.0351898e-05<br />dibpat: Type A","fitted: 0.072381564<br />response_resids: -7.5667491e-03<br />dibpat: Type A","fitted: 0.082651493<br />response_resids: -1.0486544e-02<br />dibpat: Type A","fitted: 0.165774410<br />response_resids: -3.3698938e-02<br />dibpat: Type A","fitted: 0.114323578<br />response_resids:  3.5676422e-02<br />dibpat: Type A","fitted: 0.063299679<br />response_resids:  2.2637821e-02<br />dibpat: Type A","fitted: 0.121808804<br />response_resids:  1.1699717e-01<br />dibpat: Type A","fitted: 0.175959065<br />response_resids: -1.2322701e-02<br />dibpat: Type A","fitted: 0.186629451<br />response_resids:  5.8268509e-02<br />dibpat: Type A","fitted: 0.077360540<br />response_resids: -3.7756580e-02<br />dibpat: Type A","fitted: 0.094230558<br />response_resids: -3.3214667e-03<br />dibpat: Type A","fitted: 0.100549568<br />response_resids: -3.4615502e-02<br />dibpat: Type A","fitted: 0.197791590<br />response_resids: -6.8759332e-02<br />dibpat: Type A","fitted: 0.156067604<br />response_resids: -4.3164379e-02<br />dibpat: Type A","fitted: 0.146829137<br />response_resids:  5.3170863e-02<br />dibpat: Type A","fitted: 0.209449415<br />response_resids: -6.2390591e-02<br />dibpat: Type A"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.045961436757712824,0.036293263960852619,0.051672477906886234,0.032224234433804747,0.058049978197733429,0.065160515946172379,0.038509063821240842,0.061509303008180735,0.04333615674648298,0.086613433425361805,0.034200425478447295,0.096862923630182202,0.054773853205468445,0.040854409187417909,0.073074455042508049,0.077355593240057391,0.048737652497125951,0.069012528199451348,0.081865394323964141,0.091609373353503276,0.10238379421453493],"y":[-8.9877124685298904e-05,0.0037067360391473819,-0.038339144573552898,0.025746780058948877,0.016576887473908355,0.041982341196684758,-0.030244601011323487,-0.010661845381062088,-0.010549271500581339,-0.086613433425361805,-0.013367092145113963,-0.051408378175636746,0.028559480127864884,0.0099930484397007385,0.04320461472493381,-0.0032815191659833209,0.014553486743380382,-0.027345861532784684,-0.04186539432396414,0.0021406266464967239,0.1329103234325239],"text":["fitted: 0.045961437<br />response_resids: -8.9877125e-05<br />dibpat: Type B","fitted: 0.036293264<br />response_resids:  3.7067360e-03<br />dibpat: Type B","fitted: 0.051672478<br />response_resids: -3.8339145e-02<br />dibpat: Type B","fitted: 0.032224234<br />response_resids:  2.5746780e-02<br />dibpat: Type B","fitted: 0.058049978<br />response_resids:  1.6576887e-02<br />dibpat: Type B","fitted: 0.065160516<br />response_resids:  4.1982341e-02<br />dibpat: Type B","fitted: 0.038509064<br />response_resids: -3.0244601e-02<br />dibpat: Type B","fitted: 0.061509303<br />response_resids: -1.0661845e-02<br />dibpat: Type B","fitted: 0.043336157<br />response_resids: -1.0549272e-02<br />dibpat: Type B","fitted: 0.086613433<br />response_resids: -8.6613433e-02<br />dibpat: Type B","fitted: 0.034200425<br />response_resids: -1.3367092e-02<br />dibpat: Type B","fitted: 0.096862924<br />response_resids: -5.1408378e-02<br />dibpat: Type B","fitted: 0.054773853<br />response_resids:  2.8559480e-02<br />dibpat: Type B","fitted: 0.040854409<br />response_resids:  9.9930484e-03<br />dibpat: Type B","fitted: 0.073074455<br />response_resids:  4.3204615e-02<br />dibpat: Type B","fitted: 0.077355593<br />response_resids: -3.2815192e-03<br />dibpat: Type B","fitted: 0.048737652<br />response_resids:  1.4553487e-02<br />dibpat: Type B","fitted: 0.069012528<br />response_resids: -2.7345862e-02<br />dibpat: Type B","fitted: 0.081865394<br />response_resids: -4.1865394e-02<br />dibpat: Type B","fitted: 0.091609373<br />response_resids:  2.1406266e-03<br />dibpat: Type B","fitted: 0.102383794<br />response_resids:  1.3291032e-01<br />dibpat: Type B"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.022755219083398323,0.23107355679233957],"y":[0,0],"text":"yintercept: 0","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.032224234433804747,0.034621453509857007,0.037018672585909261,0.039415891661961522,0.041813110738013783,0.044210329814066043,0.046607548890118297,0.049004767966170558,0.051401987042222819,0.053799206118275072,0.056196425194327333,0.058593644270379594,0.060990863346431848,0.063388082422484116,0.065785301498536369,0.068182520574588623,0.070579739650640877,0.072976958726693145,0.075374177802745398,0.077771396878797666,0.08016861595484992,0.082565835030902174,0.084963054106954428,0.087360273183006695,0.089757492259058949,0.092154711335111217,0.094551930411163471,0.096949149487215724,0.099346368563267992,0.10174358763932025,0.1041408067153725,0.10653802579142477,0.10893524486747702,0.11133246394352928,0.11372968301958154,0.1161269020956338,0.11852412117168605,0.12092134024773832,0.12331855932379057,0.12571577839984283,0.12811299747589511,0.13051021655194733,0.13290743562799961,0.13530465470405187,0.13770187378010412,0.14009909285615638,0.14249631193220863,0.14489353100826091,0.14729075008431314,0.14968796916036542,0.15208518823641767,0.15448240731246993,0.15687962638852221,0.15927684546457443,0.16167406454062672,0.16407128361667894,0.16646850269273122,0.16886572176878351,0.17126294084483573,0.17366015992088801,0.17605737899694024,0.17845459807299252,0.1808518171490448,0.18324903622509703,0.18564625530114931,0.18804347437720154,0.19044069345325382,0.1928379125293061,0.19523513160535833,0.19763235068141061,0.20002956975746283,0.20242678883351511,0.20482400790956734,0.20722122698561962,0.2096184460616719,0.21201566513772413,0.21441288421377641,0.21681010328982864,0.21920732236588092,0.22160454144193314],"y":[0.0022873786418898521,0.0022855473977323221,0.0021280389946747164,0.0019864408924874857,0.001848596406463707,0.0015537869130376951,0.0012177186055594197,0.00087584068918245992,0.00050571153491429282,8.4889513762394613e-05,-0.00040906700326576038,-0.00098044561236798763,-0.0012676916653127201,-0.0014151484052982004,-0.0018150206943960128,-0.002859513394677742,-0.0046042492494451914,-0.0061773548575778745,-0.0076184909053804836,-0.0090564613961362297,-0.010620070333128293,-0.012307065012777785,-0.012576456285260475,-0.012435436833056276,-0.01295135308414791,-0.012351663434359226,-0.01130833619576363,-0.010790229676235729,-0.010673770207606003,-0.010333915551222294,-0.0098059247101166709,-0.0091250566873211907,-0.0083265704858679363,-0.0074457251087889668,-0.0065177795591163483,-0.0055779928398821564,-0.0046616239541184537,-0.0038039319048573041,-0.0030706766518604871,-0.0025845113062175486,-0.0023352534294963177,-0.0023008729248562856,-0.0024593396954569369,-0.0027886236444577533,-0.0032666946750182211,-0.0038715226902978277,-0.0045810775934560571,-0.0053733292876524024,-0.0062262476760463247,-0.007117802661797343,-0.0080259641480649197,-0.0089287020380085444,-0.009803986234787716,-0.010629786641561889,-0.011384073161490583,-0.012044815697733255,-0.01259608807221186,-0.013124543847799191,-0.013664464071742351,-0.014215175654193094,-0.014776005505303128,-0.015346280535224206,-0.015925327654108042,-0.016512473772106358,-0.017107045799370901,-0.017708370646053389,-0.018315775222305566,-0.018928586438279146,-0.019546131204125856,-0.020167736429997449,-0.02079272902604563,-0.021420435902422142,-0.0220501839692787,-0.022681300136767064,-0.02331311131503894,-0.023944944414246057,-0.024576126344540154,-0.025205984016072939,-0.02583384433899618,-0.026459034223461575],"text":["fitted: 0.032224234<br />response_resids:  2.2873786e-03","fitted: 0.034621454<br />response_resids:  2.2855474e-03","fitted: 0.037018673<br />response_resids:  2.1280390e-03","fitted: 0.039415892<br />response_resids:  1.9864409e-03","fitted: 0.041813111<br />response_resids:  1.8485964e-03","fitted: 0.044210330<br />response_resids:  1.5537869e-03","fitted: 0.046607549<br />response_resids:  1.2177186e-03","fitted: 0.049004768<br />response_resids:  8.7584069e-04","fitted: 0.051401987<br />response_resids:  5.0571153e-04","fitted: 0.053799206<br />response_resids:  8.4889514e-05","fitted: 0.056196425<br />response_resids: -4.0906700e-04","fitted: 0.058593644<br />response_resids: -9.8044561e-04","fitted: 0.060990863<br />response_resids: -1.2676917e-03","fitted: 0.063388082<br />response_resids: -1.4151484e-03","fitted: 0.065785301<br />response_resids: -1.8150207e-03","fitted: 0.068182521<br />response_resids: -2.8595134e-03","fitted: 0.070579740<br />response_resids: -4.6042492e-03","fitted: 0.072976959<br />response_resids: -6.1773549e-03","fitted: 0.075374178<br />response_resids: -7.6184909e-03","fitted: 0.077771397<br />response_resids: -9.0564614e-03","fitted: 0.080168616<br />response_resids: -1.0620070e-02","fitted: 0.082565835<br />response_resids: -1.2307065e-02","fitted: 0.084963054<br />response_resids: -1.2576456e-02","fitted: 0.087360273<br />response_resids: -1.2435437e-02","fitted: 0.089757492<br />response_resids: -1.2951353e-02","fitted: 0.092154711<br />response_resids: -1.2351663e-02","fitted: 0.094551930<br />response_resids: -1.1308336e-02","fitted: 0.096949149<br />response_resids: -1.0790230e-02","fitted: 0.099346369<br />response_resids: -1.0673770e-02","fitted: 0.101743588<br />response_resids: -1.0333916e-02","fitted: 0.104140807<br />response_resids: -9.8059247e-03","fitted: 0.106538026<br />response_resids: -9.1250567e-03","fitted: 0.108935245<br />response_resids: -8.3265705e-03","fitted: 0.111332464<br />response_resids: -7.4457251e-03","fitted: 0.113729683<br />response_resids: -6.5177796e-03","fitted: 0.116126902<br />response_resids: -5.5779928e-03","fitted: 0.118524121<br />response_resids: -4.6616240e-03","fitted: 0.120921340<br />response_resids: -3.8039319e-03","fitted: 0.123318559<br />response_resids: -3.0706767e-03","fitted: 0.125715778<br />response_resids: -2.5845113e-03","fitted: 0.128112997<br />response_resids: -2.3352534e-03","fitted: 0.130510217<br />response_resids: -2.3008729e-03","fitted: 0.132907436<br />response_resids: -2.4593397e-03","fitted: 0.135304655<br />response_resids: -2.7886236e-03","fitted: 0.137701874<br />response_resids: -3.2666947e-03","fitted: 0.140099093<br />response_resids: -3.8715227e-03","fitted: 0.142496312<br />response_resids: -4.5810776e-03","fitted: 0.144893531<br />response_resids: -5.3733293e-03","fitted: 0.147290750<br />response_resids: -6.2262477e-03","fitted: 0.149687969<br />response_resids: -7.1178027e-03","fitted: 0.152085188<br />response_resids: -8.0259641e-03","fitted: 0.154482407<br />response_resids: -8.9287020e-03","fitted: 0.156879626<br />response_resids: -9.8039862e-03","fitted: 0.159276845<br />response_resids: -1.0629787e-02","fitted: 0.161674065<br />response_resids: -1.1384073e-02","fitted: 0.164071284<br />response_resids: -1.2044816e-02","fitted: 0.166468503<br />response_resids: -1.2596088e-02","fitted: 0.168865722<br />response_resids: -1.3124544e-02","fitted: 0.171262941<br />response_resids: -1.3664464e-02","fitted: 0.173660160<br />response_resids: -1.4215176e-02","fitted: 0.176057379<br />response_resids: -1.4776006e-02","fitted: 0.178454598<br />response_resids: -1.5346281e-02","fitted: 0.180851817<br />response_resids: -1.5925328e-02","fitted: 0.183249036<br />response_resids: -1.6512474e-02","fitted: 0.185646255<br />response_resids: -1.7107046e-02","fitted: 0.188043474<br />response_resids: -1.7708371e-02","fitted: 0.190440693<br />response_resids: -1.8315775e-02","fitted: 0.192837913<br />response_resids: -1.8928586e-02","fitted: 0.195235132<br />response_resids: -1.9546131e-02","fitted: 0.197632351<br />response_resids: -2.0167736e-02","fitted: 0.200029570<br />response_resids: -2.0792729e-02","fitted: 0.202426789<br />response_resids: -2.1420436e-02","fitted: 0.204824008<br />response_resids: -2.2050184e-02","fitted: 0.207221227<br />response_resids: -2.2681300e-02","fitted: 0.209618446<br />response_resids: -2.3313111e-02","fitted: 0.212015665<br />response_resids: -2.3944944e-02","fitted: 0.214412884<br />response_resids: -2.4576126e-02","fitted: 0.216810103<br />response_resids: -2.5205984e-02","fitted: 0.219207322<br />response_resids: -2.5833844e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":3.7795275590551185,"color":"rgba(51,102,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.032224234433804747,0.034621453509857007,0.037018672585909261,0.039415891661961522,0.041813110738013783,0.044210329814066043,0.046607548890118297,0.049004767966170558,0.051401987042222819,0.053799206118275072,0.056196425194327333,0.058593644270379594,0.060990863346431848,0.063388082422484116,0.065785301498536369,0.068182520574588623,0.070579739650640877,0.072976958726693145,0.075374177802745398,0.077771396878797666,0.08016861595484992,0.082565835030902174,0.084963054106954428,0.087360273183006695,0.089757492259058949,0.092154711335111217,0.094551930411163471,0.096949149487215724,0.099346368563267992,0.10174358763932025,0.1041408067153725,0.10653802579142477,0.10893524486747702,0.11133246394352928,0.11372968301958154,0.1161269020956338,0.11852412117168605,0.12092134024773832,0.12331855932379057,0.12571577839984283,0.12811299747589511,0.13051021655194733,0.13290743562799961,0.13530465470405187,0.13770187378010412,0.14009909285615638,0.14249631193220863,0.14489353100826091,0.14729075008431314,0.14968796916036542,0.15208518823641767,0.15448240731246993,0.15687962638852221,0.15927684546457443,0.16167406454062672,0.16407128361667894,0.16646850269273122,0.16886572176878351,0.17126294084483573,0.17366015992088801,0.17605737899694024,0.17845459807299252,0.1808518171490448,0.18324903622509703,0.18564625530114931,0.18804347437720154,0.19044069345325382,0.1928379125293061,0.19523513160535833,0.19763235068141061,0.20002956975746283,0.20242678883351511,0.20482400790956734,0.20722122698561962,0.2096184460616719,0.21201566513772413,0.21441288421377641,0.21681010328982864,0.21920732236588092,0.22160454144193314,0.22160454144193314,0.22160454144193314,0.21920732236588092,0.21681010328982864,0.21441288421377641,0.21201566513772413,0.2096184460616719,0.20722122698561962,0.20482400790956734,0.20242678883351511,0.20002956975746283,0.19763235068141061,0.19523513160535833,0.1928379125293061,0.19044069345325382,0.18804347437720154,0.18564625530114931,0.18324903622509703,0.1808518171490448,0.17845459807299252,0.17605737899694024,0.17366015992088801,0.17126294084483573,0.16886572176878351,0.16646850269273122,0.16407128361667894,0.16167406454062672,0.15927684546457443,0.15687962638852221,0.15448240731246993,0.15208518823641767,0.14968796916036542,0.14729075008431314,0.14489353100826091,0.14249631193220863,0.14009909285615638,0.13770187378010412,0.13530465470405187,0.13290743562799961,0.13051021655194733,0.12811299747589511,0.12571577839984283,0.12331855932379057,0.12092134024773832,0.11852412117168605,0.1161269020956338,0.11372968301958154,0.11133246394352928,0.10893524486747702,0.10653802579142477,0.1041408067153725,0.10174358763932025,0.099346368563267992,0.096949149487215724,0.094551930411163471,0.092154711335111217,0.089757492259058949,0.087360273183006695,0.084963054106954428,0.082565835030902174,0.08016861595484992,0.077771396878797666,0.075374177802745398,0.072976958726693145,0.070579739650640877,0.068182520574588623,0.065785301498536369,0.063388082422484116,0.060990863346431848,0.058593644270379594,0.056196425194327333,0.053799206118275072,0.051401987042222819,0.049004767966170558,0.046607548890118297,0.044210329814066043,0.041813110738013783,0.039415891661961522,0.037018672585909261,0.034621453509857007,0.032224234433804747,0.032224234433804747],"y":[-0.0291207962720463,-0.026928673147919132,-0.025049668515905441,-0.023240004042525401,-0.021546955218634596,-0.02018652529776999,-0.019027858198610942,-0.018083361190100986,-0.017422746720972986,-0.017078117023036177,-0.017039939312035096,-0.017269628078552649,-0.017604109969972075,-0.018177765826964731,-0.019105887664343495,-0.020423791084051481,-0.022115418182448183,-0.023513820224467886,-0.024691917091792297,-0.025924945293692707,-0.027500664314999548,-0.029492087333190638,-0.029853450281078209,-0.029922110016604747,-0.030973077994923989,-0.030448115725570574,-0.029509183566823877,-0.02958129998245309,-0.030169517519175022,-0.030166439136312825,-0.029667017598640561,-0.028812559687027249,-0.027763822063088139,-0.02668016581146973,-0.02569967134067833,-0.0249221254996966,-0.024401397192934708,-0.024152647460435224,-0.024135688192629866,-0.024193011121636639,-0.024285625937470065,-0.024402803718567706,-0.02454461632206207,-0.024718429424116263,-0.024936580507690619,-0.025214598648278175,-0.025569541213304389,-0.026018164976515212,-0.026574788292790915,-0.027248883870524859,-0.028042669242849504,-0.028949167022405773,-0.029951271039798985,-0.031022191389126857,-0.032127305759090605,-0.033227092735686872,-0.034284984307127946,-0.035345832380259262,-0.036434633709329714,-0.03755435784210439,-0.038708305309187077,-0.03989976255530471,-0.041131720683424265,-0.042406654379143247,-0.043726358147656894,-0.04509183669719713,-0.046503245276595481,-0.047959874451746494,-0.049460172597461216,-0.051001798593147463,-0.052581696999507571,-0.054196188367264309,-0.055841068182683043,-0.057511709121243516,-0.059203162581215732,-0.06091025674911927,-0.062627689599425482,-0.06435011618981186,-0.066072230360516626,-0.067788841491228075,-0.067788841491228075,0.014870773044304932,0.014404541682524259,0.013938148157665978,0.013475436910345171,0.013020367920627156,0.012576939951137848,0.012149108847709388,0.011740700244125643,0.011355316562420028,0.010996238947416314,0.01066632573315256,0.010367910189209507,0.010102701575188201,0.0098716948319843498,0.0096750954050903483,0.0095122665489150923,0.0093817068349305345,0.009281065375208182,0.0092072014848562991,0.0091562942985808186,0.0091240065337182038,0.0091057055658450136,0.0090967446846608839,0.0090928081627042259,0.0091374613402203601,0.0093591594361094356,0.0097626181060030785,0.010343298570223551,0.011091762946388684,0.011990740946719662,0.013013278546930174,0.014122292940698267,0.015271506401210409,0.016407386026392273,0.017471553267682519,0.018403191157654174,0.019141182135200753,0.019625936931148197,0.019801057868855138,0.019615119078477433,0.019023988509201541,0.017994334888908892,0.016544783650720617,0.015078149284697799,0.013766139819932285,0.012664112222445633,0.011788715593891795,0.011110681091352268,0.010562446312384866,0.010055168178407219,0.009498608033868235,0.0088219771039630187,0.0080008406299816315,0.006892511175296618,0.0057447888568521194,0.0050703718266281693,0.0050512363504921966,0.00470053771055726,0.0048779573076350689,0.0062605236487429643,0.0078120225014202474,0.0094549352810313278,0.011159110509312139,0.0129069196835578,0.014704764294695995,0.015475846275551468,0.015347469016368331,0.015068726639346636,0.015308736853816675,0.016221805305503573,0.017247896050560967,0.01843416979080157,0.019835042568465907,0.021463295409729778,0.023294099123845381,0.025244148031562011,0.027212885827500373,0.029305746505254873,0.031499767943383779,0.033695553555826006,-0.0291207962720463],"text":["fitted: 0.032224234<br />response_resids:  2.2873786e-03","fitted: 0.034621454<br />response_resids:  2.2855474e-03","fitted: 0.037018673<br />response_resids:  2.1280390e-03","fitted: 0.039415892<br />response_resids:  1.9864409e-03","fitted: 0.041813111<br />response_resids:  1.8485964e-03","fitted: 0.044210330<br />response_resids:  1.5537869e-03","fitted: 0.046607549<br />response_resids:  1.2177186e-03","fitted: 0.049004768<br />response_resids:  8.7584069e-04","fitted: 0.051401987<br />response_resids:  5.0571153e-04","fitted: 0.053799206<br />response_resids:  8.4889514e-05","fitted: 0.056196425<br />response_resids: -4.0906700e-04","fitted: 0.058593644<br />response_resids: -9.8044561e-04","fitted: 0.060990863<br />response_resids: -1.2676917e-03","fitted: 0.063388082<br />response_resids: -1.4151484e-03","fitted: 0.065785301<br />response_resids: -1.8150207e-03","fitted: 0.068182521<br />response_resids: -2.8595134e-03","fitted: 0.070579740<br />response_resids: -4.6042492e-03","fitted: 0.072976959<br />response_resids: -6.1773549e-03","fitted: 0.075374178<br />response_resids: -7.6184909e-03","fitted: 0.077771397<br />response_resids: -9.0564614e-03","fitted: 0.080168616<br />response_resids: -1.0620070e-02","fitted: 0.082565835<br />response_resids: -1.2307065e-02","fitted: 0.084963054<br />response_resids: -1.2576456e-02","fitted: 0.087360273<br />response_resids: -1.2435437e-02","fitted: 0.089757492<br />response_resids: -1.2951353e-02","fitted: 0.092154711<br />response_resids: -1.2351663e-02","fitted: 0.094551930<br />response_resids: -1.1308336e-02","fitted: 0.096949149<br />response_resids: -1.0790230e-02","fitted: 0.099346369<br />response_resids: -1.0673770e-02","fitted: 0.101743588<br />response_resids: -1.0333916e-02","fitted: 0.104140807<br />response_resids: -9.8059247e-03","fitted: 0.106538026<br />response_resids: -9.1250567e-03","fitted: 0.108935245<br />response_resids: -8.3265705e-03","fitted: 0.111332464<br />response_resids: -7.4457251e-03","fitted: 0.113729683<br />response_resids: -6.5177796e-03","fitted: 0.116126902<br />response_resids: -5.5779928e-03","fitted: 0.118524121<br />response_resids: -4.6616240e-03","fitted: 0.120921340<br />response_resids: -3.8039319e-03","fitted: 0.123318559<br />response_resids: -3.0706767e-03","fitted: 0.125715778<br />response_resids: -2.5845113e-03","fitted: 0.128112997<br />response_resids: -2.3352534e-03","fitted: 0.130510217<br />response_resids: -2.3008729e-03","fitted: 0.132907436<br />response_resids: -2.4593397e-03","fitted: 0.135304655<br />response_resids: -2.7886236e-03","fitted: 0.137701874<br />response_resids: -3.2666947e-03","fitted: 0.140099093<br />response_resids: -3.8715227e-03","fitted: 0.142496312<br />response_resids: -4.5810776e-03","fitted: 0.144893531<br />response_resids: -5.3733293e-03","fitted: 0.147290750<br />response_resids: -6.2262477e-03","fitted: 0.149687969<br />response_resids: -7.1178027e-03","fitted: 0.152085188<br />response_resids: -8.0259641e-03","fitted: 0.154482407<br />response_resids: -8.9287020e-03","fitted: 0.156879626<br />response_resids: -9.8039862e-03","fitted: 0.159276845<br />response_resids: -1.0629787e-02","fitted: 0.161674065<br />response_resids: -1.1384073e-02","fitted: 0.164071284<br />response_resids: -1.2044816e-02","fitted: 0.166468503<br />response_resids: -1.2596088e-02","fitted: 0.168865722<br />response_resids: -1.3124544e-02","fitted: 0.171262941<br />response_resids: -1.3664464e-02","fitted: 0.173660160<br />response_resids: -1.4215176e-02","fitted: 0.176057379<br />response_resids: -1.4776006e-02","fitted: 0.178454598<br />response_resids: -1.5346281e-02","fitted: 0.180851817<br />response_resids: -1.5925328e-02","fitted: 0.183249036<br />response_resids: -1.6512474e-02","fitted: 0.185646255<br />response_resids: -1.7107046e-02","fitted: 0.188043474<br />response_resids: -1.7708371e-02","fitted: 0.190440693<br />response_resids: -1.8315775e-02","fitted: 0.192837913<br />response_resids: -1.8928586e-02","fitted: 0.195235132<br />response_resids: -1.9546131e-02","fitted: 0.197632351<br />response_resids: -2.0167736e-02","fitted: 0.200029570<br />response_resids: -2.0792729e-02","fitted: 0.202426789<br />response_resids: -2.1420436e-02","fitted: 0.204824008<br />response_resids: -2.2050184e-02","fitted: 0.207221227<br />response_resids: -2.2681300e-02","fitted: 0.209618446<br />response_resids: -2.3313111e-02","fitted: 0.212015665<br />response_resids: -2.3944944e-02","fitted: 0.214412884<br />response_resids: -2.4576126e-02","fitted: 0.216810103<br />response_resids: -2.5205984e-02","fitted: 0.219207322<br />response_resids: -2.5833844e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02","fitted: 0.219207322<br />response_resids: -2.5833844e-02","fitted: 0.216810103<br />response_resids: -2.5205984e-02","fitted: 0.214412884<br />response_resids: -2.4576126e-02","fitted: 0.212015665<br />response_resids: -2.3944944e-02","fitted: 0.209618446<br />response_resids: -2.3313111e-02","fitted: 0.207221227<br />response_resids: -2.2681300e-02","fitted: 0.204824008<br />response_resids: -2.2050184e-02","fitted: 0.202426789<br />response_resids: -2.1420436e-02","fitted: 0.200029570<br />response_resids: -2.0792729e-02","fitted: 0.197632351<br />response_resids: -2.0167736e-02","fitted: 0.195235132<br />response_resids: -1.9546131e-02","fitted: 0.192837913<br />response_resids: -1.8928586e-02","fitted: 0.190440693<br />response_resids: -1.8315775e-02","fitted: 0.188043474<br />response_resids: -1.7708371e-02","fitted: 0.185646255<br />response_resids: -1.7107046e-02","fitted: 0.183249036<br />response_resids: -1.6512474e-02","fitted: 0.180851817<br />response_resids: -1.5925328e-02","fitted: 0.178454598<br />response_resids: -1.5346281e-02","fitted: 0.176057379<br />response_resids: -1.4776006e-02","fitted: 0.173660160<br />response_resids: -1.4215176e-02","fitted: 0.171262941<br />response_resids: -1.3664464e-02","fitted: 0.168865722<br />response_resids: -1.3124544e-02","fitted: 0.166468503<br />response_resids: -1.2596088e-02","fitted: 0.164071284<br />response_resids: -1.2044816e-02","fitted: 0.161674065<br />response_resids: -1.1384073e-02","fitted: 0.159276845<br />response_resids: -1.0629787e-02","fitted: 0.156879626<br />response_resids: -9.8039862e-03","fitted: 0.154482407<br />response_resids: -8.9287020e-03","fitted: 0.152085188<br />response_resids: -8.0259641e-03","fitted: 0.149687969<br />response_resids: -7.1178027e-03","fitted: 0.147290750<br />response_resids: -6.2262477e-03","fitted: 0.144893531<br />response_resids: -5.3733293e-03","fitted: 0.142496312<br />response_resids: -4.5810776e-03","fitted: 0.140099093<br />response_resids: -3.8715227e-03","fitted: 0.137701874<br />response_resids: -3.2666947e-03","fitted: 0.135304655<br />response_resids: -2.7886236e-03","fitted: 0.132907436<br />response_resids: -2.4593397e-03","fitted: 0.130510217<br />response_resids: -2.3008729e-03","fitted: 0.128112997<br />response_resids: -2.3352534e-03","fitted: 0.125715778<br />response_resids: -2.5845113e-03","fitted: 0.123318559<br />response_resids: -3.0706767e-03","fitted: 0.120921340<br />response_resids: -3.8039319e-03","fitted: 0.118524121<br />response_resids: -4.6616240e-03","fitted: 0.116126902<br />response_resids: -5.5779928e-03","fitted: 0.113729683<br />response_resids: -6.5177796e-03","fitted: 0.111332464<br />response_resids: -7.4457251e-03","fitted: 0.108935245<br />response_resids: -8.3265705e-03","fitted: 0.106538026<br />response_resids: -9.1250567e-03","fitted: 0.104140807<br />response_resids: -9.8059247e-03","fitted: 0.101743588<br />response_resids: -1.0333916e-02","fitted: 0.099346369<br />response_resids: -1.0673770e-02","fitted: 0.096949149<br />response_resids: -1.0790230e-02","fitted: 0.094551930<br />response_resids: -1.1308336e-02","fitted: 0.092154711<br />response_resids: -1.2351663e-02","fitted: 0.089757492<br />response_resids: -1.2951353e-02","fitted: 0.087360273<br />response_resids: -1.2435437e-02","fitted: 0.084963054<br />response_resids: -1.2576456e-02","fitted: 0.082565835<br />response_resids: -1.2307065e-02","fitted: 0.080168616<br />response_resids: -1.0620070e-02","fitted: 0.077771397<br />response_resids: -9.0564614e-03","fitted: 0.075374178<br />response_resids: -7.6184909e-03","fitted: 0.072976959<br />response_resids: -6.1773549e-03","fitted: 0.070579740<br />response_resids: -4.6042492e-03","fitted: 0.068182521<br />response_resids: -2.8595134e-03","fitted: 0.065785301<br />response_resids: -1.8150207e-03","fitted: 0.063388082<br />response_resids: -1.4151484e-03","fitted: 0.060990863<br />response_resids: -1.2676917e-03","fitted: 0.058593644<br />response_resids: -9.8044561e-04","fitted: 0.056196425<br />response_resids: -4.0906700e-04","fitted: 0.053799206<br />response_resids:  8.4889514e-05","fitted: 0.051401987<br />response_resids:  5.0571153e-04","fitted: 0.049004768<br />response_resids:  8.7584069e-04","fitted: 0.046607549<br />response_resids:  1.2177186e-03","fitted: 0.044210330<br />response_resids:  1.5537869e-03","fitted: 0.041813111<br />response_resids:  1.8485964e-03","fitted: 0.039415892<br />response_resids:  1.9864409e-03","fitted: 0.037018673<br />response_resids:  2.1280390e-03","fitted: 0.034621454<br />response_resids:  2.2855474e-03","fitted: 0.032224234<br />response_resids:  2.2873786e-03","fitted: 0.032224234<br />response_resids:  2.2873786e-03"],"type":"scatter","mode":"lines","line":{"width":3.7795275590551185,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(153,153,153,0.4)","hoveron":"points","hoverinfo":"x+y","showlegend":false,"xaxis":"x","yaxis":"y","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":54.794520547945211},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.022755219083398323,0.23107355679233957],"tickmode":"array","ticktext":["0.05","0.10","0.15","0.20"],"tickvals":[0.050000000000000003,0.10000000000000001,0.15000000000000002,0.20000000000000001],"categoryorder":"array","categoryarray":["0.05","0.10","0.15","0.20"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"fitted","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.097589621268256099,0.14388651127541818],"tickmode":"array","ticktext":["-0.05","0.00","0.05","0.10"],"tickvals":[-0.050000000000000003,0,0.050000000000000017,0.10000000000000001],"categoryorder":"array","categoryarray":["-0.05","0.00","0.05","0.10"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"response_resids","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"dibpat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"77a47f36c092":{"x":{},"y":{},"colour":{},"type":"scatter"},"77a4639cf27d":{"yintercept":{}},"77a454f41fa2":{"x":{},"y":{}}},"cur_data":"77a47f36c092","visdat":{"77a47f36c092":["function (y) ","x"],"77a4639cf27d":["function (y) ","x"],"77a454f41fa2":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can see a slight fan-shape here: observations on the right have larger variance (as expected since <span class="math inline">\(var(\bar y) = \pi(1-\pi)/n\)</span> is maximized when <span class="math inline">\(\pi = 0.5\)</span>).</p>
</section>
<section id="pearson-residuals" class="level3" data-number="3.7.3">
<h3 data-number="3.7.3" class="anchored" data-anchor-id="pearson-residuals"><span class="header-section-number">3.7.3</span> Pearson residuals</h3>
<p>The fan-shape in the response residuals plot isn’t necessarily a concern here, since we haven’t made an assumption of constant residual variance, as we did for linear regression.</p>
<p>However, we might want to divide by the standard error in order to make the graph easier to interpret. Here’s one way to do that:</p>
<p>The Pearson (chi-squared) residual for covariate pattern <span class="math inline">\(k\)</span> is: <span class="math display">\[
\begin{aligned}
X_k &amp;= \frac{\bar y_k - \hat\pi_k}{\sqrt{\hat \pi_k (1-\hat\pi_k)/n_k}}
\end{aligned}
\]</span></p>
<p>where <span class="math display">\[
\begin{aligned}
\hat\pi_k
&amp;\stackrel{\text{def}}{=}\hat\pi(x_k)\\
&amp;\stackrel{\text{def}}{=}\hat P(Y=1|X=x_k)\\
&amp;\stackrel{\text{def}}{=}\text{expit}(x_i'\hat \beta)\\
&amp;\stackrel{\text{def}}{=}\text{expit}(\hat \beta_0 + \sum_{j=1}^p \hat \beta_j x_{ij})
\end{aligned}
\]</span></p>
<p>Let’s take a look at the Pearson residuals for our CHD model from the WCGS data (graphed against the fitted values on the logit scale):</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The fan-shape is gone, and these residuals don’t show any obvious signs of model fit issues.</p>
<section id="pearson-residuals-plot-for-beetles-data" class="level4">
<h4 class="anchored" data-anchor-id="pearson-residuals-plot-for-beetles-data">Pearson residuals plot for <code>beetles</code> data</h4>
<p>If we create the same plot for the <code>beetles</code> model, we see some strong evidence of a lack of fit:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(beetles_glm_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pearson-residuals-with-individual-ungrouped-data" class="level4">
<h4 class="anchored" data-anchor-id="pearson-residuals-with-individual-ungrouped-data">Pearson residuals with individual (ungrouped) data</h4>
<p>What happens if we try to compute residuals without grouping the data by covariate pattern?</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Meaningless.</p>
</section>
<section id="residuals-plot-by-hand-optional-section" class="level4">
<h4 class="anchored" data-anchor-id="residuals-plot-by-hand-optional-section">Residuals plot by hand (<em>optional section</em>)</h4>
<p>If you want to check your understanding of what these residual plots are, try building them yourself:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">=</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">resids =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="ot">=</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted_logit,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> resids</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, </span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">span=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">degree=</span><span class="dv">1</span>,</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span><span class="st">"symmetric"</span>,</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">iterations=</span><span class="dv">3</span>,</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">surface=</span><span class="st">"direct"</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>                <span class="co"># span = 2/3, </span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>                <span class="co"># iterations = 3</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> stats<span class="sc">::</span>loess)</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="co"># plot.glm and autoplot use stats::lowess, which is hard to use with </span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_smooth and hard to match exactly; </span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://support.bioconductor.org/p/2323/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-0e34894bee005593ca02" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0e34894bee005593ca02">{"x":{"data":[{"x":[-1.9035045514956241,-1.8315974066617542,-1.2563402479907959,-2.3349474204988425,-2.1192259859972333,-2.6225759998343219,-2.5506688550004522,-2.4068545653327127,-1.6158759721601448,-2.0473188411633636,-2.6944831446681916,-1.9754116963294939,-1.5439688273262753,-1.4720616824924053,-2.4787617101665824,-2.2630402756649728,-2.1911331308311031,-1.4001545376585356,-1.687783116994015,-1.7596902618278842,-1.3282473928246661],"y":[-0.63437945290859576,0.62006470991397156,0.1546765344094129,-0.32314137640605828,-0.27477762864565447,-0.0013932880580615546,-0.30347473837674804,-0.37508157915284729,-0.6597108838003336,1.0028150453407565,1.0518129601938366,2.928052531785533,-0.23999767668657088,1.0468817563438477,-1.4202917745638999,-0.099763240763368691,-1.0980259512257797,-0.96109203501400919,-0.93650721161428807,1.2111732236224655,-0.89403423992454878],"text":["fitted_logit: -1.9035046<br />resids: -0.6343794529<br />dibpat: Type A","fitted_logit: -1.8315974<br />resids:  0.6200647099<br />dibpat: Type A","fitted_logit: -1.2563402<br />resids:  0.1546765344<br />dibpat: Type A","fitted_logit: -2.3349474<br />resids: -0.3231413764<br />dibpat: Type A","fitted_logit: -2.1192260<br />resids: -0.2747776286<br />dibpat: Type A","fitted_logit: -2.6225760<br />resids: -0.0013932881<br />dibpat: Type A","fitted_logit: -2.5506689<br />resids: -0.3034747384<br />dibpat: Type A","fitted_logit: -2.4068546<br />resids: -0.3750815792<br />dibpat: Type A","fitted_logit: -1.6158760<br />resids: -0.6597108838<br />dibpat: Type A","fitted_logit: -2.0473188<br />resids:  1.0028150453<br />dibpat: Type A","fitted_logit: -2.6944831<br />resids:  1.0518129602<br />dibpat: Type A","fitted_logit: -1.9754117<br />resids:  2.9280525318<br />dibpat: Type A","fitted_logit: -1.5439688<br />resids: -0.2399976767<br />dibpat: Type A","fitted_logit: -1.4720617<br />resids:  1.0468817563<br />dibpat: Type A","fitted_logit: -2.4787617<br />resids: -1.4202917746<br />dibpat: Type A","fitted_logit: -2.2630403<br />resids: -0.0997632408<br />dibpat: Type A","fitted_logit: -2.1911331<br />resids: -1.0980259512<br />dibpat: Type A","fitted_logit: -1.4001545<br />resids: -0.9610920350<br />dibpat: Type A","fitted_logit: -1.6877831<br />resids: -0.9365072116<br />dibpat: Type A","fitted_logit: -1.7596903<br />resids:  1.2111732236<br />dibpat: Type A","fitted_logit: -1.3282474<br />resids: -0.8940342399<br />dibpat: Type A"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-3.0329013797783677,-3.2791548743659225,-2.9097746324845901,-3.4022816216597005,-2.7866478851908125,-2.6635211378970349,-3.2175915007190339,-2.7250845115439239,-3.0944647534252563,-2.3557042696625916,-3.340718248012811,-2.232577522368814,-2.8482112588377015,-3.1560281270721449,-2.5403943906032578,-2.4788310169563688,-2.9713380061314787,-2.6019577642501464,-2.4172676433094802,-2.2941408960157026,-2.1710141487219254],"y":[-0.0044810795747202495,0.22159563738581595,-1.4999066438812154,1.7127098317633715,0.58026373624415217,1.2729164139631557,-1.7289660562707454,-0.34085761194085429,-0.5722654257278228,-1.6001002734221939,-0.88258984970818233,-0.81524777266671644,1.1503643930417931,0.54837451298717932,1.088576980651593,-0.090262797175270082,0.60075603631230234,-0.74744001042634334,-0.76352248832054659,0.041976829957371384,1.8076827891719742],"text":["fitted_logit: -3.0329014<br />resids: -0.0044810796<br />dibpat: Type B","fitted_logit: -3.2791549<br />resids:  0.2215956374<br />dibpat: Type B","fitted_logit: -2.9097746<br />resids: -1.4999066439<br />dibpat: Type B","fitted_logit: -3.4022816<br />resids:  1.7127098318<br />dibpat: Type B","fitted_logit: -2.7866479<br />resids:  0.5802637362<br />dibpat: Type B","fitted_logit: -2.6635211<br />resids:  1.2729164140<br />dibpat: Type B","fitted_logit: -3.2175915<br />resids: -1.7289660563<br />dibpat: Type B","fitted_logit: -2.7250845<br />resids: -0.3408576119<br />dibpat: Type B","fitted_logit: -3.0944648<br />resids: -0.5722654257<br />dibpat: Type B","fitted_logit: -2.3557043<br />resids: -1.6001002734<br />dibpat: Type B","fitted_logit: -3.3407182<br />resids: -0.8825898497<br />dibpat: Type B","fitted_logit: -2.2325775<br />resids: -0.8152477727<br />dibpat: Type B","fitted_logit: -2.8482113<br />resids:  1.1503643930<br />dibpat: Type B","fitted_logit: -3.1560281<br />resids:  0.5483745130<br />dibpat: Type B","fitted_logit: -2.5403944<br />resids:  1.0885769807<br />dibpat: Type B","fitted_logit: -2.4788310<br />resids: -0.0902627972<br />dibpat: Type B","fitted_logit: -2.9713380<br />resids:  0.6007560363<br />dibpat: Type B","fitted_logit: -2.6019578<br />resids: -0.7474400104<br />dibpat: Type B","fitted_logit: -2.4172676<br />resids: -0.7635224883<br />dibpat: Type B","fitted_logit: -2.2941409<br />resids:  0.0419768300<br />dibpat: Type B","fitted_logit: -2.1710141<br />resids:  1.8076827892<br />dibpat: Type B"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-3.5095786903431456,-1.1490431793073508],"y":[0,0],"text":"yintercept: 0","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-3.4022816216597005,-3.3751178068031322,-3.3479539919465635,-3.3207901770899952,-3.293626362233427,-3.2664625473768583,-3.23929873252029,-3.2121349176637217,-3.184971102807153,-3.1578072879505847,-3.1306434730940165,-3.1034796582374478,-3.0763158433808795,-3.0491520285243112,-3.0219882136677425,-2.9948243988111742,-2.967660583954606,-2.9404967690980373,-2.913332954241469,-2.8861691393849007,-2.859005324528332,-2.8318415096717637,-2.8046776948151955,-2.7775138799586272,-2.7503500651020585,-2.7231862502454902,-2.6960224353889219,-2.6688586205323532,-2.641694805675785,-2.6145309908192167,-2.5873671759626484,-2.5602033611060797,-2.5330395462495114,-2.5058757313929432,-2.4787119165363745,-2.4515481016798062,-2.4243842868232379,-2.3972204719666692,-2.3700566571101009,-2.3428928422535327,-2.315729027396964,-2.2885652125403957,-2.2614013976838274,-2.2342375828272587,-2.2070737679706904,-2.1799099531141222,-2.1527461382575535,-2.1255823234009852,-2.0984185085444169,-2.0712546936878482,-2.0440908788312799,-2.0169270639747117,-1.9897632491181432,-1.9625994342615747,-1.9354356194050062,-1.9082718045484379,-1.8811079896918694,-1.8539441748353009,-1.8267803599787327,-1.7996165451221642,-1.7724527302655959,-1.7452889154090274,-1.7181251005524589,-1.6909612856958907,-1.6637974708393222,-1.6366336559827537,-1.6094698411261854,-1.5823060262696169,-1.5551422114130484,-1.5279783965564802,-1.5008145816999117,-1.4736507668433434,-1.4464869519867749,-1.4193231371302064,-1.3921593222736379,-1.3649955074170697,-1.3378316925605014,-1.3106678777039327,-1.2835040628473644,-1.2563402479907959],"y":[-0.0056926112342833837,-0.0014655068031602997,0.0028627248026834476,0.0071376363715596096,0.011246513751015819,0.015097338111743503,0.018582045097171176,0.02157482692137978,0.023974315498757084,0.025751021327794554,0.026887889906031977,0.027346860434061235,0.027094217114688859,0.026147923881664013,0.024585005309459972,0.02254490427645317,0.020263582531734988,0.018113137646755099,0.016657754155375296,0.016842469031119783,0.020289606626684154,0.029174973065879392,0.044375051881825819,0.046783001239037683,0.051484393544902252,0.033586659195390528,0.03385647365258114,0.0052100346390719999,-0.0045353664964380407,-0.026157728281577943,-0.047133383380822971,-0.064813583771287389,-0.085002087709815863,-0.10627308279077179,-0.12126748905293154,-0.1351465957664077,-0.15240532995624531,-0.14988788107447951,-0.16679400995316715,-0.15806755283735852,-0.15273952587831507,-0.14460201576937726,-0.11795052084855193,-0.10817191909296144,-0.084246034162126338,-0.067064948514251335,-0.051085251977567282,-0.047066257502924015,-0.02449204986805446,-0.032743711707001792,-0.023582312823514862,-0.028707823097400741,-0.019260001872353293,-0.027058464148146444,-0.014836382606264877,-0.028272022204856421,-0.041759652010189829,-0.053375393311701332,-0.062892322941483225,-0.070772843049209486,-0.077592345129053816,-0.083820381064163507,-0.089839591346039541,-0.09595284443716344,-0.10236609846578275,-0.10919046577718902,-0.11649054204259235,-0.12429788044746347,-0.13261049809424932,-0.14141701050857211,-0.1506981811532461,-0.16042975672316281,-0.17059476616468389,-0.18121455529685906,-0.19231662964913931,-0.20390758940743961,-0.21596504491025803,-0.22846234289960157,-0.24134957275708155,-0.25456360364553021],"text":["fitted_logit: -3.4022816<br />resids: -0.0056926112","fitted_logit: -3.3751178<br />resids: -0.0014655068","fitted_logit: -3.3479540<br />resids:  0.0028627248","fitted_logit: -3.3207902<br />resids:  0.0071376364","fitted_logit: -3.2936264<br />resids:  0.0112465138","fitted_logit: -3.2664625<br />resids:  0.0150973381","fitted_logit: -3.2392987<br />resids:  0.0185820451","fitted_logit: -3.2121349<br />resids:  0.0215748269","fitted_logit: -3.1849711<br />resids:  0.0239743155","fitted_logit: -3.1578073<br />resids:  0.0257510213","fitted_logit: -3.1306435<br />resids:  0.0268878899","fitted_logit: -3.1034797<br />resids:  0.0273468604","fitted_logit: -3.0763158<br />resids:  0.0270942171","fitted_logit: -3.0491520<br />resids:  0.0261479239","fitted_logit: -3.0219882<br />resids:  0.0245850053","fitted_logit: -2.9948244<br />resids:  0.0225449043","fitted_logit: -2.9676606<br />resids:  0.0202635825","fitted_logit: -2.9404968<br />resids:  0.0181131376","fitted_logit: -2.9133330<br />resids:  0.0166577542","fitted_logit: -2.8861691<br />resids:  0.0168424690","fitted_logit: -2.8590053<br />resids:  0.0202896066","fitted_logit: -2.8318415<br />resids:  0.0291749731","fitted_logit: -2.8046777<br />resids:  0.0443750519","fitted_logit: -2.7775139<br />resids:  0.0467830012","fitted_logit: -2.7503501<br />resids:  0.0514843935","fitted_logit: -2.7231863<br />resids:  0.0335866592","fitted_logit: -2.6960224<br />resids:  0.0338564737","fitted_logit: -2.6688586<br />resids:  0.0052100346","fitted_logit: -2.6416948<br />resids: -0.0045353665","fitted_logit: -2.6145310<br />resids: -0.0261577283","fitted_logit: -2.5873672<br />resids: -0.0471333834","fitted_logit: -2.5602034<br />resids: -0.0648135838","fitted_logit: -2.5330395<br />resids: -0.0850020877","fitted_logit: -2.5058757<br />resids: -0.1062730828","fitted_logit: -2.4787119<br />resids: -0.1212674891","fitted_logit: -2.4515481<br />resids: -0.1351465958","fitted_logit: -2.4243843<br />resids: -0.1524053300","fitted_logit: -2.3972205<br />resids: -0.1498878811","fitted_logit: -2.3700567<br />resids: -0.1667940100","fitted_logit: -2.3428928<br />resids: -0.1580675528","fitted_logit: -2.3157290<br />resids: -0.1527395259","fitted_logit: -2.2885652<br />resids: -0.1446020158","fitted_logit: -2.2614014<br />resids: -0.1179505208","fitted_logit: -2.2342376<br />resids: -0.1081719191","fitted_logit: -2.2070738<br />resids: -0.0842460342","fitted_logit: -2.1799100<br />resids: -0.0670649485","fitted_logit: -2.1527461<br />resids: -0.0510852520","fitted_logit: -2.1255823<br />resids: -0.0470662575","fitted_logit: -2.0984185<br />resids: -0.0244920499","fitted_logit: -2.0712547<br />resids: -0.0327437117","fitted_logit: -2.0440909<br />resids: -0.0235823128","fitted_logit: -2.0169271<br />resids: -0.0287078231","fitted_logit: -1.9897632<br />resids: -0.0192600019","fitted_logit: -1.9625994<br />resids: -0.0270584641","fitted_logit: -1.9354356<br />resids: -0.0148363826","fitted_logit: -1.9082718<br />resids: -0.0282720222","fitted_logit: -1.8811080<br />resids: -0.0417596520","fitted_logit: -1.8539442<br />resids: -0.0533753933","fitted_logit: -1.8267804<br />resids: -0.0628923229","fitted_logit: -1.7996165<br />resids: -0.0707728430","fitted_logit: -1.7724527<br />resids: -0.0775923451","fitted_logit: -1.7452889<br />resids: -0.0838203811","fitted_logit: -1.7181251<br />resids: -0.0898395913","fitted_logit: -1.6909613<br />resids: -0.0959528444","fitted_logit: -1.6637975<br />resids: -0.1023660985","fitted_logit: -1.6366337<br />resids: -0.1091904658","fitted_logit: -1.6094698<br />resids: -0.1164905420","fitted_logit: -1.5823060<br />resids: -0.1242978804","fitted_logit: -1.5551422<br />resids: -0.1326104981","fitted_logit: -1.5279784<br />resids: -0.1414170105","fitted_logit: -1.5008146<br />resids: -0.1506981812","fitted_logit: -1.4736508<br />resids: -0.1604297567","fitted_logit: -1.4464870<br />resids: -0.1705947662","fitted_logit: -1.4193231<br />resids: -0.1812145553","fitted_logit: -1.3921593<br />resids: -0.1923166296","fitted_logit: -1.3649955<br />resids: -0.2039075894","fitted_logit: -1.3378317<br />resids: -0.2159650449","fitted_logit: -1.3106679<br />resids: -0.2284623429","fitted_logit: -1.2835041<br />resids: -0.2413495728","fitted_logit: -1.2563402<br />resids: -0.2545636036"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":3.7795275590551185,"color":"rgba(51,102,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283108,"r":7.3059360730593621,"b":40.182648401826498,"l":37.260273972602747},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-3.5095786903431456,-1.1490431793073508],"tickmode":"array","ticktext":["-3.5","-3.0","-2.5","-2.0","-1.5"],"tickvals":[-3.5,-3,-2.5,-2,-1.5],"categoryorder":"array","categoryarray":["-3.5","-3.0","-2.5","-2.0","-1.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"fitted_logit","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.9618169856735594,3.1609034611883469],"tickmode":"array","ticktext":["-1","0","1","2","3"],"tickvals":[-1,2.2204460492503131e-16,1,2,3],"categoryorder":"array","categoryarray":["-1","0","1","2","3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"resids","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"dibpat","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"77a46a3a9027":{"x":{},"y":{},"colour":{},"type":"scatter"},"77a42ace26ed":{"yintercept":{}},"77a4445da78f":{"x":{},"y":{}}},"cur_data":"77a46a3a9027","visdat":{"77a46a3a9027":["function (y) ","x"],"77a42ace26ed":["function (y) ","x"],"77a4445da78f":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="pearson-chi-squared-goodness-of-fit-test" class="level3" data-number="3.7.4">
<h3 data-number="3.7.4" class="anchored" data-anchor-id="pearson-chi-squared-goodness-of-fit-test"><span class="header-section-number">3.7.4</span> Pearson chi-squared goodness of fit test</h3>
<p>The Pearson chi-squared goodness of fit statistic is: <span class="math display">\[
X^2 = \sum_{k=1}^m X_k^2
\]</span> Under the null hypothesis that the model in question is correct (i.e., sufficiently complex), <span class="math inline">\(X^2\ \dot \sim\ \chi^2(N-p)\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>chisq_stat <span class="ot">=</span> <span class="fu">sum</span>(X<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">=</span> <span class="fu">pchisq</span>(</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  chisq_stat, </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="cn">FALSE</span>, </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">length</span>(X) <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(chd_glm_strat_grouped)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For our CHD model, the p-value for this test is 0.26523556; no significant evidence of a lack of fit at the 0.05 level.</p>
<section id="standardized-pearson-residuals" class="level4">
<h4 class="anchored" data-anchor-id="standardized-pearson-residuals">Standardized Pearson residuals</h4>
<p>Especially for small data sets, we might want to adjust our residuals for leverage (since outliers in <span class="math inline">\(X\)</span> add extra variance to the residuals):</p>
<p><span class="math display">\[r_{P_k} = \frac{X_k}{\sqrt{1-h_k}}\]</span></p>
<p>where <span class="math inline">\(h_k\)</span> is the leverage of <span class="math inline">\(X_k\)</span>. The functions <code>autoplot()</code> and <code>plot.lm()</code> use these for some of their graphs.</p>
</section>
</section>
<section id="deviance-residuals" class="level3" data-number="3.7.5">
<h3 data-number="3.7.5" class="anchored" data-anchor-id="deviance-residuals"><span class="header-section-number">3.7.5</span> Deviance residuals</h3>
<p>For large sample sizes, the Pearson and deviance residuals will be approximately the same. For small sample sizes, the deviance residuals from covariate patterns with small sample sizes can be unreliable (high variance).</p>
<p><span class="math display">\[d_k = \text{sign}(y_k - n_k \hat \pi_k)\left\{\sqrt{2[\ell_{\text{full}}(x_k) - \ell(\hat\beta; x_k)]}\right\}\]</span></p>
<section id="standardized-deviance-residuals" class="level4">
<h4 class="anchored" data-anchor-id="standardized-deviance-residuals">Standardized deviance residuals</h4>
<p><span class="math display">\[r_{D_k} = \frac{d_k}{\sqrt{1-h_k}}\]</span></p>
</section>
</section>
<section id="diagnostic-plots" class="level3" data-number="3.7.6">
<h3 data-number="3.7.6" class="anchored" data-anchor-id="diagnostic-plots"><span class="header-section-number">3.7.6</span> Diagnostic plots</h3>
<p>Let’s take a look at the full set of <code>autoplot()</code> diagnostics now for our <code>CHD</code> model:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Things look pretty good here. The QQ plot is still usable; with large samples; the residuals should be approximately Gaussian.</p>
<section id="beetles" class="level4">
<h4 class="anchored" data-anchor-id="beetles">Beetles</h4>
<p>Let’s look at the beetles model diagnostic plots for comparison:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hard to tell much from so little data, but there might be some issues here.</p>
</section>
</section>
</section>
<section id="sec-OR-RR" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="sec-OR-RR"><span class="header-section-number">3.8</span> Odds Ratios vs Probability (Risk) Ratios</h2>
<section id="case-1-rare-events" class="level4">
<h4 class="anchored" data-anchor-id="case-1-rare-events">Case 1: rare events</h4>
<p>For rare events, odds ratios and probability (a.k.a. risk, a.k.a. prevalence) ratios will be close:</p>
<p><span class="math inline">\(\pi_1 = .01\)</span> <span class="math inline">\(\pi_2 = .02\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>pi1 <span class="ot">=</span> .<span class="dv">01</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>pi2 <span class="ot">=</span> .<span class="dv">02</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>pi2<span class="sc">/</span>pi1</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">odds</span>(pi2)<span class="sc">/</span><span class="fu">odds</span>(pi1)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2.0204082</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="case-2-frequent-events" class="level4">
<h4 class="anchored" data-anchor-id="case-2-frequent-events">Case 2: frequent events</h4>
<p><span class="math inline">\(\pi_1 = .4\)</span> <span class="math inline">\(\pi_2 = .5\)</span></p>
<p>For more frequently-occurring outcomes, this won’t be the case:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pi1 <span class="ot">=</span> .<span class="dv">4</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>pi2 <span class="ot">=</span> .<span class="dv">5</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>pi2<span class="sc">/</span>pi1</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.25</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">odds</span>(pi2)<span class="sc">/</span><span class="fu">odds</span>(pi1)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If you want risk ratios, you can sometimes get them by changing the link function:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(anthers, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>anthers.sum<span class="ot">&lt;-</span><span class="fu">aggregate</span>(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  anthers[<span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"y"</span>)], </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span>anthers[<span class="fu">c</span>(<span class="st">"storage"</span>)],<span class="at">FUN=</span>sum) </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y,n<span class="sc">-</span>y)<span class="sc">~</span>storage,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>anthers.sum, </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"log"</span>))</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Risk</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-0.80</td>
<td style="text-align: center;">0.12</td>
<td style="text-align: center;">(-1.04, -0.58)</td>
<td style="text-align: center;">-6.81</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">storage</td>
<td style="text-align: center;">0.17</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(0.02, 0.31)</td>
<td style="text-align: center;">2.31</td>
<td style="text-align: center;">0.021</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now <span class="math inline">\(\text{exp}\left\{\beta\right\}\)</span> gives us risk ratios instead of odds ratios:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span> <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Risk Ratio</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">0.45</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">(0.35, 0.56)</td>
<td style="text-align: center;">-6.81</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">storage</td>
<td style="text-align: center;">1.18</td>
<td style="text-align: center;">0.09</td>
<td style="text-align: center;">(1.03, 1.36)</td>
<td style="text-align: center;">2.31</td>
<td style="text-align: center;">0.021</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s compare this model with a logistic model:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y, n <span class="sc">-</span> y) <span class="sc">~</span> storage,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> anthers.sum,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="sc">|&gt;</span> <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Odds Ratio</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">0.76</td>
<td style="text-align: center;">0.20</td>
<td style="text-align: center;">(0.45, 1.27)</td>
<td style="text-align: center;">-1.05</td>
<td style="text-align: center;">0.296</td>
</tr>
<tr class="even">
<td style="text-align: left;">storage</td>
<td style="text-align: center;">1.49</td>
<td style="text-align: center;">0.26</td>
<td style="text-align: center;">(1.06, 2.10)</td>
<td style="text-align: center;">2.29</td>
<td style="text-align: center;">0.022</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>[to add: fitted plots on each outcome scale]</p>
<p>When I try to use <code>link ="log"</code> in practice, I often get errors about not finding good starting values for the estimation procedure. This is likely because the model is producing fitted probabilities greater than 1.</p>
<p>When this happens, you can try to fit Poisson regression models instead (we will see those soon!). But then the outcome distribution isn’t quite right, and you won’t get warnings about fitted probabilities greater than 1. In my opinion, the Poisson model for binary outcomes is confusing and not very appealing.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-dobson4e" class="csl-entry" role="listitem">
Dobson, Annette J, and Adrian G Barnett. 2018. <em>An Introduction to Generalized Linear Models</em>. 4th ed. CRC press. <a href="https://doi.org/10.1201/9781315182780">https://doi.org/10.1201/9781315182780</a>.
</div>
<div id="ref-vittinghoff2012regression" class="csl-entry" role="listitem">
Vittinghoff, Eric, David V Glidden, Stephen C Shiboski, and Charles E McCulloch. 2012. <em>Regression Methods in Biostatistics: Linear, Logistic, Survival, and Repeated Measures Models</em>. 2nd ed. Springer. <a href="https://doi.org/10.1007/978-1-4614-1353-0">https://doi.org/10.1007/978-1-4614-1353-0</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Linear-models-overview.html" class="pagination-link" aria-label="Linear (Gaussian) Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./count-regression.html" class="pagination-link" aria-label="Models for Count Outcomes">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Models for Count Outcomes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb65" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Logistic regression and variations"</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Models for Binary Outcomes</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>{{&lt; include shared-config.qmd &gt;}}</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">### Acknowledgements {.unnumbered}</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>This content is adapted from:</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@dobson4e, Chapter 7</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@vittinghoff2012regression, Chapter 5</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="ot">&lt;https://dmrocke.ucdavis.edu/Class/EPI204-Spring-2021/EPI204-Spring-2021.html&gt;</span>    </span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="fu">### Configuring R {.unnumbered}</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>Functions from these packages will be used throughout this document:</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r packages, message = FALSE}</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(pander) # format tables for markdown</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2) # graphics</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggeasy) # help with graphics</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr) # manipulate data</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(haven) # import Stata files</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr) # format R output for markdown</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyr) # Tools to help to create tidy data</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(plotly) # interactive graphics</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(dobson) # datasets from Dobson and Barnett 2018</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(parameters) # format model output tables for markdown</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="in">library(conflicted) # check for conflicting function definitions</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>Here are some R settings I use in this document:</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r options, message=FALSE}</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a><span class="in">rm(list = ls()) # delete any data that's already loaded into R</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(message = FALSE)</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a><span class="in">options('digits' = 4)</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a><span class="fu">### What is logistic regression?</span></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>**Logistic regression** is a framework for modeling <span class="co">[</span><span class="ot">binary</span><span class="co">](probability.qmd#def-binary)</span> outcomes, conditional on one or more *predictors* (a.k.a. *covariates*).</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>::: {#exr-binary-examples}</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Examples of binary outcomes</span></span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>What are some examples of binary outcomes in the health sciences?</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>:::: {.solution}</span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a>{{&lt; include binary-outcome-examples.qmd &gt;}}</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a>Logistic regression uses the <span class="co">[</span><span class="ot">Bernoulli</span><span class="co">](probability.qmd#def-bernoulli)</span> distribution to model the outcome variable, conditional on one or more covariates. </span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a>::: {#exr-def-bernoulli}</span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a>Write down a mathematical definition of the Bernoulli distribution.</span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a>::::{.solution}</span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a>See @def-bernoulli.</span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression versus linear regression</span></span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a>Logistic regression differs from linear regression, which uses the Gaussian ("normal") distribution to model the outcome variable, conditional on the covariates.</span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a>:::: {#exr-linear}</span>
<span id="cb65-89"><a href="#cb65-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-90"><a href="#cb65-90" aria-hidden="true" tabindex="-1"></a>Recall: what kinds of outcomes is linear regression used for?</span>
<span id="cb65-91"><a href="#cb65-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-92"><a href="#cb65-92" aria-hidden="true" tabindex="-1"></a>::: {.solution}</span>
<span id="cb65-93"><a href="#cb65-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-94"><a href="#cb65-94" aria-hidden="true" tabindex="-1"></a>Linear regression is typically used for numerical outcomes that aren't event counts or waiting times for an event. Examples of outcomes that are often analyzed using linear regression include include weight, height, and income.</span>
<span id="cb65-95"><a href="#cb65-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-96"><a href="#cb65-96" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-97"><a href="#cb65-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-98"><a href="#cb65-98" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-99"><a href="#cb65-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-100"><a href="#cb65-100" aria-hidden="true" tabindex="-1"></a><span class="fu">## Risk Estimation and Prediction</span></span>
<span id="cb65-101"><a href="#cb65-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-102"><a href="#cb65-102" aria-hidden="true" tabindex="-1"></a>In Epi 203, you have already seen methods for modeling binary outcomes using one covariate that is also binary (such as exposure/non-exposure).</span>
<span id="cb65-103"><a href="#cb65-103" aria-hidden="true" tabindex="-1"></a>In this section, we review one-covariate analyses, with a special focus on risk ratios and odds ratios, which are important concepts for interpreting logistic regression.</span>
<span id="cb65-104"><a href="#cb65-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-105"><a href="#cb65-105" aria-hidden="true" tabindex="-1"></a>:::::{#exm-oc-mi}</span>
<span id="cb65-106"><a href="#cb65-106" aria-hidden="true" tabindex="-1"></a><span class="fu">### Oral Contraceptive Use and Heart Attack</span></span>
<span id="cb65-107"><a href="#cb65-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-108"><a href="#cb65-108" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Research question: how does oral contraceptive (OC) use affect the risk of myocardial infarction (MI; a.k.a. heart attack)?</span>
<span id="cb65-109"><a href="#cb65-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-110"><a href="#cb65-110" aria-hidden="true" tabindex="-1"></a>:::{.note}</span>
<span id="cb65-111"><a href="#cb65-111" aria-hidden="true" tabindex="-1"></a>This was an issue when oral contraceptives were first developed, because the original formulations used higher concentrations of hormones. Modern OCs don't have this issue.</span>
<span id="cb65-112"><a href="#cb65-112" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-113"><a href="#cb65-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-114"><a href="#cb65-114" aria-hidden="true" tabindex="-1"></a>@tbl-oc-mi contains simulated data for an imaginary follow-up (a.k.a. *prospective*) study in which two groups are identified, one using OCs and another not using OCs, and both groups are tracked for three years to determine how many in each groups have MIs.</span>
<span id="cb65-115"><a href="#cb65-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-118"><a href="#cb65-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-119"><a href="#cb65-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb65-120"><a href="#cb65-120" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb65-121"><a href="#cb65-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-oc-mi</span></span>
<span id="cb65-122"><a href="#cb65-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Simulated data from study of oral contraceptive use and heart attack risk</span></span>
<span id="cb65-123"><a href="#cb65-123" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb65-124"><a href="#cb65-124" aria-hidden="true" tabindex="-1"></a>oc_mi <span class="ot">=</span> </span>
<span id="cb65-125"><a href="#cb65-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tribble</span>(</span>
<span id="cb65-126"><a href="#cb65-126" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>OC, <span class="sc">~</span>MI, <span class="sc">~</span>Total,</span>
<span id="cb65-127"><a href="#cb65-127" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OC use"</span>, <span class="dv">13</span>, <span class="dv">5000</span>,</span>
<span id="cb65-128"><a href="#cb65-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">"No OC use"</span>, <span class="dv">7</span>, <span class="dv">10000</span></span>
<span id="cb65-129"><a href="#cb65-129" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-130"><a href="#cb65-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span> <span class="ot">=</span> Total <span class="sc">-</span> MI) <span class="sc">|&gt;</span> </span>
<span id="cb65-131"><a href="#cb65-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, <span class="at">.after =</span> MI)</span>
<span id="cb65-132"><a href="#cb65-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-133"><a href="#cb65-133" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">=</span> </span>
<span id="cb65-134"><a href="#cb65-134" aria-hidden="true" tabindex="-1"></a>  oc_mi <span class="sc">|&gt;</span> </span>
<span id="cb65-135"><a href="#cb65-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(MI, <span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, Total), sum)) <span class="sc">|&gt;</span> </span>
<span id="cb65-136"><a href="#cb65-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OC =</span> <span class="st">"Total"</span>)</span>
<span id="cb65-137"><a href="#cb65-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-138"><a href="#cb65-138" aria-hidden="true" tabindex="-1"></a>oc_mi <span class="ot">=</span> <span class="fu">bind_rows</span>(oc_mi, totals)</span>
<span id="cb65-139"><a href="#cb65-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-140"><a href="#cb65-140" aria-hidden="true" tabindex="-1"></a><span class="fu">pander</span>(oc_mi)</span>
<span id="cb65-141"><a href="#cb65-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-142"><a href="#cb65-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-143"><a href="#cb65-143" aria-hidden="true" tabindex="-1"></a>:::::</span>
<span id="cb65-144"><a href="#cb65-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-145"><a href="#cb65-145" aria-hidden="true" tabindex="-1"></a>::::{#exr-probs}</span>
<span id="cb65-146"><a href="#cb65-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-147"><a href="#cb65-147" aria-hidden="true" tabindex="-1"></a>Review: estimate the probabilities of MI for OC users and non-OC users in @exm-oc-mi.</span>
<span id="cb65-148"><a href="#cb65-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-149"><a href="#cb65-149" aria-hidden="true" tabindex="-1"></a>:::{.solution}</span>
<span id="cb65-150"><a href="#cb65-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-151"><a href="#cb65-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb65-152"><a href="#cb65-152" aria-hidden="true" tabindex="-1"></a><span class="in">p_MI_OC = 13/5000</span></span>
<span id="cb65-153"><a href="#cb65-153" aria-hidden="true" tabindex="-1"></a><span class="in">p_MI_nOC = 7/10000</span></span>
<span id="cb65-154"><a href="#cb65-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-155"><a href="#cb65-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-156"><a href="#cb65-156" aria-hidden="true" tabindex="-1"></a>$$\hat{p}(MI|OC) = \frac{13}{5000} = <span class="in">`r p_MI_OC`</span>$$</span>
<span id="cb65-157"><a href="#cb65-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-158"><a href="#cb65-158" aria-hidden="true" tabindex="-1"></a>$$\hat{p}(MI|\neg OC) = \frac{7}{10000} = <span class="in">`r p_MI_nOC`</span>$$</span>
<span id="cb65-159"><a href="#cb65-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-160"><a href="#cb65-160" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-161"><a href="#cb65-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-162"><a href="#cb65-162" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-163"><a href="#cb65-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-164"><a href="#cb65-164" aria-hidden="true" tabindex="-1"></a>::::{.callout-note}</span>
<span id="cb65-165"><a href="#cb65-165" aria-hidden="true" tabindex="-1"></a><span class="fu">### Two meanings of "controls"</span></span>
<span id="cb65-166"><a href="#cb65-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-167"><a href="#cb65-167" aria-hidden="true" tabindex="-1"></a>Depending on context, "controls" can mean either individuals who don't experience an *exposure* of interest, or individuals who don't experience an *outcome* of interest.</span>
<span id="cb65-168"><a href="#cb65-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-169"><a href="#cb65-169" aria-hidden="true" tabindex="-1"></a>:::{#def-cases-retrospective}</span>
<span id="cb65-170"><a href="#cb65-170" aria-hidden="true" tabindex="-1"></a><span class="fu">#### cases and controls in retrospective studies</span></span>
<span id="cb65-171"><a href="#cb65-171" aria-hidden="true" tabindex="-1"></a>In *retrospective studies*, participants who experience the outcome of interest are called **cases**, while participants who don't experience that outcome are called **controls**. </span>
<span id="cb65-172"><a href="#cb65-172" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-173"><a href="#cb65-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-174"><a href="#cb65-174" aria-hidden="true" tabindex="-1"></a>:::{#def-cases-prospective}</span>
<span id="cb65-175"><a href="#cb65-175" aria-hidden="true" tabindex="-1"></a><span class="fu">#### treatment groups and control groups in prospective studies</span></span>
<span id="cb65-176"><a href="#cb65-176" aria-hidden="true" tabindex="-1"></a>In *prospective studies*, the group of participants who experience the treatment or exposure of interest is called the **treatment group**, while the participants who receive the baseline or comparison treatment  (for example, clinical trial participants who receive a placebo or a standard-of-care treatment rather than an experimental treatment) are called **controls**.</span>
<span id="cb65-177"><a href="#cb65-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-178"><a href="#cb65-178" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-179"><a href="#cb65-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-180"><a href="#cb65-180" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-181"><a href="#cb65-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-182"><a href="#cb65-182" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing probabilities</span></span>
<span id="cb65-183"><a href="#cb65-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-184"><a href="#cb65-184" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Risk differences</span></span>
<span id="cb65-185"><a href="#cb65-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-186"><a href="#cb65-186" aria-hidden="true" tabindex="-1"></a>The simplest comparison of two probabilities, $\pi_1$, and $\pi_2$, is the difference of their values:</span>
<span id="cb65-187"><a href="#cb65-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-188"><a href="#cb65-188" aria-hidden="true" tabindex="-1"></a>:::::{.columns}</span>
<span id="cb65-189"><a href="#cb65-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-190"><a href="#cb65-190" aria-hidden="true" tabindex="-1"></a>:::{#def-RD}</span>
<span id="cb65-191"><a href="#cb65-191" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Risk difference</span></span>
<span id="cb65-192"><a href="#cb65-192" aria-hidden="true" tabindex="-1"></a>The **risk difference** of two probabilities, $\pi_1$, and $\pi_2$, is the difference of their values: </span>
<span id="cb65-193"><a href="#cb65-193" aria-hidden="true" tabindex="-1"></a>$$\delta(\pi_1,\pi_2) \eqdef \pi_1 - \pi_2$$</span>
<span id="cb65-194"><a href="#cb65-194" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-195"><a href="#cb65-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-196"><a href="#cb65-196" aria-hidden="true" tabindex="-1"></a>:::{#exm-RD}</span>
<span id="cb65-197"><a href="#cb65-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-198"><a href="#cb65-198" aria-hidden="true" tabindex="-1"></a>In @exm-oc-mi, the estimated risk difference in MI risk between OC users and OC non-users is:</span>
<span id="cb65-199"><a href="#cb65-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb65-200"><a href="#cb65-200" aria-hidden="true" tabindex="-1"></a><span class="in">rd_OC = p_MI_OC - p_MI_nOC</span></span>
<span id="cb65-201"><a href="#cb65-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-202"><a href="#cb65-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-203"><a href="#cb65-203" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-204"><a href="#cb65-204" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-205"><a href="#cb65-205" aria-hidden="true" tabindex="-1"></a>\hat\delta(\pi(OC), \pi(\neg OC))</span>
<span id="cb65-206"><a href="#cb65-206" aria-hidden="true" tabindex="-1"></a>&amp;= \delta(\hat\pi(OC), \hat\pi(\neg OC))<span class="sc">\\</span></span>
<span id="cb65-207"><a href="#cb65-207" aria-hidden="true" tabindex="-1"></a>&amp;= \hat\pi(OC) - \hat\pi(\neg OC)<span class="sc">\\</span></span>
<span id="cb65-208"><a href="#cb65-208" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r p_MI_OC`</span> - <span class="in">`r p_MI_nOC`</span><span class="sc">\\</span></span>
<span id="cb65-209"><a href="#cb65-209" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r rd_OC`</span></span>
<span id="cb65-210"><a href="#cb65-210" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-211"><a href="#cb65-211" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-212"><a href="#cb65-212" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-213"><a href="#cb65-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-214"><a href="#cb65-214" aria-hidden="true" tabindex="-1"></a>:::::</span>
<span id="cb65-215"><a href="#cb65-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-216"><a href="#cb65-216" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Risk ratios</span></span>
<span id="cb65-217"><a href="#cb65-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-218"><a href="#cb65-218" aria-hidden="true" tabindex="-1"></a>:::::{.columns}</span>
<span id="cb65-219"><a href="#cb65-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-220"><a href="#cb65-220" aria-hidden="true" tabindex="-1"></a>:::{#def-RR}</span>
<span id="cb65-221"><a href="#cb65-221" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relative risk ratios</span></span>
<span id="cb65-222"><a href="#cb65-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-223"><a href="#cb65-223" aria-hidden="true" tabindex="-1"></a>The **relative risk** of probability $\pi_1$ compared to another probability $\pi_2$, also called the **risk ratio**, **relative risk ratio**, **probability ratio**, or **rate ratio**, is the ratio of those probabilities:</span>
<span id="cb65-224"><a href="#cb65-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-225"><a href="#cb65-225" aria-hidden="true" tabindex="-1"></a>$$\rho(\pi_1,\pi_2) = \frac{\pi_1}{\pi_2}$$</span>
<span id="cb65-226"><a href="#cb65-226" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-227"><a href="#cb65-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-228"><a href="#cb65-228" aria-hidden="true" tabindex="-1"></a>:::{#exm-RR}</span>
<span id="cb65-229"><a href="#cb65-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-230"><a href="#cb65-230" aria-hidden="true" tabindex="-1"></a>Above, we estimated that:</span>
<span id="cb65-231"><a href="#cb65-231" aria-hidden="true" tabindex="-1"></a>$$\hat{p}(MI|OC) = <span class="in">`r 13/5000`</span>$$</span>
<span id="cb65-232"><a href="#cb65-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-233"><a href="#cb65-233" aria-hidden="true" tabindex="-1"></a>$$\hat{p}(MI|\neg OC) = <span class="in">`r 7/10000`</span>$$</span>
<span id="cb65-234"><a href="#cb65-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-235"><a href="#cb65-235" aria-hidden="true" tabindex="-1"></a>So we might estimate that the *relative risk* of MI for OC versus non-OC is:</span>
<span id="cb65-236"><a href="#cb65-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-239"><a href="#cb65-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-240"><a href="#cb65-240" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">=</span> (<span class="dv">13</span><span class="sc">/</span><span class="dv">5000</span>)<span class="sc">/</span>(<span class="dv">7</span><span class="sc">/</span><span class="dv">10000</span>)</span>
<span id="cb65-241"><a href="#cb65-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-242"><a href="#cb65-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-243"><a href="#cb65-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-244"><a href="#cb65-244" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-245"><a href="#cb65-245" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-246"><a href="#cb65-246" aria-hidden="true" tabindex="-1"></a>\hat\rho(OC, \neg OC)</span>
<span id="cb65-247"><a href="#cb65-247" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{\hat{p}(MI|OC)}{\hat{p}(MI|\neg OC)}<span class="sc">\\</span></span>
<span id="cb65-248"><a href="#cb65-248" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{<span class="in">`r 13/5000`</span>}{<span class="in">`r 7/10000`</span>}<span class="sc">\\</span></span>
<span id="cb65-249"><a href="#cb65-249" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r rr`</span></span>
<span id="cb65-250"><a href="#cb65-250" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-251"><a href="#cb65-251" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-252"><a href="#cb65-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-253"><a href="#cb65-253" aria-hidden="true" tabindex="-1"></a>We might summarize this result by saying that "the estimated probability of MI among OC users was <span class="in">`r rr`</span> as high as the estimated probability among OC non-users. </span>
<span id="cb65-254"><a href="#cb65-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-255"><a href="#cb65-255" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-256"><a href="#cb65-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-257"><a href="#cb65-257" aria-hidden="true" tabindex="-1"></a>:::::</span>
<span id="cb65-258"><a href="#cb65-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-259"><a href="#cb65-259" aria-hidden="true" tabindex="-1"></a>Sometimes, we divide the risk difference by the comparison probability, or equivalently, subtract 1 from the risk ratio; the result is called the **relative risk difference**:</span>
<span id="cb65-260"><a href="#cb65-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-261"><a href="#cb65-261" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-262"><a href="#cb65-262" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-263"><a href="#cb65-263" aria-hidden="true" tabindex="-1"></a>\xi(\pi_1,\pi_2) </span>
<span id="cb65-264"><a href="#cb65-264" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\pi_1-\pi_2}{\pi_2}<span class="sc">\\</span></span>
<span id="cb65-265"><a href="#cb65-265" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\pi_1}{\pi_2} - 1</span>
<span id="cb65-266"><a href="#cb65-266" aria-hidden="true" tabindex="-1"></a>\end{aligned}$$</span>
<span id="cb65-267"><a href="#cb65-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-268"><a href="#cb65-268" aria-hidden="true" tabindex="-1"></a>Risk differences, risk ratios, and relative risk differences are defined by two probabilities, plus a choice of which probability is the **baseline** or **reference** probability (i.e., which probability is the subtrahend of the risk difference or the denominator of the risk ratio). To switch which one is the reference probability, invert the ratio and multiply the difference by -1.</span>
<span id="cb65-269"><a href="#cb65-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-270"><a href="#cb65-270" aria-hidden="true" tabindex="-1"></a>:::{#exm-ref}</span>
<span id="cb65-271"><a href="#cb65-271" aria-hidden="true" tabindex="-1"></a>Above, we estimated that the risk ratio of OC versus non-OC is:</span>
<span id="cb65-272"><a href="#cb65-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-273"><a href="#cb65-273" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-274"><a href="#cb65-274" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-275"><a href="#cb65-275" aria-hidden="true" tabindex="-1"></a>\rho(OC, \neg OC)</span>
<span id="cb65-276"><a href="#cb65-276" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r (13/5000)/(7/10000)`</span></span>
<span id="cb65-277"><a href="#cb65-277" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-278"><a href="#cb65-278" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-279"><a href="#cb65-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-280"><a href="#cb65-280" aria-hidden="true" tabindex="-1"></a>In comparison, the risk ratio for non-OC versus OC is:</span>
<span id="cb65-281"><a href="#cb65-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-282"><a href="#cb65-282" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-283"><a href="#cb65-283" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-284"><a href="#cb65-284" aria-hidden="true" tabindex="-1"></a>\rho(\neg OC, OC)</span>
<span id="cb65-285"><a href="#cb65-285" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{\hat{p}(MI|\neg OC)}{\hat{p}(MI|OC)}<span class="sc">\\</span></span>
<span id="cb65-286"><a href="#cb65-286" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{<span class="in">`r 7/10000`</span>}{<span class="in">`r 13/5000`</span>}<span class="sc">\\</span></span>
<span id="cb65-287"><a href="#cb65-287" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r (7/10000)/(13/5000)`</span><span class="sc">\\</span></span>
<span id="cb65-288"><a href="#cb65-288" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{\rho(OC, \neg OC)}</span>
<span id="cb65-289"><a href="#cb65-289" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-290"><a href="#cb65-290" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-291"><a href="#cb65-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-292"><a href="#cb65-292" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-293"><a href="#cb65-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-294"><a href="#cb65-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Odds and probabilities</span></span>
<span id="cb65-295"><a href="#cb65-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-296"><a href="#cb65-296" aria-hidden="true" tabindex="-1"></a>In logistic regression, we will make use of a transformation (rescaling) of probability, called *odds*.</span>
<span id="cb65-297"><a href="#cb65-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-298"><a href="#cb65-298" aria-hidden="true" tabindex="-1"></a>:::{#def-odds}</span>
<span id="cb65-299"><a href="#cb65-299" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Odds</span></span>
<span id="cb65-300"><a href="#cb65-300" aria-hidden="true" tabindex="-1"></a>The **odds** of an outcome, denoted $\omega$ ("omega"), is the probability that the outcome occurs, divided by the probability that it doesn't occur. </span>
<span id="cb65-301"><a href="#cb65-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-302"><a href="#cb65-302" aria-hidden="true" tabindex="-1"></a>That is, if the probability of an outcome is $\pi$, then the corresponding odds of that outcome is </span>
<span id="cb65-303"><a href="#cb65-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-304"><a href="#cb65-304" aria-hidden="true" tabindex="-1"></a>$$\omega(\pi) \eqdef \frac{\pi}{1-\pi}$$</span>
<span id="cb65-305"><a href="#cb65-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-306"><a href="#cb65-306" aria-hidden="true" tabindex="-1"></a>This function, which transforms probabilities into odds, is called the **odds function** (see @fig-odds-probs).</span>
<span id="cb65-307"><a href="#cb65-307" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-308"><a href="#cb65-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-311"><a href="#cb65-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-312"><a href="#cb65-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb65-313"><a href="#cb65-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fig-odds-probs"</span></span>
<span id="cb65-314"><a href="#cb65-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Odds versus probability"</span></span>
<span id="cb65-315"><a href="#cb65-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-316"><a href="#cb65-316" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">=</span> <span class="cf">function</span>(pi) pi<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>pi)</span>
<span id="cb65-317"><a href="#cb65-317" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb65-318"><a href="#cb65-318" aria-hidden="true" tabindex="-1"></a>odds_plot <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb65-319"><a href="#cb65-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> odds, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"odds function"</span>)) <span class="sc">+</span></span>
<span id="cb65-320"><a href="#cb65-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb65-321"><a href="#cb65-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb65-322"><a href="#cb65-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Odds"</span>) <span class="sc">+</span></span>
<span id="cb65-323"><a href="#cb65-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"y=x"</span>)) <span class="sc">+</span> </span>
<span id="cb65-324"><a href="#cb65-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb65-325"><a href="#cb65-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb65-326"><a href="#cb65-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb65-327"><a href="#cb65-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-328"><a href="#cb65-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-329"><a href="#cb65-329" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-332"><a href="#cb65-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-333"><a href="#cb65-333" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(odds_plot)</span>
<span id="cb65-334"><a href="#cb65-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-335"><a href="#cb65-335" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-336"><a href="#cb65-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-337"><a href="#cb65-337" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-340"><a href="#cb65-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-341"><a href="#cb65-341" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(odds_plot) <span class="sc">|&gt;</span>  </span>
<span id="cb65-342"><a href="#cb65-342" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(<span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">'h'</span>))</span>
<span id="cb65-343"><a href="#cb65-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-344"><a href="#cb65-344" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-345"><a href="#cb65-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-346"><a href="#cb65-346" aria-hidden="true" tabindex="-1"></a>:::{#exm-odds}</span>
<span id="cb65-347"><a href="#cb65-347" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculating odds</span></span>
<span id="cb65-348"><a href="#cb65-348" aria-hidden="true" tabindex="-1"></a>In @exr-probs, we estimated that the probability of MI, given OC use, is $\pi(OC) \eqdef \Pr(MI|OC) = <span class="in">`r 13/5000`</span>$. If this estimate is correct, then the odds of MI, given OC use, is:</span>
<span id="cb65-349"><a href="#cb65-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-352"><a href="#cb65-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-353"><a href="#cb65-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb65-354"><a href="#cb65-354" aria-hidden="true" tabindex="-1"></a>pi_OC <span class="ot">=</span> <span class="dv">13</span><span class="sc">/</span><span class="dv">5000</span></span>
<span id="cb65-355"><a href="#cb65-355" aria-hidden="true" tabindex="-1"></a>odds_OC <span class="ot">=</span> <span class="fu">odds</span>(pi_OC)</span>
<span id="cb65-356"><a href="#cb65-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-357"><a href="#cb65-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-358"><a href="#cb65-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-359"><a href="#cb65-359" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-360"><a href="#cb65-360" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-361"><a href="#cb65-361" aria-hidden="true" tabindex="-1"></a>\omega(OC) </span>
<span id="cb65-362"><a href="#cb65-362" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \frac{\Pr(MI|OC)}{\Pr(\neg MI|OC)}<span class="sc">\\</span></span>
<span id="cb65-363"><a href="#cb65-363" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{\Pr(MI|OC)}{1-\Pr(MI|OC)}<span class="sc">\\</span></span>
<span id="cb65-364"><a href="#cb65-364" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{\pi(OC)}{1-\pi(OC)}<span class="sc">\\</span></span>
<span id="cb65-365"><a href="#cb65-365" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{<span class="in">`r 13/5000`</span>}{1-<span class="in">`r 13/5000`</span>}<span class="sc">\\</span></span>
<span id="cb65-366"><a href="#cb65-366" aria-hidden="true" tabindex="-1"></a>&amp;=<span class="in">`r (13/5000)/(1- (13/5000))`</span></span>
<span id="cb65-367"><a href="#cb65-367" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-368"><a href="#cb65-368" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-369"><a href="#cb65-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-370"><a href="#cb65-370" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-371"><a href="#cb65-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-372"><a href="#cb65-372" aria-hidden="true" tabindex="-1"></a>:::{#exr-odds}</span>
<span id="cb65-373"><a href="#cb65-373" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculating odds</span></span>
<span id="cb65-374"><a href="#cb65-374" aria-hidden="true" tabindex="-1"></a>Estimate the odds of MI, for non-OC users.</span>
<span id="cb65-375"><a href="#cb65-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-376"><a href="#cb65-376" aria-hidden="true" tabindex="-1"></a>::::{.solution}</span>
<span id="cb65-377"><a href="#cb65-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb65-378"><a href="#cb65-378" aria-hidden="true" tabindex="-1"></a><span class="in">pi_nOC = 7/10000</span></span>
<span id="cb65-379"><a href="#cb65-379" aria-hidden="true" tabindex="-1"></a><span class="in">odds_nOC = pi_nOC/(1-pi_nOC)</span></span>
<span id="cb65-380"><a href="#cb65-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-381"><a href="#cb65-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-382"><a href="#cb65-382" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-383"><a href="#cb65-383" aria-hidden="true" tabindex="-1"></a>\omega_(\neg OC) = <span class="in">`r odds_nOC`</span></span>
<span id="cb65-384"><a href="#cb65-384" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-385"><a href="#cb65-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-386"><a href="#cb65-386" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-387"><a href="#cb65-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-388"><a href="#cb65-388" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-389"><a href="#cb65-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-390"><a href="#cb65-390" aria-hidden="true" tabindex="-1"></a><span class="fu">#### A shortcut for calculating odds</span></span>
<span id="cb65-391"><a href="#cb65-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-392"><a href="#cb65-392" aria-hidden="true" tabindex="-1"></a>The usual estimate for a probability of an event is "# events/# observations". We often denote # events as $x$ and # observations as $n$. So: $$\hat\pi = \frac{x}{n}$$ </span>
<span id="cb65-393"><a href="#cb65-393" aria-hidden="true" tabindex="-1"></a>Thus, the usual estimate for the probability of a nonevent is:</span>
<span id="cb65-394"><a href="#cb65-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-395"><a href="#cb65-395" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-396"><a href="#cb65-396" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-397"><a href="#cb65-397" aria-hidden="true" tabindex="-1"></a>1-\hat\pi </span>
<span id="cb65-398"><a href="#cb65-398" aria-hidden="true" tabindex="-1"></a>&amp;= 1-\frac{x}{n}<span class="sc">\\</span></span>
<span id="cb65-399"><a href="#cb65-399" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{n}{n} - \frac{x}{n}<span class="sc">\\</span></span>
<span id="cb65-400"><a href="#cb65-400" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{n - x}{n}</span>
<span id="cb65-401"><a href="#cb65-401" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-402"><a href="#cb65-402" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-403"><a href="#cb65-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-404"><a href="#cb65-404" aria-hidden="true" tabindex="-1"></a>Thus, the estimated odds is:</span>
<span id="cb65-405"><a href="#cb65-405" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-406"><a href="#cb65-406" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-407"><a href="#cb65-407" aria-hidden="true" tabindex="-1"></a>\frac{\hat\pi}{1-\hat\pi}</span>
<span id="cb65-408"><a href="#cb65-408" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\left(\frac{x}{n}\right)}{\left(\frac{n-x}{n}\right)}<span class="sc">\\</span></span>
<span id="cb65-409"><a href="#cb65-409" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{x}{n-x}</span>
<span id="cb65-410"><a href="#cb65-410" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-411"><a href="#cb65-411" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-412"><a href="#cb65-412" aria-hidden="true" tabindex="-1"></a>That is, odds can be calculated directly as "# events" divided by "# nonevents" (without needing to calculate $\hat\pi$ and $1-\hat\pi$ first).</span>
<span id="cb65-413"><a href="#cb65-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-414"><a href="#cb65-414" aria-hidden="true" tabindex="-1"></a>::::{#exm-odds-shortcut}</span>
<span id="cb65-415"><a href="#cb65-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-416"><a href="#cb65-416" aria-hidden="true" tabindex="-1"></a><span class="fu">#### calculating odds using the shortcut</span></span>
<span id="cb65-417"><a href="#cb65-417" aria-hidden="true" tabindex="-1"></a>In @exm-odds, we calculated </span>
<span id="cb65-418"><a href="#cb65-418" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-419"><a href="#cb65-419" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-420"><a href="#cb65-420" aria-hidden="true" tabindex="-1"></a>\omega(OC) </span>
<span id="cb65-421"><a href="#cb65-421" aria-hidden="true" tabindex="-1"></a>&amp;=<span class="in">`r (13/5000)/(1- (13/5000))`</span></span>
<span id="cb65-422"><a href="#cb65-422" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-423"><a href="#cb65-423" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-424"><a href="#cb65-424" aria-hidden="true" tabindex="-1"></a>Let's recalculate this result using our shortcut:</span>
<span id="cb65-425"><a href="#cb65-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-426"><a href="#cb65-426" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-427"><a href="#cb65-427" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-428"><a href="#cb65-428" aria-hidden="true" tabindex="-1"></a>\omega(OC) </span>
<span id="cb65-429"><a href="#cb65-429" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{13}{5000-13}<span class="sc">\\</span></span>
<span id="cb65-430"><a href="#cb65-430" aria-hidden="true" tabindex="-1"></a>&amp;=<span class="in">`r (13)/(5000- 13)`</span></span>
<span id="cb65-431"><a href="#cb65-431" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-432"><a href="#cb65-432" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-433"><a href="#cb65-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-434"><a href="#cb65-434" aria-hidden="true" tabindex="-1"></a>Same answer!</span>
<span id="cb65-435"><a href="#cb65-435" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-436"><a href="#cb65-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-437"><a href="#cb65-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-438"><a href="#cb65-438" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Odds of rare events</span></span>
<span id="cb65-439"><a href="#cb65-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-440"><a href="#cb65-440" aria-hidden="true" tabindex="-1"></a>For rare events (small $\pi$), odds and probabilities are nearly equal, because $1-\pi \approx 1$ (see @fig-odds-probs).</span>
<span id="cb65-441"><a href="#cb65-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-442"><a href="#cb65-442" aria-hidden="true" tabindex="-1"></a>For example, in @exm-odds, the probability and odds differ by $<span class="in">`r abs(pi_OC - odds_OC)`</span>$.</span>
<span id="cb65-443"><a href="#cb65-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-444"><a href="#cb65-444" aria-hidden="true" tabindex="-1"></a>:::{#exr-odds-probs}</span>
<span id="cb65-445"><a href="#cb65-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-446"><a href="#cb65-446" aria-hidden="true" tabindex="-1"></a>What odds value corresponds to the probability $\pi = 0.2$, and what is the numerical difference between these two values?</span>
<span id="cb65-447"><a href="#cb65-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-448"><a href="#cb65-448" aria-hidden="true" tabindex="-1"></a>::::{.solution}</span>
<span id="cb65-449"><a href="#cb65-449" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-450"><a href="#cb65-450" aria-hidden="true" tabindex="-1"></a>\omega = \frac{\pi}{1-\pi} </span>
<span id="cb65-451"><a href="#cb65-451" aria-hidden="true" tabindex="-1"></a>=\frac{.2}{.8}</span>
<span id="cb65-452"><a href="#cb65-452" aria-hidden="true" tabindex="-1"></a>= .25</span>
<span id="cb65-453"><a href="#cb65-453" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-454"><a href="#cb65-454" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-455"><a href="#cb65-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-456"><a href="#cb65-456" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-457"><a href="#cb65-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-458"><a href="#cb65-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### The inverse odds function</span></span>
<span id="cb65-459"><a href="#cb65-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-460"><a href="#cb65-460" aria-hidden="true" tabindex="-1"></a>:::{#def-inv-odds}</span>
<span id="cb65-461"><a href="#cb65-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-462"><a href="#cb65-462" aria-hidden="true" tabindex="-1"></a><span class="fu">##### inverse odds function</span></span>
<span id="cb65-463"><a href="#cb65-463" aria-hidden="true" tabindex="-1"></a>The **inverse odds function**, </span>
<span id="cb65-464"><a href="#cb65-464" aria-hidden="true" tabindex="-1"></a>$$\pi(\omega)\eqdef \frac{\omega}{1+\omega}$$</span>
<span id="cb65-465"><a href="#cb65-465" aria-hidden="true" tabindex="-1"></a>converts odds into their corresponding probabilities (@fig-inv-odds).</span>
<span id="cb65-466"><a href="#cb65-466" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-467"><a href="#cb65-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-468"><a href="#cb65-468" aria-hidden="true" tabindex="-1"></a>The inverse-odds function takes an odds as input and produces a probability as output. Its domain of inputs is $<span class="co">[</span><span class="ot">0,\infty)$ and its range of outputs is $[0,1</span><span class="co">]</span>$.</span>
<span id="cb65-469"><a href="#cb65-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-472"><a href="#cb65-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-473"><a href="#cb65-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-inv-odds</span></span>
<span id="cb65-474"><a href="#cb65-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The inverse odds function, $\pi(\omega)$</span></span>
<span id="cb65-475"><a href="#cb65-475" aria-hidden="true" tabindex="-1"></a>odds_inv <span class="ot">=</span> <span class="cf">function</span>(omega) (<span class="dv">1</span> <span class="sc">+</span> omega<span class="sc">^-</span><span class="dv">1</span>)<span class="sc">^-</span><span class="dv">1</span></span>
<span id="cb65-476"><a href="#cb65-476" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-477"><a href="#cb65-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> odds_inv, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"inverse-odds"</span>)) <span class="sc">+</span></span>
<span id="cb65-478"><a href="#cb65-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Odds"</span>) <span class="sc">+</span></span>
<span id="cb65-479"><a href="#cb65-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb65-480"><a href="#cb65-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb65-481"><a href="#cb65-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb65-482"><a href="#cb65-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"x=y"</span>))</span>
<span id="cb65-483"><a href="#cb65-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-484"><a href="#cb65-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-485"><a href="#cb65-485" aria-hidden="true" tabindex="-1"></a>:::{.callout-important}</span>
<span id="cb65-486"><a href="#cb65-486" aria-hidden="true" tabindex="-1"></a>An equivalent expression for the inverse odds function is $$\pi(\omega) = (1-\omega^{-1})^{-1}$${#eq-inv-odds-reduced}</span>
<span id="cb65-487"><a href="#cb65-487" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-488"><a href="#cb65-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-489"><a href="#cb65-489" aria-hidden="true" tabindex="-1"></a>:::{#exr-inv-odds2}</span>
<span id="cb65-490"><a href="#cb65-490" aria-hidden="true" tabindex="-1"></a>Prove that @eq-inv-odds-reduced is equivalent to @def-inv-odds.</span>
<span id="cb65-491"><a href="#cb65-491" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-492"><a href="#cb65-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-493"><a href="#cb65-493" aria-hidden="true" tabindex="-1"></a>:::{#exr-odds-probs}</span>
<span id="cb65-494"><a href="#cb65-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-495"><a href="#cb65-495" aria-hidden="true" tabindex="-1"></a>What probability corresponds to an odds of $\omega = 1$, and what is the numerical difference between these two values?</span>
<span id="cb65-496"><a href="#cb65-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-497"><a href="#cb65-497" aria-hidden="true" tabindex="-1"></a>::::{.solution}</span>
<span id="cb65-498"><a href="#cb65-498" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-499"><a href="#cb65-499" aria-hidden="true" tabindex="-1"></a>\pi(1) = \frac{1}{1+1} </span>
<span id="cb65-500"><a href="#cb65-500" aria-hidden="true" tabindex="-1"></a>=\frac{1}{2}</span>
<span id="cb65-501"><a href="#cb65-501" aria-hidden="true" tabindex="-1"></a>= .5</span>
<span id="cb65-502"><a href="#cb65-502" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-503"><a href="#cb65-503" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-504"><a href="#cb65-504" aria-hidden="true" tabindex="-1"></a>1 - \pi(1) = 1 - .5 = .5</span>
<span id="cb65-505"><a href="#cb65-505" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-506"><a href="#cb65-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-507"><a href="#cb65-507" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-508"><a href="#cb65-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-509"><a href="#cb65-509" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-510"><a href="#cb65-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-511"><a href="#cb65-511" aria-hidden="true" tabindex="-1"></a><span class="fu">### Odds ratios</span></span>
<span id="cb65-512"><a href="#cb65-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-513"><a href="#cb65-513" aria-hidden="true" tabindex="-1"></a>Now that we have defined odds, we can introduce another way of comparing event probabilities: odds ratios.</span>
<span id="cb65-514"><a href="#cb65-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-515"><a href="#cb65-515" aria-hidden="true" tabindex="-1"></a>:::{#def-OR}</span>
<span id="cb65-516"><a href="#cb65-516" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Odds ratio</span></span>
<span id="cb65-517"><a href="#cb65-517" aria-hidden="true" tabindex="-1"></a>The **odds ratio** for two odds $\omega_1$, $\omega_2$ is their ratio:</span>
<span id="cb65-518"><a href="#cb65-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-519"><a href="#cb65-519" aria-hidden="true" tabindex="-1"></a>$$\theta(\omega_1, \omega_2) = \frac{\omega_1}{\omega_2}$$</span>
<span id="cb65-520"><a href="#cb65-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-521"><a href="#cb65-521" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-522"><a href="#cb65-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-523"><a href="#cb65-523" aria-hidden="true" tabindex="-1"></a>:::{#exm-OR}</span>
<span id="cb65-524"><a href="#cb65-524" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Calculating odds ratios</span></span>
<span id="cb65-525"><a href="#cb65-525" aria-hidden="true" tabindex="-1"></a>In @exm-oc-mi, the odds ratio for OC users versus OC-non-users is:</span>
<span id="cb65-526"><a href="#cb65-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-527"><a href="#cb65-527" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-528"><a href="#cb65-528" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-529"><a href="#cb65-529" aria-hidden="true" tabindex="-1"></a>\theta(\omega(OC), \omega(\neg OC))</span>
<span id="cb65-530"><a href="#cb65-530" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\omega(OC)}{\omega(\neg OC)}<span class="sc">\\</span></span>
<span id="cb65-531"><a href="#cb65-531" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{<span class="in">`r pi_OC`</span>}{<span class="in">`r pi_nOC`</span>}<span class="sc">\\</span></span>
<span id="cb65-532"><a href="#cb65-532" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r pi_OC / pi_nOC`</span><span class="sc">\\</span></span>
<span id="cb65-533"><a href="#cb65-533" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-534"><a href="#cb65-534" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-535"><a href="#cb65-535" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-536"><a href="#cb65-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-537"><a href="#cb65-537" aria-hidden="true" tabindex="-1"></a>When the outcome is rare (i.e., its probability is small) for both groups being compared in an odds ratio, the odds of the outcome will be similar to the probability of the outcome, and thus the risk ratio will be similar to the odds ratio.</span>
<span id="cb65-538"><a href="#cb65-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-539"><a href="#cb65-539" aria-hidden="true" tabindex="-1"></a>For example, in @exm-oc-mi, the outcome is rare for both OC and non-OC participants, so the odds for both groups are similar to the corresponding probabilities, and the odds ratio is similar the risk ratio.</span>
<span id="cb65-540"><a href="#cb65-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-541"><a href="#cb65-541" aria-hidden="true" tabindex="-1"></a><span class="fu">#### A shortcut for calculating odds ratio estimates</span></span>
<span id="cb65-542"><a href="#cb65-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-543"><a href="#cb65-543" aria-hidden="true" tabindex="-1"></a>The general form of a two-by-two table is shown in @tbl-2x2-generic. </span>
<span id="cb65-544"><a href="#cb65-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-545"><a href="#cb65-545" aria-hidden="true" tabindex="-1"></a>|               | Event | Non-Event | Total</span>
<span id="cb65-546"><a href="#cb65-546" aria-hidden="true" tabindex="-1"></a>|-------------- | ------ | ---------- | ----- </span>
<span id="cb65-547"><a href="#cb65-547" aria-hidden="true" tabindex="-1"></a>|Exposed        | a      | b | a+b</span>
<span id="cb65-548"><a href="#cb65-548" aria-hidden="true" tabindex="-1"></a>|Non-exposed    | c      | d | c+d</span>
<span id="cb65-549"><a href="#cb65-549" aria-hidden="true" tabindex="-1"></a>|Total         | a+c   | b+d | a+b+c+d</span>
<span id="cb65-550"><a href="#cb65-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-551"><a href="#cb65-551" aria-hidden="true" tabindex="-1"></a>: A generic 2x2 table {#tbl-2x2-generic}</span>
<span id="cb65-552"><a href="#cb65-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-553"><a href="#cb65-553" aria-hidden="true" tabindex="-1"></a>From this table, we have:</span>
<span id="cb65-554"><a href="#cb65-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-555"><a href="#cb65-555" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\hat\pi(Event|Exposed) = a/(a+b)$</span>
<span id="cb65-556"><a href="#cb65-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-557"><a href="#cb65-557" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\hat\pi(\neg Event|Exposed) = b/(a+b)$</span>
<span id="cb65-558"><a href="#cb65-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-559"><a href="#cb65-559" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\hat\omega(Event|Exposed) = \frac{\left(\frac{a}{a+b}\right)}{\left(\frac{b}{a+b}\right)}=\frac{a}{b}$</span>
<span id="cb65-560"><a href="#cb65-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-561"><a href="#cb65-561" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\hat\omega(Event|\neg Exposed) = \frac{c}{d}$</span>
<span id="cb65-562"><a href="#cb65-562" aria-hidden="true" tabindex="-1"></a>(see @exr-odds-generic)</span>
<span id="cb65-563"><a href="#cb65-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-564"><a href="#cb65-564" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\theta(Exposed,\neg Exposed) = \frac{\frac{a}{b}}{\frac{c}{d}} = \frac{ad}{bc}$</span>
<span id="cb65-565"><a href="#cb65-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-566"><a href="#cb65-566" aria-hidden="true" tabindex="-1"></a>:::{#exr-odds-generic}</span>
<span id="cb65-567"><a href="#cb65-567" aria-hidden="true" tabindex="-1"></a>Given @tbl-2x2-generic, show that $\hat\omega(Event|\neg Exposed) = \frac{c}{d}$.</span>
<span id="cb65-568"><a href="#cb65-568" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-569"><a href="#cb65-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-570"><a href="#cb65-570" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Properties of odds ratios {#sec-OR-props}</span></span>
<span id="cb65-571"><a href="#cb65-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-572"><a href="#cb65-572" aria-hidden="true" tabindex="-1"></a>Odds ratios have a special property: we can swap a covariate with the outcome, and the odds ratio remains the same.</span>
<span id="cb65-573"><a href="#cb65-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-574"><a href="#cb65-574" aria-hidden="true" tabindex="-1"></a>:::{#exm-or-inv-MI}</span>
<span id="cb65-575"><a href="#cb65-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-576"><a href="#cb65-576" aria-hidden="true" tabindex="-1"></a>In @exm-oc-mi, we have:</span>
<span id="cb65-577"><a href="#cb65-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-578"><a href="#cb65-578" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-579"><a href="#cb65-579" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-580"><a href="#cb65-580" aria-hidden="true" tabindex="-1"></a>\theta(MI; OC) </span>
<span id="cb65-581"><a href="#cb65-581" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef</span>
<span id="cb65-582"><a href="#cb65-582" aria-hidden="true" tabindex="-1"></a>\frac{\omega(MI|OC)}{\omega(MI|\neg OC)}<span class="sc">\\</span></span>
<span id="cb65-583"><a href="#cb65-583" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \frac</span>
<span id="cb65-584"><a href="#cb65-584" aria-hidden="true" tabindex="-1"></a>{\left(\frac{\Pr(MI|OC)}{\Pr(\neg MI|OC)}\right)}</span>
<span id="cb65-585"><a href="#cb65-585" aria-hidden="true" tabindex="-1"></a>{\left(\frac{\Pr(MI|\neg OC)}{\Pr(\neg MI|\neg OC)}\right)}<span class="sc">\\</span></span>
<span id="cb65-586"><a href="#cb65-586" aria-hidden="true" tabindex="-1"></a>&amp;= \frac</span>
<span id="cb65-587"><a href="#cb65-587" aria-hidden="true" tabindex="-1"></a>{\left(\frac{\Pr(MI,OC)}{\Pr(\neg MI,OC)}\right)}</span>
<span id="cb65-588"><a href="#cb65-588" aria-hidden="true" tabindex="-1"></a>{\left(\frac{\Pr(MI,\neg OC)}{\Pr(\neg MI,\neg OC)}\right)}<span class="sc">\\</span></span>
<span id="cb65-589"><a href="#cb65-589" aria-hidden="true" tabindex="-1"></a>&amp;= \left(\frac{\Pr(MI,OC)}{\Pr(\neg MI,OC)}\right)</span>
<span id="cb65-590"><a href="#cb65-590" aria-hidden="true" tabindex="-1"></a>\left(\frac{\Pr(\neg MI,\neg OC)}{\Pr(MI,\neg OC)}\right)<span class="sc">\\</span></span>
<span id="cb65-591"><a href="#cb65-591" aria-hidden="true" tabindex="-1"></a>&amp;= \left(\frac{\Pr(MI,OC)}{\Pr(MI,\neg OC)}\right)</span>
<span id="cb65-592"><a href="#cb65-592" aria-hidden="true" tabindex="-1"></a>\left(\frac{\Pr(\neg MI,\neg OC)}{\Pr(\neg MI,OC)}\right)<span class="sc">\\</span></span>
<span id="cb65-593"><a href="#cb65-593" aria-hidden="true" tabindex="-1"></a>&amp;= \left(\frac{\Pr(OC,MI)}{\Pr(\neg OC,MI)}\right)</span>
<span id="cb65-594"><a href="#cb65-594" aria-hidden="true" tabindex="-1"></a>\left(\frac{\Pr(\neg OC,\neg MI)}{\Pr(OC,\neg MI)}\right)<span class="sc">\\</span></span>
<span id="cb65-595"><a href="#cb65-595" aria-hidden="true" tabindex="-1"></a>&amp;= \left(\frac{\Pr(OC|MI)}{\Pr(\neg OC|MI)}\right)</span>
<span id="cb65-596"><a href="#cb65-596" aria-hidden="true" tabindex="-1"></a>\left(\frac{\Pr(\neg OC|\neg MI)}{\Pr(OC|\neg MI)}\right)<span class="sc">\\</span></span>
<span id="cb65-597"><a href="#cb65-597" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\left(\frac{\Pr(OC|MI)}{\Pr(\neg OC|MI)}\right)}</span>
<span id="cb65-598"><a href="#cb65-598" aria-hidden="true" tabindex="-1"></a>{\left(\frac{\Pr(OC|\neg MI)}{\Pr(\neg OC|\neg MI)}\right)}<span class="sc">\\</span></span>
<span id="cb65-599"><a href="#cb65-599" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \frac{\omega(OC|MI)}</span>
<span id="cb65-600"><a href="#cb65-600" aria-hidden="true" tabindex="-1"></a>{\omega(OC|\neg MI)}<span class="sc">\\</span></span>
<span id="cb65-601"><a href="#cb65-601" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \theta(OC; MI)</span>
<span id="cb65-602"><a href="#cb65-602" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-603"><a href="#cb65-603" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-604"><a href="#cb65-604" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-605"><a href="#cb65-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-606"><a href="#cb65-606" aria-hidden="true" tabindex="-1"></a>:::{#exr-2x2-generic}</span>
<span id="cb65-607"><a href="#cb65-607" aria-hidden="true" tabindex="-1"></a>For @tbl-2x2-generic, show that $\hat\theta(Exposed, Unexposed) = \hat\theta(Event, \neg Event)$.</span>
<span id="cb65-608"><a href="#cb65-608" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-609"><a href="#cb65-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-610"><a href="#cb65-610" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect of study design</span></span>
<span id="cb65-611"><a href="#cb65-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-612"><a href="#cb65-612" aria-hidden="true" tabindex="-1"></a>@tbl-oc-mi simulates a follow-up study in which two populations were followed and the number of MI’s was observed. The risks are $P(MI|OC)$ and $P(MI|\neg OC)$ and we can estimate these risks from the data.</span>
<span id="cb65-613"><a href="#cb65-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-614"><a href="#cb65-614" aria-hidden="true" tabindex="-1"></a>But suppose we had a case-control study in which we had 100 women with MI and selected a comparison group of 100 women without MI (matched as groups on age, etc.). Then MI is not random, and we cannot compute P(MI|OC) and we cannot compute the risk ratio. However, the odds ratio however can be computed.</span>
<span id="cb65-615"><a href="#cb65-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-616"><a href="#cb65-616" aria-hidden="true" tabindex="-1"></a>The disease odds ratio is the odds for the disease in the exposed group divided by the odds for the disease in the unexposed group, and we cannot validly compute and use these separate parts.</span>
<span id="cb65-617"><a href="#cb65-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-618"><a href="#cb65-618" aria-hidden="true" tabindex="-1"></a>But we can validly compute and use the exposure odds ratio, which is the odds for exposure in the disease group divided by the odds for exposure in the non-diseased group (because exposure can be treated as random):</span>
<span id="cb65-619"><a href="#cb65-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-620"><a href="#cb65-620" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-621"><a href="#cb65-621" aria-hidden="true" tabindex="-1"></a>\hth(OC|MI) = </span>
<span id="cb65-622"><a href="#cb65-622" aria-hidden="true" tabindex="-1"></a>\frac{\hat{\omega}(OC|MI)}{\hat{\omega}(OC|\neg MI)}</span>
<span id="cb65-623"><a href="#cb65-623" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-624"><a href="#cb65-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-625"><a href="#cb65-625" aria-hidden="true" tabindex="-1"></a>And these two odds ratios, $\hth(MI|OC)$ and $\hth(OC|MI)$ are mathematically equivalent, as we saw in @sec-OR-props.</span>
<span id="cb65-626"><a href="#cb65-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-627"><a href="#cb65-627" aria-hidden="true" tabindex="-1"></a>:::{#exr-or-rev}</span>
<span id="cb65-628"><a href="#cb65-628" aria-hidden="true" tabindex="-1"></a>Calculate the odds ratio of MI with respect to OC use, assuming that @tbl-oc-mi comes from a case-control study. Confirm that the result is the same as in @exm-OR.</span>
<span id="cb65-629"><a href="#cb65-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-630"><a href="#cb65-630" aria-hidden="true" tabindex="-1"></a>::::{.solution}</span>
<span id="cb65-631"><a href="#cb65-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-632"><a href="#cb65-632" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\omega(OC|MI) = P(OC|MI)/(1 – P(OC|MI) = \frac{13}{7} = <span class="in">`r 13/7`</span>$</span>
<span id="cb65-633"><a href="#cb65-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-634"><a href="#cb65-634" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\omega(OC|\neg MI) = P(OC|\neg MI)/(1 – P(OC|\neg MI) = \frac{4987}{9993} = <span class="in">`r 4987/9993`</span>$</span>
<span id="cb65-635"><a href="#cb65-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-636"><a href="#cb65-636" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\theta(OC,MI) = \frac{\omega(OC|MI)}{\omega(OC|\neg MI)} = \frac{13/7}{4987/9993} = <span class="in">`r (13/7)/(4987/9993)`</span>$</span>
<span id="cb65-637"><a href="#cb65-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-638"><a href="#cb65-638" aria-hidden="true" tabindex="-1"></a>This is the same estimate we calculated in @exm-OR.</span>
<span id="cb65-639"><a href="#cb65-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-640"><a href="#cb65-640" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-641"><a href="#cb65-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-642"><a href="#cb65-642" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-643"><a href="#cb65-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-644"><a href="#cb65-644" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cross-Sectional Studies</span></span>
<span id="cb65-645"><a href="#cb65-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-646"><a href="#cb65-646" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If a cross-sectional study is a probability sample of a population (which it rarely is) then we can estimate risks.</span>
<span id="cb65-647"><a href="#cb65-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-648"><a href="#cb65-648" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If it is a sample, but not an unbiased probability sample, then we need to treat it in the same way as a case-control study.</span>
<span id="cb65-649"><a href="#cb65-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-650"><a href="#cb65-650" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>We can validly estimate odds ratios in either case.</span>
<span id="cb65-651"><a href="#cb65-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-652"><a href="#cb65-652" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>But we can usually not validly estimate risks and risk ratios.</span>
<span id="cb65-653"><a href="#cb65-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-654"><a href="#cb65-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-655"><a href="#cb65-655" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to logistic regression</span></span>
<span id="cb65-656"><a href="#cb65-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-657"><a href="#cb65-657" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In @exm-oc-mi, we estimated the risk and the odds of MI for two discrete cases, as to whether of not the individual used oral contraceptives.</span>
<span id="cb65-658"><a href="#cb65-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-659"><a href="#cb65-659" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If the predictor is quantitative (dose) or there is more than one predictor, the task becomes more difficult.</span>
<span id="cb65-660"><a href="#cb65-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-661"><a href="#cb65-661" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In this case, we will use logistic regression, which is a generalization of the linear regression models you have been using that can account for a binary response instead of a continuous one.</span>
<span id="cb65-662"><a href="#cb65-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-663"><a href="#cb65-663" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary outcomes models - one group, no covariates</span></span>
<span id="cb65-664"><a href="#cb65-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-665"><a href="#cb65-665" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-666"><a href="#cb65-666" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-667"><a href="#cb65-667" aria-hidden="true" tabindex="-1"></a>p(Y=1) &amp;= \pi<span class="sc">\\</span></span>
<span id="cb65-668"><a href="#cb65-668" aria-hidden="true" tabindex="-1"></a>p(Y=0) &amp;= 1-\pi<span class="sc">\\</span></span>
<span id="cb65-669"><a href="#cb65-669" aria-hidden="true" tabindex="-1"></a>p(Y=y) &amp;= \pi^y (1-\pi)^{1-y}<span class="sc">\\</span></span>
<span id="cb65-670"><a href="#cb65-670" aria-hidden="true" tabindex="-1"></a>\mathbf y  &amp;= (y_1, ..., y_n)<span class="sc">\\</span></span>
<span id="cb65-671"><a href="#cb65-671" aria-hidden="true" tabindex="-1"></a>\mathcal L(\pi;\mathbf y) &amp;= \pi^{\sum y_i} (1-\pi)^{n - \sum y_i}<span class="sc">\\</span></span>
<span id="cb65-672"><a href="#cb65-672" aria-hidden="true" tabindex="-1"></a>\ell(\pi, \mathbf y) &amp;= \left({\sum y_i}\right) \log{\pi} + \left(n - \sum y_i\right) \log{1-\pi}<span class="sc">\\</span></span>
<span id="cb65-673"><a href="#cb65-673" aria-hidden="true" tabindex="-1"></a>&amp;= \left({\sum y_i}\right) \left(\log{\pi} - \log{1-\pi}\right) + n \cdot \log{1-\pi}<span class="sc">\\</span></span>
<span id="cb65-674"><a href="#cb65-674" aria-hidden="true" tabindex="-1"></a>&amp;= \left({\sum y_i}\right) \log{\frac{\pi}{ 1-\pi}} + n \cdot \log{1-\pi}</span>
<span id="cb65-675"><a href="#cb65-675" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-676"><a href="#cb65-676" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-677"><a href="#cb65-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-678"><a href="#cb65-678" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary outcomes - general</span></span>
<span id="cb65-679"><a href="#cb65-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-680"><a href="#cb65-680" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-681"><a href="#cb65-681" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-682"><a href="#cb65-682" aria-hidden="true" tabindex="-1"></a>p(Y_i=1) &amp;= \pi_i<span class="sc">\\</span></span>
<span id="cb65-683"><a href="#cb65-683" aria-hidden="true" tabindex="-1"></a>p(Y_i=0) &amp;= 1-\pi_i<span class="sc">\\</span></span>
<span id="cb65-684"><a href="#cb65-684" aria-hidden="true" tabindex="-1"></a>p(Y_i=y) &amp;= (\pi_i)^y (1-\pi_i)^{1-y}<span class="sc">\\</span></span>
<span id="cb65-685"><a href="#cb65-685" aria-hidden="true" tabindex="-1"></a>\mathbf y  &amp;= (y_1, ..., y_n)<span class="sc">\\</span></span>
<span id="cb65-686"><a href="#cb65-686" aria-hidden="true" tabindex="-1"></a>\mathcal L(\pi;\mathbf y) &amp;= \prod_{i=1}^n </span>
<span id="cb65-687"><a href="#cb65-687" aria-hidden="true" tabindex="-1"></a>(\pi_i)^{y_i} (1-\pi_i)^{1 - y_i}<span class="sc">\\</span></span>
<span id="cb65-688"><a href="#cb65-688" aria-hidden="true" tabindex="-1"></a>\ell(\pi, \mathbf y) &amp;= </span>
<span id="cb65-689"><a href="#cb65-689" aria-hidden="true" tabindex="-1"></a>\sum_{i=1}^n </span>
<span id="cb65-690"><a href="#cb65-690" aria-hidden="true" tabindex="-1"></a>y_i \log{\pi_i} + (1 - y_i) \log{1-\pi_i}</span>
<span id="cb65-691"><a href="#cb65-691" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-692"><a href="#cb65-692" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-693"><a href="#cb65-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-694"><a href="#cb65-694" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modeling $\pi_i$ as a function of $X_i$</span></span>
<span id="cb65-695"><a href="#cb65-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-696"><a href="#cb65-696" aria-hidden="true" tabindex="-1"></a>If there are only a few distinct $X_i$ values, we can model each one</span>
<span id="cb65-697"><a href="#cb65-697" aria-hidden="true" tabindex="-1"></a>separately.</span>
<span id="cb65-698"><a href="#cb65-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-699"><a href="#cb65-699" aria-hidden="true" tabindex="-1"></a>Otherwise, we need regression.</span>
<span id="cb65-700"><a href="#cb65-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-701"><a href="#cb65-701" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-702"><a href="#cb65-702" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-703"><a href="#cb65-703" aria-hidden="true" tabindex="-1"></a>\pi(x) &amp;\equiv \text{E}(Y=1|X=x)<span class="sc">\\</span></span>
<span id="cb65-704"><a href="#cb65-704" aria-hidden="true" tabindex="-1"></a>&amp;= f(x^\top\beta)</span>
<span id="cb65-705"><a href="#cb65-705" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-706"><a href="#cb65-706" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-707"><a href="#cb65-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-708"><a href="#cb65-708" aria-hidden="true" tabindex="-1"></a>Typically, we use $f(\eta) = \text{expit}(\eta)$.</span>
<span id="cb65-709"><a href="#cb65-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-710"><a href="#cb65-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-711"><a href="#cb65-711" aria-hidden="true" tabindex="-1"></a>:::{#def-expit}</span>
<span id="cb65-712"><a href="#cb65-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-713"><a href="#cb65-713" aria-hidden="true" tabindex="-1"></a><span class="fu">#### expit function</span></span>
<span id="cb65-714"><a href="#cb65-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-715"><a href="#cb65-715" aria-hidden="true" tabindex="-1"></a>The **expit** function (@fig-expit-plot), also known as the **inverse-logit** or **logistic** function, is:</span>
<span id="cb65-716"><a href="#cb65-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-717"><a href="#cb65-717" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-718"><a href="#cb65-718" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-719"><a href="#cb65-719" aria-hidden="true" tabindex="-1"></a>\text{expit}(\eta)</span>
<span id="cb65-720"><a href="#cb65-720" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \frac{\exp{\eta}}{1+\exp{\eta}}<span class="sc">\\</span></span>
<span id="cb65-721"><a href="#cb65-721" aria-hidden="true" tabindex="-1"></a>&amp;= (1 + \exp{-\eta})^{-1}</span>
<span id="cb65-722"><a href="#cb65-722" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-723"><a href="#cb65-723" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-724"><a href="#cb65-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-725"><a href="#cb65-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-728"><a href="#cb65-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-729"><a href="#cb65-729" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-expit-plot</span></span>
<span id="cb65-730"><a href="#cb65-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The expit function</span></span>
<span id="cb65-731"><a href="#cb65-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb65-732"><a href="#cb65-732" aria-hidden="true" tabindex="-1"></a>expit <span class="ot">=</span> <span class="cf">function</span>(eta) <span class="fu">exp</span>(eta)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(eta))</span>
<span id="cb65-733"><a href="#cb65-733" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb65-734"><a href="#cb65-734" aria-hidden="true" tabindex="-1"></a>expit_plot <span class="ot">=</span> </span>
<span id="cb65-735"><a href="#cb65-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb65-736"><a href="#cb65-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> expit) <span class="sc">+</span> </span>
<span id="cb65-737"><a href="#cb65-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb65-738"><a href="#cb65-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb65-739"><a href="#cb65-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">expit</span>(eta))) <span class="sc">+</span></span>
<span id="cb65-740"><a href="#cb65-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(eta)) <span class="sc">+</span></span>
<span id="cb65-741"><a href="#cb65-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb65-742"><a href="#cb65-742" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expit_plot)</span>
<span id="cb65-743"><a href="#cb65-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-744"><a href="#cb65-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-745"><a href="#cb65-745" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-746"><a href="#cb65-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-747"><a href="#cb65-747" aria-hidden="true" tabindex="-1"></a>:::{#def-logit}</span>
<span id="cb65-748"><a href="#cb65-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-749"><a href="#cb65-749" aria-hidden="true" tabindex="-1"></a><span class="fu">##### logit function</span></span>
<span id="cb65-750"><a href="#cb65-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-751"><a href="#cb65-751" aria-hidden="true" tabindex="-1"></a>The inverse of the <span class="in">`expit`</span> function is the <span class="in">`logit`</span> function:</span>
<span id="cb65-752"><a href="#cb65-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-753"><a href="#cb65-753" aria-hidden="true" tabindex="-1"></a>$$g(p) = f^{-1}(p) = \text{logit}(p) = \log{\frac{p}{1-p}}$$</span>
<span id="cb65-754"><a href="#cb65-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-755"><a href="#cb65-755" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-756"><a href="#cb65-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-759"><a href="#cb65-759" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-760"><a href="#cb65-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb65-761"><a href="#cb65-761" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: the logit function</span></span>
<span id="cb65-762"><a href="#cb65-762" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-logit</span></span>
<span id="cb65-763"><a href="#cb65-763" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">=</span> <span class="cf">function</span>(p) <span class="fu">log</span>(<span class="fu">odds</span>(p))</span>
<span id="cb65-764"><a href="#cb65-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-765"><a href="#cb65-765" aria-hidden="true" tabindex="-1"></a>logit_plot <span class="ot">=</span> </span>
<span id="cb65-766"><a href="#cb65-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb65-767"><a href="#cb65-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> logit) <span class="sc">+</span> </span>
<span id="cb65-768"><a href="#cb65-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(.<span class="dv">01</span>, .<span class="dv">99</span>) <span class="sc">+</span> </span>
<span id="cb65-769"><a href="#cb65-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"logit(p)"</span>) <span class="sc">+</span></span>
<span id="cb65-770"><a href="#cb65-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"p"</span>) <span class="sc">+</span></span>
<span id="cb65-771"><a href="#cb65-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb65-772"><a href="#cb65-772" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(logit_plot)</span>
<span id="cb65-773"><a href="#cb65-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-774"><a href="#cb65-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-775"><a href="#cb65-775" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagram of expit and logit {#sec-expit-logit-diagram}</span></span>
<span id="cb65-776"><a href="#cb65-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-777"><a href="#cb65-777" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-778"><a href="#cb65-778" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-779"><a href="#cb65-779" aria-hidden="true" tabindex="-1"></a>\left<span class="co">[</span><span class="ot"> \pi  \eqdef\Pr(Y=1)\right</span><span class="co">]</span></span>
<span id="cb65-780"><a href="#cb65-780" aria-hidden="true" tabindex="-1"></a>\underbrace{</span>
<span id="cb65-781"><a href="#cb65-781" aria-hidden="true" tabindex="-1"></a>\overbrace{</span>
<span id="cb65-782"><a href="#cb65-782" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb65-783"><a href="#cb65-783" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot"> \frac{\omega}{1+\omega}</span><span class="co">]</span>{}</span>
<span id="cb65-784"><a href="#cb65-784" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-785"><a href="#cb65-785" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-786"><a href="#cb65-786" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\frac{\pi}{1-\pi}}</span>
<span id="cb65-787"><a href="#cb65-787" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-788"><a href="#cb65-788" aria-hidden="true" tabindex="-1"></a>\left<span class="co">[</span><span class="ot">\omega \eqdef \text{odds}(Y=1)\right</span><span class="co">]</span></span>
<span id="cb65-789"><a href="#cb65-789" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb65-790"><a href="#cb65-790" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot">\exp{\eta}</span><span class="co">]</span>{}</span>
<span id="cb65-791"><a href="#cb65-791" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-792"><a href="#cb65-792" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-793"><a href="#cb65-793" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\log{\omega}}</span>
<span id="cb65-794"><a href="#cb65-794" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-795"><a href="#cb65-795" aria-hidden="true" tabindex="-1"></a>}^{\text{logit}(\pi)}</span>
<span id="cb65-796"><a href="#cb65-796" aria-hidden="true" tabindex="-1"></a>}_{\text{expit}(\eta)}</span>
<span id="cb65-797"><a href="#cb65-797" aria-hidden="true" tabindex="-1"></a>\left<span class="co">[</span><span class="ot">\eta \eqdef \text{log-odds}(Y=1)\right</span><span class="co">]</span></span>
<span id="cb65-798"><a href="#cb65-798" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-799"><a href="#cb65-799" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-800"><a href="#cb65-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-801"><a href="#cb65-801" aria-hidden="true" tabindex="-1"></a>::: {.content-hidden when-format="pdf"}</span>
<span id="cb65-802"><a href="#cb65-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-803"><a href="#cb65-803" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-804"><a href="#cb65-804" aria-hidden="true" tabindex="-1"></a>\underbrace{\pi}_{\atop{\Pr(Y=1)} }</span>
<span id="cb65-805"><a href="#cb65-805" aria-hidden="true" tabindex="-1"></a>\overbrace{</span>
<span id="cb65-806"><a href="#cb65-806" aria-hidden="true" tabindex="-1"></a>\underbrace{</span>
<span id="cb65-807"><a href="#cb65-807" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb65-808"><a href="#cb65-808" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot">\frac{\omega}{1+\omega}</span><span class="co">]</span>{}</span>
<span id="cb65-809"><a href="#cb65-809" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-810"><a href="#cb65-810" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-811"><a href="#cb65-811" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\frac{\pi}{1-\pi}}</span>
<span id="cb65-812"><a href="#cb65-812" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-813"><a href="#cb65-813" aria-hidden="true" tabindex="-1"></a>\underbrace{\omega}_{\text{odds}(Y=1)}</span>
<span id="cb65-814"><a href="#cb65-814" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb65-815"><a href="#cb65-815" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot">\exp{\eta}</span><span class="co">]</span>{}</span>
<span id="cb65-816"><a href="#cb65-816" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-817"><a href="#cb65-817" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-818"><a href="#cb65-818" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\log{\omega}}</span>
<span id="cb65-819"><a href="#cb65-819" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-820"><a href="#cb65-820" aria-hidden="true" tabindex="-1"></a>}_{\text{expit}(\eta)}</span>
<span id="cb65-821"><a href="#cb65-821" aria-hidden="true" tabindex="-1"></a>}^{\text{logit}(\pi)}</span>
<span id="cb65-822"><a href="#cb65-822" aria-hidden="true" tabindex="-1"></a>\underbrace{\eta}_{\atop{\text{log-odds}(Y=1)}}</span>
<span id="cb65-823"><a href="#cb65-823" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-824"><a href="#cb65-824" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-825"><a href="#cb65-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-826"><a href="#cb65-826" aria-hidden="true" tabindex="-1"></a><span class="fu">### Meet the beetles</span></span>
<span id="cb65-827"><a href="#cb65-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-830"><a href="#cb65-830" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-831"><a href="#cb65-831" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmx)</span>
<span id="cb65-832"><a href="#cb65-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-833"><a href="#cb65-833" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(BeetleMortality, <span class="at">package =</span> <span class="st">"glmx"</span>)</span>
<span id="cb65-834"><a href="#cb65-834" aria-hidden="true" tabindex="-1"></a>beetles <span class="ot">=</span> BeetleMortality <span class="sc">|&gt;</span></span>
<span id="cb65-835"><a href="#cb65-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-836"><a href="#cb65-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct =</span> died<span class="sc">/</span>n,</span>
<span id="cb65-837"><a href="#cb65-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">survived =</span> n <span class="sc">-</span> died</span>
<span id="cb65-838"><a href="#cb65-838" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-839"><a href="#cb65-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-840"><a href="#cb65-840" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">=</span> </span>
<span id="cb65-841"><a href="#cb65-841" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span> </span>
<span id="cb65-842"><a href="#cb65-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb65-843"><a href="#cb65-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb65-844"><a href="#cb65-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Dose (log mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb65-845"><a href="#cb65-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mortality rate (%)"</span>) <span class="sc">+</span></span>
<span id="cb65-846"><a href="#cb65-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb65-847"><a href="#cb65-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb65-848"><a href="#cb65-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb65-849"><a href="#cb65-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-850"><a href="#cb65-850" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1)</span>
<span id="cb65-851"><a href="#cb65-851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-852"><a href="#cb65-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-853"><a href="#cb65-853" aria-hidden="true" tabindex="-1"></a>Mortality rates of adult flour beetles after five hours' exposure to</span>
<span id="cb65-854"><a href="#cb65-854" aria-hidden="true" tabindex="-1"></a>gaseous carbon disulphide (Bliss 1935)</span>
<span id="cb65-855"><a href="#cb65-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-856"><a href="#cb65-856" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why don't we use linear regression?</span></span>
<span id="cb65-857"><a href="#cb65-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-860"><a href="#cb65-860" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-861"><a href="#cb65-861" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">=</span> beetles <span class="sc">|&gt;</span> </span>
<span id="cb65-862"><a href="#cb65-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(<span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb65-863"><a href="#cb65-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-864"><a href="#cb65-864" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">=</span> </span>
<span id="cb65-865"><a href="#cb65-865" aria-hidden="true" tabindex="-1"></a>  beetles  <span class="sc">|&gt;</span> </span>
<span id="cb65-866"><a href="#cb65-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb65-867"><a href="#cb65-867" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb65-868"><a href="#cb65-868" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb65-869"><a href="#cb65-869" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died), </span>
<span id="cb65-870"><a href="#cb65-870" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived))</span>
<span id="cb65-871"><a href="#cb65-871" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-872"><a href="#cb65-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb65-873"><a href="#cb65-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> dose, </span>
<span id="cb65-874"><a href="#cb65-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb65-875"><a href="#cb65-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-876"><a href="#cb65-876" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">=</span> </span>
<span id="cb65-877"><a href="#cb65-877" aria-hidden="true" tabindex="-1"></a>  beetles  <span class="sc">|&gt;</span> </span>
<span id="cb65-878"><a href="#cb65-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb65-879"><a href="#cb65-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb65-880"><a href="#cb65-880" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb65-881"><a href="#cb65-881" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died), </span>
<span id="cb65-882"><a href="#cb65-882" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived))</span>
<span id="cb65-883"><a href="#cb65-883" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-884"><a href="#cb65-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb65-885"><a href="#cb65-885" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> <span class="fu">log</span>(dose), </span>
<span id="cb65-886"><a href="#cb65-886" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb65-887"><a href="#cb65-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-888"><a href="#cb65-888" aria-hidden="true" tabindex="-1"></a>range1 <span class="ot">=</span> <span class="fu">range</span>(beetles<span class="sc">$</span>dose) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, .<span class="dv">2</span>)</span>
<span id="cb65-889"><a href="#cb65-889" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(beetles_glm_grouped, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb65-890"><a href="#cb65-890" aria-hidden="true" tabindex="-1"></a>f.linear <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb65-891"><a href="#cb65-891" aria-hidden="true" tabindex="-1"></a>f.linearlog <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb65-892"><a href="#cb65-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-893"><a href="#cb65-893" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">=</span> </span>
<span id="cb65-894"><a href="#cb65-894" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">+</span> </span>
<span id="cb65-895"><a href="#cb65-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb65-896"><a href="#cb65-896" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> f.linear, </span>
<span id="cb65-897"><a href="#cb65-897" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Straight line"</span>)) <span class="sc">+</span></span>
<span id="cb65-898"><a href="#cb65-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">"Model"</span>, <span class="at">size =</span> <span class="st">""</span>)</span>
<span id="cb65-899"><a href="#cb65-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-900"><a href="#cb65-900" aria-hidden="true" tabindex="-1"></a>plot2 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-901"><a href="#cb65-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-902"><a href="#cb65-902" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-903"><a href="#cb65-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-904"><a href="#cb65-904" aria-hidden="true" tabindex="-1"></a><span class="fu">### Zoom out</span></span>
<span id="cb65-905"><a href="#cb65-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-908"><a href="#cb65-908" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-909"><a href="#cb65-909" aria-hidden="true" tabindex="-1"></a>(plot2 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-910"><a href="#cb65-910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-911"><a href="#cb65-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-912"><a href="#cb65-912" aria-hidden="true" tabindex="-1"></a><span class="fu">### log transformation of dose?</span></span>
<span id="cb65-913"><a href="#cb65-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-916"><a href="#cb65-916" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-917"><a href="#cb65-917" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">=</span> plot2 <span class="sc">+</span> </span>
<span id="cb65-918"><a href="#cb65-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb65-919"><a href="#cb65-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> f.linearlog, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Log-transform dose"</span>))</span>
<span id="cb65-920"><a href="#cb65-920" aria-hidden="true" tabindex="-1"></a>(plot3 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-921"><a href="#cb65-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-922"><a href="#cb65-922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-923"><a href="#cb65-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-924"><a href="#cb65-924" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression</span></span>
<span id="cb65-925"><a href="#cb65-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-928"><a href="#cb65-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-929"><a href="#cb65-929" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">=</span> plot3 <span class="sc">+</span> <span class="fu">geom_function</span>(<span class="at">fun =</span> f, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Logistic regression"</span>))</span>
<span id="cb65-930"><a href="#cb65-930" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-931"><a href="#cb65-931" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-932"><a href="#cb65-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-933"><a href="#cb65-933" aria-hidden="true" tabindex="-1"></a><span class="fu">### Three parts to regression models</span></span>
<span id="cb65-934"><a href="#cb65-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-935"><a href="#cb65-935" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What distribution does the outcome have for a specific subpopulation</span>
<span id="cb65-936"><a href="#cb65-936" aria-hidden="true" tabindex="-1"></a>defined by covariates? (outcome model)</span>
<span id="cb65-937"><a href="#cb65-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-938"><a href="#cb65-938" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How does the combination of covariates relate to the mean? (link</span>
<span id="cb65-939"><a href="#cb65-939" aria-hidden="true" tabindex="-1"></a>function)</span>
<span id="cb65-940"><a href="#cb65-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-941"><a href="#cb65-941" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How do the covariates combine? (linear predictor, interactions)</span>
<span id="cb65-942"><a href="#cb65-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-943"><a href="#cb65-943" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression in R</span></span>
<span id="cb65-944"><a href="#cb65-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-947"><a href="#cb65-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-948"><a href="#cb65-948" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">=</span> </span>
<span id="cb65-949"><a href="#cb65-949" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span> </span>
<span id="cb65-950"><a href="#cb65-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb65-951"><a href="#cb65-951" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose, </span>
<span id="cb65-952"><a href="#cb65-952" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb65-953"><a href="#cb65-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-954"><a href="#cb65-954" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> </span>
<span id="cb65-955"><a href="#cb65-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-956"><a href="#cb65-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb65-957"><a href="#cb65-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-958"><a href="#cb65-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-959"><a href="#cb65-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-960"><a href="#cb65-960" aria-hidden="true" tabindex="-1"></a>Fitted values:</span>
<span id="cb65-961"><a href="#cb65-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-964"><a href="#cb65-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-965"><a href="#cb65-965" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted.values</span>(beetles_glm_grouped)</span>
<span id="cb65-966"><a href="#cb65-966" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb65-967"><a href="#cb65-967" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"link"</span>)</span>
<span id="cb65-968"><a href="#cb65-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-969"><a href="#cb65-969" aria-hidden="true" tabindex="-1"></a>fit_y <span class="ot">=</span> beetles<span class="sc">$</span>n <span class="sc">*</span> <span class="fu">fitted.values</span>(beetles_glm_grouped)</span>
<span id="cb65-970"><a href="#cb65-970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-971"><a href="#cb65-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-972"><a href="#cb65-972" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual observations</span></span>
<span id="cb65-973"><a href="#cb65-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-976"><a href="#cb65-976" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-977"><a href="#cb65-977" aria-hidden="true" tabindex="-1"></a>beetles_long <span class="ot">=</span> </span>
<span id="cb65-978"><a href="#cb65-978" aria-hidden="true" tabindex="-1"></a>  beetles  <span class="sc">|&gt;</span> </span>
<span id="cb65-979"><a href="#cb65-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb65-980"><a href="#cb65-980" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb65-981"><a href="#cb65-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb65-982"><a href="#cb65-982" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died), </span>
<span id="cb65-983"><a href="#cb65-983" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived))</span>
<span id="cb65-984"><a href="#cb65-984" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-985"><a href="#cb65-985" aria-hidden="true" tabindex="-1"></a>beetles_long <span class="sc">|&gt;</span> <span class="fu">tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-986"><a href="#cb65-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-987"><a href="#cb65-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-988"><a href="#cb65-988" aria-hidden="true" tabindex="-1"></a>Here's the model with individual data</span>
<span id="cb65-989"><a href="#cb65-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-992"><a href="#cb65-992" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-993"><a href="#cb65-993" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="ot">=</span> </span>
<span id="cb65-994"><a href="#cb65-994" aria-hidden="true" tabindex="-1"></a>  beetles_long <span class="sc">|&gt;</span> </span>
<span id="cb65-995"><a href="#cb65-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb65-996"><a href="#cb65-996" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> dose, </span>
<span id="cb65-997"><a href="#cb65-997" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb65-998"><a href="#cb65-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-999"><a href="#cb65-999" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb65-1000"><a href="#cb65-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1001"><a href="#cb65-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1002"><a href="#cb65-1002" aria-hidden="true" tabindex="-1"></a>Here's the previous version again:</span>
<span id="cb65-1003"><a href="#cb65-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1006"><a href="#cb65-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1007"><a href="#cb65-1007" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb65-1008"><a href="#cb65-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1009"><a href="#cb65-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1010"><a href="#cb65-1010" aria-hidden="true" tabindex="-1"></a>They seem the same! But not quite:</span>
<span id="cb65-1011"><a href="#cb65-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1014"><a href="#cb65-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1015"><a href="#cb65-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_grouped)</span>
<span id="cb65-1016"><a href="#cb65-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_ungrouped)</span>
<span id="cb65-1017"><a href="#cb65-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1018"><a href="#cb65-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1019"><a href="#cb65-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1020"><a href="#cb65-1020" aria-hidden="true" tabindex="-1"></a>The difference is due to the binomial coefficient</span>
<span id="cb65-1021"><a href="#cb65-1021" aria-hidden="true" tabindex="-1"></a>$\left(n\atop x \right)$ which isn't included in the</span>
<span id="cb65-1022"><a href="#cb65-1022" aria-hidden="true" tabindex="-1"></a>individual-observations (Bernoulli) version of the model.</span>
<span id="cb65-1023"><a href="#cb65-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1024"><a href="#cb65-1024" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple logistic regression</span></span>
<span id="cb65-1025"><a href="#cb65-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1026"><a href="#cb65-1026" aria-hidden="true" tabindex="-1"></a><span class="fu">### Coronary heart disease (WCGS) study data</span></span>
<span id="cb65-1027"><a href="#cb65-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1028"><a href="#cb65-1028" aria-hidden="true" tabindex="-1"></a>Let's use the data from the following study to explore multiple logistic</span>
<span id="cb65-1029"><a href="#cb65-1029" aria-hidden="true" tabindex="-1"></a>regression:</span>
<span id="cb65-1030"><a href="#cb65-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1031"><a href="#cb65-1031" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summary of study</span></span>
<span id="cb65-1032"><a href="#cb65-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1033"><a href="#cb65-1033" aria-hidden="true" tabindex="-1"></a>*From @vittinghoff2012regression:*</span>
<span id="cb65-1034"><a href="#cb65-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1035"><a href="#cb65-1035" aria-hidden="true" tabindex="-1"></a>"The **Western Collaborative Group Study (WCGS)** was a large</span>
<span id="cb65-1036"><a href="#cb65-1036" aria-hidden="true" tabindex="-1"></a>epidemiological study designed to investigate the association between</span>
<span id="cb65-1037"><a href="#cb65-1037" aria-hidden="true" tabindex="-1"></a>the"type A" behavior pattern and coronary heart disease (CHD) (Rosenman</span>
<span id="cb65-1038"><a href="#cb65-1038" aria-hidden="true" tabindex="-1"></a>et al. 1964)."</span>
<span id="cb65-1039"><a href="#cb65-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1040"><a href="#cb65-1040" aria-hidden="true" tabindex="-1"></a>*From Wikipedia, "Type A and Type B personality theory":*</span>
<span id="cb65-1041"><a href="#cb65-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1042"><a href="#cb65-1042" aria-hidden="true" tabindex="-1"></a>"The hypothesis describes Type A individuals as outgoing, ambitious,</span>
<span id="cb65-1043"><a href="#cb65-1043" aria-hidden="true" tabindex="-1"></a>rigidly organized, highly status-conscious, impatient, anxious,</span>
<span id="cb65-1044"><a href="#cb65-1044" aria-hidden="true" tabindex="-1"></a>proactive, and concerned with time management....</span>
<span id="cb65-1045"><a href="#cb65-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1046"><a href="#cb65-1046" aria-hidden="true" tabindex="-1"></a>The hypothesis describes Type B individuals as a contrast to those of</span>
<span id="cb65-1047"><a href="#cb65-1047" aria-hidden="true" tabindex="-1"></a>Type A. Type B personalities, by definition, are noted to live at lower</span>
<span id="cb65-1048"><a href="#cb65-1048" aria-hidden="true" tabindex="-1"></a>stress levels. They typically work steadily and may enjoy achievement,</span>
<span id="cb65-1049"><a href="#cb65-1049" aria-hidden="true" tabindex="-1"></a>although they have a greater tendency to disregard physical or mental</span>
<span id="cb65-1050"><a href="#cb65-1050" aria-hidden="true" tabindex="-1"></a>stress when they do not achieve."</span>
<span id="cb65-1051"><a href="#cb65-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1052"><a href="#cb65-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Study design</span></span>
<span id="cb65-1053"><a href="#cb65-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1054"><a href="#cb65-1054" aria-hidden="true" tabindex="-1"></a>*from `?faraway::wcgs`:*</span>
<span id="cb65-1055"><a href="#cb65-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1056"><a href="#cb65-1056" aria-hidden="true" tabindex="-1"></a>3154 healthy young men aged 39-59 from the San Francisco area were</span>
<span id="cb65-1057"><a href="#cb65-1057" aria-hidden="true" tabindex="-1"></a>assessed for their personality type. All were free from coronary heart</span>
<span id="cb65-1058"><a href="#cb65-1058" aria-hidden="true" tabindex="-1"></a>disease at the start of the research. Eight and a half years later</span>
<span id="cb65-1059"><a href="#cb65-1059" aria-hidden="true" tabindex="-1"></a>change in CHD status was recorded.</span>
<span id="cb65-1060"><a href="#cb65-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1061"><a href="#cb65-1061" aria-hidden="true" tabindex="-1"></a>*Details (from `faraway::wcgs`)*</span>
<span id="cb65-1062"><a href="#cb65-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1063"><a href="#cb65-1063" aria-hidden="true" tabindex="-1"></a>The WCGS began in 1960 with 3,524 male volunteers who were employed by</span>
<span id="cb65-1064"><a href="#cb65-1064" aria-hidden="true" tabindex="-1"></a>11 California companies. Subjects were 39 to 59 years old and free of</span>
<span id="cb65-1065"><a href="#cb65-1065" aria-hidden="true" tabindex="-1"></a>heart disease as determined by electrocardiogram. After the initial</span>
<span id="cb65-1066"><a href="#cb65-1066" aria-hidden="true" tabindex="-1"></a>screening, the study population dropped to 3,154 and the number of</span>
<span id="cb65-1067"><a href="#cb65-1067" aria-hidden="true" tabindex="-1"></a>companies to 10 because of various exclusions. The cohort comprised both</span>
<span id="cb65-1068"><a href="#cb65-1068" aria-hidden="true" tabindex="-1"></a>blue- and white-collar employees.</span>
<span id="cb65-1069"><a href="#cb65-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1070"><a href="#cb65-1070" aria-hidden="true" tabindex="-1"></a>At baseline the following information was collected:</span>
<span id="cb65-1071"><a href="#cb65-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1072"><a href="#cb65-1072" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>socio-demographic including:</span>
<span id="cb65-1073"><a href="#cb65-1073" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>age</span>
<span id="cb65-1074"><a href="#cb65-1074" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>education</span>
<span id="cb65-1075"><a href="#cb65-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>marital status</span>
<span id="cb65-1076"><a href="#cb65-1076" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>income</span>
<span id="cb65-1077"><a href="#cb65-1077" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>occupation</span>
<span id="cb65-1078"><a href="#cb65-1078" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>physical and physiological including:</span>
<span id="cb65-1079"><a href="#cb65-1079" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>height</span>
<span id="cb65-1080"><a href="#cb65-1080" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>weight</span>
<span id="cb65-1081"><a href="#cb65-1081" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>blood pressure</span>
<span id="cb65-1082"><a href="#cb65-1082" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>electrocardiogram</span>
<span id="cb65-1083"><a href="#cb65-1083" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>corneal arcus;</span>
<span id="cb65-1084"><a href="#cb65-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>biochemical including:</span>
<span id="cb65-1085"><a href="#cb65-1085" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>cholesterol and lipoprotein fractions;</span>
<span id="cb65-1086"><a href="#cb65-1086" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>medical and family history and use of medications;</span>
<span id="cb65-1087"><a href="#cb65-1087" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>behavioral data including</span>
<span id="cb65-1088"><a href="#cb65-1088" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Type A interview,</span>
<span id="cb65-1089"><a href="#cb65-1089" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>smoking,</span>
<span id="cb65-1090"><a href="#cb65-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>exercise</span>
<span id="cb65-1091"><a href="#cb65-1091" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>alcohol use.</span>
<span id="cb65-1092"><a href="#cb65-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1093"><a href="#cb65-1093" aria-hidden="true" tabindex="-1"></a>Later surveys added data on: </span>
<span id="cb65-1094"><a href="#cb65-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1095"><a href="#cb65-1095" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>anthropometry </span>
<span id="cb65-1096"><a href="#cb65-1096" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>triglycerides </span>
<span id="cb65-1097"><a href="#cb65-1097" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Jenkins Activity Survey </span>
<span id="cb65-1098"><a href="#cb65-1098" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>caffeine use</span>
<span id="cb65-1099"><a href="#cb65-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1100"><a href="#cb65-1100" aria-hidden="true" tabindex="-1"></a>Average follow-up continued for 8.5 years with repeat examinations.</span>
<span id="cb65-1101"><a href="#cb65-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1102"><a href="#cb65-1102" aria-hidden="true" tabindex="-1"></a>Reference: Coronary Heart Disease in the Western Collaborative Group</span>
<span id="cb65-1103"><a href="#cb65-1103" aria-hidden="true" tabindex="-1"></a>Study Final Follow-up Experience of 8 1/2 Years Ray H. Rosenman, MD;</span>
<span id="cb65-1104"><a href="#cb65-1104" aria-hidden="true" tabindex="-1"></a>Richard J. Brand, PhD; C. David Jenkins, PhD; Meyer Friedman, MD; Reuben</span>
<span id="cb65-1105"><a href="#cb65-1105" aria-hidden="true" tabindex="-1"></a>Straus, MD; Moses Wurm, MD JAMA. 1975;233(8):872-877.</span>
<span id="cb65-1106"><a href="#cb65-1106" aria-hidden="true" tabindex="-1"></a>doi:10.1001/jama.1975.03260080034016.</span>
<span id="cb65-1107"><a href="#cb65-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1108"><a href="#cb65-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load the data</span></span>
<span id="cb65-1109"><a href="#cb65-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1110"><a href="#cb65-1110" aria-hidden="true" tabindex="-1"></a>Here, I load the data:</span>
<span id="cb65-1111"><a href="#cb65-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1114"><a href="#cb65-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1115"><a href="#cb65-1115" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-1116"><a href="#cb65-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1117"><a href="#cb65-1117" aria-hidden="true" tabindex="-1"></a><span class="do">### load the data directly from a UCSF website:</span></span>
<span id="cb65-1118"><a href="#cb65-1118" aria-hidden="true" tabindex="-1"></a><span class="co"># library(haven)</span></span>
<span id="cb65-1119"><a href="#cb65-1119" aria-hidden="true" tabindex="-1"></a><span class="co"># url = paste0( </span></span>
<span id="cb65-1120"><a href="#cb65-1120" aria-hidden="true" tabindex="-1"></a><span class="co">#     # I'm breaking up the url into two chunks for readability</span></span>
<span id="cb65-1121"><a href="#cb65-1121" aria-hidden="true" tabindex="-1"></a><span class="co">#     "https://regression.ucsf.edu/sites/g/files/",</span></span>
<span id="cb65-1122"><a href="#cb65-1122" aria-hidden="true" tabindex="-1"></a><span class="co">#     "tkssra6706/f/wysiwyg/home/data/wcgs.dta")</span></span>
<span id="cb65-1123"><a href="#cb65-1123" aria-hidden="true" tabindex="-1"></a><span class="co"># wcgs = haven::read_dta(url)</span></span>
<span id="cb65-1124"><a href="#cb65-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1125"><a href="#cb65-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1126"><a href="#cb65-1126" aria-hidden="true" tabindex="-1"></a><span class="co"># I presaved the data in my project's `data` folder</span></span>
<span id="cb65-1127"><a href="#cb65-1127" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># provides the `here()` function</span></span>
<span id="cb65-1128"><a href="#cb65-1128" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs) <span class="co"># provides the `path()` function</span></span>
<span id="cb65-1129"><a href="#cb65-1129" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">here</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-1130"><a href="#cb65-1130" aria-hidden="true" tabindex="-1"></a>  fs<span class="sc">::</span><span class="fu">path</span>(<span class="st">'data/wcgs.rda'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-1131"><a href="#cb65-1131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>()</span>
<span id="cb65-1132"><a href="#cb65-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1133"><a href="#cb65-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1134"><a href="#cb65-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1135"><a href="#cb65-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">### Now let's do some data cleaning</span></span>
<span id="cb65-1136"><a href="#cb65-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1139"><a href="#cb65-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1140"><a href="#cb65-1140" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-1141"><a href="#cb65-1141" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arsenal) <span class="co"># provides `set_labels()`</span></span>
<span id="cb65-1142"><a href="#cb65-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1143"><a href="#cb65-1143" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">=</span> wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1144"><a href="#cb65-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-1145"><a href="#cb65-1145" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> age <span class="sc">|&gt;</span> </span>
<span id="cb65-1146"><a href="#cb65-1146" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Age (years)"</span>),</span>
<span id="cb65-1147"><a href="#cb65-1147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-1148"><a href="#cb65-1148" aria-hidden="true" tabindex="-1"></a>    <span class="at">arcus =</span> </span>
<span id="cb65-1149"><a href="#cb65-1149" aria-hidden="true" tabindex="-1"></a>      arcus <span class="sc">|&gt;</span> </span>
<span id="cb65-1150"><a href="#cb65-1150" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.logical</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-1151"><a href="#cb65-1151" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Arcus Senilis"</span>),</span>
<span id="cb65-1152"><a href="#cb65-1152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-1153"><a href="#cb65-1153" aria-hidden="true" tabindex="-1"></a>    <span class="at">time169 =</span> </span>
<span id="cb65-1154"><a href="#cb65-1154" aria-hidden="true" tabindex="-1"></a>      time169 <span class="sc">|&gt;</span> </span>
<span id="cb65-1155"><a href="#cb65-1155" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-1156"><a href="#cb65-1156" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Observation (follow up) time (days)"</span>),</span>
<span id="cb65-1157"><a href="#cb65-1157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-1158"><a href="#cb65-1158" aria-hidden="true" tabindex="-1"></a>    <span class="at">dibpat =</span></span>
<span id="cb65-1159"><a href="#cb65-1159" aria-hidden="true" tabindex="-1"></a>      dibpat <span class="sc">|&gt;</span> </span>
<span id="cb65-1160"><a href="#cb65-1160" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_factor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-1161"><a href="#cb65-1161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">relevel</span>(<span class="at">ref =</span> <span class="st">"Type A"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-1162"><a href="#cb65-1162" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Behavioral Pattern"</span>),</span>
<span id="cb65-1163"><a href="#cb65-1163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-1164"><a href="#cb65-1164" aria-hidden="true" tabindex="-1"></a>    <span class="at">typchd69 =</span> typchd69 <span class="sc">|&gt;</span> </span>
<span id="cb65-1165"><a href="#cb65-1165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(</span>
<span id="cb65-1166"><a href="#cb65-1166" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Type of CHD Event"</span>,</span>
<span id="cb65-1167"><a href="#cb65-1167" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> </span>
<span id="cb65-1168"><a href="#cb65-1168" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb65-1169"><a href="#cb65-1169" aria-hidden="true" tabindex="-1"></a>            <span class="st">"None"</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb65-1170"><a href="#cb65-1170" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infdeath"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb65-1171"><a href="#cb65-1171" aria-hidden="true" tabindex="-1"></a>            <span class="st">"silent"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb65-1172"><a href="#cb65-1172" aria-hidden="true" tabindex="-1"></a>            <span class="st">"angina"</span> <span class="ot">=</span> <span class="dv">3</span>)),</span>
<span id="cb65-1173"><a href="#cb65-1173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-1174"><a href="#cb65-1174" aria-hidden="true" tabindex="-1"></a>    <span class="co"># turn stata-style labelled variables in to R-style factors:</span></span>
<span id="cb65-1175"><a href="#cb65-1175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb65-1176"><a href="#cb65-1176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">where</span>(is.labelled), </span>
<span id="cb65-1177"><a href="#cb65-1177" aria-hidden="true" tabindex="-1"></a>      haven<span class="sc">::</span>as_factor)</span>
<span id="cb65-1178"><a href="#cb65-1178" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1179"><a href="#cb65-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1180"><a href="#cb65-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1181"><a href="#cb65-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1182"><a href="#cb65-1182" aria-hidden="true" tabindex="-1"></a><span class="fu">### What's in the data {.smaller}</span></span>
<span id="cb65-1183"><a href="#cb65-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1184"><a href="#cb65-1184" aria-hidden="true" tabindex="-1"></a>Here's a table of the data:</span>
<span id="cb65-1185"><a href="#cb65-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1186"><a href="#cb65-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results = "asis"}</span></span>
<span id="cb65-1187"><a href="#cb65-1187" aria-hidden="true" tabindex="-1"></a><span class="in">wcgs |&gt;</span></span>
<span id="cb65-1188"><a href="#cb65-1188" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-c(id, uni, t1)) |&gt;</span></span>
<span id="cb65-1189"><a href="#cb65-1189" aria-hidden="true" tabindex="-1"></a><span class="in">  tableby(chd69 ~ ., data = _) |&gt;</span></span>
<span id="cb65-1190"><a href="#cb65-1190" aria-hidden="true" tabindex="-1"></a><span class="in">  summary(</span></span>
<span id="cb65-1191"><a href="#cb65-1191" aria-hidden="true" tabindex="-1"></a><span class="in">    pfootnote = TRUE,</span></span>
<span id="cb65-1192"><a href="#cb65-1192" aria-hidden="true" tabindex="-1"></a><span class="in">    title =</span></span>
<span id="cb65-1193"><a href="#cb65-1193" aria-hidden="true" tabindex="-1"></a><span class="in">      "Baseline characteristics by CHD status at end of follow-up")</span></span>
<span id="cb65-1194"><a href="#cb65-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1195"><a href="#cb65-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1196"><a href="#cb65-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1197"><a href="#cb65-1197" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data by age and personality type</span></span>
<span id="cb65-1198"><a href="#cb65-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1199"><a href="#cb65-1199" aria-hidden="true" tabindex="-1"></a>For now, we will look at the interaction between age and personality</span>
<span id="cb65-1200"><a href="#cb65-1200" aria-hidden="true" tabindex="-1"></a>type (<span class="in">`dibpat`</span>). To make it easier to visualize the data, we summarize</span>
<span id="cb65-1201"><a href="#cb65-1201" aria-hidden="true" tabindex="-1"></a>the event rates for each combination of age:</span>
<span id="cb65-1202"><a href="#cb65-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1205"><a href="#cb65-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1206"><a href="#cb65-1206" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "event rates by age"</span></span>
<span id="cb65-1207"><a href="#cb65-1207" aria-hidden="true" tabindex="-1"></a>chd_grouped_data <span class="ot">=</span> </span>
<span id="cb65-1208"><a href="#cb65-1208" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1209"><a href="#cb65-1209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-1210"><a href="#cb65-1210" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(age, dibpat),</span>
<span id="cb65-1211"><a href="#cb65-1211" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb65-1212"><a href="#cb65-1212" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-1213"><a href="#cb65-1213" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(<span class="at">label =</span> <span class="st">"CHD Event by 1969"</span>),</span>
<span id="cb65-1214"><a href="#cb65-1214" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span>),</span>
<span id="cb65-1215"><a href="#cb65-1215" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">logit(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span>)</span>
<span id="cb65-1216"><a href="#cb65-1216" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1217"><a href="#cb65-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1218"><a href="#cb65-1218" aria-hidden="true" tabindex="-1"></a>chd_grouped_data</span>
<span id="cb65-1219"><a href="#cb65-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1220"><a href="#cb65-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1221"><a href="#cb65-1221" aria-hidden="true" tabindex="-1"></a><span class="fu">### Graphical exploration</span></span>
<span id="cb65-1222"><a href="#cb65-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1223"><a href="#cb65-1223" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Probability scale</span></span>
<span id="cb65-1224"><a href="#cb65-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1225"><a href="#cb65-1225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r "graphical exploration"}</span></span>
<span id="cb65-1226"><a href="#cb65-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1227"><a href="#cb65-1227" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb65-1228"><a href="#cb65-1228" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggeasy)</span></span>
<span id="cb65-1229"><a href="#cb65-1229" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb65-1230"><a href="#cb65-1230" aria-hidden="true" tabindex="-1"></a><span class="in">chd_plot_probs = </span></span>
<span id="cb65-1231"><a href="#cb65-1231" aria-hidden="true" tabindex="-1"></a><span class="in">  chd_grouped_data |&gt; </span></span>
<span id="cb65-1232"><a href="#cb65-1232" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(</span></span>
<span id="cb65-1233"><a href="#cb65-1233" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(</span></span>
<span id="cb65-1234"><a href="#cb65-1234" aria-hidden="true" tabindex="-1"></a><span class="in">      x = age, </span></span>
<span id="cb65-1235"><a href="#cb65-1235" aria-hidden="true" tabindex="-1"></a><span class="in">      y = `p(chd)`, </span></span>
<span id="cb65-1236"><a href="#cb65-1236" aria-hidden="true" tabindex="-1"></a><span class="in">      col = dibpat)</span></span>
<span id="cb65-1237"><a href="#cb65-1237" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb65-1238"><a href="#cb65-1238" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(size = n), alpha = .7) + </span></span>
<span id="cb65-1239"><a href="#cb65-1239" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_size(range = c(1,4)) +</span></span>
<span id="cb65-1240"><a href="#cb65-1240" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line() +</span></span>
<span id="cb65-1241"><a href="#cb65-1241" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb65-1242"><a href="#cb65-1242" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("P(CHD Event by 1969)") +</span></span>
<span id="cb65-1243"><a href="#cb65-1243" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb65-1244"><a href="#cb65-1244" aria-hidden="true" tabindex="-1"></a><span class="in">    labels = scales::label_percent(),</span></span>
<span id="cb65-1245"><a href="#cb65-1245" aria-hidden="true" tabindex="-1"></a><span class="in">    sec.axis = sec_axis(</span></span>
<span id="cb65-1246"><a href="#cb65-1246" aria-hidden="true" tabindex="-1"></a><span class="in">      ~ odds(.),</span></span>
<span id="cb65-1247"><a href="#cb65-1247" aria-hidden="true" tabindex="-1"></a><span class="in">      name = "odds(CHD Event by 1969)")) +</span></span>
<span id="cb65-1248"><a href="#cb65-1248" aria-hidden="true" tabindex="-1"></a><span class="in">  ggeasy::easy_labs() +</span></span>
<span id="cb65-1249"><a href="#cb65-1249" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb65-1250"><a href="#cb65-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1251"><a href="#cb65-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1252"><a href="#cb65-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1253"><a href="#cb65-1253" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1256"><a href="#cb65-1256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1257"><a href="#cb65-1257" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd-graph-prob-scale-interactive</span></span>
<span id="cb65-1258"><a href="#cb65-1258" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "CHD rates by age group, probability scale"</span></span>
<span id="cb65-1259"><a href="#cb65-1259" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_probs)</span>
<span id="cb65-1260"><a href="#cb65-1260" aria-hidden="true" tabindex="-1"></a><span class="co"># print(chd_plot_probs)</span></span>
<span id="cb65-1261"><a href="#cb65-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1262"><a href="#cb65-1262" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1263"><a href="#cb65-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1264"><a href="#cb65-1264" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1267"><a href="#cb65-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1268"><a href="#cb65-1268" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd-graph-prob-scale-static</span></span>
<span id="cb65-1269"><a href="#cb65-1269" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "CHD rates by age group, probability scale"</span></span>
<span id="cb65-1270"><a href="#cb65-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_probs)</span>
<span id="cb65-1271"><a href="#cb65-1271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1272"><a href="#cb65-1272" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1273"><a href="#cb65-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1274"><a href="#cb65-1274" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Odds scale</span></span>
<span id="cb65-1275"><a href="#cb65-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1278"><a href="#cb65-1278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1279"><a href="#cb65-1279" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd-odds-scale</span></span>
<span id="cb65-1280"><a href="#cb65-1280" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "CHD rates by age group, odds scale"</span></span>
<span id="cb65-1281"><a href="#cb65-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1282"><a href="#cb65-1282" aria-hidden="true" tabindex="-1"></a>trans_odds <span class="ot">=</span> <span class="fu">trans_new</span>(</span>
<span id="cb65-1283"><a href="#cb65-1283" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"odds"</span>, </span>
<span id="cb65-1284"><a href="#cb65-1284" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> odds, </span>
<span id="cb65-1285"><a href="#cb65-1285" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> odds_inv)</span>
<span id="cb65-1286"><a href="#cb65-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1287"><a href="#cb65-1287" aria-hidden="true" tabindex="-1"></a>chd_plot_probs <span class="sc">+</span> </span>
<span id="cb65-1288"><a href="#cb65-1288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb65-1289"><a href="#cb65-1289" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> trans_odds, </span>
<span id="cb65-1290"><a href="#cb65-1290" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">paste</span>(chd_plot_probs<span class="sc">$</span>labels<span class="sc">$</span>y, <span class="st">"(odds spacing)"</span>),</span>
<span id="cb65-1291"><a href="#cb65-1291" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb65-1292"><a href="#cb65-1292" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">odds</span>(.),</span>
<span id="cb65-1293"><a href="#cb65-1293" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"odds(CHD Event by 1969)"</span>))</span>
<span id="cb65-1294"><a href="#cb65-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1295"><a href="#cb65-1295" aria-hidden="true" tabindex="-1"></a>chd_plot_odds <span class="ot">=</span> </span>
<span id="cb65-1296"><a href="#cb65-1296" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span> </span>
<span id="cb65-1297"><a href="#cb65-1297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb65-1298"><a href="#cb65-1298" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb65-1299"><a href="#cb65-1299" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> age, </span>
<span id="cb65-1300"><a href="#cb65-1300" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span>, </span>
<span id="cb65-1301"><a href="#cb65-1301" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> dibpat)</span>
<span id="cb65-1302"><a href="#cb65-1302" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-1303"><a href="#cb65-1303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb65-1304"><a href="#cb65-1304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb65-1305"><a href="#cb65-1305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb65-1306"><a href="#cb65-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb65-1307"><a href="#cb65-1307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"odds(CHD Event by 1969)"</span>) <span class="sc">+</span></span>
<span id="cb65-1308"><a href="#cb65-1308" aria-hidden="true" tabindex="-1"></a>  ggeasy<span class="sc">::</span><span class="fu">easy_labs</span>()</span>
<span id="cb65-1309"><a href="#cb65-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1310"><a href="#cb65-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1311"><a href="#cb65-1311" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1314"><a href="#cb65-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1315"><a href="#cb65-1315" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_odds)</span>
<span id="cb65-1316"><a href="#cb65-1316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1317"><a href="#cb65-1317" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1318"><a href="#cb65-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1319"><a href="#cb65-1319" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1322"><a href="#cb65-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1323"><a href="#cb65-1323" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_odds)</span>
<span id="cb65-1324"><a href="#cb65-1324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1325"><a href="#cb65-1325" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1326"><a href="#cb65-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1327"><a href="#cb65-1327" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Log-odds (logit) scale</span></span>
<span id="cb65-1328"><a href="#cb65-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1331"><a href="#cb65-1331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1332"><a href="#cb65-1332" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd_plot_logit</span></span>
<span id="cb65-1333"><a href="#cb65-1333" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "CHD data (logit-scale)"</span></span>
<span id="cb65-1334"><a href="#cb65-1334" aria-hidden="true" tabindex="-1"></a>chd_plot_logit <span class="ot">=</span> </span>
<span id="cb65-1335"><a href="#cb65-1335" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span> </span>
<span id="cb65-1336"><a href="#cb65-1336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb65-1337"><a href="#cb65-1337" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb65-1338"><a href="#cb65-1338" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> age, </span>
<span id="cb65-1339"><a href="#cb65-1339" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">logit(chd)</span><span class="st">`</span>, </span>
<span id="cb65-1340"><a href="#cb65-1340" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> dibpat)</span>
<span id="cb65-1341"><a href="#cb65-1341" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-1342"><a href="#cb65-1342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb65-1343"><a href="#cb65-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb65-1344"><a href="#cb65-1344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb65-1345"><a href="#cb65-1345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb65-1346"><a href="#cb65-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"log{odds(CHD Event by 1969)}"</span>) <span class="sc">+</span></span>
<span id="cb65-1347"><a href="#cb65-1347" aria-hidden="true" tabindex="-1"></a>  ggeasy<span class="sc">::</span><span class="fu">easy_labs</span>()</span>
<span id="cb65-1348"><a href="#cb65-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1349"><a href="#cb65-1349" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_logit)</span>
<span id="cb65-1350"><a href="#cb65-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1351"><a href="#cb65-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1352"><a href="#cb65-1352" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression models for CHD data {.smaller}</span></span>
<span id="cb65-1353"><a href="#cb65-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1354"><a href="#cb65-1354" aria-hidden="true" tabindex="-1"></a>Here, we fit stratified models for CHD by personality type.</span>
<span id="cb65-1355"><a href="#cb65-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1358"><a href="#cb65-1358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1359"><a href="#cb65-1359" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb65-1360"><a href="#cb65-1360" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb65-1361"><a href="#cb65-1361" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs,</span>
<span id="cb65-1362"><a href="#cb65-1362" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb65-1363"><a href="#cb65-1363" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-1364"><a href="#cb65-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1365"><a href="#cb65-1365" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb65-1366"><a href="#cb65-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1367"><a href="#cb65-1367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1368"><a href="#cb65-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1369"><a href="#cb65-1369" aria-hidden="true" tabindex="-1"></a>We can get the corresponding odds ratios ($e^{\beta}$s) by passing</span>
<span id="cb65-1370"><a href="#cb65-1370" aria-hidden="true" tabindex="-1"></a><span class="in">`exponentiate = TRUE`</span> to <span class="in">`parameters()`</span>:</span>
<span id="cb65-1371"><a href="#cb65-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1374"><a href="#cb65-1374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1375"><a href="#cb65-1375" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Odds ratio estimates for CHD model"</span></span>
<span id="cb65-1376"><a href="#cb65-1376" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-chd-glm-strat-OR</span></span>
<span id="cb65-1377"><a href="#cb65-1377" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span> </span>
<span id="cb65-1378"><a href="#cb65-1378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-1379"><a href="#cb65-1379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb65-1380"><a href="#cb65-1380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1381"><a href="#cb65-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1382"><a href="#cb65-1382" aria-hidden="true" tabindex="-1"></a><span class="fu">### Models superimposed on data</span></span>
<span id="cb65-1383"><a href="#cb65-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1384"><a href="#cb65-1384" aria-hidden="true" tabindex="-1"></a>We can graph our fitted models on each scale (probability, odds,</span>
<span id="cb65-1385"><a href="#cb65-1385" aria-hidden="true" tabindex="-1"></a>log-odds).</span>
<span id="cb65-1386"><a href="#cb65-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1387"><a href="#cb65-1387" aria-hidden="true" tabindex="-1"></a><span class="fu">#### probability scale</span></span>
<span id="cb65-1388"><a href="#cb65-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1391"><a href="#cb65-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1392"><a href="#cb65-1392" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb65-1393"><a href="#cb65-1393" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-1394"><a href="#cb65-1394" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb65-1395"><a href="#cb65-1395" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb65-1396"><a href="#cb65-1396" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>))</span>
<span id="cb65-1397"><a href="#cb65-1397" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-1398"><a href="#cb65-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1399"><a href="#cb65-1399" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb65-1400"><a href="#cb65-1400" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-1401"><a href="#cb65-1401" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb65-1402"><a href="#cb65-1402" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb65-1403"><a href="#cb65-1403" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>))</span>
<span id="cb65-1404"><a href="#cb65-1404" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-1405"><a href="#cb65-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1406"><a href="#cb65-1406" aria-hidden="true" tabindex="-1"></a>chd_plot_probs_2 <span class="ot">=</span></span>
<span id="cb65-1407"><a href="#cb65-1407" aria-hidden="true" tabindex="-1"></a>  chd_plot_probs <span class="sc">+</span></span>
<span id="cb65-1408"><a href="#cb65-1408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb65-1409"><a href="#cb65-1409" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb65-1410"><a href="#cb65-1410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb65-1411"><a href="#cb65-1411" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-1412"><a href="#cb65-1412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb65-1413"><a href="#cb65-1413" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb65-1414"><a href="#cb65-1414" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb65-1415"><a href="#cb65-1415" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1416"><a href="#cb65-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1417"><a href="#cb65-1417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1418"><a href="#cb65-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1419"><a href="#cb65-1419" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1422"><a href="#cb65-1422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1423"><a href="#cb65-1423" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_probs_2)</span>
<span id="cb65-1424"><a href="#cb65-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1425"><a href="#cb65-1425" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1426"><a href="#cb65-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1427"><a href="#cb65-1427" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1430"><a href="#cb65-1430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1431"><a href="#cb65-1431" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_probs_2)</span>
<span id="cb65-1432"><a href="#cb65-1432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1433"><a href="#cb65-1433" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1434"><a href="#cb65-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1435"><a href="#cb65-1435" aria-hidden="true" tabindex="-1"></a><span class="fu">#### odds scale</span></span>
<span id="cb65-1436"><a href="#cb65-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1439"><a href="#cb65-1439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1440"><a href="#cb65-1440" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb65-1441"><a href="#cb65-1441" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-1442"><a href="#cb65-1442" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb65-1443"><a href="#cb65-1443" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb65-1444"><a href="#cb65-1444" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>)) <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb65-1445"><a href="#cb65-1445" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-1446"><a href="#cb65-1446" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb65-1447"><a href="#cb65-1447" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-1448"><a href="#cb65-1448" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb65-1449"><a href="#cb65-1449" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb65-1450"><a href="#cb65-1450" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>)) <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb65-1451"><a href="#cb65-1451" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-1452"><a href="#cb65-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1453"><a href="#cb65-1453" aria-hidden="true" tabindex="-1"></a>chd_plot_odds_2 <span class="ot">=</span></span>
<span id="cb65-1454"><a href="#cb65-1454" aria-hidden="true" tabindex="-1"></a>  chd_plot_odds <span class="sc">+</span></span>
<span id="cb65-1455"><a href="#cb65-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb65-1456"><a href="#cb65-1456" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb65-1457"><a href="#cb65-1457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb65-1458"><a href="#cb65-1458" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-1459"><a href="#cb65-1459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb65-1460"><a href="#cb65-1460" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb65-1461"><a href="#cb65-1461" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb65-1462"><a href="#cb65-1462" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1463"><a href="#cb65-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1464"><a href="#cb65-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1465"><a href="#cb65-1465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1466"><a href="#cb65-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1467"><a href="#cb65-1467" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1470"><a href="#cb65-1470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1471"><a href="#cb65-1471" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_odds_2)</span>
<span id="cb65-1472"><a href="#cb65-1472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1473"><a href="#cb65-1473" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1474"><a href="#cb65-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1475"><a href="#cb65-1475" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1478"><a href="#cb65-1478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1479"><a href="#cb65-1479" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_odds_2)</span>
<span id="cb65-1480"><a href="#cb65-1480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1481"><a href="#cb65-1481" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1482"><a href="#cb65-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1483"><a href="#cb65-1483" aria-hidden="true" tabindex="-1"></a><span class="fu">#### log-odds (logit) scale</span></span>
<span id="cb65-1484"><a href="#cb65-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1487"><a href="#cb65-1487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1488"><a href="#cb65-1488" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb65-1489"><a href="#cb65-1489" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-1490"><a href="#cb65-1490" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb65-1491"><a href="#cb65-1491" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb65-1492"><a href="#cb65-1492" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>))</span>
<span id="cb65-1493"><a href="#cb65-1493" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-1494"><a href="#cb65-1494" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">=</span> <span class="cf">function</span>(x) </span>
<span id="cb65-1495"><a href="#cb65-1495" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-1496"><a href="#cb65-1496" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb65-1497"><a href="#cb65-1497" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"link"</span>,</span>
<span id="cb65-1498"><a href="#cb65-1498" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>))</span>
<span id="cb65-1499"><a href="#cb65-1499" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-1500"><a href="#cb65-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1501"><a href="#cb65-1501" aria-hidden="true" tabindex="-1"></a>chd_plot_logit_2 <span class="ot">=</span></span>
<span id="cb65-1502"><a href="#cb65-1502" aria-hidden="true" tabindex="-1"></a>  chd_plot_logit <span class="sc">+</span></span>
<span id="cb65-1503"><a href="#cb65-1503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb65-1504"><a href="#cb65-1504" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb65-1505"><a href="#cb65-1505" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb65-1506"><a href="#cb65-1506" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-1507"><a href="#cb65-1507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb65-1508"><a href="#cb65-1508" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb65-1509"><a href="#cb65-1509" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb65-1510"><a href="#cb65-1510" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1511"><a href="#cb65-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1512"><a href="#cb65-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1513"><a href="#cb65-1513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1514"><a href="#cb65-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1515"><a href="#cb65-1515" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1518"><a href="#cb65-1518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1519"><a href="#cb65-1519" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(chd_plot_logit_2)</span>
<span id="cb65-1520"><a href="#cb65-1520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1521"><a href="#cb65-1521" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1522"><a href="#cb65-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1523"><a href="#cb65-1523" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1526"><a href="#cb65-1526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1527"><a href="#cb65-1527" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_logit_2)</span>
<span id="cb65-1528"><a href="#cb65-1528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1529"><a href="#cb65-1529" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1530"><a href="#cb65-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1531"><a href="#cb65-1531" aria-hidden="true" tabindex="-1"></a><span class="fu">### reference-group and contrast parametrization</span></span>
<span id="cb65-1532"><a href="#cb65-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1533"><a href="#cb65-1533" aria-hidden="true" tabindex="-1"></a>We can also use the corner-point parametrization (with reference groups</span>
<span id="cb65-1534"><a href="#cb65-1534" aria-hidden="true" tabindex="-1"></a>and contrasts):</span>
<span id="cb65-1535"><a href="#cb65-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1538"><a href="#cb65-1538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1539"><a href="#cb65-1539" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="ot">=</span> </span>
<span id="cb65-1540"><a href="#cb65-1540" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1541"><a href="#cb65-1541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb65-1542"><a href="#cb65-1542" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb65-1543"><a href="#cb65-1543" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat<span class="sc">*</span>age, </span>
<span id="cb65-1544"><a href="#cb65-1544" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb65-1545"><a href="#cb65-1545" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1546"><a href="#cb65-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1547"><a href="#cb65-1547" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="sc">|&gt;</span> </span>
<span id="cb65-1548"><a href="#cb65-1548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-1549"><a href="#cb65-1549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb65-1550"><a href="#cb65-1550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1551"><a href="#cb65-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1552"><a href="#cb65-1552" aria-hidden="true" tabindex="-1"></a>Compare with what we had before:</span>
<span id="cb65-1553"><a href="#cb65-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1556"><a href="#cb65-1556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1557"><a href="#cb65-1557" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span> </span>
<span id="cb65-1558"><a href="#cb65-1558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-1559"><a href="#cb65-1559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb65-1560"><a href="#cb65-1560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1561"><a href="#cb65-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1562"><a href="#cb65-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1563"><a href="#cb65-1563" aria-hidden="true" tabindex="-1"></a>:::{#exr-strat-to-contrast}</span>
<span id="cb65-1564"><a href="#cb65-1564" aria-hidden="true" tabindex="-1"></a>If I give you model 1, how would you get the coefficients of model 2?</span>
<span id="cb65-1565"><a href="#cb65-1565" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1566"><a href="#cb65-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1567"><a href="#cb65-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting logistic regression models</span></span>
<span id="cb65-1568"><a href="#cb65-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1569"><a href="#cb65-1569" aria-hidden="true" tabindex="-1"></a><span class="fu">### </span></span>
<span id="cb65-1570"><a href="#cb65-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1571"><a href="#cb65-1571" aria-hidden="true" tabindex="-1"></a>In general, the estimating equation $\ell'(\beta; \mathbf x) = 0$ cannot</span>
<span id="cb65-1572"><a href="#cb65-1572" aria-hidden="true" tabindex="-1"></a>be solved analytically.</span>
<span id="cb65-1573"><a href="#cb65-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1574"><a href="#cb65-1574" aria-hidden="true" tabindex="-1"></a>Instead, we have to use a variant of the Newton-Raphson method, which</span>
<span id="cb65-1575"><a href="#cb65-1575" aria-hidden="true" tabindex="-1"></a>was discussed briefly in Epi 203. We won't go over it in this class; if</span>
<span id="cb65-1576"><a href="#cb65-1576" aria-hidden="true" tabindex="-1"></a>you need to learn it, see @dobson4e, Chapter 4.</span>
<span id="cb65-1577"><a href="#cb65-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1578"><a href="#cb65-1578" aria-hidden="true" tabindex="-1"></a>For now, all you need to know is that we make an iterative series of</span>
<span id="cb65-1579"><a href="#cb65-1579" aria-hidden="true" tabindex="-1"></a>guesses, and each guess helps us make the next guess better (higher</span>
<span id="cb65-1580"><a href="#cb65-1580" aria-hidden="true" tabindex="-1"></a>log-likelihood).</span>
<span id="cb65-1581"><a href="#cb65-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1582"><a href="#cb65-1582" aria-hidden="true" tabindex="-1"></a>You can see some information about this process like so:</span>
<span id="cb65-1583"><a href="#cb65-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1586"><a href="#cb65-1586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1587"><a href="#cb65-1587" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">8</span>)</span>
<span id="cb65-1588"><a href="#cb65-1588" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> </span>
<span id="cb65-1589"><a href="#cb65-1589" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1590"><a href="#cb65-1590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb65-1591"><a href="#cb65-1591" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">glm.control</span>(<span class="at">trace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-1592"><a href="#cb65-1592" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb65-1593"><a href="#cb65-1593" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat<span class="sc">*</span>age, </span>
<span id="cb65-1594"><a href="#cb65-1594" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb65-1595"><a href="#cb65-1595" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1596"><a href="#cb65-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1597"><a href="#cb65-1597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1598"><a href="#cb65-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1599"><a href="#cb65-1599" aria-hidden="true" tabindex="-1"></a>After each iteration of the fitting procedure, the deviance</span>
<span id="cb65-1600"><a href="#cb65-1600" aria-hidden="true" tabindex="-1"></a>($2(\ell_{\text{full}} - \ell(\hat\beta))$ ) is printed. You can see</span>
<span id="cb65-1601"><a href="#cb65-1601" aria-hidden="true" tabindex="-1"></a>that the algorithm took six iterations to converge to a solution where</span>
<span id="cb65-1602"><a href="#cb65-1602" aria-hidden="true" tabindex="-1"></a>the likelihood wasn't changing much anymore.</span>
<span id="cb65-1603"><a href="#cb65-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1604"><a href="#cb65-1604" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model comparisons for logistic models {#sec-gof}</span></span>
<span id="cb65-1605"><a href="#cb65-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1606"><a href="#cb65-1606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deviance test</span></span>
<span id="cb65-1607"><a href="#cb65-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1608"><a href="#cb65-1608" aria-hidden="true" tabindex="-1"></a>We can compare the maximized log-likelihood of our model,</span>
<span id="cb65-1609"><a href="#cb65-1609" aria-hidden="true" tabindex="-1"></a>$\ell(\hat\beta; \mathbf x)$, versus the log-likelihood of the full</span>
<span id="cb65-1610"><a href="#cb65-1610" aria-hidden="true" tabindex="-1"></a>model (aka saturated model aka maximal model), $\ell_{\text{full}}$,</span>
<span id="cb65-1611"><a href="#cb65-1611" aria-hidden="true" tabindex="-1"></a>which has one parameter per covariate pattern. With enough data,</span>
<span id="cb65-1612"><a href="#cb65-1612" aria-hidden="true" tabindex="-1"></a>$2(\ell_{\text{full}} - \ell(\hat\beta; \mathbf x)) \dot \sim \chi^2(N - p)$,</span>
<span id="cb65-1613"><a href="#cb65-1613" aria-hidden="true" tabindex="-1"></a>where $N$ is the number of distinct covariate patterns and $p$ is the</span>
<span id="cb65-1614"><a href="#cb65-1614" aria-hidden="true" tabindex="-1"></a>number of $\beta$ parameters in our model. A significant p-value for</span>
<span id="cb65-1615"><a href="#cb65-1615" aria-hidden="true" tabindex="-1"></a>this **deviance** statistic indicates that there's some detectable</span>
<span id="cb65-1616"><a href="#cb65-1616" aria-hidden="true" tabindex="-1"></a>pattern in the data that our model isn't flexible enough to catch.</span>
<span id="cb65-1617"><a href="#cb65-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1618"><a href="#cb65-1618" aria-hidden="true" tabindex="-1"></a>::: callout-caution</span>
<span id="cb65-1619"><a href="#cb65-1619" aria-hidden="true" tabindex="-1"></a>The deviance statistic needs to have a large amount of data **for each</span>
<span id="cb65-1620"><a href="#cb65-1620" aria-hidden="true" tabindex="-1"></a>covariate pattern** for the $\chi^2$ approximation to hold. A guideline</span>
<span id="cb65-1621"><a href="#cb65-1621" aria-hidden="true" tabindex="-1"></a>from Dobson is that if there are $q$ distinct covariate patterns</span>
<span id="cb65-1622"><a href="#cb65-1622" aria-hidden="true" tabindex="-1"></a>$x_1...,x_q$, with $n_1,...,n_q$ observations per pattern, then the</span>
<span id="cb65-1623"><a href="#cb65-1623" aria-hidden="true" tabindex="-1"></a>expected frequencies $n_k \cdot \pi(x_k)$ should be at least 1 for every</span>
<span id="cb65-1624"><a href="#cb65-1624" aria-hidden="true" tabindex="-1"></a>pattern $k\in 1:q$.</span>
<span id="cb65-1625"><a href="#cb65-1625" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1626"><a href="#cb65-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1627"><a href="#cb65-1627" aria-hidden="true" tabindex="-1"></a>If you have covariates measured on a continuous scale, you may not be</span>
<span id="cb65-1628"><a href="#cb65-1628" aria-hidden="true" tabindex="-1"></a>able to use the deviance tests to assess goodness of fit.</span>
<span id="cb65-1629"><a href="#cb65-1629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1630"><a href="#cb65-1630" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hosmer-Lemeshow test</span></span>
<span id="cb65-1631"><a href="#cb65-1631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1632"><a href="#cb65-1632" aria-hidden="true" tabindex="-1"></a>If our covariate patterns produce groups that are too small, a</span>
<span id="cb65-1633"><a href="#cb65-1633" aria-hidden="true" tabindex="-1"></a>reasonable solution is to make bigger groups by merging some of the</span>
<span id="cb65-1634"><a href="#cb65-1634" aria-hidden="true" tabindex="-1"></a>covariate-pattern groups together.</span>
<span id="cb65-1635"><a href="#cb65-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1636"><a href="#cb65-1636" aria-hidden="true" tabindex="-1"></a>Hosmer and Lemeshow (1980) proposed that we group the patterns by their</span>
<span id="cb65-1637"><a href="#cb65-1637" aria-hidden="true" tabindex="-1"></a>predicted probabilities according to the model of interest. For example,</span>
<span id="cb65-1638"><a href="#cb65-1638" aria-hidden="true" tabindex="-1"></a>you could group all of the observations with predicted probabilities of</span>
<span id="cb65-1639"><a href="#cb65-1639" aria-hidden="true" tabindex="-1"></a>10% or less together, then group the observations with 11%-20%</span>
<span id="cb65-1640"><a href="#cb65-1640" aria-hidden="true" tabindex="-1"></a>probability together, and so on; $g=10$ categories in all.</span>
<span id="cb65-1641"><a href="#cb65-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1642"><a href="#cb65-1642" aria-hidden="true" tabindex="-1"></a>Then we can construct a statistic</span>
<span id="cb65-1643"><a href="#cb65-1643" aria-hidden="true" tabindex="-1"></a>$$X^2 = \sum_{c=1}^g \frac{(o_c - e_c)^2}{e_c}$$ where $o_c$ is the</span>
<span id="cb65-1644"><a href="#cb65-1644" aria-hidden="true" tabindex="-1"></a>number of events *observed* in group $c$, and $e_c$ is the number of</span>
<span id="cb65-1645"><a href="#cb65-1645" aria-hidden="true" tabindex="-1"></a>events expected in group $c$ (based on the sum of the fitted values</span>
<span id="cb65-1646"><a href="#cb65-1646" aria-hidden="true" tabindex="-1"></a>$\hat\pi_i$ for observations in group $c$).</span>
<span id="cb65-1647"><a href="#cb65-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1648"><a href="#cb65-1648" aria-hidden="true" tabindex="-1"></a>If each group has enough observations in it, you can compare $X^2$ to a</span>
<span id="cb65-1649"><a href="#cb65-1649" aria-hidden="true" tabindex="-1"></a>$\chi^2$ distribution; by simulation, the degrees of freedom has been</span>
<span id="cb65-1650"><a href="#cb65-1650" aria-hidden="true" tabindex="-1"></a>found to be approximately $g-2$.</span>
<span id="cb65-1651"><a href="#cb65-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1652"><a href="#cb65-1652" aria-hidden="true" tabindex="-1"></a>For our CHD model, this procedure would be:</span>
<span id="cb65-1653"><a href="#cb65-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1656"><a href="#cb65-1656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1657"><a href="#cb65-1657" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">=</span> </span>
<span id="cb65-1658"><a href="#cb65-1658" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1659"><a href="#cb65-1659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-1660"><a href="#cb65-1660" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb65-1661"><a href="#cb65-1661" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> </span>
<span id="cb65-1662"><a href="#cb65-1662" aria-hidden="true" tabindex="-1"></a>      pred_probs_glm1 <span class="sc">|&gt;</span> </span>
<span id="cb65-1663"><a href="#cb65-1663" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>), </span>
<span id="cb65-1664"><a href="#cb65-1664" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-1665"><a href="#cb65-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1666"><a href="#cb65-1666" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">=</span> </span>
<span id="cb65-1667"><a href="#cb65-1667" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1668"><a href="#cb65-1668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-1669"><a href="#cb65-1669" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb65-1670"><a href="#cb65-1670" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb65-1671"><a href="#cb65-1671" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb65-1672"><a href="#cb65-1672" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb65-1673"><a href="#cb65-1673" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1674"><a href="#cb65-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1675"><a href="#cb65-1675" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span>
<span id="cb65-1676"><a href="#cb65-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1677"><a href="#cb65-1677" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> HL_table <span class="sc">|&gt;</span> </span>
<span id="cb65-1678"><a href="#cb65-1678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-1679"><a href="#cb65-1679" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o<span class="sc">-</span>e)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>e)</span>
<span id="cb65-1680"><a href="#cb65-1680" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-1681"><a href="#cb65-1681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb65-1682"><a href="#cb65-1682" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb65-1683"><a href="#cb65-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1684"><a href="#cb65-1684" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">=</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb65-1685"><a href="#cb65-1685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1686"><a href="#cb65-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1687"><a href="#cb65-1687" aria-hidden="true" tabindex="-1"></a>Our statistic is $X^2 = <span class="in">`r X2`</span>$; $p(\chi^2(1) &gt; <span class="in">`r X2`</span>) = <span class="in">`r pval1`</span>$,</span>
<span id="cb65-1688"><a href="#cb65-1688" aria-hidden="true" tabindex="-1"></a>which is our p-value for detecting a lack of goodness of fit.</span>
<span id="cb65-1689"><a href="#cb65-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1690"><a href="#cb65-1690" aria-hidden="true" tabindex="-1"></a>Unfortunately that grouping plan left us with just three categories with</span>
<span id="cb65-1691"><a href="#cb65-1691" aria-hidden="true" tabindex="-1"></a>any observations, so instead of grouping by 10% increments of predicted</span>
<span id="cb65-1692"><a href="#cb65-1692" aria-hidden="true" tabindex="-1"></a>probability, typically analysts use deciles of the predicted</span>
<span id="cb65-1693"><a href="#cb65-1693" aria-hidden="true" tabindex="-1"></a>probabilities:</span>
<span id="cb65-1694"><a href="#cb65-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1697"><a href="#cb65-1697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1698"><a href="#cb65-1698" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">=</span> </span>
<span id="cb65-1699"><a href="#cb65-1699" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1700"><a href="#cb65-1700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-1701"><a href="#cb65-1701" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb65-1702"><a href="#cb65-1702" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> </span>
<span id="cb65-1703"><a href="#cb65-1703" aria-hidden="true" tabindex="-1"></a>      pred_probs_glm1 <span class="sc">|&gt;</span> </span>
<span id="cb65-1704"><a href="#cb65-1704" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(<span class="at">breaks =</span> <span class="fu">quantile</span>(pred_probs_glm1, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>)), </span>
<span id="cb65-1705"><a href="#cb65-1705" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>))</span>
<span id="cb65-1706"><a href="#cb65-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1707"><a href="#cb65-1707" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">=</span> </span>
<span id="cb65-1708"><a href="#cb65-1708" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1709"><a href="#cb65-1709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-1710"><a href="#cb65-1710" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb65-1711"><a href="#cb65-1711" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb65-1712"><a href="#cb65-1712" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb65-1713"><a href="#cb65-1713" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb65-1714"><a href="#cb65-1714" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1715"><a href="#cb65-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1716"><a href="#cb65-1716" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span>
<span id="cb65-1717"><a href="#cb65-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1718"><a href="#cb65-1718" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> HL_table <span class="sc">|&gt;</span> </span>
<span id="cb65-1719"><a href="#cb65-1719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-1720"><a href="#cb65-1720" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o<span class="sc">-</span>e)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>e)</span>
<span id="cb65-1721"><a href="#cb65-1721" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-1722"><a href="#cb65-1722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb65-1723"><a href="#cb65-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1724"><a href="#cb65-1724" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb65-1725"><a href="#cb65-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1726"><a href="#cb65-1726" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">=</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb65-1727"><a href="#cb65-1727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1728"><a href="#cb65-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1729"><a href="#cb65-1729" aria-hidden="true" tabindex="-1"></a>Now we have more evenly split categories. The p-value is $<span class="in">`r pval1`</span>$,</span>
<span id="cb65-1730"><a href="#cb65-1730" aria-hidden="true" tabindex="-1"></a>still not significant.</span>
<span id="cb65-1731"><a href="#cb65-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1732"><a href="#cb65-1732" aria-hidden="true" tabindex="-1"></a>Graphically, we have compared:</span>
<span id="cb65-1733"><a href="#cb65-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1736"><a href="#cb65-1736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1737"><a href="#cb65-1737" aria-hidden="true" tabindex="-1"></a>HL_plot <span class="ot">=</span> </span>
<span id="cb65-1738"><a href="#cb65-1738" aria-hidden="true" tabindex="-1"></a>  HL_table <span class="sc">|&gt;</span> </span>
<span id="cb65-1739"><a href="#cb65-1739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_prob_cats1)) <span class="sc">+</span> </span>
<span id="cb65-1740"><a href="#cb65-1740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">x =</span> pred_prob_cats1, <span class="at">group =</span> <span class="st">"Expected"</span>, <span class="at">col =</span> <span class="st">"Expected"</span>)) <span class="sc">+</span></span>
<span id="cb65-1741"><a href="#cb65-1741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Expected"</span>)) <span class="sc">+</span></span>
<span id="cb65-1742"><a href="#cb65-1742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb65-1743"><a href="#cb65-1743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">col =</span> <span class="st">"Observed"</span>, <span class="at">group =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb65-1744"><a href="#cb65-1744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb65-1745"><a href="#cb65-1745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb65-1746"><a href="#cb65-1746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"number of CHD events"</span>) <span class="sc">+</span></span>
<span id="cb65-1747"><a href="#cb65-1747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span>
<span id="cb65-1748"><a href="#cb65-1748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1749"><a href="#cb65-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1750"><a href="#cb65-1750" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1753"><a href="#cb65-1753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1754"><a href="#cb65-1754" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(HL_plot)</span>
<span id="cb65-1755"><a href="#cb65-1755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1756"><a href="#cb65-1756" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1757"><a href="#cb65-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1758"><a href="#cb65-1758" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1761"><a href="#cb65-1761" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1762"><a href="#cb65-1762" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(HL_plot)</span>
<span id="cb65-1763"><a href="#cb65-1763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1764"><a href="#cb65-1764" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1765"><a href="#cb65-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1766"><a href="#cb65-1766" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing models</span></span>
<span id="cb65-1767"><a href="#cb65-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1768"><a href="#cb65-1768" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>AIC = $-2 * \ell(\hat\theta) + 2 * p$ <span class="sc">\[</span>lower is better<span class="sc">\]</span></span>
<span id="cb65-1769"><a href="#cb65-1769" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BIC = $-2 * \ell(\hat\theta) + p * \text{log}(n)$ <span class="sc">\[</span>lower is</span>
<span id="cb65-1770"><a href="#cb65-1770" aria-hidden="true" tabindex="-1"></a>better<span class="sc">\]</span></span>
<span id="cb65-1771"><a href="#cb65-1771" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>likelihood ratio <span class="sc">\[</span>higher is better<span class="sc">\]</span></span>
<span id="cb65-1772"><a href="#cb65-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1773"><a href="#cb65-1773" aria-hidden="true" tabindex="-1"></a><span class="fu">## Residual-based diagnostics</span></span>
<span id="cb65-1774"><a href="#cb65-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1775"><a href="#cb65-1775" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression residuals only work for grouped data</span></span>
<span id="cb65-1776"><a href="#cb65-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1777"><a href="#cb65-1777" aria-hidden="true" tabindex="-1"></a>Residuals only work if there is more than one observation for most</span>
<span id="cb65-1778"><a href="#cb65-1778" aria-hidden="true" tabindex="-1"></a>covariate patterns.</span>
<span id="cb65-1779"><a href="#cb65-1779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1780"><a href="#cb65-1780" aria-hidden="true" tabindex="-1"></a>Here we will create the grouped-data version of our CHD model from the</span>
<span id="cb65-1781"><a href="#cb65-1781" aria-hidden="true" tabindex="-1"></a>WCGS study:</span>
<span id="cb65-1782"><a href="#cb65-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1785"><a href="#cb65-1785" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1786"><a href="#cb65-1786" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">=</span> </span>
<span id="cb65-1787"><a href="#cb65-1787" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span> </span>
<span id="cb65-1788"><a href="#cb65-1788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-1789"><a href="#cb65-1789" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(dibpat, age),</span>
<span id="cb65-1790"><a href="#cb65-1790" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb65-1791"><a href="#cb65-1791" aria-hidden="true" tabindex="-1"></a>    <span class="at">chd =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb65-1792"><a href="#cb65-1792" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">!chd</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"No"</span>)</span>
<span id="cb65-1793"><a href="#cb65-1793" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1794"><a href="#cb65-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1795"><a href="#cb65-1795" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb65-1796"><a href="#cb65-1796" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(chd, <span class="st">`</span><span class="at">!chd</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb65-1797"><a href="#cb65-1797" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs_grouped,</span>
<span id="cb65-1798"><a href="#cb65-1798" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb65-1799"><a href="#cb65-1799" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-1800"><a href="#cb65-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1801"><a href="#cb65-1801" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb65-1802"><a href="#cb65-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1803"><a href="#cb65-1803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1804"><a href="#cb65-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1805"><a href="#cb65-1805" aria-hidden="true" tabindex="-1"></a><span class="fu">### (Response) residuals</span></span>
<span id="cb65-1806"><a href="#cb65-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1807"><a href="#cb65-1807" aria-hidden="true" tabindex="-1"></a>$$e_k \eqdef \bar y_k - \hat{\pi}(x_k)$$</span>
<span id="cb65-1808"><a href="#cb65-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1809"><a href="#cb65-1809" aria-hidden="true" tabindex="-1"></a>($k$ indexes the covariate patterns)</span>
<span id="cb65-1810"><a href="#cb65-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1811"><a href="#cb65-1811" aria-hidden="true" tabindex="-1"></a>We can graph these residuals $e_k$ against the fitted values</span>
<span id="cb65-1812"><a href="#cb65-1812" aria-hidden="true" tabindex="-1"></a>$\hat\pi(x_k)$:</span>
<span id="cb65-1813"><a href="#cb65-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1816"><a href="#cb65-1816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1817"><a href="#cb65-1817" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb65-1818"><a href="#cb65-1818" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">=</span> </span>
<span id="cb65-1819"><a href="#cb65-1819" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="cb65-1820"><a href="#cb65-1820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-1821"><a href="#cb65-1821" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb65-1822"><a href="#cb65-1822" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="cb65-1823"><a href="#cb65-1823" aria-hidden="true" tabindex="-1"></a>    <span class="at">response_resids =</span> </span>
<span id="cb65-1824"><a href="#cb65-1824" aria-hidden="true" tabindex="-1"></a>      chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb65-1825"><a href="#cb65-1825" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1826"><a href="#cb65-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1827"><a href="#cb65-1827" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="ot">=</span> </span>
<span id="cb65-1828"><a href="#cb65-1828" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="cb65-1829"><a href="#cb65-1829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb65-1830"><a href="#cb65-1830" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb65-1831"><a href="#cb65-1831" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted,</span>
<span id="cb65-1832"><a href="#cb65-1832" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> response_resids</span>
<span id="cb65-1833"><a href="#cb65-1833" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-1834"><a href="#cb65-1834" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb65-1835"><a href="#cb65-1835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb65-1836"><a href="#cb65-1836" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="cb65-1837"><a href="#cb65-1837" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-1838"><a href="#cb65-1838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb65-1839"><a href="#cb65-1839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1840"><a href="#cb65-1840" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,  <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1841"><a href="#cb65-1841" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>( <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1842"><a href="#cb65-1842" aria-hidden="true" tabindex="-1"></a>      <span class="at">span=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1843"><a href="#cb65-1843" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree=</span><span class="dv">1</span>, <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1844"><a href="#cb65-1844" aria-hidden="true" tabindex="-1"></a>      <span class="at">family=</span><span class="st">"symmetric"</span>, <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1845"><a href="#cb65-1845" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations=</span><span class="dv">3</span>), <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1846"><a href="#cb65-1846" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> stats<span class="sc">::</span>loess) <span class="co">#&lt;1&gt;</span></span>
<span id="cb65-1847"><a href="#cb65-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1848"><a href="#cb65-1848" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1849"><a href="#cb65-1849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1850"><a href="#cb65-1850" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Don't worry about these options for now; I chose them to match</span>
<span id="cb65-1851"><a href="#cb65-1851" aria-hidden="true" tabindex="-1"></a><span class="in">`autoplot()`</span> as closely as I can. <span class="in">`plot.glm`</span> and <span class="in">`autoplot`</span> use</span>
<span id="cb65-1852"><a href="#cb65-1852" aria-hidden="true" tabindex="-1"></a><span class="in">`stats::lowess`</span> instead of <span class="in">`stats::loess`</span>; <span class="in">`stats::lowess`</span> is older,</span>
<span id="cb65-1853"><a href="#cb65-1853" aria-hidden="true" tabindex="-1"></a>hard to use with <span class="in">`geom_smooth`</span>, and hard to match exactly with</span>
<span id="cb65-1854"><a href="#cb65-1854" aria-hidden="true" tabindex="-1"></a><span class="in">`stats::loess`</span>; see https://support.bioconductor.org/p/2323/.<span class="sc">\]</span></span>
<span id="cb65-1855"><a href="#cb65-1855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1856"><a href="#cb65-1856" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1859"><a href="#cb65-1859" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1860"><a href="#cb65-1860" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb65-1861"><a href="#cb65-1861" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-1862"><a href="#cb65-1862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1863"><a href="#cb65-1863" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1864"><a href="#cb65-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1865"><a href="#cb65-1865" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1868"><a href="#cb65-1868" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1869"><a href="#cb65-1869" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span>
<span id="cb65-1870"><a href="#cb65-1870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1871"><a href="#cb65-1871" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1872"><a href="#cb65-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1873"><a href="#cb65-1873" aria-hidden="true" tabindex="-1"></a>We can see a slight fan-shape here: observations on the right have</span>
<span id="cb65-1874"><a href="#cb65-1874" aria-hidden="true" tabindex="-1"></a>larger variance (as expected since $var(\bar y) = \pi(1-\pi)/n$ is</span>
<span id="cb65-1875"><a href="#cb65-1875" aria-hidden="true" tabindex="-1"></a>maximized when $\pi = 0.5$).</span>
<span id="cb65-1876"><a href="#cb65-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1877"><a href="#cb65-1877" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pearson residuals</span></span>
<span id="cb65-1878"><a href="#cb65-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1879"><a href="#cb65-1879" aria-hidden="true" tabindex="-1"></a>The fan-shape in the response residuals plot isn't necessarily a concern</span>
<span id="cb65-1880"><a href="#cb65-1880" aria-hidden="true" tabindex="-1"></a>here, since we haven't made an assumption of constant residual variance,</span>
<span id="cb65-1881"><a href="#cb65-1881" aria-hidden="true" tabindex="-1"></a>as we did for linear regression.</span>
<span id="cb65-1882"><a href="#cb65-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1883"><a href="#cb65-1883" aria-hidden="true" tabindex="-1"></a>However, we might want to divide by the standard error in order to make</span>
<span id="cb65-1884"><a href="#cb65-1884" aria-hidden="true" tabindex="-1"></a>the graph easier to interpret. Here's one way to do that:</span>
<span id="cb65-1885"><a href="#cb65-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1886"><a href="#cb65-1886" aria-hidden="true" tabindex="-1"></a>The Pearson (chi-squared) residual for covariate pattern $k$ is: $$</span>
<span id="cb65-1887"><a href="#cb65-1887" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-1888"><a href="#cb65-1888" aria-hidden="true" tabindex="-1"></a>X_k &amp;= \frac{\bar y_k - \hat\pi_k}{\sqrt{\hat \pi_k (1-\hat\pi_k)/n_k}}</span>
<span id="cb65-1889"><a href="#cb65-1889" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-1890"><a href="#cb65-1890" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-1891"><a href="#cb65-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1892"><a href="#cb65-1892" aria-hidden="true" tabindex="-1"></a>where $$</span>
<span id="cb65-1893"><a href="#cb65-1893" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb65-1894"><a href="#cb65-1894" aria-hidden="true" tabindex="-1"></a>\hat\pi_k </span>
<span id="cb65-1895"><a href="#cb65-1895" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \hat\pi(x_k)<span class="sc">\\</span></span>
<span id="cb65-1896"><a href="#cb65-1896" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \hat P(Y=1|X=x_k)<span class="sc">\\</span> </span>
<span id="cb65-1897"><a href="#cb65-1897" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \text{expit}(x_i'\hat \beta)<span class="sc">\\</span></span>
<span id="cb65-1898"><a href="#cb65-1898" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \text{expit}(\hat \beta_0 + \sum_{j=1}^p \hat \beta_j x_{ij})</span>
<span id="cb65-1899"><a href="#cb65-1899" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb65-1900"><a href="#cb65-1900" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb65-1901"><a href="#cb65-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1902"><a href="#cb65-1902" aria-hidden="true" tabindex="-1"></a>Let's take a look at the Pearson residuals for our CHD model from the</span>
<span id="cb65-1903"><a href="#cb65-1903" aria-hidden="true" tabindex="-1"></a>WCGS data (graphed against the fitted values on the logit scale):</span>
<span id="cb65-1904"><a href="#cb65-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1907"><a href="#cb65-1907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1908"><a href="#cb65-1908" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb65-1909"><a href="#cb65-1909" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1910"><a href="#cb65-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1911"><a href="#cb65-1911" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1914"><a href="#cb65-1914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1915"><a href="#cb65-1915" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb65-1916"><a href="#cb65-1916" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-1917"><a href="#cb65-1917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1918"><a href="#cb65-1918" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1919"><a href="#cb65-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1920"><a href="#cb65-1920" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1923"><a href="#cb65-1923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1924"><a href="#cb65-1924" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-1925"><a href="#cb65-1925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1926"><a href="#cb65-1926" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1927"><a href="#cb65-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1928"><a href="#cb65-1928" aria-hidden="true" tabindex="-1"></a>The fan-shape is gone, and these residuals don't show any obvious signs</span>
<span id="cb65-1929"><a href="#cb65-1929" aria-hidden="true" tabindex="-1"></a>of model fit issues.</span>
<span id="cb65-1930"><a href="#cb65-1930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1931"><a href="#cb65-1931" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pearson residuals plot for `beetles` data</span></span>
<span id="cb65-1932"><a href="#cb65-1932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1933"><a href="#cb65-1933" aria-hidden="true" tabindex="-1"></a>If we create the same plot for the <span class="in">`beetles`</span> model, we see some strong</span>
<span id="cb65-1934"><a href="#cb65-1934" aria-hidden="true" tabindex="-1"></a>evidence of a lack of fit:</span>
<span id="cb65-1935"><a href="#cb65-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1936"><a href="#cb65-1936" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1939"><a href="#cb65-1939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1940"><a href="#cb65-1940" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(beetles_glm_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-1941"><a href="#cb65-1941" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1942"><a href="#cb65-1942" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1943"><a href="#cb65-1943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1944"><a href="#cb65-1944" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1947"><a href="#cb65-1947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1948"><a href="#cb65-1948" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb65-1949"><a href="#cb65-1949" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(beetles_glm_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-1950"><a href="#cb65-1950" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1951"><a href="#cb65-1951" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1952"><a href="#cb65-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1953"><a href="#cb65-1953" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pearson residuals with individual (ungrouped) data</span></span>
<span id="cb65-1954"><a href="#cb65-1954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1955"><a href="#cb65-1955" aria-hidden="true" tabindex="-1"></a>What happens if we try to compute residuals without grouping the data by</span>
<span id="cb65-1956"><a href="#cb65-1956" aria-hidden="true" tabindex="-1"></a>covariate pattern?</span>
<span id="cb65-1957"><a href="#cb65-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1960"><a href="#cb65-1960" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1961"><a href="#cb65-1961" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb65-1962"><a href="#cb65-1962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1963"><a href="#cb65-1963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1964"><a href="#cb65-1964" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-1967"><a href="#cb65-1967" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1968"><a href="#cb65-1968" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-1969"><a href="#cb65-1969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1970"><a href="#cb65-1970" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1971"><a href="#cb65-1971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1972"><a href="#cb65-1972" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-1975"><a href="#cb65-1975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1976"><a href="#cb65-1976" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb65-1977"><a href="#cb65-1977" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-1978"><a href="#cb65-1978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-1979"><a href="#cb65-1979" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-1980"><a href="#cb65-1980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1981"><a href="#cb65-1981" aria-hidden="true" tabindex="-1"></a>Meaningless.</span>
<span id="cb65-1982"><a href="#cb65-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1983"><a href="#cb65-1983" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residuals plot by hand (*optional section*)</span></span>
<span id="cb65-1984"><a href="#cb65-1984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1985"><a href="#cb65-1985" aria-hidden="true" tabindex="-1"></a>If you want to check your understanding of what these residual plots</span>
<span id="cb65-1986"><a href="#cb65-1986" aria-hidden="true" tabindex="-1"></a>are, try building them yourself:</span>
<span id="cb65-1987"><a href="#cb65-1987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1990"><a href="#cb65-1990" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-1991"><a href="#cb65-1991" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">=</span> </span>
<span id="cb65-1992"><a href="#cb65-1992" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="cb65-1993"><a href="#cb65-1993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-1994"><a href="#cb65-1994" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb65-1995"><a href="#cb65-1995" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="cb65-1996"><a href="#cb65-1996" aria-hidden="true" tabindex="-1"></a>    <span class="at">resids =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb65-1997"><a href="#cb65-1997" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-1998"><a href="#cb65-1998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1999"><a href="#cb65-1999" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="ot">=</span> </span>
<span id="cb65-2000"><a href="#cb65-2000" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span> </span>
<span id="cb65-2001"><a href="#cb65-2001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb65-2002"><a href="#cb65-2002" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb65-2003"><a href="#cb65-2003" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted_logit,</span>
<span id="cb65-2004"><a href="#cb65-2004" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> resids</span>
<span id="cb65-2005"><a href="#cb65-2005" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-2006"><a href="#cb65-2006" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb65-2007"><a href="#cb65-2007" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-2008"><a href="#cb65-2008" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb65-2009"><a href="#cb65-2009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb65-2010"><a href="#cb65-2010" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="cb65-2011"><a href="#cb65-2011" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-2012"><a href="#cb65-2012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb65-2013"><a href="#cb65-2013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, </span>
<span id="cb65-2014"><a href="#cb65-2014" aria-hidden="true" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(</span>
<span id="cb65-2015"><a href="#cb65-2015" aria-hidden="true" tabindex="-1"></a>                <span class="at">span=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb65-2016"><a href="#cb65-2016" aria-hidden="true" tabindex="-1"></a>                <span class="at">degree=</span><span class="dv">1</span>,</span>
<span id="cb65-2017"><a href="#cb65-2017" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span><span class="st">"symmetric"</span>,</span>
<span id="cb65-2018"><a href="#cb65-2018" aria-hidden="true" tabindex="-1"></a>                <span class="at">iterations=</span><span class="dv">3</span>,</span>
<span id="cb65-2019"><a href="#cb65-2019" aria-hidden="true" tabindex="-1"></a>                <span class="at">surface=</span><span class="st">"direct"</span></span>
<span id="cb65-2020"><a href="#cb65-2020" aria-hidden="true" tabindex="-1"></a>                <span class="co"># span = 2/3, </span></span>
<span id="cb65-2021"><a href="#cb65-2021" aria-hidden="true" tabindex="-1"></a>                <span class="co"># iterations = 3</span></span>
<span id="cb65-2022"><a href="#cb65-2022" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb65-2023"><a href="#cb65-2023" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> stats<span class="sc">::</span>loess)</span>
<span id="cb65-2024"><a href="#cb65-2024" aria-hidden="true" tabindex="-1"></a><span class="co"># plot.glm and autoplot use stats::lowess, which is hard to use with </span></span>
<span id="cb65-2025"><a href="#cb65-2025" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_smooth and hard to match exactly; </span></span>
<span id="cb65-2026"><a href="#cb65-2026" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://support.bioconductor.org/p/2323/</span></span>
<span id="cb65-2027"><a href="#cb65-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2028"><a href="#cb65-2028" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2029"><a href="#cb65-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2030"><a href="#cb65-2030" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-2033"><a href="#cb65-2033" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2034"><a href="#cb65-2034" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb65-2035"><a href="#cb65-2035" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-2036"><a href="#cb65-2036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2037"><a href="#cb65-2037" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-2038"><a href="#cb65-2038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2039"><a href="#cb65-2039" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-2042"><a href="#cb65-2042" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2043"><a href="#cb65-2043" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span>
<span id="cb65-2044"><a href="#cb65-2044" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2045"><a href="#cb65-2045" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-2046"><a href="#cb65-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2047"><a href="#cb65-2047" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pearson chi-squared goodness of fit test</span></span>
<span id="cb65-2048"><a href="#cb65-2048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2049"><a href="#cb65-2049" aria-hidden="true" tabindex="-1"></a>The Pearson chi-squared goodness of fit statistic is: $$</span>
<span id="cb65-2050"><a href="#cb65-2050" aria-hidden="true" tabindex="-1"></a>X^2 = \sum_{k=1}^m X_k^2 </span>
<span id="cb65-2051"><a href="#cb65-2051" aria-hidden="true" tabindex="-1"></a>$$ Under the null hypothesis that the model in question is correct</span>
<span id="cb65-2052"><a href="#cb65-2052" aria-hidden="true" tabindex="-1"></a>(i.e., sufficiently complex), $X^2\ \dot \sim\ \chi^2(N-p)$.</span>
<span id="cb65-2053"><a href="#cb65-2053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2056"><a href="#cb65-2056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2057"><a href="#cb65-2057" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> </span>
<span id="cb65-2058"><a href="#cb65-2058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb65-2059"><a href="#cb65-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2060"><a href="#cb65-2060" aria-hidden="true" tabindex="-1"></a>chisq_stat <span class="ot">=</span> <span class="fu">sum</span>(X<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb65-2061"><a href="#cb65-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2062"><a href="#cb65-2062" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">=</span> <span class="fu">pchisq</span>(</span>
<span id="cb65-2063"><a href="#cb65-2063" aria-hidden="true" tabindex="-1"></a>  chisq_stat, </span>
<span id="cb65-2064"><a href="#cb65-2064" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="cn">FALSE</span>, </span>
<span id="cb65-2065"><a href="#cb65-2065" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">length</span>(X) <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(chd_glm_strat_grouped)))</span>
<span id="cb65-2066"><a href="#cb65-2066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2067"><a href="#cb65-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2068"><a href="#cb65-2068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2069"><a href="#cb65-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2070"><a href="#cb65-2070" aria-hidden="true" tabindex="-1"></a>For our CHD model, the p-value for this test is <span class="in">`r pval`</span>; no significant</span>
<span id="cb65-2071"><a href="#cb65-2071" aria-hidden="true" tabindex="-1"></a>evidence of a lack of fit at the 0.05 level.</span>
<span id="cb65-2072"><a href="#cb65-2072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2073"><a href="#cb65-2073" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized Pearson residuals</span></span>
<span id="cb65-2074"><a href="#cb65-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2075"><a href="#cb65-2075" aria-hidden="true" tabindex="-1"></a>Especially for small data sets, we might want to adjust our residuals</span>
<span id="cb65-2076"><a href="#cb65-2076" aria-hidden="true" tabindex="-1"></a>for leverage (since outliers in $X$ add extra variance to the</span>
<span id="cb65-2077"><a href="#cb65-2077" aria-hidden="true" tabindex="-1"></a>residuals):</span>
<span id="cb65-2078"><a href="#cb65-2078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2079"><a href="#cb65-2079" aria-hidden="true" tabindex="-1"></a>$$r_{P_k} = \frac{X_k}{\sqrt{1-h_k}}$$</span>
<span id="cb65-2080"><a href="#cb65-2080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2081"><a href="#cb65-2081" aria-hidden="true" tabindex="-1"></a>where $h_k$ is the leverage of $X_k$. The functions <span class="in">`autoplot()`</span> and</span>
<span id="cb65-2082"><a href="#cb65-2082" aria-hidden="true" tabindex="-1"></a><span class="in">`plot.lm()`</span> use these for some of their graphs.</span>
<span id="cb65-2083"><a href="#cb65-2083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2084"><a href="#cb65-2084" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deviance residuals</span></span>
<span id="cb65-2085"><a href="#cb65-2085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2086"><a href="#cb65-2086" aria-hidden="true" tabindex="-1"></a>For large sample sizes, the Pearson and deviance residuals will be</span>
<span id="cb65-2087"><a href="#cb65-2087" aria-hidden="true" tabindex="-1"></a>approximately the same. For small sample sizes, the deviance residuals</span>
<span id="cb65-2088"><a href="#cb65-2088" aria-hidden="true" tabindex="-1"></a>from covariate patterns with small sample sizes can be unreliable (high</span>
<span id="cb65-2089"><a href="#cb65-2089" aria-hidden="true" tabindex="-1"></a>variance).</span>
<span id="cb65-2090"><a href="#cb65-2090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2091"><a href="#cb65-2091" aria-hidden="true" tabindex="-1"></a>$$d_k = \text{sign}(y_k - n_k \hat \pi_k)\left<span class="sc">\{</span>\sqrt{2<span class="co">[</span><span class="ot">\ell_{\text{full}}(x_k) - \ell(\hat\beta; x_k)</span><span class="co">]</span>}\right<span class="sc">\}</span>$$</span>
<span id="cb65-2092"><a href="#cb65-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2093"><a href="#cb65-2093" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized deviance residuals</span></span>
<span id="cb65-2094"><a href="#cb65-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2095"><a href="#cb65-2095" aria-hidden="true" tabindex="-1"></a>$$r_{D_k} = \frac{d_k}{\sqrt{1-h_k}}$$</span>
<span id="cb65-2096"><a href="#cb65-2096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2097"><a href="#cb65-2097" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagnostic plots</span></span>
<span id="cb65-2098"><a href="#cb65-2098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2099"><a href="#cb65-2099" aria-hidden="true" tabindex="-1"></a>Let's take a look at the full set of <span class="in">`autoplot()`</span> diagnostics now for</span>
<span id="cb65-2100"><a href="#cb65-2100" aria-hidden="true" tabindex="-1"></a>our <span class="in">`CHD`</span> model:</span>
<span id="cb65-2101"><a href="#cb65-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2102"><a href="#cb65-2102" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-2105"><a href="#cb65-2105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2106"><a href="#cb65-2106" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-2107"><a href="#cb65-2107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2108"><a href="#cb65-2108" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-2109"><a href="#cb65-2109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2110"><a href="#cb65-2110" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-2113"><a href="#cb65-2113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2114"><a href="#cb65-2114" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb65-2115"><a href="#cb65-2115" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-2116"><a href="#cb65-2116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2117"><a href="#cb65-2117" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-2118"><a href="#cb65-2118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2119"><a href="#cb65-2119" aria-hidden="true" tabindex="-1"></a>Things look pretty good here. The QQ plot is still usable; with large</span>
<span id="cb65-2120"><a href="#cb65-2120" aria-hidden="true" tabindex="-1"></a>samples; the residuals should be approximately Gaussian.</span>
<span id="cb65-2121"><a href="#cb65-2121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2122"><a href="#cb65-2122" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Beetles</span></span>
<span id="cb65-2123"><a href="#cb65-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2124"><a href="#cb65-2124" aria-hidden="true" tabindex="-1"></a>Let's look at the beetles model diagnostic plots for comparison:</span>
<span id="cb65-2125"><a href="#cb65-2125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2126"><a href="#cb65-2126" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb65-2129"><a href="#cb65-2129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2130"><a href="#cb65-2130" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-2131"><a href="#cb65-2131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2132"><a href="#cb65-2132" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-2133"><a href="#cb65-2133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2134"><a href="#cb65-2134" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb65-2137"><a href="#cb65-2137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2138"><a href="#cb65-2138" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb65-2139"><a href="#cb65-2139" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb65-2140"><a href="#cb65-2140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2141"><a href="#cb65-2141" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-2142"><a href="#cb65-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2143"><a href="#cb65-2143" aria-hidden="true" tabindex="-1"></a>Hard to tell much from so little data, but there might be some issues</span>
<span id="cb65-2144"><a href="#cb65-2144" aria-hidden="true" tabindex="-1"></a>here.</span>
<span id="cb65-2145"><a href="#cb65-2145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2146"><a href="#cb65-2146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Odds Ratios vs Probability (Risk) Ratios {#sec-OR-RR}</span></span>
<span id="cb65-2147"><a href="#cb65-2147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2148"><a href="#cb65-2148" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Case 1: rare events</span></span>
<span id="cb65-2149"><a href="#cb65-2149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2150"><a href="#cb65-2150" aria-hidden="true" tabindex="-1"></a>For rare events, odds ratios and probability (a.k.a. risk, a.k.a.</span>
<span id="cb65-2151"><a href="#cb65-2151" aria-hidden="true" tabindex="-1"></a>prevalence) ratios will be close:</span>
<span id="cb65-2152"><a href="#cb65-2152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2153"><a href="#cb65-2153" aria-hidden="true" tabindex="-1"></a>$\pi_1 = .01$ $\pi_2 = .02$</span>
<span id="cb65-2154"><a href="#cb65-2154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2155"><a href="#cb65-2155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r "rare events or-rr"}</span></span>
<span id="cb65-2156"><a href="#cb65-2156" aria-hidden="true" tabindex="-1"></a><span class="in">pi1 = .01</span></span>
<span id="cb65-2157"><a href="#cb65-2157" aria-hidden="true" tabindex="-1"></a><span class="in">pi2 = .02</span></span>
<span id="cb65-2158"><a href="#cb65-2158" aria-hidden="true" tabindex="-1"></a><span class="in">pi2/pi1</span></span>
<span id="cb65-2159"><a href="#cb65-2159" aria-hidden="true" tabindex="-1"></a><span class="in">odds(pi2)/odds(pi1)</span></span>
<span id="cb65-2160"><a href="#cb65-2160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2161"><a href="#cb65-2161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2162"><a href="#cb65-2162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2163"><a href="#cb65-2163" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Case 2: frequent events</span></span>
<span id="cb65-2164"><a href="#cb65-2164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2165"><a href="#cb65-2165" aria-hidden="true" tabindex="-1"></a>$\pi_1 = .4$ $\pi_2 = .5$</span>
<span id="cb65-2166"><a href="#cb65-2166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2167"><a href="#cb65-2167" aria-hidden="true" tabindex="-1"></a>For more frequently-occurring outcomes, this won't be the case:</span>
<span id="cb65-2168"><a href="#cb65-2168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2171"><a href="#cb65-2171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2172"><a href="#cb65-2172" aria-hidden="true" tabindex="-1"></a>pi1 <span class="ot">=</span> .<span class="dv">4</span></span>
<span id="cb65-2173"><a href="#cb65-2173" aria-hidden="true" tabindex="-1"></a>pi2 <span class="ot">=</span> .<span class="dv">5</span></span>
<span id="cb65-2174"><a href="#cb65-2174" aria-hidden="true" tabindex="-1"></a>pi2<span class="sc">/</span>pi1</span>
<span id="cb65-2175"><a href="#cb65-2175" aria-hidden="true" tabindex="-1"></a><span class="fu">odds</span>(pi2)<span class="sc">/</span><span class="fu">odds</span>(pi1)</span>
<span id="cb65-2176"><a href="#cb65-2176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2177"><a href="#cb65-2177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2178"><a href="#cb65-2178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2179"><a href="#cb65-2179" aria-hidden="true" tabindex="-1"></a>If you want risk ratios, you can sometimes get them by changing the link</span>
<span id="cb65-2180"><a href="#cb65-2180" aria-hidden="true" tabindex="-1"></a>function:</span>
<span id="cb65-2181"><a href="#cb65-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2184"><a href="#cb65-2184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2185"><a href="#cb65-2185" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(anthers, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb65-2186"><a href="#cb65-2186" aria-hidden="true" tabindex="-1"></a>anthers.sum<span class="ot">&lt;-</span><span class="fu">aggregate</span>(</span>
<span id="cb65-2187"><a href="#cb65-2187" aria-hidden="true" tabindex="-1"></a>  anthers[<span class="fu">c</span>(<span class="st">"n"</span>,<span class="st">"y"</span>)], </span>
<span id="cb65-2188"><a href="#cb65-2188" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span>anthers[<span class="fu">c</span>(<span class="st">"storage"</span>)],<span class="at">FUN=</span>sum) </span>
<span id="cb65-2189"><a href="#cb65-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2190"><a href="#cb65-2190" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb65-2191"><a href="#cb65-2191" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y,n<span class="sc">-</span>y)<span class="sc">~</span>storage,</span>
<span id="cb65-2192"><a href="#cb65-2192" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>anthers.sum, </span>
<span id="cb65-2193"><a href="#cb65-2193" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"log"</span>))</span>
<span id="cb65-2194"><a href="#cb65-2194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2195"><a href="#cb65-2195" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb65-2196"><a href="#cb65-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2197"><a href="#cb65-2197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2198"><a href="#cb65-2198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2199"><a href="#cb65-2199" aria-hidden="true" tabindex="-1"></a>Now $\exp{\beta}$ gives us risk ratios instead of odds ratios:</span>
<span id="cb65-2200"><a href="#cb65-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2203"><a href="#cb65-2203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2204"><a href="#cb65-2204" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span> <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb65-2205"><a href="#cb65-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2206"><a href="#cb65-2206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2207"><a href="#cb65-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2208"><a href="#cb65-2208" aria-hidden="true" tabindex="-1"></a>Let's compare this model with a logistic model:</span>
<span id="cb65-2209"><a href="#cb65-2209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2212"><a href="#cb65-2212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb65-2213"><a href="#cb65-2213" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb65-2214"><a href="#cb65-2214" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y, n <span class="sc">-</span> y) <span class="sc">~</span> storage,</span>
<span id="cb65-2215"><a href="#cb65-2215" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> anthers.sum,</span>
<span id="cb65-2216"><a href="#cb65-2216" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb65-2217"><a href="#cb65-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2218"><a href="#cb65-2218" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="sc">|&gt;</span> <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb65-2219"><a href="#cb65-2219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2220"><a href="#cb65-2220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-2221"><a href="#cb65-2221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2222"><a href="#cb65-2222" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span>to add: fitted plots on each outcome scale<span class="sc">\]</span></span>
<span id="cb65-2223"><a href="#cb65-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2224"><a href="#cb65-2224" aria-hidden="true" tabindex="-1"></a>When I try to use <span class="in">`link ="log"`</span> in practice, I often get errors about</span>
<span id="cb65-2225"><a href="#cb65-2225" aria-hidden="true" tabindex="-1"></a>not finding good starting values for the estimation procedure. This is</span>
<span id="cb65-2226"><a href="#cb65-2226" aria-hidden="true" tabindex="-1"></a>likely because the model is producing fitted probabilities greater than</span>
<span id="cb65-2227"><a href="#cb65-2227" aria-hidden="true" tabindex="-1"></a>1.</span>
<span id="cb65-2228"><a href="#cb65-2228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2229"><a href="#cb65-2229" aria-hidden="true" tabindex="-1"></a>When this happens, you can try to fit Poisson regression models instead</span>
<span id="cb65-2230"><a href="#cb65-2230" aria-hidden="true" tabindex="-1"></a>(we will see those soon!). But then the outcome distribution isn't quite</span>
<span id="cb65-2231"><a href="#cb65-2231" aria-hidden="true" tabindex="-1"></a>right, and you won't get warnings about fitted probabilities greater</span>
<span id="cb65-2232"><a href="#cb65-2232" aria-hidden="true" tabindex="-1"></a>than 1. In my opinion, the Poisson model for binary outcomes is</span>
<span id="cb65-2233"><a href="#cb65-2233" aria-hidden="true" tabindex="-1"></a>confusing and not very appealing.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2024, Douglas Ezra Morrison
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/d-morrison/rme/edit/main/logistic-regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/rme/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>