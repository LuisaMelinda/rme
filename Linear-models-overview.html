<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Regression Models for Epidemiology - 2&nbsp; Linear (Gaussian) Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./logistic-regression.html" rel="next">
<link href="./glms.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-W625DGE908"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-W625DGE908', { 'anonymize_ip': true});
</script><script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false,
  "enableExperimentalNewNoteButton": true
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="site_libs/plotly-binding-4.10.2/plotly.js"></script><script src="site_libs/typedarray-0.1/typedarray.min.js"></script><script src="site_libs/jquery-3.5.1/jquery.min.js"></script><link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="custom.scss">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glms.html">Generalized Linear Models</a></li><li class="breadcrumb-item"><a href="./Linear-models-overview.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression Models for Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/d-morrison/rme" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Regression-Models-for-Epidemiology.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-GLMs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Linear-models-overview.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Models for Count Outcomes</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./time-to-event-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time to Event Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./proportional-hazards-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Proportional Hazards Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coxph-model-building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building Cox Proportional Hazards models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parametric-survival-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Parametric survival models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-MLEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Introduction to Maximum Likelihood Inference</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#understanding-gaussian-linear-regression-models" id="toc-understanding-gaussian-linear-regression-models" class="nav-link active" data-scroll-target="#understanding-gaussian-linear-regression-models"><span class="header-section-number">2.1</span> Understanding Gaussian Linear Regression Models</a>
  <ul class="collapse">
<li><a href="#motivating-example-birthweights-and-gestational-age" id="toc-motivating-example-birthweights-and-gestational-age" class="nav-link" data-scroll-target="#motivating-example-birthweights-and-gestational-age"><span class="header-section-number">2.1.1</span> Motivating example: birthweights and gestational age</a></li>
  <li><a href="#parallel-lines-regression" id="toc-parallel-lines-regression" class="nav-link" data-scroll-target="#parallel-lines-regression"><span class="header-section-number">2.1.2</span> Parallel lines regression</a></li>
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions"><span class="header-section-number">2.1.3</span> Interactions</a></li>
  <li><a href="#stratified-regression" id="toc-stratified-regression" class="nav-link" data-scroll-target="#stratified-regression"><span class="header-section-number">2.1.4</span> Stratified regression</a></li>
  <li><a href="#curved-line-regression" id="toc-curved-line-regression" class="nav-link" data-scroll-target="#curved-line-regression"><span class="header-section-number">2.1.5</span> Curved-line regression</a></li>
  </ul>
</li>
  <li>
<a href="#estimating-linear-models-via-maximum-likelihood" id="toc-estimating-linear-models-via-maximum-likelihood" class="nav-link" data-scroll-target="#estimating-linear-models-via-maximum-likelihood"><span class="header-section-number">2.2</span> Estimating Linear Models via Maximum Likelihood</a>
  <ul class="collapse">
<li><a href="#review-of-one-sample-inference" id="toc-review-of-one-sample-inference" class="nav-link" data-scroll-target="#review-of-one-sample-inference"><span class="header-section-number">2.2.1</span> Review of one-sample inference</a></li>
  <li><a href="#mles-for-linear-regression" id="toc-mles-for-linear-regression" class="nav-link" data-scroll-target="#mles-for-linear-regression"><span class="header-section-number">2.2.2</span> MLEs for Linear Regression</a></li>
  </ul>
</li>
  <li>
<a href="#inference-about-gaussian-linear-regression-models" id="toc-inference-about-gaussian-linear-regression-models" class="nav-link" data-scroll-target="#inference-about-gaussian-linear-regression-models"><span class="header-section-number">2.3</span> Inference about Gaussian Linear Regression Models</a>
  <ul class="collapse">
<li><a href="#wald-tests-and-cis" id="toc-wald-tests-and-cis" class="nav-link" data-scroll-target="#wald-tests-and-cis"><span class="header-section-number">2.3.1</span> Wald tests and CIs</a></li>
  <li><a href="#one-parameter-inference-by-hand" id="toc-one-parameter-inference-by-hand" class="nav-link" data-scroll-target="#one-parameter-inference-by-hand"><span class="header-section-number">2.3.2</span> One-parameter inference by hand</a></li>
  <li><a href="#gaussian-approximations" id="toc-gaussian-approximations" class="nav-link" data-scroll-target="#gaussian-approximations"><span class="header-section-number">2.3.3</span> Gaussian approximations</a></li>
  <li><a href="#likelihood-ratio-statistics" id="toc-likelihood-ratio-statistics" class="nav-link" data-scroll-target="#likelihood-ratio-statistics"><span class="header-section-number">2.3.4</span> Likelihood ratio statistics</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">2.3.5</span> </a></li>
  </ul>
</li>
  <li>
<a href="#goodness-of-fit" id="toc-goodness-of-fit" class="nav-link" data-scroll-target="#goodness-of-fit"><span class="header-section-number">2.4</span> Goodness of fit</a>
  <ul class="collapse">
<li><a href="#aic-and-bic" id="toc-aic-and-bic" class="nav-link" data-scroll-target="#aic-and-bic"><span class="header-section-number">2.4.1</span> AIC and BIC</a></li>
  <li><a href="#residual-deviance" id="toc-residual-deviance" class="nav-link" data-scroll-target="#residual-deviance"><span class="header-section-number">2.4.2</span> (Residual) Deviance</a></li>
  <li><a href="#null-deviance" id="toc-null-deviance" class="nav-link" data-scroll-target="#null-deviance"><span class="header-section-number">2.4.3</span> Null Deviance</a></li>
  </ul>
</li>
  <li>
<a href="#rescaling" id="toc-rescaling" class="nav-link" data-scroll-target="#rescaling"><span class="header-section-number">2.5</span> Rescaling</a>
  <ul class="collapse">
<li><a href="#rescale-age" id="toc-rescale-age" class="nav-link" data-scroll-target="#rescale-age"><span class="header-section-number">2.5.1</span> Rescale age</a></li>
  </ul>
</li>
  <li>
<a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction"><span class="header-section-number">2.6</span> Prediction</a>
  <ul class="collapse">
<li><a href="#prediction-for-linear-models" id="toc-prediction-for-linear-models" class="nav-link" data-scroll-target="#prediction-for-linear-models"><span class="header-section-number">2.6.1</span> Prediction for linear models</a></li>
  <li><a href="#prediction-in-r" id="toc-prediction-in-r" class="nav-link" data-scroll-target="#prediction-in-r"><span class="header-section-number">2.6.2</span> prediction in R</a></li>
  </ul>
</li>
  <li>
<a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics"><span class="header-section-number">2.7</span> Diagnostics</a>
  <ul class="collapse">
<li><a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals"><span class="header-section-number">2.7.1</span> Residuals</a></li>
  <li><a href="#marginal-distributions-of-residuals" id="toc-marginal-distributions-of-residuals" class="nav-link" data-scroll-target="#marginal-distributions-of-residuals"><span class="header-section-number">2.7.2</span> Marginal distributions of residuals</a></li>
  <li><a href="#qq-plot-of-standardized-residuals" id="toc-qq-plot-of-standardized-residuals" class="nav-link" data-scroll-target="#qq-plot-of-standardized-residuals"><span class="header-section-number">2.7.3</span> QQ plot of standardized residuals</a></li>
  <li><a href="#conditional-distributions-of-residuals" id="toc-conditional-distributions-of-residuals" class="nav-link" data-scroll-target="#conditional-distributions-of-residuals"><span class="header-section-number">2.7.4</span> Conditional distributions of residuals</a></li>
  <li><a href="#diagnostics-constructed-by-hand" id="toc-diagnostics-constructed-by-hand" class="nav-link" data-scroll-target="#diagnostics-constructed-by-hand"><span class="header-section-number">2.7.5</span> Diagnostics constructed by hand</a></li>
  </ul>
</li>
  <li>
<a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection"><span class="header-section-number">2.8</span> Model selection</a>
  <ul class="collapse">
<li><a href="#mean-squared-error" id="toc-mean-squared-error" class="nav-link" data-scroll-target="#mean-squared-error"><span class="header-section-number">2.8.1</span> Mean squared error</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">2.8.2</span> Cross-validation</a></li>
  </ul>
</li>
  <li>
<a href="#categorical-covariates-with-more-than-two-levels" id="toc-categorical-covariates-with-more-than-two-levels" class="nav-link" data-scroll-target="#categorical-covariates-with-more-than-two-levels"><span class="header-section-number">2.9</span> Categorical covariates with more than two levels</a>
  <ul class="collapse">
<li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">2.9.1</span> </a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">2.9.2</span> </a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"><span class="header-section-number">2.9.3</span> </a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"><span class="header-section-number">2.9.4</span> </a></li>
  <li><a href="#lets-see-how-that-model-looks" id="toc-lets-see-how-that-model-looks" class="nav-link" data-scroll-target="#lets-see-how-that-model-looks"><span class="header-section-number">2.9.5</span> Let’s see how that model looks:</a></li>
  <li><a href="#lets-see-what-r-does-with-categorical-variables-by-default" id="toc-lets-see-what-r-does-with-categorical-variables-by-default" class="nav-link" data-scroll-target="#lets-see-what-r-does-with-categorical-variables-by-default"><span class="header-section-number">2.9.6</span> Let’s see what R does with categorical variables by default:</a></li>
  <li><a href="#re-parametrize-with-no-intercept" id="toc-re-parametrize-with-no-intercept" class="nav-link" data-scroll-target="#re-parametrize-with-no-intercept"><span class="header-section-number">2.9.7</span> Re-parametrize with no intercept</a></li>
  <li><a href="#lets-see-what-these-new-models-look-like" id="toc-lets-see-what-these-new-models-look-like" class="nav-link" data-scroll-target="#lets-see-what-these-new-models-look-like"><span class="header-section-number">2.9.8</span> Let’s see what these new models look like:</a></li>
  <li><a href="#lets-see-how-r-did-that" id="toc-lets-see-how-r-did-that" class="nav-link" data-scroll-target="#lets-see-how-r-did-that"><span class="header-section-number">2.9.9</span> Let’s see how R did that:</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/d-morrison/rme/edit/main/Linear-models-overview.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/d-morrison/rme/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Last modified: 2023-10-10: 17:56:59 (PM)</p>
    </div>
  </div>
  
    
  </div>
  

</header><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This content is adapted from Dobson &amp; Barnett, An Introduction to Generalized Linear Models, 4th edition, Chapters 2-6]</p>
</div>
</div>
<p>Functions from these packages will be used throughout this document:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-2_34ae94d2fe4a197c32cd676cd6812deb">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/">pander</a></span><span class="op">)</span> <span class="co"># format tables for markdown</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonocarroll/ggeasy">ggeasy</a></span><span class="op">)</span> <span class="co"># help with graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="co"># manipulate data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span> <span class="co"># import Stata files</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span> <span class="co"># format R output for markdown</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span> <span class="co"># Tools to help to create tidy data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span> <span class="co"># interactive graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dobson</span><span class="op">)</span> <span class="co"># datasets from Dobson and Barnett 2018</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/">parameters</a></span><span class="op">)</span> <span class="co"># format model output tables for markdown</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://conflicted.r-lib.org/">conflicted</a></span><span class="op">)</span> <span class="co"># check for conflicting function definitions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="understanding-gaussian-linear-regression-models" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="understanding-gaussian-linear-regression-models">
<span class="header-section-number">2.1</span> Understanding Gaussian Linear Regression Models</h2>
<section id="motivating-example-birthweights-and-gestational-age" class="level3" data-number="2.1.1"><h3 data-number="2.1.1" class="anchored" data-anchor-id="motivating-example-birthweights-and-gestational-age">
<span class="header-section-number">2.1.1</span> Motivating example: birthweights and gestational age</h3>
<p>Suppose we want to learn about the distributions of birthweights for (human) babies born at different gestational ages and with different chromosomal sexes (Dobson and Barnett, Example 2.2.2):</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-3_4e6ef4d4d48ac70e6337924723486af5">
<details><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"birthweight"</span>, package <span class="op">=</span> <span class="st">"dobson"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">birthweight</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">".value"</span><span class="op">)</span>,</span>
<span>    names_sep <span class="op">=</span> <span class="st">"s "</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"boy"</span>, <span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span>,</span>
<span>    male <span class="op">=</span> <span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">`gestational age`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-4_7b22d832eaf7b0776a603ded3a65cf74">
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot1</span> <span class="op">=</span> <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">age</span>, </span>
<span>    y <span class="op">=</span> <span class="va">weight</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    shape <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    col <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Gestational age (weeks)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Birthweight (grams)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># expand_limits(y = 0, x = 0) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-5_0693556edbff9c1d8dfbdcee50727397">
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">plot1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-32fd0092e8c6ed58c459" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-32fd0092e8c6ed58c459">{"x":{"data":[{"x":[40,36,40,38,42,39,40,37,36,38,39,40],"y":[3317,2729,2935,2754,3210,2817,3126,2539,2412,2991,2875,3231],"text":["age: 40<br />weight: 3317<br />sex: female<br />sex: female<br />sex: female","age: 36<br />weight: 2729<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 2935<br />sex: female<br />sex: female<br />sex: female","age: 38<br />weight: 2754<br />sex: female<br />sex: female<br />sex: female","age: 42<br />weight: 3210<br />sex: female<br />sex: female<br />sex: female","age: 39<br />weight: 2817<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3126<br />sex: female<br />sex: female<br />sex: female","age: 37<br />weight: 2539<br />sex: female<br />sex: female<br />sex: female","age: 36<br />weight: 2412<br />sex: female<br />sex: female<br />sex: female","age: 38<br />weight: 2991<br />sex: female<br />sex: female<br />sex: female","age: 39<br />weight: 2875<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3231<br />sex: female<br />sex: female<br />sex: female"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"female","legendgroup":"female","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[40,38,40,35,36,37,41,40,37,38,40,38],"y":[2968,2795,3163,2925,2625,2847,3292,3473,2628,3176,3421,2975],"text":["age: 40<br />weight: 2968<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 2795<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3163<br />sex: male<br />sex: male<br />sex: male","age: 35<br />weight: 2925<br />sex: male<br />sex: male<br />sex: male","age: 36<br />weight: 2625<br />sex: male<br />sex: male<br />sex: male","age: 37<br />weight: 2847<br />sex: male<br />sex: male<br />sex: male","age: 41<br />weight: 3292<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3473<br />sex: male<br />sex: male<br />sex: male","age: 37<br />weight: 2628<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 3176<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3421<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 2975<br />sex: male<br />sex: male<br />sex: male"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":5.6692913385826778,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"male","legendgroup":"male","showlegend":true,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.917808219178085,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,0.49592302674494454],"automargin":true,"type":"linear","autorange":false,"range":[34.649999999999999,42.350000000000001],"tickmode":"array","ticktext":["36","38","40","42"],"tickvals":[36,38,40,42],"categoryorder":"array","categoryarray":["36","38","40","42"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"Gestational age (weeks)","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.917808219178088},{"text":"Birthweight (grams)","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-33.607305936073068},{"text":"female","x":0.24796151337247227,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"male","x":0.7520384866275277,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2358.9499999999998,3526.0500000000002],"tickmode":"array","ticktext":["2400","2700","3000","3300"],"tickvals":[2400,2700,3000,3300],"categoryorder":"array","categoryarray":["2400","2700","3000","3300"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.49592302674494454,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.49592302674494454,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.5040769732550554,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.5040769732550554,"x1":1,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[34.649999999999999,42.350000000000001],"tickmode":"array","ticktext":["36","38","40","42"],"tickvals":[36,38,40,42],"categoryorder":"array","categoryarray":["36","38","40","42"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.5040769732550554,1],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"sex","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd8402547a9":{"x":{},"y":{},"linetype":{},"shape":{},"colour":{},"type":"scatter"}},"cur_data":"4dd8402547a9","visdat":{"4dd8402547a9":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section id="parallel-lines-regression" class="level3" data-number="2.1.2"><h3 data-number="2.1.2" class="anchored" data-anchor-id="parallel-lines-regression">
<span class="header-section-number">2.1.2</span> Parallel lines regression</h3>
<p>We don’t have enough data to model the distribution of birth weight separately for each combination of gestational age and sex, so let’s instead consider a (relatively) simple model for how that distribution varies with gestational age and sex.</p>
<section id="notation" class="level4"><h4 class="anchored" data-anchor-id="notation">Notation</h4>
<p>Let:</p>
<ul>
<li>
<span class="math inline">\(Y\)</span> represent birthweight (measured in grams)</li>
<li>
<span class="math inline">\(X_1\)</span> represent chromosomal sex:
<ul>
<li>
<span class="math inline">\(X_1 = 0\)</span> if female (XX)</li>
<li>
<span class="math inline">\(X_1 = 1\)</span> if male (XY)</li>
</ul>
</li>
<li>
<span class="math inline">\(X_2\)</span> represent gestational age at birth (measured in weeks).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Female is the <strong>reference level</strong> for the categorical variable <span class="math inline">\(X_1\)</span> (chromosomal sex). The choice of a reference level is arbitrary and does not limit what we can do with the resulting model; it only makes it more computationally convenient to make inferences about comparisons involving that reference group.</p>
</div>
</div>
<p>Now, consider the following model:</p>
<p><span class="math display">\[Y \sim N(\mu(X_1,X_2), \sigma^2)\]</span></p>
<p><span class="math display">\[\mu(X_1,X_2)\stackrel{\text{def}}{=}E[Y|X_1, X_2] = \beta_0 + \beta_1 X_1+ \beta_2 X_2\]</span></p>
</section><section id="implementing-the-model-in-r" class="level4"><h4 class="anchored" data-anchor-id="implementing-the-model-in-r">Implementing the Model in R</h4>
<p>Here’s how we can implement this model in R:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-7_25d7ef1d503e3400d0d2948a0122505e">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span>, </span>
<span>  data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bw_lm1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span>show_sigma <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 30%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(21)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-1773.32</td>
<td style="text-align: center;">794.59</td>
<td style="text-align: center;">(-3425.75, -120.89)</td>
<td style="text-align: center;">-2.23</td>
<td style="text-align: center;">0.037</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">163.04</td>
<td style="text-align: center;">72.81</td>
<td style="text-align: center;">(11.63, 314.45)</td>
<td style="text-align: center;">2.24</td>
<td style="text-align: center;">0.036</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: center;">120.89</td>
<td style="text-align: center;">20.46</td>
<td style="text-align: center;">(78.34, 163.45)</td>
<td style="text-align: center;">5.91</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here’s how this model looks, superimposed on the data:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-8_3f9ba253c42f5091a7c4d2b153fd206b">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`E[Y|X=x]` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">=</span> </span>
<span>  <span class="va">plot1</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html">%+%</a></span> <span class="va">bw</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">`E[Y|X=x]`</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-10_099f59c25104ac854dbf04ea0060159c">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">plot2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b30648f4f0858e69ef94" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b30648f4f0858e69ef94">{"x":{"data":[{"x":[36,36,37,38,38,39,39,40,40,40,40,42],"y":[2729,2412,2539,2754,2991,2817,2875,3317,2935,3126,3231,3210],"text":["age: 36<br />weight: 2729<br />sex: female<br />sex: female<br />sex: female","age: 36<br />weight: 2412<br />sex: female<br />sex: female<br />sex: female","age: 37<br />weight: 2539<br />sex: female<br />sex: female<br />sex: female","age: 38<br />weight: 2754<br />sex: female<br />sex: female<br />sex: female","age: 38<br />weight: 2991<br />sex: female<br />sex: female<br />sex: female","age: 39<br />weight: 2817<br />sex: female<br />sex: female<br />sex: female","age: 39<br />weight: 2875<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3317<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 2935<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3126<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3231<br />sex: female<br />sex: female<br />sex: female","age: 42<br />weight: 3210<br />sex: female<br />sex: female<br />sex: female"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"female","legendgroup":"female","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[35,36,37,37,38,38,38,40,40,40,40,41],"y":[2925,2625,2847,2628,2795,3176,2975,2968,3163,3473,3421,3292],"text":["age: 35<br />weight: 2925<br />sex: male<br />sex: male<br />sex: male","age: 36<br />weight: 2625<br />sex: male<br />sex: male<br />sex: male","age: 37<br />weight: 2847<br />sex: male<br />sex: male<br />sex: male","age: 37<br />weight: 2628<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 2795<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 3176<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 2975<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 2968<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3163<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3473<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3421<br />sex: male<br />sex: male<br />sex: male","age: 41<br />weight: 3292<br />sex: male<br />sex: male<br />sex: male"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":5.6692913385826778,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"male","legendgroup":"male","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[36,36,37,38,38,39,39,40,40,40,40,42],"y":[2578.8739340007401,2578.8739340007401,2699.7682610307743,2820.662588060808,2820.662588060808,2941.5569150908418,2941.5569150908418,3062.4512421208756,3062.4512421208756,3062.4512421208756,3062.4512421208756,3304.2398961809436],"text":["age: 36<br />E[Y|X=x]: 2579<br />sex: female<br />sex: female<br />sex: female","age: 36<br />E[Y|X=x]: 2579<br />sex: female<br />sex: female<br />sex: female","age: 37<br />E[Y|X=x]: 2700<br />sex: female<br />sex: female<br />sex: female","age: 38<br />E[Y|X=x]: 2821<br />sex: female<br />sex: female<br />sex: female","age: 38<br />E[Y|X=x]: 2821<br />sex: female<br />sex: female<br />sex: female","age: 39<br />E[Y|X=x]: 2942<br />sex: female<br />sex: female<br />sex: female","age: 39<br />E[Y|X=x]: 2942<br />sex: female<br />sex: female<br />sex: female","age: 40<br />E[Y|X=x]: 3062<br />sex: female<br />sex: female<br />sex: female","age: 40<br />E[Y|X=x]: 3062<br />sex: female<br />sex: female<br />sex: female","age: 40<br />E[Y|X=x]: 3062<br />sex: female<br />sex: female<br />sex: female","age: 40<br />E[Y|X=x]: 3062<br />sex: female<br />sex: female<br />sex: female","age: 42<br />E[Y|X=x]: 3304<br />sex: female<br />sex: female<br />sex: female"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"female","legendgroup":"female","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[35,36,37,37,38,38,38,40,40,40,40,41],"y":[2621.0189098998881,2741.9132369299218,2862.8075639599556,2862.8075639599556,2983.7018909899903,2983.7018909899898,2983.7018909899898,3225.4905450500451,3225.4905450500573,3225.4905450500573,3225.4905450500573,3346.3848720800911],"text":["age: 35<br />E[Y|X=x]: 2621<br />sex: male<br />sex: male<br />sex: male","age: 36<br />E[Y|X=x]: 2742<br />sex: male<br />sex: male<br />sex: male","age: 37<br />E[Y|X=x]: 2863<br />sex: male<br />sex: male<br />sex: male","age: 37<br />E[Y|X=x]: 2863<br />sex: male<br />sex: male<br />sex: male","age: 38<br />E[Y|X=x]: 2984<br />sex: male<br />sex: male<br />sex: male","age: 38<br />E[Y|X=x]: 2984<br />sex: male<br />sex: male<br />sex: male","age: 38<br />E[Y|X=x]: 2984<br />sex: male<br />sex: male<br />sex: male","age: 40<br />E[Y|X=x]: 3225<br />sex: male<br />sex: male<br />sex: male","age: 40<br />E[Y|X=x]: 3225<br />sex: male<br />sex: male<br />sex: male","age: 40<br />E[Y|X=x]: 3225<br />sex: male<br />sex: male<br />sex: male","age: 40<br />E[Y|X=x]: 3225<br />sex: male<br />sex: male<br />sex: male","age: 41<br />E[Y|X=x]: 3346<br />sex: male<br />sex: male<br />sex: male"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"dash"},"hoveron":"points","name":"male","legendgroup":"male","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[34.649999999999999,42.350000000000001],"tickmode":"array","ticktext":["36","38","40","42"],"tickvals":[36,38,40,42],"categoryorder":"array","categoryarray":["36","38","40","42"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Gestational age (weeks)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2358.9499999999998,3526.0500000000002],"tickmode":"array","ticktext":["2400","2700","3000","3300"],"tickvals":[2400,2700,3000,3300],"categoryorder":"array","categoryarray":["2400","2700","3000","3300"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Birthweight (grams)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"sex","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd872683150":{"x":{},"y":{},"linetype":{},"shape":{},"colour":{},"type":"scatter"},"4dd8165e5892":{"x":{},"y":{},"linetype":{},"shape":{},"colour":{}}},"cur_data":"4dd872683150","visdat":{"4dd872683150":["function (y) ","x"],"4dd8165e5892":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>Parallel-slopes model of birthweight</p>
</div>
</div>
</section><section id="model-assumptions-and-predictions" class="level4"><h4 class="anchored" data-anchor-id="model-assumptions-and-predictions">Model assumptions and predictions</h4>
<p>To learn what this model is assuming, let’s plug in a few values.</p>
<p>According to this model, what’s the mean birthweight for a female born at 36 weeks?</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-11_d7b3887c865de502696e06e525c44250">
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_female</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span></span>
<span></span>
<span><span class="co"># print(pred_female)</span></span>
<span><span class="co">## built-in prediction: </span></span>
<span><span class="co"># predict(bw_lm1, newdata = tibble(sex = "female", age = 36))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[E[Y|X_1 = 0, X_2 = 36] = \beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36 =  2578.8739\]</span></p>
<p>What’s the mean birthweight for a male born at 36 weeks?</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-12_84d58b89c22162e62ccfaaba4c296c90">
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_male</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
E[Y|X_1 = 1, X_2 = 36] = \beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36 =  2741.9132
\]</span></p>
<p>What’s the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</p>
<p><span class="math display">\[
\begin{aligned}
&amp; E[Y|X_1 = 1, X_2 = 36] - E[Y|X_1 = 0, X_2 = 36]\\
&amp;=
2741.9132 - 2578.8739\\
&amp;=
163.0393
\end{aligned}
\]</span></p>
<p>Shortcut:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; E[Y|X_1 = 1, X_2 = 36] -
E[Y|X_1 = 0, X_2 = 36]\\
&amp;= (\beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36) - (\beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36) \\
&amp;= \beta_1 \\
&amp;=  163.0393
\end{aligned}
\]</span></p>
<p>Note that age doesn’t show up in this difference: in other words, according to this model, the difference between females and males with the same gestational age is the same for every age.</p>
<p>That’s an assumption of the model; it’s built-in to the parametric structure, even before we plug in the estimated values of those parameters.</p>
<p>That’s why the lines are parallel.</p>
</section></section><section id="interactions" class="level3" data-number="2.1.3"><h3 data-number="2.1.3" class="anchored" data-anchor-id="interactions">
<span class="header-section-number">2.1.3</span> Interactions</h3>
<p>What if we don’t like that parallel lines assumption?</p>
<p>Then we need to allow an “interaction” between age and sex:</p>
<p><span class="math display">\[
E[Y|X_1, X_2] = \beta_0 + \beta_1 X_1+ \beta_2 X_2 + \beta_3 (X_1 \cdot X_2)
\]</span></p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-13_b3ddc00ea07346d4be1bf1f0b56933a4">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are the estimated parameters (<span class="math inline">\(\beta\)</span>s):</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-14_10482dca2dda38c87a50587ef3c3e6da">
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
<td style="text-align: center;">1163.60</td>
<td style="text-align: center;">(-4568.90, 285.56)</td>
<td style="text-align: center;">-1.84</td>
<td style="text-align: center;">0.081</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
<td style="text-align: center;">1611.33</td>
<td style="text-align: center;">(-2488.18, 4234.17)</td>
<td style="text-align: center;">0.54</td>
<td style="text-align: center;">0.594</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here’s another way we could rewrite this model (by collecting terms involving <span class="math inline">\(X_2\)</span>):</p>
<p><span class="math display">\[
E[Y|X_1, X_2] = \beta_0 + \beta_1 X_1+ (\beta_2 + \beta_3 X_1) X_2
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to understand a coefficient in a model with interactions, collect terms for the corresponding variable, and you will see what other variables are interacting with the variable you are interested in.</p>
</div>
</div>
<p>In this case, the coefficient <span class="math inline">\(X_2\)</span> is interacting with <span class="math inline">\(X_1\)</span>. So the slope of <span class="math inline">\(Y\)</span> with respect to <span class="math inline">\(X_2\)</span> depends on the value of <span class="math inline">\(X_2\)</span>.</p>
<p>According to this model, there is no such thing as “<em>the</em> slope of birthweight with respect to age”. There are two slopes, one for each sex.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> We can only talk about “the slope of birthweight with respect to age among males” and “the slope of birthweight with respect to age among females”.</p>
<p>Then: that coefficient is the difference in means per unit change in its corresponding coefficient, when the other collected variables are set to 0.</p>
<p>Here’s how this model looks, superimposed on the data:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-15_e1b7d16686d1f062b6d2e0db7cf3076f">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predlm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1_interact</span> <span class="op">=</span> </span>
<span>  <span class="va">plot1</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html">%+%</a></span> <span class="va">bw</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">predlm2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-17_92f422935973d442f0158987e43f2530">
<details><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">plot1_interact</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2a72d3f2935bc3c8e0d9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2a72d3f2935bc3c8e0d9">{"x":{"data":[{"x":[36,36,37,38,38,39,39,40,40,40,40,42],"y":[2729,2412,2539,2754,2991,2817,2875,3317,2935,3126,3231,3210],"text":["age: 36<br />weight: 2729<br />sex: female<br />sex: female<br />sex: female","age: 36<br />weight: 2412<br />sex: female<br />sex: female<br />sex: female","age: 37<br />weight: 2539<br />sex: female<br />sex: female<br />sex: female","age: 38<br />weight: 2754<br />sex: female<br />sex: female<br />sex: female","age: 38<br />weight: 2991<br />sex: female<br />sex: female<br />sex: female","age: 39<br />weight: 2817<br />sex: female<br />sex: female<br />sex: female","age: 39<br />weight: 2875<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3317<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 2935<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3126<br />sex: female<br />sex: female<br />sex: female","age: 40<br />weight: 3231<br />sex: female<br />sex: female<br />sex: female","age: 42<br />weight: 3210<br />sex: female<br />sex: female<br />sex: female"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":0.69999999999999996,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"female","legendgroup":"female","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[35,36,37,37,38,38,38,40,40,40,40,41],"y":[2925,2625,2847,2628,2795,3176,2975,2968,3163,3473,3421,3292],"text":["age: 35<br />weight: 2925<br />sex: male<br />sex: male<br />sex: male","age: 36<br />weight: 2625<br />sex: male<br />sex: male<br />sex: male","age: 37<br />weight: 2847<br />sex: male<br />sex: male<br />sex: male","age: 37<br />weight: 2628<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 2795<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 3176<br />sex: male<br />sex: male<br />sex: male","age: 38<br />weight: 2975<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 2968<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3163<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3473<br />sex: male<br />sex: male<br />sex: male","age: 40<br />weight: 3421<br />sex: male<br />sex: male<br />sex: male","age: 41<br />weight: 3292<br />sex: male<br />sex: male<br />sex: male"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":0.69999999999999996,"size":5.6692913385826778,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"male","legendgroup":"male","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[36,36,37,38,38,39,39,40,40,40,40,42],"y":[2552.7333333333404,2552.7333333333404,2683.1333333333391,2813.5333333333388,2813.5333333333388,2943.9333333333375,2943.9333333333375,3074.3333333333362,3074.3333333333362,3074.3333333333362,3074.3333333333362,3335.1333333333337],"text":["age: 36<br />predlm2: 2553<br />sex: female<br />sex: female<br />sex: female","age: 36<br />predlm2: 2553<br />sex: female<br />sex: female<br />sex: female","age: 37<br />predlm2: 2683<br />sex: female<br />sex: female<br />sex: female","age: 38<br />predlm2: 2814<br />sex: female<br />sex: female<br />sex: female","age: 38<br />predlm2: 2814<br />sex: female<br />sex: female<br />sex: female","age: 39<br />predlm2: 2944<br />sex: female<br />sex: female<br />sex: female","age: 39<br />predlm2: 2944<br />sex: female<br />sex: female<br />sex: female","age: 40<br />predlm2: 3074<br />sex: female<br />sex: female<br />sex: female","age: 40<br />predlm2: 3074<br />sex: female<br />sex: female<br />sex: female","age: 40<br />predlm2: 3074<br />sex: female<br />sex: female<br />sex: female","age: 40<br />predlm2: 3074<br />sex: female<br />sex: female<br />sex: female","age: 42<br />predlm2: 3335<br />sex: female<br />sex: female<br />sex: female"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"female","legendgroup":"female","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[35,36,37,37,38,38,38,40,40,40,40,41],"y":[2650.7241379310381,2762.7068965517274,2874.6896551724167,2874.6896551724167,2986.6724137931069,2986.6724137931069,2986.6724137931069,3210.637931034486,3210.637931034486,3210.637931034486,3210.637931034486,3322.6206896551753],"text":["age: 35<br />predlm2: 2651<br />sex: male<br />sex: male<br />sex: male","age: 36<br />predlm2: 2763<br />sex: male<br />sex: male<br />sex: male","age: 37<br />predlm2: 2875<br />sex: male<br />sex: male<br />sex: male","age: 37<br />predlm2: 2875<br />sex: male<br />sex: male<br />sex: male","age: 38<br />predlm2: 2987<br />sex: male<br />sex: male<br />sex: male","age: 38<br />predlm2: 2987<br />sex: male<br />sex: male<br />sex: male","age: 38<br />predlm2: 2987<br />sex: male<br />sex: male<br />sex: male","age: 40<br />predlm2: 3211<br />sex: male<br />sex: male<br />sex: male","age: 40<br />predlm2: 3211<br />sex: male<br />sex: male<br />sex: male","age: 40<br />predlm2: 3211<br />sex: male<br />sex: male<br />sex: male","age: 40<br />predlm2: 3211<br />sex: male<br />sex: male<br />sex: male","age: 41<br />predlm2: 3323<br />sex: male<br />sex: male<br />sex: male"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"dash"},"hoveron":"points","name":"male","legendgroup":"male","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[34.649999999999999,42.350000000000001],"tickmode":"array","ticktext":["36","38","40","42"],"tickvals":[36,38,40,42],"categoryorder":"array","categoryarray":["36","38","40","42"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Gestational age (weeks)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2358.9499999999998,3526.0500000000002],"tickmode":"array","ticktext":["2400","2700","3000","3300"],"tickvals":[2400,2700,3000,3300],"categoryorder":"array","categoryarray":["2400","2700","3000","3300"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Birthweight (grams)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"sex","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd81c7e71b":{"x":{},"y":{},"linetype":{},"shape":{},"colour":{},"type":"scatter"},"4dd82581013":{"x":{},"y":{},"linetype":{},"shape":{},"colour":{}}},"cur_data":"4dd81c7e71b","visdat":{"4dd81c7e71b":["function (y) ","x"],"4dd82581013":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now we can see that the lines aren’t parallel.</p>
<p>To learn what this model is assuming, let’s plug in a few values.</p>
<p>According to this model, what’s the mean birthweight for a female born at 36 weeks?</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-18_1fc56bc8e9c96714a560e01af77a0969">
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_female</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[E[Y|X_1 = 0, X_2 = 36] = \beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36 + \beta_3 \cdot (0 * 36) =  2552.7333\]</span> What’s the mean birthweight for a male born at 36 weeks?</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-19_4f542a0605575d0310a7d5460d651599">
<details><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_male</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale:age"</span><span class="op">]</span> <span class="op">*</span> <span class="fl">36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[E[Y|X_1 = 0, X_2 = 36] = \beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36 + \beta_3 \cdot 1 \cdot 36 =  2762.7069\]</span></p>
<p>What’s the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</p>
<p><span class="math display">\[
\begin{aligned}
&amp; E[Y|X_1 = 1, X_2 = 36] - E[Y|X_1 = 0, X_2 = 36]\\
&amp;= (\beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36 + \beta_3 \cdot 1 \cdot 36)\\
&amp;\ \ \ \ \  -(\beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36 + \beta_3 \cdot 0 \cdot 36) \\
&amp;= \beta_2 + \beta_3\cdot 36\\
&amp;=  209.9736
\end{aligned}
\]</span></p>
<p>Note that age now does show up in the difference: in other words, according to this model, the difference in mean birthweights between females and males with the same gestational age can vary by gestational age.</p>
<p>That’s how the lines in the graph ended up non-parallel.</p>
</section><section id="stratified-regression" class="level3" data-number="2.1.4"><h3 data-number="2.1.4" class="anchored" data-anchor-id="stratified-regression">
<span class="header-section-number">2.1.4</span> Stratified regression</h3>
<p>We could re-write the interaction model as a stratified model, with a slope and intercept for each sex:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-20_76a24a3c3175edd8fddd45700783c699">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm_strat</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>    data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bw_lm_strat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 27%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sex (female)</td>
<td style="text-align: center;">-2141.67</td>
<td style="text-align: center;">1163.60</td>
<td style="text-align: center;">(-4568.90, 285.56)</td>
<td style="text-align: center;">-1.84</td>
<td style="text-align: center;">0.081</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">-1268.67</td>
<td style="text-align: center;">1114.64</td>
<td style="text-align: center;">(-3593.77, 1056.42)</td>
<td style="text-align: center;">-1.14</td>
<td style="text-align: center;">0.268</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (female) × age</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">111.98</td>
<td style="text-align: center;">29.05</td>
<td style="text-align: center;">(51.39, 172.57)</td>
<td style="text-align: center;">3.86</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="curved-line-regression" class="level3" data-number="2.1.5"><h3 data-number="2.1.5" class="anchored" data-anchor-id="curved-line-regression">
<span class="header-section-number">2.1.5</span> Curved-line regression</h3>
<p>If we transform some of our covariates (<span class="math inline">\(X\)</span>s) and plot the resulting model on the original covariate scale, we end up with curved regression lines:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-21_52a60600fc624d6a6be2825e2e7af5fe">
<details><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ggpenguins</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">penguins</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span> , y <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Bill length (mm)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Body mass (g)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ggpenguins2</span> <span class="op">=</span> <span class="va">ggpenguins</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>              geom <span class="op">=</span> <span class="st">"smooth"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Bill length (mm)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Body mass (g)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-23_03b22ae5df3f6ad9209d1bca27388dde">
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ggpenguins2</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a69167fae59d3c576acf" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a69167fae59d3c576acf">{"x":{"data":[{"x":[39.100000000000001,39.5,40.299999999999997,null,36.700000000000003,39.299999999999997,38.899999999999999,39.200000000000003,34.100000000000001,42,37.799999999999997,37.799999999999997,41.100000000000001,38.600000000000001,34.600000000000001,36.600000000000001,38.700000000000003,42.5,34.399999999999999,46,37.799999999999997,37.700000000000003,35.899999999999999,38.200000000000003,38.799999999999997,35.299999999999997,40.600000000000001,40.5,37.899999999999999,40.5,39.5,37.200000000000003,39.5,40.899999999999999,36.399999999999999,39.200000000000003,38.799999999999997,42.200000000000003,37.600000000000001,39.799999999999997,36.5,40.799999999999997,36,44.100000000000001,37,39.600000000000001,41.100000000000001,37.5,36,42.299999999999997,39.600000000000001,40.100000000000001,35,42,34.5,41.399999999999999,39,40.600000000000001,36.5,37.600000000000001,35.700000000000003,41.299999999999997,37.600000000000001,41.100000000000001,36.399999999999999,41.600000000000001,35.5,41.100000000000001,35.899999999999999,41.799999999999997,33.5,39.700000000000003,39.600000000000001,45.799999999999997,35.5,42.799999999999997,40.899999999999999,37.200000000000003,36.200000000000003,42.100000000000001,34.600000000000001,42.899999999999999,36.700000000000003,35.100000000000001,37.299999999999997,41.299999999999997,36.299999999999997,36.899999999999999,38.299999999999997,38.899999999999999,35.700000000000003,41.100000000000001,34,39.600000000000001,36.200000000000003,40.799999999999997,38.100000000000001,40.299999999999997,33.100000000000001,43.200000000000003,35,41,37.700000000000003,37.799999999999997,37.899999999999999,39.700000000000003,38.600000000000001,38.200000000000003,38.100000000000001,43.200000000000003,38.100000000000001,45.600000000000001,39.700000000000003,42.200000000000003,39.600000000000001,42.700000000000003,38.600000000000001,37.299999999999997,35.700000000000003,41.100000000000001,36.200000000000003,37.700000000000003,40.200000000000003,41.399999999999999,35.200000000000003,40.600000000000001,38.799999999999997,41.5,39,44.100000000000001,38.5,43.100000000000001,36.799999999999997,37.5,38.100000000000001,41.100000000000001,35.600000000000001,40.200000000000003,37,39.700000000000003,40.200000000000003,40.600000000000001,32.100000000000001,40.700000000000003,37.299999999999997,39,39.200000000000003,36.600000000000001,36,37.799999999999997,36,41.5],"y":[3750,3800,3250,null,3450,3650,3625,4675,3475,4250,3300,3700,3200,3800,4400,3700,3450,4500,3325,4200,3400,3600,3800,3950,3800,3800,3550,3200,3150,3950,3250,3900,3300,3900,3325,4150,3950,3550,3300,4650,3150,3900,3100,4400,3000,4600,3425,2975,3450,4150,3500,4300,3450,4050,2900,3700,3550,3800,2850,3750,3150,4400,3600,4050,2850,3950,3350,4100,3050,4450,3600,3900,3550,4150,3700,4250,3700,3900,3550,4000,3200,4700,3800,4200,3350,3550,3800,3500,3950,3600,3550,4300,3400,4450,3300,4300,3700,4350,2900,4100,3725,4725,3075,4250,2925,3550,3750,3900,3175,4775,3825,4600,3200,4275,3900,4075,2900,3775,3350,3325,3150,3500,3450,3875,3050,4000,3275,4300,3050,4000,3325,3500,3500,4475,3425,3900,3175,3975,3400,4250,3400,3475,3050,3725,3000,3650,4250,3475,3450,3750,3700,4000],"text":["bill_length_mm: 39.1<br />body_mass_g: 3750","bill_length_mm: 39.5<br />body_mass_g: 3800","bill_length_mm: 40.3<br />body_mass_g: 3250","bill_length_mm:   NA<br />body_mass_g:   NA","bill_length_mm: 36.7<br />body_mass_g: 3450","bill_length_mm: 39.3<br />body_mass_g: 3650","bill_length_mm: 38.9<br />body_mass_g: 3625","bill_length_mm: 39.2<br />body_mass_g: 4675","bill_length_mm: 34.1<br />body_mass_g: 3475","bill_length_mm: 42.0<br />body_mass_g: 4250","bill_length_mm: 37.8<br />body_mass_g: 3300","bill_length_mm: 37.8<br />body_mass_g: 3700","bill_length_mm: 41.1<br />body_mass_g: 3200","bill_length_mm: 38.6<br />body_mass_g: 3800","bill_length_mm: 34.6<br />body_mass_g: 4400","bill_length_mm: 36.6<br />body_mass_g: 3700","bill_length_mm: 38.7<br />body_mass_g: 3450","bill_length_mm: 42.5<br />body_mass_g: 4500","bill_length_mm: 34.4<br />body_mass_g: 3325","bill_length_mm: 46.0<br />body_mass_g: 4200","bill_length_mm: 37.8<br />body_mass_g: 3400","bill_length_mm: 37.7<br />body_mass_g: 3600","bill_length_mm: 35.9<br />body_mass_g: 3800","bill_length_mm: 38.2<br />body_mass_g: 3950","bill_length_mm: 38.8<br />body_mass_g: 3800","bill_length_mm: 35.3<br />body_mass_g: 3800","bill_length_mm: 40.6<br />body_mass_g: 3550","bill_length_mm: 40.5<br />body_mass_g: 3200","bill_length_mm: 37.9<br />body_mass_g: 3150","bill_length_mm: 40.5<br />body_mass_g: 3950","bill_length_mm: 39.5<br />body_mass_g: 3250","bill_length_mm: 37.2<br />body_mass_g: 3900","bill_length_mm: 39.5<br />body_mass_g: 3300","bill_length_mm: 40.9<br />body_mass_g: 3900","bill_length_mm: 36.4<br />body_mass_g: 3325","bill_length_mm: 39.2<br />body_mass_g: 4150","bill_length_mm: 38.8<br />body_mass_g: 3950","bill_length_mm: 42.2<br />body_mass_g: 3550","bill_length_mm: 37.6<br />body_mass_g: 3300","bill_length_mm: 39.8<br />body_mass_g: 4650","bill_length_mm: 36.5<br />body_mass_g: 3150","bill_length_mm: 40.8<br />body_mass_g: 3900","bill_length_mm: 36.0<br />body_mass_g: 3100","bill_length_mm: 44.1<br />body_mass_g: 4400","bill_length_mm: 37.0<br />body_mass_g: 3000","bill_length_mm: 39.6<br />body_mass_g: 4600","bill_length_mm: 41.1<br />body_mass_g: 3425","bill_length_mm: 37.5<br />body_mass_g: 2975","bill_length_mm: 36.0<br />body_mass_g: 3450","bill_length_mm: 42.3<br />body_mass_g: 4150","bill_length_mm: 39.6<br />body_mass_g: 3500","bill_length_mm: 40.1<br />body_mass_g: 4300","bill_length_mm: 35.0<br />body_mass_g: 3450","bill_length_mm: 42.0<br />body_mass_g: 4050","bill_length_mm: 34.5<br />body_mass_g: 2900","bill_length_mm: 41.4<br />body_mass_g: 3700","bill_length_mm: 39.0<br />body_mass_g: 3550","bill_length_mm: 40.6<br />body_mass_g: 3800","bill_length_mm: 36.5<br />body_mass_g: 2850","bill_length_mm: 37.6<br />body_mass_g: 3750","bill_length_mm: 35.7<br />body_mass_g: 3150","bill_length_mm: 41.3<br />body_mass_g: 4400","bill_length_mm: 37.6<br />body_mass_g: 3600","bill_length_mm: 41.1<br />body_mass_g: 4050","bill_length_mm: 36.4<br />body_mass_g: 2850","bill_length_mm: 41.6<br />body_mass_g: 3950","bill_length_mm: 35.5<br />body_mass_g: 3350","bill_length_mm: 41.1<br />body_mass_g: 4100","bill_length_mm: 35.9<br />body_mass_g: 3050","bill_length_mm: 41.8<br />body_mass_g: 4450","bill_length_mm: 33.5<br />body_mass_g: 3600","bill_length_mm: 39.7<br />body_mass_g: 3900","bill_length_mm: 39.6<br />body_mass_g: 3550","bill_length_mm: 45.8<br />body_mass_g: 4150","bill_length_mm: 35.5<br />body_mass_g: 3700","bill_length_mm: 42.8<br />body_mass_g: 4250","bill_length_mm: 40.9<br />body_mass_g: 3700","bill_length_mm: 37.2<br />body_mass_g: 3900","bill_length_mm: 36.2<br />body_mass_g: 3550","bill_length_mm: 42.1<br />body_mass_g: 4000","bill_length_mm: 34.6<br />body_mass_g: 3200","bill_length_mm: 42.9<br />body_mass_g: 4700","bill_length_mm: 36.7<br />body_mass_g: 3800","bill_length_mm: 35.1<br />body_mass_g: 4200","bill_length_mm: 37.3<br />body_mass_g: 3350","bill_length_mm: 41.3<br />body_mass_g: 3550","bill_length_mm: 36.3<br />body_mass_g: 3800","bill_length_mm: 36.9<br />body_mass_g: 3500","bill_length_mm: 38.3<br />body_mass_g: 3950","bill_length_mm: 38.9<br />body_mass_g: 3600","bill_length_mm: 35.7<br />body_mass_g: 3550","bill_length_mm: 41.1<br />body_mass_g: 4300","bill_length_mm: 34.0<br />body_mass_g: 3400","bill_length_mm: 39.6<br />body_mass_g: 4450","bill_length_mm: 36.2<br />body_mass_g: 3300","bill_length_mm: 40.8<br />body_mass_g: 4300","bill_length_mm: 38.1<br />body_mass_g: 3700","bill_length_mm: 40.3<br />body_mass_g: 4350","bill_length_mm: 33.1<br />body_mass_g: 2900","bill_length_mm: 43.2<br />body_mass_g: 4100","bill_length_mm: 35.0<br />body_mass_g: 3725","bill_length_mm: 41.0<br />body_mass_g: 4725","bill_length_mm: 37.7<br />body_mass_g: 3075","bill_length_mm: 37.8<br />body_mass_g: 4250","bill_length_mm: 37.9<br />body_mass_g: 2925","bill_length_mm: 39.7<br />body_mass_g: 3550","bill_length_mm: 38.6<br />body_mass_g: 3750","bill_length_mm: 38.2<br />body_mass_g: 3900","bill_length_mm: 38.1<br />body_mass_g: 3175","bill_length_mm: 43.2<br />body_mass_g: 4775","bill_length_mm: 38.1<br />body_mass_g: 3825","bill_length_mm: 45.6<br />body_mass_g: 4600","bill_length_mm: 39.7<br />body_mass_g: 3200","bill_length_mm: 42.2<br />body_mass_g: 4275","bill_length_mm: 39.6<br />body_mass_g: 3900","bill_length_mm: 42.7<br />body_mass_g: 4075","bill_length_mm: 38.6<br />body_mass_g: 2900","bill_length_mm: 37.3<br />body_mass_g: 3775","bill_length_mm: 35.7<br />body_mass_g: 3350","bill_length_mm: 41.1<br />body_mass_g: 3325","bill_length_mm: 36.2<br />body_mass_g: 3150","bill_length_mm: 37.7<br />body_mass_g: 3500","bill_length_mm: 40.2<br />body_mass_g: 3450","bill_length_mm: 41.4<br />body_mass_g: 3875","bill_length_mm: 35.2<br />body_mass_g: 3050","bill_length_mm: 40.6<br />body_mass_g: 4000","bill_length_mm: 38.8<br />body_mass_g: 3275","bill_length_mm: 41.5<br />body_mass_g: 4300","bill_length_mm: 39.0<br />body_mass_g: 3050","bill_length_mm: 44.1<br />body_mass_g: 4000","bill_length_mm: 38.5<br />body_mass_g: 3325","bill_length_mm: 43.1<br />body_mass_g: 3500","bill_length_mm: 36.8<br />body_mass_g: 3500","bill_length_mm: 37.5<br />body_mass_g: 4475","bill_length_mm: 38.1<br />body_mass_g: 3425","bill_length_mm: 41.1<br />body_mass_g: 3900","bill_length_mm: 35.6<br />body_mass_g: 3175","bill_length_mm: 40.2<br />body_mass_g: 3975","bill_length_mm: 37.0<br />body_mass_g: 3400","bill_length_mm: 39.7<br />body_mass_g: 4250","bill_length_mm: 40.2<br />body_mass_g: 3400","bill_length_mm: 40.6<br />body_mass_g: 3475","bill_length_mm: 32.1<br />body_mass_g: 3050","bill_length_mm: 40.7<br />body_mass_g: 3725","bill_length_mm: 37.3<br />body_mass_g: 3000","bill_length_mm: 39.0<br />body_mass_g: 3650","bill_length_mm: 39.2<br />body_mass_g: 4250","bill_length_mm: 36.6<br />body_mass_g: 3475","bill_length_mm: 36.0<br />body_mass_g: 3450","bill_length_mm: 37.8<br />body_mass_g: 3750","bill_length_mm: 36.0<br />body_mass_g: 3700","bill_length_mm: 41.5<br />body_mass_g: 4000"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[32.100000000000001,32.275949367088607,32.451898734177213,32.627848101265826,32.803797468354432,32.979746835443038,33.155696202531644,33.331645569620257,33.507594936708863,33.683544303797468,33.859493670886074,34.035443037974687,34.211392405063293,34.387341772151899,34.563291139240505,34.739240506329118,34.915189873417724,35.09113924050633,35.267088607594935,35.443037974683548,35.618987341772154,35.79493670886076,35.970886075949366,36.146835443037979,36.322784810126585,36.498734177215191,36.674683544303797,36.85063291139241,37.026582278481015,37.202531645569621,37.378481012658227,37.554430379746833,37.730379746835446,37.906329113924052,38.082278481012658,38.258227848101271,38.434177215189877,38.610126582278482,38.786075949367088,38.962025316455694,39.137974683544307,39.313924050632913,39.489873417721519,39.665822784810125,39.841772151898738,40.017721518987344,40.19367088607595,40.369620253164555,40.545569620253161,40.721518987341774,40.89746835443038,41.073417721518986,41.249367088607599,41.425316455696205,41.601265822784811,41.777215189873417,41.953164556962022,42.129113924050635,42.305063291139241,42.481012658227847,42.65696202531646,42.832911392405066,43.008860759493672,43.184810126582278,43.360759493670884,43.536708860759497,43.712658227848102,43.888607594936708,44.064556962025321,44.240506329113927,44.416455696202533,44.592405063291139,44.768354430379745,44.944303797468358,45.120253164556964,45.296202531645569,45.472151898734182,45.648101265822788,45.824050632911394,46],"y":[3019.697336632591,3039.6027761357327,3059.3999974025173,3079.0901707552694,3098.6744476337535,3118.1539609992196,3137.5298257276936,3156.8031389928656,3175.9749806388845,3195.0464135434122,3214.0184839712074,3232.8922219185424,3251.6686414487431,3270.3487410191337,3288.9335037996279,3307.4238979832262,3325.8208770886777,3344.1253802555402,3362.3383325318518,3380.4606451546479,3398.4932158235224,3416.4369289674778,3434.2926560051983,3452.0612555989883,3469.7435739025568,3487.3404448027923,3504.8526901557361,3522.2811200169108,3539.6265328661593,3556.889715827152,3574.0714448817216,3591.1724850791579,3608.1935907406205,3625.1355056587763,3641.9989632928518,3658.7846869591467,3675.4933900171982,3692.1257760517092,3708.6825390503036,3725.1643635772853,3741.5719249434842,3757.9058893722704,3774.1669141618913,3790.3556478441678,3806.472730339714,3822.5187931096989,3838.4944593043219,3854.400343907997,3870.2370538814284,3886.0051883005708,3901.7053384926185,3917.3380881690664,3932.9040135559226,3948.4036835211627,3963.8376596994694,3979.2064966143535,3994.5107417976869,4009.7509359067681,4024.9276128389065,4040.0412998436695,4055.0925176327819,4070.0817804877697,4085.0095963654112,4099.8764670010114,4114.6828880096036,4129.4293489850734,4144.1163335973179,4158.7443196874101,4173.3137793609058,4187.8251790792583,4202.2789797494279,4216.675636811724,4231.0156003259235,4245.2993150556795,4259.5272205512974,4273.6997512309044,4287.8173364600279,4301.880400629645,4315.8893632327454,4329.844638939403],"text":["bill_length_mm: 32.10<br />body_mass_g: 3020","bill_length_mm: 32.28<br />body_mass_g: 3040","bill_length_mm: 32.45<br />body_mass_g: 3059","bill_length_mm: 32.63<br />body_mass_g: 3079","bill_length_mm: 32.80<br />body_mass_g: 3099","bill_length_mm: 32.98<br />body_mass_g: 3118","bill_length_mm: 33.16<br />body_mass_g: 3138","bill_length_mm: 33.33<br />body_mass_g: 3157","bill_length_mm: 33.51<br />body_mass_g: 3176","bill_length_mm: 33.68<br />body_mass_g: 3195","bill_length_mm: 33.86<br />body_mass_g: 3214","bill_length_mm: 34.04<br />body_mass_g: 3233","bill_length_mm: 34.21<br />body_mass_g: 3252","bill_length_mm: 34.39<br />body_mass_g: 3270","bill_length_mm: 34.56<br />body_mass_g: 3289","bill_length_mm: 34.74<br />body_mass_g: 3307","bill_length_mm: 34.92<br />body_mass_g: 3326","bill_length_mm: 35.09<br />body_mass_g: 3344","bill_length_mm: 35.27<br />body_mass_g: 3362","bill_length_mm: 35.44<br />body_mass_g: 3380","bill_length_mm: 35.62<br />body_mass_g: 3398","bill_length_mm: 35.79<br />body_mass_g: 3416","bill_length_mm: 35.97<br />body_mass_g: 3434","bill_length_mm: 36.15<br />body_mass_g: 3452","bill_length_mm: 36.32<br />body_mass_g: 3470","bill_length_mm: 36.50<br />body_mass_g: 3487","bill_length_mm: 36.67<br />body_mass_g: 3505","bill_length_mm: 36.85<br />body_mass_g: 3522","bill_length_mm: 37.03<br />body_mass_g: 3540","bill_length_mm: 37.20<br />body_mass_g: 3557","bill_length_mm: 37.38<br />body_mass_g: 3574","bill_length_mm: 37.55<br />body_mass_g: 3591","bill_length_mm: 37.73<br />body_mass_g: 3608","bill_length_mm: 37.91<br />body_mass_g: 3625","bill_length_mm: 38.08<br />body_mass_g: 3642","bill_length_mm: 38.26<br />body_mass_g: 3659","bill_length_mm: 38.43<br />body_mass_g: 3675","bill_length_mm: 38.61<br />body_mass_g: 3692","bill_length_mm: 38.79<br />body_mass_g: 3709","bill_length_mm: 38.96<br />body_mass_g: 3725","bill_length_mm: 39.14<br />body_mass_g: 3742","bill_length_mm: 39.31<br />body_mass_g: 3758","bill_length_mm: 39.49<br />body_mass_g: 3774","bill_length_mm: 39.67<br />body_mass_g: 3790","bill_length_mm: 39.84<br />body_mass_g: 3806","bill_length_mm: 40.02<br />body_mass_g: 3823","bill_length_mm: 40.19<br />body_mass_g: 3838","bill_length_mm: 40.37<br />body_mass_g: 3854","bill_length_mm: 40.55<br />body_mass_g: 3870","bill_length_mm: 40.72<br />body_mass_g: 3886","bill_length_mm: 40.90<br />body_mass_g: 3902","bill_length_mm: 41.07<br />body_mass_g: 3917","bill_length_mm: 41.25<br />body_mass_g: 3933","bill_length_mm: 41.43<br />body_mass_g: 3948","bill_length_mm: 41.60<br />body_mass_g: 3964","bill_length_mm: 41.78<br />body_mass_g: 3979","bill_length_mm: 41.95<br />body_mass_g: 3995","bill_length_mm: 42.13<br />body_mass_g: 4010","bill_length_mm: 42.31<br />body_mass_g: 4025","bill_length_mm: 42.48<br />body_mass_g: 4040","bill_length_mm: 42.66<br />body_mass_g: 4055","bill_length_mm: 42.83<br />body_mass_g: 4070","bill_length_mm: 43.01<br />body_mass_g: 4085","bill_length_mm: 43.18<br />body_mass_g: 4100","bill_length_mm: 43.36<br />body_mass_g: 4115","bill_length_mm: 43.54<br />body_mass_g: 4129","bill_length_mm: 43.71<br />body_mass_g: 4144","bill_length_mm: 43.89<br />body_mass_g: 4159","bill_length_mm: 44.06<br />body_mass_g: 4173","bill_length_mm: 44.24<br />body_mass_g: 4188","bill_length_mm: 44.42<br />body_mass_g: 4202","bill_length_mm: 44.59<br />body_mass_g: 4217","bill_length_mm: 44.77<br />body_mass_g: 4231","bill_length_mm: 44.94<br />body_mass_g: 4245","bill_length_mm: 45.12<br />body_mass_g: 4260","bill_length_mm: 45.30<br />body_mass_g: 4274","bill_length_mm: 45.47<br />body_mass_g: 4288","bill_length_mm: 45.65<br />body_mass_g: 4302","bill_length_mm: 45.82<br />body_mass_g: 4316","bill_length_mm: 46.00<br />body_mass_g: 4330"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":3.7795275590551185,"color":"rgba(51,102,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[32.100000000000001,32.275949367088607,32.451898734177213,32.627848101265826,32.803797468354432,32.979746835443038,33.155696202531644,33.331645569620257,33.507594936708863,33.683544303797468,33.859493670886074,34.035443037974687,34.211392405063293,34.387341772151899,34.563291139240505,34.739240506329118,34.915189873417724,35.09113924050633,35.267088607594935,35.443037974683548,35.618987341772154,35.79493670886076,35.970886075949366,36.146835443037979,36.322784810126585,36.498734177215191,36.674683544303797,36.85063291139241,37.026582278481015,37.202531645569621,37.378481012658227,37.554430379746833,37.730379746835446,37.906329113924052,38.082278481012658,38.258227848101271,38.434177215189877,38.610126582278482,38.786075949367088,38.962025316455694,39.137974683544307,39.313924050632913,39.489873417721519,39.665822784810125,39.841772151898738,40.017721518987344,40.19367088607595,40.369620253164555,40.545569620253161,40.721518987341774,40.89746835443038,41.073417721518986,41.249367088607599,41.425316455696205,41.601265822784811,41.777215189873417,41.953164556962022,42.129113924050635,42.305063291139241,42.481012658227847,42.65696202531646,42.832911392405066,43.008860759493672,43.184810126582278,43.360759493670884,43.536708860759497,43.712658227848102,43.888607594936708,44.064556962025321,44.240506329113927,44.416455696202533,44.592405063291139,44.768354430379745,44.944303797468358,45.120253164556964,45.296202531645569,45.472151898734182,45.648101265822788,45.824050632911394,46,46,46,45.824050632911394,45.648101265822788,45.472151898734182,45.296202531645569,45.120253164556964,44.944303797468358,44.768354430379745,44.592405063291139,44.416455696202533,44.240506329113927,44.064556962025321,43.888607594936708,43.712658227848102,43.536708860759497,43.360759493670884,43.184810126582278,43.008860759493672,42.832911392405066,42.65696202531646,42.481012658227847,42.305063291139241,42.129113924050635,41.953164556962022,41.777215189873417,41.601265822784811,41.425316455696205,41.249367088607599,41.073417721518986,40.89746835443038,40.721518987341774,40.545569620253161,40.369620253164555,40.19367088607595,40.017721518987344,39.841772151898738,39.665822784810125,39.489873417721519,39.313924050632913,39.137974683544307,38.962025316455694,38.786075949367088,38.610126582278482,38.434177215189877,38.258227848101271,38.082278481012658,37.906329113924052,37.730379746835446,37.554430379746833,37.378481012658227,37.202531645569621,37.026582278481015,36.85063291139241,36.674683544303797,36.498734177215191,36.322784810126585,36.146835443037979,35.970886075949366,35.79493670886076,35.618987341772154,35.443037974683548,35.267088607594935,35.09113924050633,34.915189873417724,34.739240506329118,34.563291139240505,34.387341772151899,34.211392405063293,34.035443037974687,33.859493670886074,33.683544303797468,33.507594936708863,33.331645569620257,33.155696202531644,32.979746835443038,32.803797468354432,32.627848101265826,32.451898734177213,32.275949367088607,32.100000000000001,32.100000000000001],"y":[2839.1844720575841,2863.7352786442716,2888.1353766884513,2912.3850766952828,2936.4845551107869,2960.4338420959134,2984.2328076342624,3007.881145749704,3031.3783565828589,3054.7237260471529,3077.9163027568211,3100.9548718931164,3123.8379256539233,3146.5636299206299,3169.1297867812241,3191.5337925800532,3213.7725912361848,3235.8426227029763,3257.7397666571615,3279.4592818405981,3300.9957419749144,3322.3429698813557,3343.4939724241394,3364.4408802151556,3385.174897715387,3405.6862714493814,3425.9642864387765,3445.9973034476116,3465.7728517994033,3485.2777936893458,3504.4985751049931,3523.4215745200167,3542.0335523475369,3560.3221912107697,3578.2767001153939,3595.8884370985497,3613.1514892638288,3630.0631416705805,3646.6241718383762,3662.8389260312624,3678.7151638212886,3694.2636914760242,3709.4978337607727,3724.432810959458,3739.0850907254307,3753.4717747369614,3767.6100629402385,3781.5168189075748,3795.2082427966247,3808.6996458607377,3822.0053129092753,3835.1384358460646,3848.1111012189403,3860.9343163733356,3873.6180613368169,3886.1713562977534,3898.6023370860171,3910.9183332301955,3923.1259449007262,3935.2311163745358,3947.2392046309465,3959.1550423792514,3970.9829952899158,3982.7270135099761,3994.3906777341622,4005.9772402114349,4017.4896611184831,4028.9306407460458,4040.302647934855,4051.607945174389,4062.8486107466247,4074.0265582624256,4085.1435539030881,4096.201231645533,4107.2011067177991,4118.1445875021645,4129.032986076727,4139.867527562672,4150.6493584234395,4161.3795538434551,4161.3795538434551,4498.3097240353509,4481.1293680420513,4463.8932736966181,4446.6016868433289,4429.2549149596443,4411.8533343847957,4394.397398465826,4376.8876467487589,4359.3247153610228,4341.7093487522316,4324.0424129841276,4306.324910786956,4288.5579986287739,4270.7430060761526,4252.8814577587118,4234.9750982850455,4217.0259204920467,4199.036197440907,4181.008518596288,4162.9458306346169,4144.8514833128029,4126.7292807770864,4108.5835385833407,4090.4191465093568,4072.2416369309535,4054.0572580621219,4035.8730506689899,4017.6969258929048,3999.5377404920682,3981.4053640759616,3963.3107307404039,3945.2658649662321,3927.2838689084192,3909.3788556684053,3891.5658114824364,3873.8603699539972,3856.2784847288776,3838.83599456301,3821.5480872685166,3804.4286860656798,3787.4898011233081,3770.740906262231,3754.1884104328378,3737.8352907705676,3721.6809368197437,3705.7212264703098,3689.9488201067829,3674.3536291337041,3658.9233956382991,3643.6443146584502,3628.5016379649583,3613.4802139329154,3598.56493658621,3583.7410938726957,3568.9946181562032,3554.3122500897266,3539.6816309828209,3525.0913395862572,3510.5308880535999,3495.9906896721304,3481.4620084686976,3466.9368984065422,3452.4081378081041,3437.8691629411705,3423.3140033863992,3408.7372208180318,3394.1338521176376,3379.4993572435628,3364.8295719439684,3350.1206651855937,3335.3691010396715,3320.5716046949101,3305.7251322360271,3290.8268438211248,3275.8740799025259,3260.8643401567201,3245.7952648152559,3230.6646181165834,3215.4702736271938,3200.2102012075979,2839.1844720575841],"text":["bill_length_mm: 32.10<br />body_mass_g: 3020","bill_length_mm: 32.28<br />body_mass_g: 3040","bill_length_mm: 32.45<br />body_mass_g: 3059","bill_length_mm: 32.63<br />body_mass_g: 3079","bill_length_mm: 32.80<br />body_mass_g: 3099","bill_length_mm: 32.98<br />body_mass_g: 3118","bill_length_mm: 33.16<br />body_mass_g: 3138","bill_length_mm: 33.33<br />body_mass_g: 3157","bill_length_mm: 33.51<br />body_mass_g: 3176","bill_length_mm: 33.68<br />body_mass_g: 3195","bill_length_mm: 33.86<br />body_mass_g: 3214","bill_length_mm: 34.04<br />body_mass_g: 3233","bill_length_mm: 34.21<br />body_mass_g: 3252","bill_length_mm: 34.39<br />body_mass_g: 3270","bill_length_mm: 34.56<br />body_mass_g: 3289","bill_length_mm: 34.74<br />body_mass_g: 3307","bill_length_mm: 34.92<br />body_mass_g: 3326","bill_length_mm: 35.09<br />body_mass_g: 3344","bill_length_mm: 35.27<br />body_mass_g: 3362","bill_length_mm: 35.44<br />body_mass_g: 3380","bill_length_mm: 35.62<br />body_mass_g: 3398","bill_length_mm: 35.79<br />body_mass_g: 3416","bill_length_mm: 35.97<br />body_mass_g: 3434","bill_length_mm: 36.15<br />body_mass_g: 3452","bill_length_mm: 36.32<br />body_mass_g: 3470","bill_length_mm: 36.50<br />body_mass_g: 3487","bill_length_mm: 36.67<br />body_mass_g: 3505","bill_length_mm: 36.85<br />body_mass_g: 3522","bill_length_mm: 37.03<br />body_mass_g: 3540","bill_length_mm: 37.20<br />body_mass_g: 3557","bill_length_mm: 37.38<br />body_mass_g: 3574","bill_length_mm: 37.55<br />body_mass_g: 3591","bill_length_mm: 37.73<br />body_mass_g: 3608","bill_length_mm: 37.91<br />body_mass_g: 3625","bill_length_mm: 38.08<br />body_mass_g: 3642","bill_length_mm: 38.26<br />body_mass_g: 3659","bill_length_mm: 38.43<br />body_mass_g: 3675","bill_length_mm: 38.61<br />body_mass_g: 3692","bill_length_mm: 38.79<br />body_mass_g: 3709","bill_length_mm: 38.96<br />body_mass_g: 3725","bill_length_mm: 39.14<br />body_mass_g: 3742","bill_length_mm: 39.31<br />body_mass_g: 3758","bill_length_mm: 39.49<br />body_mass_g: 3774","bill_length_mm: 39.67<br />body_mass_g: 3790","bill_length_mm: 39.84<br />body_mass_g: 3806","bill_length_mm: 40.02<br />body_mass_g: 3823","bill_length_mm: 40.19<br />body_mass_g: 3838","bill_length_mm: 40.37<br />body_mass_g: 3854","bill_length_mm: 40.55<br />body_mass_g: 3870","bill_length_mm: 40.72<br />body_mass_g: 3886","bill_length_mm: 40.90<br />body_mass_g: 3902","bill_length_mm: 41.07<br />body_mass_g: 3917","bill_length_mm: 41.25<br />body_mass_g: 3933","bill_length_mm: 41.43<br />body_mass_g: 3948","bill_length_mm: 41.60<br />body_mass_g: 3964","bill_length_mm: 41.78<br />body_mass_g: 3979","bill_length_mm: 41.95<br />body_mass_g: 3995","bill_length_mm: 42.13<br />body_mass_g: 4010","bill_length_mm: 42.31<br />body_mass_g: 4025","bill_length_mm: 42.48<br />body_mass_g: 4040","bill_length_mm: 42.66<br />body_mass_g: 4055","bill_length_mm: 42.83<br />body_mass_g: 4070","bill_length_mm: 43.01<br />body_mass_g: 4085","bill_length_mm: 43.18<br />body_mass_g: 4100","bill_length_mm: 43.36<br />body_mass_g: 4115","bill_length_mm: 43.54<br />body_mass_g: 4129","bill_length_mm: 43.71<br />body_mass_g: 4144","bill_length_mm: 43.89<br />body_mass_g: 4159","bill_length_mm: 44.06<br />body_mass_g: 4173","bill_length_mm: 44.24<br />body_mass_g: 4188","bill_length_mm: 44.42<br />body_mass_g: 4202","bill_length_mm: 44.59<br />body_mass_g: 4217","bill_length_mm: 44.77<br />body_mass_g: 4231","bill_length_mm: 44.94<br />body_mass_g: 4245","bill_length_mm: 45.12<br />body_mass_g: 4260","bill_length_mm: 45.30<br />body_mass_g: 4274","bill_length_mm: 45.47<br />body_mass_g: 4288","bill_length_mm: 45.65<br />body_mass_g: 4302","bill_length_mm: 45.82<br />body_mass_g: 4316","bill_length_mm: 46.00<br />body_mass_g: 4330","bill_length_mm: 46.00<br />body_mass_g: 4330","bill_length_mm: 46.00<br />body_mass_g: 4330","bill_length_mm: 45.82<br />body_mass_g: 4316","bill_length_mm: 45.65<br />body_mass_g: 4302","bill_length_mm: 45.47<br />body_mass_g: 4288","bill_length_mm: 45.30<br />body_mass_g: 4274","bill_length_mm: 45.12<br />body_mass_g: 4260","bill_length_mm: 44.94<br />body_mass_g: 4245","bill_length_mm: 44.77<br />body_mass_g: 4231","bill_length_mm: 44.59<br />body_mass_g: 4217","bill_length_mm: 44.42<br />body_mass_g: 4202","bill_length_mm: 44.24<br />body_mass_g: 4188","bill_length_mm: 44.06<br />body_mass_g: 4173","bill_length_mm: 43.89<br />body_mass_g: 4159","bill_length_mm: 43.71<br />body_mass_g: 4144","bill_length_mm: 43.54<br />body_mass_g: 4129","bill_length_mm: 43.36<br />body_mass_g: 4115","bill_length_mm: 43.18<br />body_mass_g: 4100","bill_length_mm: 43.01<br />body_mass_g: 4085","bill_length_mm: 42.83<br />body_mass_g: 4070","bill_length_mm: 42.66<br />body_mass_g: 4055","bill_length_mm: 42.48<br />body_mass_g: 4040","bill_length_mm: 42.31<br />body_mass_g: 4025","bill_length_mm: 42.13<br />body_mass_g: 4010","bill_length_mm: 41.95<br />body_mass_g: 3995","bill_length_mm: 41.78<br />body_mass_g: 3979","bill_length_mm: 41.60<br />body_mass_g: 3964","bill_length_mm: 41.43<br />body_mass_g: 3948","bill_length_mm: 41.25<br />body_mass_g: 3933","bill_length_mm: 41.07<br />body_mass_g: 3917","bill_length_mm: 40.90<br />body_mass_g: 3902","bill_length_mm: 40.72<br />body_mass_g: 3886","bill_length_mm: 40.55<br />body_mass_g: 3870","bill_length_mm: 40.37<br />body_mass_g: 3854","bill_length_mm: 40.19<br />body_mass_g: 3838","bill_length_mm: 40.02<br />body_mass_g: 3823","bill_length_mm: 39.84<br />body_mass_g: 3806","bill_length_mm: 39.67<br />body_mass_g: 3790","bill_length_mm: 39.49<br />body_mass_g: 3774","bill_length_mm: 39.31<br />body_mass_g: 3758","bill_length_mm: 39.14<br />body_mass_g: 3742","bill_length_mm: 38.96<br />body_mass_g: 3725","bill_length_mm: 38.79<br />body_mass_g: 3709","bill_length_mm: 38.61<br />body_mass_g: 3692","bill_length_mm: 38.43<br />body_mass_g: 3675","bill_length_mm: 38.26<br />body_mass_g: 3659","bill_length_mm: 38.08<br />body_mass_g: 3642","bill_length_mm: 37.91<br />body_mass_g: 3625","bill_length_mm: 37.73<br />body_mass_g: 3608","bill_length_mm: 37.55<br />body_mass_g: 3591","bill_length_mm: 37.38<br />body_mass_g: 3574","bill_length_mm: 37.20<br />body_mass_g: 3557","bill_length_mm: 37.03<br />body_mass_g: 3540","bill_length_mm: 36.85<br />body_mass_g: 3522","bill_length_mm: 36.67<br />body_mass_g: 3505","bill_length_mm: 36.50<br />body_mass_g: 3487","bill_length_mm: 36.32<br />body_mass_g: 3470","bill_length_mm: 36.15<br />body_mass_g: 3452","bill_length_mm: 35.97<br />body_mass_g: 3434","bill_length_mm: 35.79<br />body_mass_g: 3416","bill_length_mm: 35.62<br />body_mass_g: 3398","bill_length_mm: 35.44<br />body_mass_g: 3380","bill_length_mm: 35.27<br />body_mass_g: 3362","bill_length_mm: 35.09<br />body_mass_g: 3344","bill_length_mm: 34.92<br />body_mass_g: 3326","bill_length_mm: 34.74<br />body_mass_g: 3307","bill_length_mm: 34.56<br />body_mass_g: 3289","bill_length_mm: 34.39<br />body_mass_g: 3270","bill_length_mm: 34.21<br />body_mass_g: 3252","bill_length_mm: 34.04<br />body_mass_g: 3233","bill_length_mm: 33.86<br />body_mass_g: 3214","bill_length_mm: 33.68<br />body_mass_g: 3195","bill_length_mm: 33.51<br />body_mass_g: 3176","bill_length_mm: 33.33<br />body_mass_g: 3157","bill_length_mm: 33.16<br />body_mass_g: 3138","bill_length_mm: 32.98<br />body_mass_g: 3118","bill_length_mm: 32.80<br />body_mass_g: 3099","bill_length_mm: 32.63<br />body_mass_g: 3079","bill_length_mm: 32.45<br />body_mass_g: 3059","bill_length_mm: 32.28<br />body_mass_g: 3040","bill_length_mm: 32.10<br />body_mass_g: 3020","bill_length_mm: 32.10<br />body_mass_g: 3020"],"type":"scatter","mode":"lines","line":{"width":3.7795275590551185,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(153,153,153,0.4)","hoveron":"points","hoverinfo":"x+y","showlegend":false,"xaxis":"x","yaxis":"y","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[31.405000000000001,46.695],"tickmode":"array","ticktext":["32","36","40","44"],"tickvals":[32,36,40,44],"categoryorder":"array","categoryarray":["32","36","40","44"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Bill length (mm)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2742.3936956604634,4871.7907763971207],"tickmode":"array","ticktext":["3000","3500","4000","4500"],"tickvals":[3000,3500,4000,4500],"categoryorder":"array","categoryarray":["3000","3500","4000","4500"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Body mass (g)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd84353ad":{"x":{},"y":{},"type":"scatter"},"4dd86e81297d":{"x":{},"y":{}}},"cur_data":"4dd84353ad","visdat":{"4dd84353ad":["function (y) ","x"],"4dd86e81297d":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section></section><section id="estimating-linear-models-via-maximum-likelihood" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="estimating-linear-models-via-maximum-likelihood">
<span class="header-section-number">2.2</span> Estimating Linear Models via Maximum Likelihood</h2>
<section id="review-of-one-sample-inference" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="review-of-one-sample-inference">
<span class="header-section-number">2.2.1</span> Review of one-sample inference</h3>
<p>Previously, we learned how to fit outcome-only models of the form <span class="math inline">\(p(X=x|\theta)\)</span> to iid data <span class="math inline">\(\mathbf x = (x_1,…,x_n)\)</span> using maximum likelihood estimation:</p>
<p><span class="math display">\[\mathcal L(\mathbf x|\theta) = p(X_1 = x_1, …,X_n =x_n|\theta) = \prod_{i=1}^n p(X=x_i|\theta)\]</span></p>
<p><span class="math display">\[\ell(x|\theta) = \text{log}\left\{\mathcal L(x|\theta)\right\}\]</span></p>
<p><span class="math display">\[\hat \theta_{ML} = \arg \max_\theta \ell(x|\theta)\]</span></p>
<p>We learned how to quantify our uncertainty about these maximum likelihood estimates; with sufficient sample size, <span class="math inline">\(\hat \theta_{ML}\)</span> has the approximate distribution:</p>
<p><span class="math display">\[
\hat\theta_{ML} \dot \sim N(\theta,\mathcal I(\theta)^{-1})
\]</span></p>
<p>For models in the “exponential family” of distributions, which includes the Gaussian, Poisson, Bernoulli, Binomial, Exponential, and Gamma distributions, <span class="math inline">\(\mathcal I(\theta) = \text -E[\mathcal{l}''(X|\theta)]\)</span>, so we estimated <span class="math inline">\(\mathcal I(\theta)\)</span> using either <span class="math inline">\(\mathcal I(\theta)|_{\theta = \hat \theta_{ML}}\)</span> or <span class="math inline">\(\mathcal{l}''(\mathbf x |\theta)|_{\theta = \hat \theta_{ML}}\)</span>.</p>
<p>Then an asymptotic approximation of a 95% confidence interval for <span class="math inline">\(\theta_k\)</span> is</p>
<p><span class="math display">\[\hat \theta_{ML} \pm z_{0.975} \times \left[\left(\hat{\mathcal I}(\hat \theta_{ML})\right)^{-1}\right]_{kk}\]</span></p>
<p>where <span class="math inline">\(z_\beta\)</span> the <span class="math inline">\(\beta\)</span> quantile of the standard Gaussian distribution.</p>
</section><section id="mles-for-linear-regression" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="mles-for-linear-regression">
<span class="header-section-number">2.2.2</span> MLEs for Linear Regression</h3>
<p>Let’s use maximum likelihood again:</p>
<p><span class="math display">\[
\mathcal L(\mathbf y|\mathbf x,\beta, \sigma^2) =
\prod_{i=1}^n (2\pi\sigma^2)^{-1/2}
\text{exp}\left\{-\frac{1}{2\sigma^2}(y_i - x_i'\beta)^2\right\}
\]</span></p>
<p><span class="math display">\[
\ell(\mathbf y|\mathbf x,\beta, \sigma^2) \propto -\frac{n}{2}\text{log}\left\{\sigma^2\right\} - \frac{1}{2\sigma^2}\sum_{i=1}^n (y_i - x_i' \beta)^2
\]</span></p>
<p><span class="math display">\[
\ell'(\mathbf y|\mathbf x,\beta, \sigma^2) \propto -\frac{n}{2}\text{log}\left\{\sigma^2\right\} - \frac{1}{2\sigma^2}\frac{d}{d\beta}\left(\sum_{i=1}^n (y_i - x_i' \beta)^2\right)
\]</span></p>
<p>A few tools from linear algebra will make this analysis go easier (see <span class="citation" data-cites="fieller2018basics">Fieller (<a href="references.html#ref-fieller2018basics" role="doc-biblioref">2016</a>)</span>, Section 7.2 for details).</p>
<p><span class="math display">\[
f_{\beta}(\mathbf x) = (f_{\beta}(x_1), f_{\beta}(x_2), ..., f_{\beta}(x_n))^\top
\]</span></p>
<p>Let <span class="math inline">\(\mathbf x\)</span> and <span class="math inline">\(\beta\)</span> be vectors of length <span class="math inline">\(p\)</span>, or in other words, matrices of length <span class="math inline">\(p\times 1\)</span>:</p>
<p><span class="math display">\[
x = \begin{bmatrix}
x_{1} \\
x_{2} \\
\vdots \\
x_{p}
\end{bmatrix} \\
\beta = \begin{bmatrix}
\beta_{1} \\
\beta_{2} \\
\vdots \\
\beta_{p}
\end{bmatrix}
\]</span></p>
<p>Then</p>
<p><span class="math display">\[
x' \equiv x^\top \equiv [x_1, x_2, ..., x_p]
\]</span></p>
<p>and</p>
<p><span class="math display">\[
x'\beta = [x_1, x_2, ..., x_p]
\begin{bmatrix}
\beta_{1} \\
\beta_{2} \\
\vdots \\
\beta_{p}
\end{bmatrix} =
x_1\beta_1+x_2\beta_2 +...+x_p \beta_p
\]</span></p>
<p>If <span class="math inline">\(f(\beta)\)</span> is a function that takes <span class="math inline">\(\beta\)</span> as input and outputs a scalar, such as <span class="math inline">\(f(\beta) = x'\beta\)</span>, then:</p>
<p><span class="math display">\[
\frac{d}{d \beta} f(\beta)=
\begin{bmatrix}
\frac{d}{d\beta_1}f(\beta) \\
\frac{d}{d\beta_2}f(\beta) \\
\vdots \\
\frac{d}{d\beta_p}f(\beta)
\end{bmatrix}
\]</span></p>
<p>In particular, if <span class="math inline">\(f(\beta) = x'\beta\)</span>, then:</p>
<p><span class="math display">\[
\frac{d}{d \beta} x'\beta=
\begin{bmatrix}
\frac{d}{d\beta_1}(x_1\beta_1+x_2\beta_2 +...+x_p \beta_p ) \\
\frac{d}{d\beta_2}(x_1\beta_1+x_2\beta_2 +...+x_p \beta_p ) \\
\vdots \\
\frac{d}{d\beta_p}(x_1\beta_1+x_2\beta_2 +...+x_p \beta_p )
\end{bmatrix}
=
\begin{bmatrix}
x_{1} \\
x_{2} \\
\vdots \\
x_{p}
\end{bmatrix}
= \mathbf x
\]</span></p>
<p>In general:</p>
<p><span class="math display">\[
\frac{d}{d\beta} x'\beta = x
\]</span></p>
<p>This looks a lot like non-vector calculus, except that you have to transpose the coefficient.</p>
<p>Similarly,</p>
<p><span class="math display">\[
\frac{d}{d\beta} \beta'\beta = 2\beta
\]</span></p>
<p>This is like taking the derivative of <span class="math inline">\(x^2\)</span>.</p>
<p>And finally, if <span class="math inline">\(S\)</span> is a <span class="math inline">\(p\times p\)</span> matrix, then:</p>
<p><span class="math display">\[
\frac{d}{d\beta} \beta'S\beta = 2S\beta
\]</span></p>
<p>Again, this is like taking the derivative of <span class="math inline">\(cx^2\)</span> with respect to <span class="math inline">\(c\)</span> in non-vector calculus.</p>
<p>Thus:</p>
<p><span class="math display">\[
\sum_{i=1}^n (y_i - f_\beta(x_i))^2 = (\mathbf y - X\beta)'(\mathbf y - X\beta)
\]</span></p>
<p><span class="math display">\[
(\mathbf y - X\beta)' = (\mathbf y' - (X\beta)') = (\mathbf y' - \beta'X')
\]</span></p>
<p>So</p>
<p><span class="math display">\[
\begin{aligned}
(\mathbf y - X\beta)'(\mathbf y - X\beta) &amp;= (\mathbf y' - \beta'X')(\mathbf y - X\beta)\\
&amp;= y'y - \beta'X'y - y'X\beta +\beta'X'X\beta\\
&amp;= y'y - 2y'X\beta +\beta'X'X\beta
\end{aligned}
\]</span></p>
<p>So</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d}{d\beta}\left(\sum_{i=1}^n (y_i - x_i' \beta)^2\right) &amp;=
\frac{d}{d\beta}(\mathbf y - X\beta)'(\mathbf y - X\beta)\\
&amp;= \frac{d}{d\beta} (y'y - 2y'X\beta +\beta'X'X\beta)\\
&amp;= (- 2X'y +2X'X\beta)
\end{aligned}
\]</span></p>
<p>So if <span class="math inline">\(\ell(\beta,\sigma^2) =0\)</span>, then</p>
<p><span class="math display">\[
\begin{aligned}
0 &amp;= (- 2X'y +2X'X\beta)\\
2X'y &amp;= 2X'X\beta\\
X'y &amp;= X'X\beta\\
(X'X)^{-1}X'y &amp;= \beta
\end{aligned}
\]</span></p>
<p>The second derivative matrix <span class="math inline">\(\ell_{\beta, \beta'} ''(\beta, \sigma^2;\mathbf X,\mathbf y)\)</span> is negative definite at <span class="math inline">\(\beta = (X'X)^{-1}X'y\)</span>, so <span class="math inline">\(\hat \beta_{ML} = (X'X)^{-1}X'y\)</span> is the MLE for <span class="math inline">\(\beta\)</span>.</p>
<p>Similarly (not shown):</p>
<p><span class="math display">\[
\hat\sigma^2_{ML} = \frac{1}{n} (Y-X\hat\beta)'(Y-X\hat\beta)
\]</span></p>
<p>And</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal I_{\beta} &amp;= E[-\ell_{\beta, \beta'} ''(Y|X,\beta, \sigma^2)]\\
&amp;= \frac{1}{\sigma^2}X'X
\end{aligned}
\]</span></p>
<p>So:</p>
<p><span class="math display">\[
Var(\hat \beta) \approx (\mathcal I_{\beta})^{-1} = \sigma^2 (X'X)^{-1}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\hat\beta \dot \sim N(\beta, \mathcal I_{\beta}^{-1})
\]</span> These are all results you have hopefully seen before, and in the Gaussian linear regression case they are exact, not just approximate.</p>
<p>In our model 2 above, this matrix is:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-24_8c15574099759592eaa5e9bd4a75e018">
<details><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>            (Intercept)  sexmale      age sexmale:age
(Intercept)     1353968 -1353968 -34871.0     34871.0
sexmale        -1353968  2596387  34871.0    -67211.0
age              -34871    34871    899.9      -899.9
sexmale:age       34871   -67211   -899.9      1743.5</code></pre>
</div>
</div>
<p>Note that if we take the square roots of the diagonals, we get the standard errors listed in the model output:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-25_703357937191b738bf668c550142e936">
<details><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     sexmale         age sexmale:age 
    1163.60     1611.33       30.00       41.76 </code></pre>
</div>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-26_000416f0eac8ca6b11c79390e22c6e3f">
<details><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 16%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Estimate</th>
<th style="text-align: center;">Std. Error</th>
<th style="text-align: center;">t value</th>
<th style="text-align: center;">Pr(&gt;|t|)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(Intercept)</td>
<td style="text-align: center;">-2,142</td>
<td style="text-align: center;">1,164</td>
<td style="text-align: center;">-1.841</td>
<td style="text-align: center;">0.08057</td>
</tr>
<tr class="even">
<td style="text-align: center;">sexmale</td>
<td style="text-align: center;">873</td>
<td style="text-align: center;">1,611</td>
<td style="text-align: center;">0.5418</td>
<td style="text-align: center;">0.594</td>
</tr>
<tr class="odd">
<td style="text-align: center;">age</td>
<td style="text-align: center;">130.4</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">4.347</td>
<td style="text-align: center;">0.0003127</td>
</tr>
<tr class="even">
<td style="text-align: center;">sexmale:age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">-0.4411</td>
<td style="text-align: center;">0.6639</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So we can do confidence intervals, hypothesis tests, and p-values exactly as in the one-variable case we looked at previously.</p>
</section></section><section id="inference-about-gaussian-linear-regression-models" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="inference-about-gaussian-linear-regression-models">
<span class="header-section-number">2.3</span> Inference about Gaussian Linear Regression Models</h2>
<p>Research question: is there really an interaction between sex and age?</p>
<p><span class="math inline">\(H_0: \beta_3 = 0\)</span></p>
<p><span class="math inline">\(H_A: \beta_3 \neq 0\)</span></p>
<p><span class="math inline">\(P(|\hat\beta_3| &gt; |-18.4172| \mid H_0)\)</span> = ?</p>
<section id="wald-tests-and-cis" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="wald-tests-and-cis">
<span class="header-section-number">2.3.1</span> Wald tests and CIs</h3>
<p>R can give you Wald tests for single coefficients and corresponding CIs:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/wald tests bw_lm2_f5ca1a55501d8f9af323297a91653942">
<details><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
<td style="text-align: center;">1163.60</td>
<td style="text-align: center;">(-4568.90, 285.56)</td>
<td style="text-align: center;">-1.84</td>
<td style="text-align: center;">0.081</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
<td style="text-align: center;">1611.33</td>
<td style="text-align: center;">(-2488.18, 4234.17)</td>
<td style="text-align: center;">0.54</td>
<td style="text-align: center;">0.594</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="one-parameter-inference-by-hand" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="one-parameter-inference-by-hand">
<span class="header-section-number">2.3.2</span> One-parameter inference by hand</h3>
<p>To understand what’s happening, let’s replicate these results by hand for the interaction term.</p>
<section id="p-value" class="level4"><h4 class="anchored" data-anchor-id="p-value">P-value</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-27_2c691c93f6c3520f56abfb622ca2e874">
<details><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale:age"</span>, <span class="st">"Estimate"</span><span class="op">]</span></span>
<span><span class="va">se_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale:age"</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span><span class="va">dfresid</span> <span class="op">=</span> <span class="va">bw_lm2</span><span class="op">$</span><span class="va">df.residual</span></span>
<span><span class="va">t_stat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">beta_hat</span><span class="op">)</span><span class="op">/</span><span class="va">se_hat</span></span>
<span><span class="va">pval_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">pt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">t_stat</span><span class="op">)</span>, df <span class="op">=</span> <span class="va">dfresid</span>, lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{aligned}
&amp;P\left(
| \hat \beta_3  | &gt;
| -18.4172| \middle| H_0
\right)
&amp;= P\left(
\left| \frac{\hat\beta_3}{\hat{SE}(\hat\beta_3)} \right| &gt;
\left| \frac{-18.4172}{41.7558} \right| \middle| H_0
\right)\\
&amp;= P\left(
| T_{20} | &gt;  0.4411 \middle| H_0
\right)\\
&amp;= 0.6639
\end{aligned}
\]</span> This matches the result in the table above.</p>
</section><section id="confidence-interval" class="level4"><h4 class="anchored" data-anchor-id="confidence-interval">Confidence interval</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-28_f96e2251d5b095367487bb6dd47a5a99">
<details><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">confint_radius_t</span> <span class="op">=</span> <span class="va">se_hat</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">qt</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.975</span>, df <span class="op">=</span> <span class="va">dfresid</span>, lower <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">confint_t</span> <span class="op">=</span> <span class="va">beta_hat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">confint_radius_t</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">confint_t</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] -105.52   68.68</code></pre>
</div>
</div>
<p>This also matches.</p>
</section></section><section id="gaussian-approximations" class="level3" data-number="2.3.3"><h3 data-number="2.3.3" class="anchored" data-anchor-id="gaussian-approximations">
<span class="header-section-number">2.3.3</span> Gaussian approximations</h3>
<p>Here are the asymptotic (Gaussian approximation) equivalents:</p>
<section id="p-value-1" class="level4"><h4 class="anchored" data-anchor-id="p-value-1">P-value</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-29_047ac419577924232d0edc1890077e5c">
<details><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pval_z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">t_stat</span><span class="op">)</span>, lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pval_z</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6592</code></pre>
</div>
</div>
</section><section id="confidence-interval-1" class="level4"><h4 class="anchored" data-anchor-id="confidence-interval-1">Confidence interval</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-30_2bf00b2f61f713cce5fcb8d603e99137">
<details><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">confint_radius_z</span> <span class="op">=</span> <span class="va">se_hat</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span>, lower <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">confint_z</span> <span class="op">=</span> </span>
<span>  <span class="va">beta_hat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">confint_radius_z</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">confint_z</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] -100.26   63.42</code></pre>
</div>
</div>
</section></section><section id="likelihood-ratio-statistics" class="level3" data-number="2.3.4"><h3 data-number="2.3.4" class="anchored" data-anchor-id="likelihood-ratio-statistics">
<span class="header-section-number">2.3.4</span> Likelihood ratio statistics</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-31_975298ea64892123d7e50944240b7239">
<details><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>'log Lik.' -156.6 (df=5)</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>'log Lik.' -156.7 (df=4)</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lLR</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">delta_df</span> <span class="op">=</span> <span class="op">(</span><span class="va">bw_lm1</span><span class="op">$</span><span class="va">df.residual</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_lLR</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">df</span> <span class="op">=</span> <span class="va">delta_df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">dchisq</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_max</span> <span class="op">=</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">chisq_plot</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">d_lLR</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span> fun <span class="op">=</span> <span class="va">d_lLR</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lLR</span>, <span class="va">x_max</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"area"</span>, fill <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lLR</span>, xend <span class="op">=</span> <span class="va">lLR</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fu">d_lLR</span><span class="op">(</span><span class="va">lLR</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0.0001</span>,<span class="va">x_max</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"p(X=x)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(likelihood ratio) statistic [x]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-32_34b493a8c5f15345d340712bafa5e984">
<details><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span></span>
<span>  q <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">lLR</span>, </span>
<span>  df <span class="op">=</span> <span class="va">delta_df</span>, </span>
<span>  lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6298</code></pre>
</div>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-34_2732c04eafd4bf28fc0dc2f3b3b6fabb">
<details><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chisq_plot</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ab75fb569f601ac98212" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ab75fb569f601ac98212">{"x":{"data":[{"x":[0.0001,0.010099,0.020098000000000001,0.030097000000000002,0.040096000000000007,0.050095000000000008,0.060094000000000009,0.070093000000000003,0.08009200000000001,0.090091000000000018,0.10009000000000001,0.11008900000000001,0.12008800000000001,0.13008700000000001,0.14008599999999999,0.150085,0.160084,0.17008300000000001,0.18008200000000002,0.190081,0.20008000000000001,0.21007900000000002,0.220078,0.230077,0.24007600000000001,0.25007500000000005,0.26007400000000003,0.27007300000000001,0.28007199999999999,0.29007100000000002,0.30007,0.31006900000000004,0.32006800000000002,0.330067,0.34006600000000003,0.35006500000000002,0.36006400000000005,0.37006300000000003,0.38006200000000001,0.39006100000000005,0.40006000000000003,0.41005900000000001,0.42005800000000004,0.43005700000000002,0.440056,0.45005500000000004,0.46005400000000002,0.47005300000000005,0.48005200000000003,0.49005100000000001,0.50005000000000011,0.51004900000000009,0.52004800000000007,0.53004700000000005,0.54004600000000003,0.55004500000000001,0.56004399999999999,0.57004300000000008,0.58004200000000006,0.59004100000000004,0.60004000000000002,0.610039,0.62003800000000009,0.63003700000000007,0.64003600000000005,0.65003500000000003,0.66003400000000001,0.6700330000000001,0.68003200000000008,0.69003100000000006,0.70003000000000004,0.71002900000000002,0.72002800000000011,0.73002700000000009,0.74002600000000007,0.75002500000000005,0.76002400000000003,0.77002300000000001,0.7800220000000001,0.79002100000000008,0.80002000000000006,0.81001900000000004,0.82001800000000002,0.83001700000000012,0.8400160000000001,0.85001500000000008,0.86001400000000006,0.87001300000000004,0.88001200000000002,0.89001100000000011,0.90001000000000009,0.91000900000000007,0.92000800000000005,0.93000700000000003,0.94000600000000012,0.9500050000000001,0.96000400000000008,0.97000300000000006,0.98000200000000004,0.99000100000000013,1],"y":[39.892233378608211,3.9498255041164581,2.7859249938531958,2.2652335286559815,1.952777692966801,1.7383406432944384,1.5792295551876125,1.4549639743681413,1.3543276329342735,1.2705926828004384,1.1994453188881977,1.1379746294835569,1.0841352911975315,1.036442190511474,0.99378722601206693,0.95532441573429994,0.92039511119107975,0.88847775319425448,0.85915318360328641,0.83208012204289161,0.8069774638017968,0.78361126352561805,0.76178500543916616,0.74133222193747894,0.72211081849024927,0.70399865724438782,0.68689008198862567,0.67069315604458435,0.65532744633275142,0.64072223031972542,0.62681503360276558,0.61355042836081763,0.60087903936270781,0.58875671641591942,0.57714384126415663,0.56600474383689359,0.5553072080114263,0.54502205109060153,0.53512276433281702,0.52558520431779765,0.51638732685596689,0.50750895667267981,0.4989315873122746,0.49063820667961483,0.48261314442078679,0.47484193797992336,0.46731121468657144,0.46000858765153185,0.45292256359735444,0.44604246103729223,0.43935833745509195,0.43286092433667872,0.42654156907090063,0.42039218287588992,0.4144051940249871,0.40857350574537088,0.4028904582466461,0.39734979440817308,0.39194562871494626,0.3866724190840507,0.38152494126852282,0.37649826556399446,0.37158773557675234,0.36678894884060376,0.36209773909487486,0.35751016005753811,0.35302247054633501,0.34863112081724362,0.34433274000404906,0.34012412455541624,0.33600222757696374,0.33196414899560928,0.32800712647207186,0.32412852699503247,0.32032583909718687,0.31659666563940414,0.31293871711450377,0.30934980542688845,0.30582783810847058,0.30237081293508788,0.29897681291095074,0.2956440015916717,0.29237061871911502,0.28915497614372088,0.28599545401212684,0.28289049719986759,0.27983861197069038,0.27683836284561486,0.27388836966630153,0.27098730483858907,0.2681338907432409,0.26532689730200226,0.26256513968804235,0.25984747617073045,0.25717280608549875,0.25454006792027045,0.25194823751059747,0.24939632633625639,0.24688337991260653,0.24440847627051809,0.24197072451914337],"text":"","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.11616163586785433,0.12500001950917577,0.13383840315049725,0.14267678679181869,0.15151517043314017,0.16035355407446161,0.16919193771578306,0.1780303213571045,0.18686870499842598,0.19570708863974745,0.2045454722810689,0.21338385592239034,0.22222223956371179,0.23106062320503326,0.23989900684635471,0.24873739048767618,0.25757577412899763,0.26641415777031907,0.27525254141164057,0.28409092505296196,0.29292930869428346,0.30176769233560491,0.31060607597692635,0.31944445961824786,0.32828284325956925,0.33712122690089075,0.34595961054221219,0.35479799418353364,0.36363637782485508,0.37247476146617653,0.38131314510749803,0.39015152874881948,0.39898991239014092,0.40782829603146237,0.41666667967278381,0.42550506331410531,0.43434344695542676,0.44318183059674821,0.45202021423806965,0.4608585978793911,0.4696969815207126,0.47853536516203404,0.48737374880335549,0.49621213244467693,0.50505051608599838,0.51388889972731988,0.52272728336864138,0.53156566700996277,0.54040405065128416,0.54924243429260566,0.55808081793392716,0.56691920157524867,0.57575758521657006,0.58459596885789145,0.59343435249921295,0.60227273614053445,0.61111111978185584,0.61994950342317734,0.62878788706449873,0.63762627070582023,0.64646465434714173,0.65530303798846312,0.66414142162978462,0.67297980527110601,0.68181818891242751,0.69065657255374902,0.69949495619507041,0.70833333983639191,0.7171717234777133,0.7260101071190348,0.7348484907603563,0.74368687440167769,0.75252525804299919,0.76136364168432058,0.77020202532564208,0.77904040896696358,0.78787879260828497,0.79671717624960647,0.80555555989092786,0.81439394353224936,0.82323232717357087,0.83207071081489226,0.84090909445621376,0.84974747809753515,0.85858586173885665,0.86742424538017804,0.87626262902149954,0.88510101266282104,0.89393939630414243,0.90277777994546393,0.91161616358678532,0.92045454722810682,0.92929293086942832,0.93813131451074971,0.94696969815207122,0.95580808179339261,0.96464646543471411,0.97348484907603561,0.982323232717357,0.9911616163586785,1,1,1,0.9911616163586785,0.982323232717357,0.97348484907603561,0.96464646543471411,0.95580808179339261,0.94696969815207122,0.93813131451074971,0.92929293086942832,0.92045454722810682,0.91161616358678532,0.90277777994546393,0.89393939630414243,0.88510101266282104,0.87626262902149954,0.86742424538017804,0.85858586173885665,0.84974747809753515,0.84090909445621376,0.83207071081489226,0.82323232717357087,0.81439394353224936,0.80555555989092786,0.79671717624960647,0.78787879260828497,0.77904040896696358,0.77020202532564208,0.76136364168432058,0.75252525804299919,0.74368687440167769,0.7348484907603563,0.7260101071190348,0.7171717234777133,0.70833333983639191,0.69949495619507041,0.69065657255374902,0.68181818891242751,0.67297980527110601,0.66414142162978462,0.65530303798846312,0.64646465434714173,0.63762627070582023,0.62878788706449873,0.61994950342317734,0.61111111978185584,0.60227273614053445,0.59343435249921295,0.58459596885789145,0.57575758521657006,0.56691920157524867,0.55808081793392716,0.54924243429260566,0.54040405065128416,0.53156566700996277,0.52272728336864138,0.51388889972731988,0.50505051608599838,0.49621213244467693,0.48737374880335549,0.47853536516203404,0.4696969815207126,0.4608585978793911,0.45202021423806965,0.44318183059674821,0.43434344695542676,0.42550506331410531,0.41666667967278381,0.40782829603146237,0.39898991239014092,0.39015152874881948,0.38131314510749803,0.37247476146617653,0.36363637782485508,0.35479799418353364,0.34595961054221219,0.33712122690089075,0.32828284325956925,0.31944445961824786,0.31060607597692635,0.30176769233560491,0.29292930869428346,0.28409092505296196,0.27525254141164057,0.26641415777031907,0.25757577412899763,0.24873739048767618,0.23989900684635471,0.23106062320503326,0.22222223956371179,0.21338385592239034,0.2045454722810689,0.19570708863974745,0.18686870499842598,0.1780303213571045,0.16919193771578306,0.16035355407446161,0.15151517043314017,0.14267678679181869,0.13383840315049725,0.12500001950917577,0.11616163586785433,0.11616163586785433],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.24197072451914337,0.24412362931957571,0.24630548218417042,0.24851689472866317,0.25075849734268607,0.25303093995275933,0.25533489282388355,0.25767104740207109,0.26004011720032283,0.26244283873073315,0.26487997248560202,0.26735230397063986,0.26986064479358107,0.27240583381176658,0.27498873834252191,0.27761025544045104,0.28027131324607829,0.28297287241061553,0.28571592760200532,0.28850150909779704,0.29133068447085891,0.29420456037441145,0.29712428443339889,0.30009104724979485,0.30310608453007121,0.30617067934375575,0.30928616452276569,0.31245392521204152,0.31567540158292523,0.31895209172174183,0.32228555470715342,0.32567741389109212,0.32912936039942964,0.33264315687004703,0.33622064144762759,0.33986373205633669,0.34357443097359741,0.34735482973043585,0.35120711436639834,0.35513357106985244,0.35913659223762001,0.36321868299139637,0.3673824681923249,0.37163069999949472,0.37596626602304967,0.38039219812814223,0.38491168195219627,0.38952806720497896,0.39424487882892151,0.39906582910612104,0.40399483080864373,0.40903601150033037,0.41419372911147667,0.41947258892278777,0.42487746211217775,0.43041350603764661,0.43608618645203839,0.44190130187144988,0.4478650103489944,0.45398385894023735,0.46026481618672332,0.46671530799061528,0.47334325730775584,0.48015712814988948,0.48716597446111165,0.49437949452096008,0.50180809162956008,0.50946294195206021,0.51735607054419741,0.52550043675306768,0.53391003039310114,0.54259998034438772,0.55158667751830437,0.56088791449579312,0.57052304458166203,0.58051316355316429,0.5908813180373933,0.60165274526140355,0.61285514992246026,0.62451902517702695,0.63667802631640047,0.64936940767754536,0.66263453585402576,0.67651949549131229,0.6910758081002365,0.70636128971300793,0.72244108026817111,0.73938888694551164,0.75728849612908333,0.77623562547194747,0.79634021043122427,0.81772925122392837,0.84055039028009704,0.86497645278374691,0.89121127280319001,0.91949725897446299,0.95012534941947924,0.98344830281207829,1.0198987339477037,1.0600140363161161,1.1044715346886762,0],"text":"","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(190,190,190,1)","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.11616163586785433,0.11616163586785433],"y":[0,1.1044715346886762],"text":"lLR: 0.1162<br />y: 0<br />lLR: 0.1162<br />d_lLR(lLR): 1.104","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":31.415525114155255},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.049895000000000002,1.049995],"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.00","0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"log(likelihood ratio) statistic [x]","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.20000000000000001,4.2000000000000002],"tickmode":"array","ticktext":["0","1","2","3","4"],"tickvals":[0,1,2,3,4],"categoryorder":"array","categoryarray":["0","1","2","3","4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"p(X=x)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd857d93190":{"type":"scatter"},"4dd873255be6":[],"4dd8c13236b":{"x":{},"y":{},"xend":{},"yend":{}}},"cur_data":"4dd857d93190","visdat":{"4dd857d93190":["function (y) ","x"],"4dd873255be6":["function (y) ","x"],"4dd8c13236b":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now we can get the p-value:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-35_e8dcd045da06d611ea1c08b11e690e9b">
<details><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">lLR</span>, df <span class="op">=</span> <span class="va">delta_df</span>, lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6298</code></pre>
</div>
</div>
</section><section id="section" class="level3" data-number="2.3.5"><h3 data-number="2.3.5" class="anchored" data-anchor-id="section">
<span class="header-section-number">2.3.5</span> </h3>
<p>In practice you don’t have to do this by hand; there are functions to do it for you:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-36_52fa245d8c6567930b40034091d35e31">
<details><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># built in</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">bw_lm2</span>, <span class="va">bw_lm1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: weight ~ sex + age + sex:age
Model 2: weight ~ sex + age
  #Df LogLik Df Chisq Pr(&gt;Chisq)
1   5   -157                    
2   4   -157 -1  0.23       0.63</code></pre>
</div>
</div>
</section></section><section id="goodness-of-fit" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="goodness-of-fit">
<span class="header-section-number">2.4</span> Goodness of fit</h2>
<section id="aic-and-bic" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="aic-and-bic">
<span class="header-section-number">2.4.1</span> AIC and BIC</h3>
<p>When we use likelihood ratio tests, we are comparing how well different models fit the data.</p>
<p>Likelihood ratio tests require “nested” models: one must be a special case of the other.</p>
<p>If we have non-nested models, we can instead use the Akaike Information Criterion (AIC) or Bayesian Information Criterion (BIC):</p>
<ul>
<li><p>AIC = <span class="math inline">\(-2 * \ell(\hat\theta) + 2 * p\)</span></p></li>
<li><p>BIC = <span class="math inline">\(-2 * \ell(\hat\theta) + p * \text{log}(n)\)</span></p></li>
</ul>
<p>where <span class="math inline">\(\ell\)</span> is the log-likelihood of the data evaluated using the parameter estimates <span class="math inline">\(\hat\theta\)</span>, <span class="math inline">\(p\)</span> is the number of estimated parameters in the model (including <span class="math inline">\(\hat\sigma^2\)</span>), and <span class="math inline">\(n\)</span> is the number of observations.</p>
<p>You can calculate these criteria using the <code><a href="https://rdrr.io/r/stats/logLik.html">logLik()</a></code> function, or use the built-in R functions:</p>
<section id="aic-in-r" class="level4"><h4 class="anchored" data-anchor-id="aic-in-r">AIC in R</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-37_a9b02ab076301bf858c132ecfe02b56b">
<details><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="co"># sigma counts as a parameter here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 323.2</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 323.2</code></pre>
</div>
</div>
</section><section id="bic-in-r" class="level4"><h4 class="anchored" data-anchor-id="bic-in-r">BIC in R</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-38_963b49c33b296b11b2df469f356e02ac">
<details><summary>Code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 329</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 329</code></pre>
</div>
</div>
<p>Large values of AIC and BIC are worse than small values. There are no hypothesis tests or p-values associated with these criteria.</p>
</section></section><section id="residual-deviance" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="residual-deviance">
<span class="header-section-number">2.4.2</span> (Residual) Deviance</h3>
<p>Let <span class="math inline">\(q\)</span> be the number of distinct covariate combinations in a data set.</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-39_1a52d66fb93719c1dfd3f8cebedb3327">
<details><summary>Code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw.X.unique</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_unique.bw</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bw.X.unique</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For example, in the <code>birthweight</code> data, there are <span class="math inline">\(q = 12\)</span> unique patterns:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-40_64080d15f71c22a0c87dd0ca3c40f2b9">
<details><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw.X.unique</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span></span>
<span>    row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bw.X.unique</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">sex</th>
<th style="text-align: center;">age</th>
<th style="text-align: center;">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">37</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">female</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">37</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: center;">male</td>
<td style="text-align: center;">41</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If a given covariate pattern has more than one observation in a dataset, those observations are called <strong>replicates</strong>.</p>
</div>
</div>
<p>Then the most complicated model we could fit would have one parameter (a mean) for each of these combinations, plus a variance parameter:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-41_ebad32db073e38a53decb2b47f3c57c9">
<details><summary>Code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_max</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>    data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_max</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 27%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 25%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(12)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sex (male) × age35</td>
<td style="text-align: center;">2925.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2515.55, 3334.45)</td>
<td style="text-align: center;">15.56</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age36</td>
<td style="text-align: center;">2570.50</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2280.98, 2860.02)</td>
<td style="text-align: center;">19.34</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age36</td>
<td style="text-align: center;">2625.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2215.55, 3034.45)</td>
<td style="text-align: center;">13.97</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age37</td>
<td style="text-align: center;">2539.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2129.55, 2948.45)</td>
<td style="text-align: center;">13.51</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age37</td>
<td style="text-align: center;">2737.50</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2447.98, 3027.02)</td>
<td style="text-align: center;">20.60</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age38</td>
<td style="text-align: center;">2872.50</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2582.98, 3162.02)</td>
<td style="text-align: center;">21.62</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age38</td>
<td style="text-align: center;">2982.00</td>
<td style="text-align: center;">108.50</td>
<td style="text-align: center;">(2745.60, 3218.40)</td>
<td style="text-align: center;">27.48</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age39</td>
<td style="text-align: center;">2846.00</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2556.48, 3135.52)</td>
<td style="text-align: center;">21.42</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (female) × age40</td>
<td style="text-align: center;">3152.25</td>
<td style="text-align: center;">93.96</td>
<td style="text-align: center;">(2947.52, 3356.98)</td>
<td style="text-align: center;">33.55</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age40</td>
<td style="text-align: center;">3256.25</td>
<td style="text-align: center;">93.96</td>
<td style="text-align: center;">(3051.52, 3460.98)</td>
<td style="text-align: center;">34.66</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age41</td>
<td style="text-align: center;">3292.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2882.55, 3701.45)</td>
<td style="text-align: center;">17.52</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age42</td>
<td style="text-align: center;">3210.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2800.55, 3619.45)</td>
<td style="text-align: center;">17.08</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We call this model the <strong>full</strong>, <strong>maximal</strong>, or <strong>saturated</strong> model for this dataset.</p>
<p>We can calculate the log-likelihood of this model as usual:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-42_ae2243e78697cc20e4917b80c0fac9cc">
<details><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">lm_max</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>'log Lik.' -151.4 (df=13)</code></pre>
</div>
</div>
<p>We can compare this model to our other models using chi-square tests, as usual:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-43_6506057d07047cd7ade21a03e1c4f01a">
<details><summary>Code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">lm_max</span>, <span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: weight ~ sex:age - 1
Model 2: weight ~ sex + age + sex:age
  #Df LogLik Df Chisq Pr(&gt;Chisq)
1  13   -151                    
2   5   -157 -8  10.4       0.24</code></pre>
</div>
</div>
<p>The likelihood ratio statistic for this test is <span class="math display">\[\lambda = 2 * (\ell_{\text{full}} - \ell) = 10.3554\]</span> where:</p>
<ul>
<li>
<span class="math inline">\(\ell_{\text{max}}\)</span> is the log-likelihood of the full model: -151.4016</li>
<li>
<span class="math inline">\(\ell\)</span> is the log-likelihood of our comparison model (two slopes, two intercepts): -156.5793</li>
</ul>
<p>This statistic is called the <strong>deviance</strong> or <strong>residual deviance</strong> for our two-slopes and two-intercepts model; it tells us how much the likelihood of that model deviates from the likelihood of the maximal model.</p>
<p>The corresponding p-value tells us whether there we have enough evidence to detect that our two-slopes, two-intercepts model is a worse fit for the data than the maximal model; in other words, it tells us if there’s evidence that we missed any important patterns. (Remember, a nonsignificant p-value could mean that we didn’t miss anything and a more complicated model is unnecessary, or it could mean we just don’t have enough data to tell the difference between these models.)</p>
</section><section id="null-deviance" class="level3" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="null-deviance">
<span class="header-section-number">2.4.3</span> Null Deviance</h3>
<p>Similarly, the <em>least</em> complicated model we could fit would have only one mean parameter, an intercept:</p>
<p><span class="math display">\[\text E[Y|X=x] = \beta_0\]</span> We can fit this model in R like so:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-44_f26cd8b087b8044c44a438808179a9e0">
<details><summary>Code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 19%">
<col style="width: 10%">
<col style="width: 29%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(23)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">2967.67</td>
<td style="text-align: center;">57.58</td>
<td style="text-align: center;">(2848.56, 3086.77)</td>
<td style="text-align: center;">51.54</td>
<td style="text-align: center;">&lt; .001</td>
</tr></tbody>
</table>
</div>
</div>
<p>This model also has a likelihood:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-45_1eb11919e475e92a2e95e6bc67e1eb9b">
<details><summary>Code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>'log Lik.' -169 (df=2)</code></pre>
</div>
</div>
<p>And we can compare it to more complicated models using a likelihood ratio test:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-46_c5286b30eb4e9a271544efe9012c64ca">
<details><summary>Code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">bw_lm2</span>, <span class="va">lm0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: weight ~ sex + age + sex:age
Model 2: weight ~ 1
  #Df LogLik Df Chisq Pr(&gt;Chisq)    
1   5   -157                        
2   2   -169 -3  24.8    1.7e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The likelihood ratio statistic for the test comparing the null model to the maximal model is <span class="math display">\[\lambda = 2 * (\ell_{\text{full}} - \ell_{0}) = 35.1067\]</span> where:</p>
<ul>
<li>
<span class="math inline">\(\ell_{\text{0}}\)</span> is the log-likelihood of the null model: -168.955</li>
<li>
<span class="math inline">\(\ell_{\text{full}}\)</span> is the log-likelihood of the maximal model: -151.4016</li>
</ul>
<p>In R, this test is:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-47_ce9dc2b1c786f35affb42aa9d8fafcc4">
<details><summary>Code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">lm_max</span>, <span class="va">lm0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: weight ~ sex:age - 1
Model 2: weight ~ 1
  #Df LogLik  Df Chisq Pr(&gt;Chisq)    
1  13   -151                         
2   2   -169 -11  35.1    0.00024 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>This log-likelihood ratio statistic is called the <strong>null deviance</strong>. It tells us whether we have enough data to detect a difference between the null and full models.</p>
</section></section><section id="rescaling" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="rescaling">
<span class="header-section-number">2.5</span> Rescaling</h2>
<section id="rescale-age" class="level3 smaller" data-number="2.5.1"><h3 class="smaller anchored" data-number="2.5.1" data-anchor-id="rescale-age">
<span class="header-section-number">2.5.1</span> Rescale age</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-48_bb268c5a18e73c7b20e69ebe7281c879">
<details><summary>Code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    `age - mean` <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>    `age - 36wks` <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">36</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">lm1c</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">`age - 36wks`</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm2c</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">`age - 36wks`</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">`age - 36wks`</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">lm2c</span>, ci_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 24%">
<col style="width: 8%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">2552.73</td>
<td style="text-align: center;">97.59</td>
<td style="text-align: center;">(2349.16, 2756.30)</td>
<td style="text-align: center;">26.16</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">209.97</td>
<td style="text-align: center;">129.75</td>
<td style="text-align: center;">(-60.68, 480.63)</td>
<td style="text-align: center;">1.62</td>
<td style="text-align: center;">0.121</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age - 36wks</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age - 36wks</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Compare with what we got without rescaling:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-49_45d90b05894291e1b4221ff99a3096b0">
<details><summary>Code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">bw_lm2</span>, ci_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
<td style="text-align: center;">1163.60</td>
<td style="text-align: center;">(-4568.90, 285.56)</td>
<td style="text-align: center;">-1.84</td>
<td style="text-align: center;">0.081</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
<td style="text-align: center;">1611.33</td>
<td style="text-align: center;">(-2488.18, 4234.17)</td>
<td style="text-align: center;">0.54</td>
<td style="text-align: center;">0.594</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
</section></section><section id="prediction" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="prediction">
<span class="header-section-number">2.6</span> Prediction</h2>
<section id="prediction-for-linear-models" class="level3" data-number="2.6.1"><h3 data-number="2.6.1" class="anchored" data-anchor-id="prediction-for-linear-models">
<span class="header-section-number">2.6.1</span> Prediction for linear models</h3>
<p><span class="math display">\[
\begin{aligned}
\hat Y &amp;= \hat E[Y|X=x] \\
&amp;= x'\hat\beta \\
&amp;= \hat\beta_0\cdot 1 + \hat\beta_1 x_1 + ... + \hat\beta_p x_p
\end{aligned}
\]</span></p>
</section><section id="prediction-in-r" class="level3" data-number="2.6.2"><h3 data-number="2.6.2" class="anchored" data-anchor-id="prediction-in-r">
<span class="header-section-number">2.6.2</span> prediction in R</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-50_2235d3726c63affed8b43611e5965457">
<details><summary>Code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
   `(Intercept)` sexmale   age
           &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1             1       1    40
 2             1       0    40
 3             1       1    38
 4             1       0    36
 5             1       1    40
 6             1       0    40
 7             1       1    35
 8             1       0    38
 9             1       1    36
10             1       0    42
# ℹ 14 more rows</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     sexmale         age 
          1           1          40 </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     sexmale         age 
    -1773.3       163.0       120.9 </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     sexmale         age 
      -1773         163        4836 </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">{</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 3225</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1] 3225 3062 2984 2579 3225 3062 2621 2821 2742 3304 2863 2942 3346 3062 3225
[16] 2700 2863 2579 2984 2821 3225 2942 2984 3062</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 
3225 3062 2984 2579 3225 3062 2621 2821 2742 3304 2863 2942 3346 3062 3225 2700 
  17   18   19   20   21   22   23   24 
2863 2579 2984 2821 3225 2942 2984 3062 </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm1</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>$fit
   1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 
3225 3062 2984 2579 3225 3062 2621 2821 2742 3304 2863 2942 3346 3062 3225 2700 
  17   18   19   20   21   22   23   24 
2863 2579 2984 2821 3225 2942 2984 3062 

$se.fit
 [1] 61.46 57.17 51.58 76.03 61.46 57.17 85.25 53.38 69.96 83.89 57.95 51.38
[13] 74.78 57.17 61.46 62.42 57.95 76.03 51.58 53.38 61.46 51.38 51.58 57.17

$df
[1] 21

$residual.scale
[1] 177.1</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm1</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 
3225 3062 2984 2579 3225 3062 2621 2821 2742 3304 2863 2942 3346 3062 3225 2700 
  17   18   19   20   21   22   23   24 
2863 2579 2984 2821 3225 2942 2984 3062 </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm1</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">se.fit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1] 61.46 57.17 51.58 76.03 61.46 57.17 85.25 53.38 69.96 83.89 57.95 51.38
[13] 74.78 57.17 61.46 62.42 57.95 76.03 51.58 53.38 61.46 51.38 51.58 57.17</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm1</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
     fit   lwr   upr
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 3225. 3098. 3353.
 2 3062. 2944. 3181.
 3 2984. 2876. 3091.
 4 2579. 2421. 2737.
 5 3225. 3098. 3353.
 6 3062. 2944. 3181.
 7 2621. 2444. 2798.
 8 2821. 2710. 2932.
 9 2742. 2596. 2887.
10 3304. 3130. 3479.
# ℹ 14 more rows</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm1</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"predict"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
     fit   lwr   upr
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 3225. 2836. 3615.
 2 3062. 2675. 3449.
 3 2984. 2600. 3367.
 4 2579. 2178. 2980.
 5 3225. 2836. 3615.
 6 3062. 2675. 3449.
 7 2621. 2212. 3030.
 8 2821. 2436. 3205.
 9 2742. 2346. 3138.
10 3304. 2897. 3712.
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>The warning from the last command is: “predictions on current data refer to <em>future</em> responses” (since you already know what happened to the current data, and thus don’t need to predict it). You could also supply <code>newdata</code> to get predictions for new combinations of predictors that you didn’t see in your original dataset. See <code><a href="https://rdrr.io/r/stats/predict.lm.html">?predict.lm</a></code> for more.</p>
</section></section><section id="diagnostics" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="diagnostics">
<span class="header-section-number">2.7</span> Diagnostics</h2>
<section id="residuals" class="level3" data-number="2.7.1"><h3 data-number="2.7.1" class="anchored" data-anchor-id="residuals">
<span class="header-section-number">2.7.1</span> Residuals</h3>
<section id="definitions-of-residuals" class="level4"><h4 class="anchored" data-anchor-id="definitions-of-residuals">Definitions of residuals</h4>
<ul>
<li><p>Residuals: <span class="math display">\[e_i = y_i - \hat E[Y|X=x]\]</span></p></li>
<li><p>For Gaussian models, <span class="math inline">\(e_i\)</span> can be seen as an estimate of <span class="math display">\[\epsilon_i = Y_i - \text{E}[Y|X=x_i]\]</span></p></li>
<li><p>Standardized residuals: <span class="math display">\[r_i = \frac{e_i}{\hat{SD}(e_i)}\]</span></p></li>
<li><p>For Gaussian models: <span class="math display">\[\hat{SD}(e_i) \approx \frac{e_i}{\hat{\sigma}}\]</span></p></li>
</ul></section><section id="characteristics-of-residuals" class="level4"><h4 class="anchored" data-anchor-id="characteristics-of-residuals">Characteristics of residuals</h4>
<p>With enough data and a correct model, the residuals will be approximately Guassian distributed, with variance <span class="math inline">\(\sigma^2\)</span>, which we can estimate using <span class="math inline">\(\hat\sigma^2\)</span>: that is:</p>
<p><span class="math display">\[
e_i\ \dot \sim_{iid}\ N(0, \hat\sigma^2)
\]</span></p>
<p>Hence, with enough data and a correct model, the standardized residuals will be approximately standard Gaussian; that is,</p>
<p><span class="math display">\[
r_i\ \dot \sim_{iid}\ N(0,1)
\]</span></p>
</section></section><section id="marginal-distributions-of-residuals" class="level3" data-number="2.7.2"><h3 data-number="2.7.2" class="anchored" data-anchor-id="marginal-distributions-of-residuals">
<span class="header-section-number">2.7.2</span> Marginal distributions of residuals</h3>
<p>To look for problems with our model, we can check whether the residuals <span class="math inline">\(e_i\)</span> and standardized residuals <span class="math inline">\(r_i\)</span> look like they have the distributions that they are supposed to have, according to the model.</p>
<p>First, we need to compute the residuals. R makes this easy:</p>
<section id="non-standardized-residuals-in-r" class="level4"><h4 class="anchored" data-anchor-id="non-standardized-residuals-in-r">(non-standardized) residuals in R</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-51_42e2a90146beece34fbf7f32b6b897db">
<details><summary>Code</summary><div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>      1       2       3       4       5       6       7       8       9      10 
 176.27 -140.73 -144.13  -59.53  177.47 -126.93  -68.93  242.67 -139.33   51.67 
     11      12      13      14      15      16      17      18      19      20 
 156.67 -125.13  274.28 -137.71  -27.69 -246.69 -191.67  189.33  -11.67 -242.64 
     21      22      23      24 
 -47.64  262.36  210.36  -30.62 </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># check by hand</span></span>
<span><span class="va">bw</span><span class="op">$</span><span class="va">weight</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>      1       2       3       4       5       6       7       8       9      10 
 176.27 -140.73 -144.13  -59.53  177.47 -126.93  -68.93  242.67 -139.33   51.67 
     11      12      13      14      15      16      17      18      19      20 
 156.67 -125.13  274.28 -137.71  -27.69 -246.69 -191.67  189.33  -11.67 -242.64 
     21      22      23      24 
 -47.64  262.36  210.36  -30.62 </code></pre>
</div>
</div>
<p>Success!</p>
</section><section id="standardized-residuals-in-r" class="level4"><h4 class="anchored" data-anchor-id="standardized-residuals-in-r">Standardized residuals in R</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-52_e2628ba8b68ad63e18a4e52c0d1b26f8">
<details><summary>Code</summary><div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
 1.15982 -0.92601 -0.87479 -0.34723  1.03507 -0.73473 -0.39901  1.43752 
       9       10       11       12       13       14       15       16 
-0.82539  0.30606  0.92807 -0.87616  1.91428 -0.86559 -0.16430 -1.46376 
      17       18       19       20       21       22       23       24 
-1.11016  1.09658 -0.06761 -1.46159 -0.28696  1.58040  1.26717 -0.19805 </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
 0.97593 -0.77920 -0.79802 -0.32962  0.98258 -0.70279 -0.38166  1.34357 
       9       10       11       12       13       14       15       16 
-0.77144  0.28606  0.86741 -0.69282  1.51858 -0.76244 -0.15331 -1.36584 
      17       18       19       20       21       22       23       24 
-1.06123  1.04825 -0.06463 -1.34341 -0.26376  1.45262  1.16471 -0.16954 </code></pre>
</div>
</div>
<p>These are not quite the same, because R is doing something more complicated and precise to get the standard errors. Let’s not worry about those details for now; the difference is pretty small in this case:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-53_db924bad551f250ce70149ca9ff64591">
<details><summary>Code</summary><div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rstandard_compare_plot</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"resid(bw_lm2)/sigma(bw_lm2)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"rstandard(bw_lm2)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    slope <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    col <span class="op">=</span> <span class="st">"x=y"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-54_d5f1a40b9c7a5d2ff4fb309eb1684bd5">
<details><summary>Code</summary><div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">rstandard_compare_plot</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6bd681bae772480769a0" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6bd681bae772480769a0">{"x":{"data":[{"x":[0.97593310836755265,-0.77919621473671374,-0.7980209456469719,-0.32961734711505747,0.98257713104171263,-0.70278995398326405,-0.38166219139637508,1.3435690296738816,-0.77144485495011095,0.28606208736188538,0.86741407135539106,-0.6928239199719296,1.5185792054792588,-0.76243978590412698,-0.1533089140055125,-1.3658430520491105,-1.0612298860518561,1.0482473130102932,-0.064626484920131969,-1.3434099295140569,-0.26375624495468869,1.4526162792166142,1.1647086300007825,-0.16953713030746553],"y":[1.1598166040138864,-0.92601091190365625,-0.87479165935722436,-0.34722553413921142,1.0350664858662322,-0.73473146215227025,-0.3990085776604258,1.4375164217020679,-0.82538717619706392,0.30606462275250207,0.92806692060435769,-0.87615924904961917,1.9142780218641535,-0.86559211299437233,-0.16429930069729862,-1.463757406212296,-1.1101598943215245,1.0965787352293477,-0.067606211069143884,-1.4615864587633836,-0.28695824526136737,1.5803994274854269,1.2671652372182225,-0.19805433812126064],"text":["x:  0.97593<br />y:  1.15982","x: -0.77920<br />y: -0.92601","x: -0.79802<br />y: -0.87479","x: -0.32962<br />y: -0.34723","x:  0.98258<br />y:  1.03507","x: -0.70279<br />y: -0.73473","x: -0.38166<br />y: -0.39901","x:  1.34357<br />y:  1.43752","x: -0.77144<br />y: -0.82539","x:  0.28606<br />y:  0.30606","x:  0.86741<br />y:  0.92807","x: -0.69282<br />y: -0.87616","x:  1.51858<br />y:  1.91428","x: -0.76244<br />y: -0.86559","x: -0.15331<br />y: -0.16430","x: -1.36584<br />y: -1.46376","x: -1.06123<br />y: -1.11016","x:  1.04825<br />y:  1.09658","x: -0.06463<br />y: -0.06761","x: -1.34341<br />y: -1.46159","x: -0.26376<br />y: -0.28696","x:  1.45262<br />y:  1.58040","x:  1.16471<br />y:  1.26717","x: -0.16954<br />y: -0.19805"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772],"y":[-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,-1.5100641649255289,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772,1.6628003183556772],"text":"intercept: 0<br />slope: 1<br />colour: x=y","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,0,0,1)","dash":"solid"},"hoveron":"points","name":"x=y","legendgroup":"x=y","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.5100641649255289,1.6628003183556772],"tickmode":"array","ticktext":["-1","0","1"],"tickvals":[-1,0,1.0000000000000002],"categoryorder":"array","categoryarray":["-1","0","1"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"resid(bw_lm2)/sigma(bw_lm2)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"scaleanchor":"y","scaleratio":1,"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.6326591776161186,2.0831797932679761],"tickmode":"array","ticktext":["-1","0","1","2"],"tickvals":[-1,0,1,2],"categoryorder":"array","categoryarray":["-1","0","1","2"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"rstandard(bw_lm2)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"scaleanchor":"x","scaleratio":1,"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd854616a9":{"x":{},"y":{},"type":"scatter"},"4dd83cfc4f3d":{"intercept":{},"slope":{},"colour":{}}},"cur_data":"4dd854616a9","visdat":{"4dd854616a9":["function (y) ","x"],"4dd83cfc4f3d":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Let’s add these residuals to the <code>tibble</code> of our dataset:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-56_44a0a496cbde6649c842d25e008e159e">
<details><summary>Code</summary><div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    fitted_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    </span>
<span>    resid_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    <span class="co"># resid_lm2 = weight - fitted_lm2,</span></span>
<span>    </span>
<span>    std_resid_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    <span class="co"># std_resid_lm2 = resid_lm2 / sigma(bw_lm2)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">sex</span>,</span>
<span>    <span class="va">age</span>,</span>
<span>    <span class="va">weight</span>,</span>
<span>    <span class="va">fitted_lm2</span>,</span>
<span>    <span class="va">resid_lm2</span>,</span>
<span>    <span class="va">std_resid_lm2</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
   sex      age weight fitted_lm2 resid_lm2 std_resid_lm2
   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 female    36   2729      2553.     176.          1.16 
 2 female    36   2412      2553.    -141.         -0.926
 3 female    37   2539      2683.    -144.         -0.875
 4 female    38   2754      2814.     -59.5        -0.347
 5 female    38   2991      2814.     177.          1.04 
 6 female    39   2817      2944.    -127.         -0.735
 7 female    39   2875      2944.     -68.9        -0.399
 8 female    40   3317      3074.     243.          1.44 
 9 female    40   2935      3074.    -139.         -0.825
10 female    40   3126      3074.      51.7         0.306
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>Now let’s build histograms:</p>
</section><section id="marginal-distribution-of-nonstandardized-residuals" class="level4"><h4 class="anchored" data-anchor-id="marginal-distribution-of-nonstandardized-residuals">Marginal distribution of (nonstandardized) residuals</h4>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-57_552c98838f0e44b83802a0c086f8283c">
<details><summary>Code</summary><div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">resid_marginal_hist</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resid_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-58_63102a2482c4674b804bd06b72117c62">
<details><summary>Code</summary><div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">resid_marginal_hist</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1d08245c66601f3d44da" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1d08245c66601f3d44da">{"x":{"data":[{"orientation":"v","width":[17.964328180737198,17.964328180737198,17.964328180737198,17.964328180737198,17.964328180737198,17.964328180737198,17.964328180737198,17.964328180737226,17.964328180737226,17.964328180737226,17.964328180737198,17.964328180737226,17.964328180737226,17.964328180737198,17.964328180737255,17.964328180737198,17.964328180737198,17.964328180737255,17.964328180737198,17.964328180737255,17.964328180737198,17.964328180737198,17.964328180737255,17.964328180737198,17.964328180737198,17.964328180737255,17.964328180737198,17.964328180737198,17.964328180737198,17.964328180737311],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[-251.50059453032111,-233.53626634958385,-215.57193816884666,-197.60760998810946,-179.6432818073722,-161.67895362663501,-143.71462544589781,-125.75029726516057,-107.78596908442334,-89.821640903686117,-71.857312722948905,-53.892984542211693,-35.928656361474467,-17.964328180737255,-2.8421709430404007e-14,17.964328180737198,35.928656361474395,53.892984542211622,71.857312722948848,89.821640903686074,107.7859690844233,125.7502972651605,143.71462544589772,161.67895362663495,179.64328180737215,197.60760998810937,215.5719381688466,233.5362663495838,251.500594530321,269.46492271105825],"y":[2,0,0,1,0,0,4,2,0,0,1,2,2,1,0,0,0,1,0,0,0,0,0,1,2,1,1,0,1,2],"text":["count: 2<br />resid_lm2: -2.515e+02","count: 0<br />resid_lm2: -2.335e+02","count: 0<br />resid_lm2: -2.156e+02","count: 1<br />resid_lm2: -1.976e+02","count: 0<br />resid_lm2: -1.796e+02","count: 0<br />resid_lm2: -1.617e+02","count: 4<br />resid_lm2: -1.437e+02","count: 2<br />resid_lm2: -1.258e+02","count: 0<br />resid_lm2: -1.078e+02","count: 0<br />resid_lm2: -8.982e+01","count: 1<br />resid_lm2: -7.186e+01","count: 2<br />resid_lm2: -5.389e+01","count: 2<br />resid_lm2: -3.593e+01","count: 1<br />resid_lm2: -1.796e+01","count: 0<br />resid_lm2: -2.842e-14","count: 0<br />resid_lm2:  1.796e+01","count: 0<br />resid_lm2:  3.593e+01","count: 1<br />resid_lm2:  5.389e+01","count: 0<br />resid_lm2:  7.186e+01","count: 0<br />resid_lm2:  8.982e+01","count: 0<br />resid_lm2:  1.078e+02","count: 0<br />resid_lm2:  1.258e+02","count: 0<br />resid_lm2:  1.437e+02","count: 1<br />resid_lm2:  1.617e+02","count: 2<br />resid_lm2:  1.796e+02","count: 1<br />resid_lm2:  1.976e+02","count: 1<br />resid_lm2:  2.156e+02","count: 0<br />resid_lm2:  2.335e+02","count: 1<br />resid_lm2:  2.515e+02","count: 2<br />resid_lm2:  2.695e+02"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":31.415525114155255},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-287.42925089179556,305.39357907253276],"tickmode":"array","ticktext":["-200","-100","0","100","200","300"],"tickvals":[-200,-100,0,100,200,300.00000000000006],"categoryorder":"array","categoryarray":["-200","-100","0","100","200","300"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"resid_lm2","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.20000000000000001,4.2000000000000002],"tickmode":"array","ticktext":["0","1","2","3","4"],"tickvals":[0,1,2,3,4],"categoryorder":"array","categoryarray":["0","1","2","3","4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd84fe84ffe":{"x":{},"type":"bar"}},"cur_data":"4dd84fe84ffe","visdat":{"4dd84fe84ffe":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Hard to tell with this small amount of data, but I’m a bit concerned that the histogram doesn’t show a bell-curve shape.</p>
<section id="marginal-distribution-of-standardized-residuals" class="level5"><h5 class="anchored" data-anchor-id="marginal-distribution-of-standardized-residuals">Marginal distribution of standardized residuals</h5>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-60_f673d7ca62a76dc96cbfeef05a73420a">
<details><summary>Code</summary><div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">std_resid_marginal_hist</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">std_resid_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-61_ca7051e5a0a9938c20de295c26db4ffe">
<details><summary>Code</summary><div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">std_resid_marginal_hist</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-23a177be599735c58fb6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-23a177be599735c58fb6">{"x":{"data":[{"orientation":"v","width":[0.11648398027849804,0.11648398027849804,0.11648398027849804,0.11648398027849804,0.11648398027849804,0.11648398027849827,0.11648398027849827,0.11648398027849827,0.11648398027849804,0.11648398027849827,0.11648398027849827,0.11648398027849827,0.11648398027849827,0.11648398027849827,0.11648398027849827,0.11648398027849827,0.11648398027849827,0.11648398027849804,0.11648398027849849,0.11648398027849804,0.11648398027849849,0.11648398027849804,0.11648398027849849,0.11648398027849804,0.11648398027849849,0.11648398027849804,0.11648398027849849,0.11648398027849804,0.11648398027849849,0.11648398027849804],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[-1.5142917436204772,-1.3978077633419792,-1.2813237830634807,-1.1648398027849827,-1.0483558225064844,-0.93187184222798614,-0.81538786194948787,-0.6989038816709896,-0.58241990139249133,-0.46593592111399318,-0.34945194083549491,-0.23296796055699664,-0.11648398027849838,-1.1102230246251565e-16,0.11648398027849816,0.23296796055699642,0.34945194083549469,0.46593592111399285,0.58241990139249111,0.69890388167098938,0.81538786194948765,0.93187184222798591,1.0483558225064842,1.1648398027849824,1.2813237830634807,1.397807763341979,1.5142917436204772,1.6307757238989755,1.7472597041774738,1.863743684455972],"y":[2,0,0,1,0,3,2,1,0,0,2,2,2,0,0,0,1,0,0,0,0,1,2,1,1,1,0,1,0,1],"text":["count: 2<br />std_resid_lm2: -1.514e+00","count: 0<br />std_resid_lm2: -1.398e+00","count: 0<br />std_resid_lm2: -1.281e+00","count: 1<br />std_resid_lm2: -1.165e+00","count: 0<br />std_resid_lm2: -1.048e+00","count: 3<br />std_resid_lm2: -9.319e-01","count: 2<br />std_resid_lm2: -8.154e-01","count: 1<br />std_resid_lm2: -6.989e-01","count: 0<br />std_resid_lm2: -5.824e-01","count: 0<br />std_resid_lm2: -4.659e-01","count: 2<br />std_resid_lm2: -3.495e-01","count: 2<br />std_resid_lm2: -2.330e-01","count: 2<br />std_resid_lm2: -1.165e-01","count: 0<br />std_resid_lm2: -1.110e-16","count: 0<br />std_resid_lm2:  1.165e-01","count: 0<br />std_resid_lm2:  2.330e-01","count: 1<br />std_resid_lm2:  3.495e-01","count: 0<br />std_resid_lm2:  4.659e-01","count: 0<br />std_resid_lm2:  5.824e-01","count: 0<br />std_resid_lm2:  6.989e-01","count: 0<br />std_resid_lm2:  8.154e-01","count: 1<br />std_resid_lm2:  9.319e-01","count: 2<br />std_resid_lm2:  1.048e+00","count: 1<br />std_resid_lm2:  1.165e+00","count: 1<br />std_resid_lm2:  1.281e+00","count: 1<br />std_resid_lm2:  1.398e+00","count: 0<br />std_resid_lm2:  1.514e+00","count: 1<br />std_resid_lm2:  1.631e+00","count: 0<br />std_resid_lm2:  1.747e+00","count: 1<br />std_resid_lm2:  1.864e+00"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":31.415525114155255},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.7472597041774738,2.0967116450129684],"tickmode":"array","ticktext":["-1","0","1","2"],"tickvals":[-1,0,1,2],"categoryorder":"array","categoryarray":["-1","0","1","2"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"std_resid_lm2","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.15000000000000002,3.1499999999999999],"tickmode":"array","ticktext":["0","1","2","3"],"tickvals":[0,0.99999999999999989,2,3],"categoryorder":"array","categoryarray":["0","1","2","3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd814c970":{"x":{},"type":"bar"}},"cur_data":"4dd814c970","visdat":{"4dd814c970":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>This looks similar, although the scale of the x-axis got narrower, because we divided by <span class="math inline">\(\hat\sigma\)</span> (roughly speaking).</p>
<p>Still hard to tell if the distribution is Gaussian.</p>
</section></section></section><section id="qq-plot-of-standardized-residuals" class="level3" data-number="2.7.3"><h3 data-number="2.7.3" class="anchored" data-anchor-id="qq-plot-of-standardized-residuals">
<span class="header-section-number">2.7.3</span> QQ plot of standardized residuals</h3>
<p>Another way to assess normality is the QQ plot of the standardized residuals versus normal quantiles:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-63_1a46d2c37293ac744abe2d9ed5415483">
<details><summary>Code</summary><div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span> </span>
<span><span class="co"># needed to make ggplot2::autoplot() work for `lm` objects</span></span>
<span></span>
<span><span class="va">qqplot_lm2_auto</span> <span class="op">=</span> </span>
<span>  <span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span></span>
<span>    which <span class="op">=</span> <span class="fl">2</span>, <span class="co"># options are 1:6; can do multiple at once</span></span>
<span>    ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-64_b5cb023fc79270b3d726f808b8a3e7a8">
<details><summary>Code</summary><div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">qqplot_lm2_auto</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If the Gaussian model were correct, these points should follow the dotted line.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Fig 2.4 panel (c) in Dobson is a little different; they didn’t specify how they produced it, but other statistical analysis systems do things differently from R.</p>
</div>
</div>
<section id="qq-plot---how-its-built" class="level4"><h4 class="anchored" data-anchor-id="qq-plot---how-its-built">QQ plot - how it’s built</h4>
<p>Let’s construct it by hand:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-66_ed0e2abb1f0b13d7bc8a64c24e991124">
<details><summary>Code</summary><div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    p <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="va">std_resid_lm2</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># "Blom's method"</span></span>
<span>    expected_quantiles_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">qqplot_lm2</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">expected_quantiles_lm2</span>, </span>
<span>      y <span class="op">=</span> <span class="va">std_resid_lm2</span>, </span>
<span>      col <span class="op">=</span> <span class="va">sex</span>, </span>
<span>      shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span><span class="op">)</span> <span class="op">+</span> <span class="co"># removing the plot legend</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Normal Q-Q"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Theoretical Quantiles"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Standardized residuals"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We find the expected line like so:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-67_bd0e9f2b937e587663c25a09727f58c1">
<details><summary>Code</summary><div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.75</span><span class="op">)</span>                  <span class="co"># reference probabilities</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>, <span class="va">ps</span><span class="op">)</span>  <span class="co"># empirical quantiles</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>                     <span class="co"># theoretical quantiles</span></span>
<span></span>
<span><span class="va">qq_slope</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="va">qq_intcpt</span> <span class="op">=</span> <span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">qq_slope</span></span>
<span></span>
<span><span class="va">qqplot_lm2</span> <span class="op">=</span> </span>
<span>  <span class="va">qqplot_lm2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="va">qq_slope</span>, intercept <span class="op">=</span> <span class="va">qq_intcpt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-68_786cc10619cf86b809af1bf64cd96a64">
<details><summary>Code</summary><div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">qqplot_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cf323030becdfe59e3c3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cf323030becdfe59e3c3">{"x":{"data":[{"x":[0.88714655901887585,-1.0544724517700528,-0.74159404386151651,-0.15731068461017067,0.61029461018633246,-0.37409541019772347,-0.26414697682592359,1.2581615610630972,-0.48877641111466941,0.37409541019772358,0.48877641111466941,-0.88714655901887585],"y":[1.1598166040138864,-0.92601091190365625,-0.87479165935722436,-0.34722553413921142,1.0350664858662322,-0.73473146215227025,-0.3990085776604258,1.4375164217020679,-0.82538717619706392,0.30606462275250207,0.92806692060435769,-0.87615924904961917],"text":["expected_quantiles_lm2:  0.88715<br />std_resid_lm2:  1.15982<br />sex: female<br />sex: female","expected_quantiles_lm2: -1.05447<br />std_resid_lm2: -0.92601<br />sex: female<br />sex: female","expected_quantiles_lm2: -0.74159<br />std_resid_lm2: -0.87479<br />sex: female<br />sex: female","expected_quantiles_lm2: -0.15731<br />std_resid_lm2: -0.34723<br />sex: female<br />sex: female","expected_quantiles_lm2:  0.61029<br />std_resid_lm2:  1.03507<br />sex: female<br />sex: female","expected_quantiles_lm2: -0.37410<br />std_resid_lm2: -0.73473<br />sex: female<br />sex: female","expected_quantiles_lm2: -0.26415<br />std_resid_lm2: -0.39901<br />sex: female<br />sex: female","expected_quantiles_lm2:  1.25816<br />std_resid_lm2:  1.43752<br />sex: female<br />sex: female","expected_quantiles_lm2: -0.48878<br />std_resid_lm2: -0.82539<br />sex: female<br />sex: female","expected_quantiles_lm2:  0.37410<br />std_resid_lm2:  0.30606<br />sex: female<br />sex: female","expected_quantiles_lm2:  0.48878<br />std_resid_lm2:  0.92807<br />sex: female<br />sex: female","expected_quantiles_lm2: -0.88715<br />std_resid_lm2: -0.87616<br />sex: female<br />sex: female"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"female","legendgroup":"female","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2.0368341317013874,-0.6102946101863328,0.15731068461017067,-2.0368341317013887,-1.2581615610630965,0.74159404386151651,0.26414697682592347,-1.5341205443525459,-0.05224518037594035,1.5341205443525459,1.0544724517700528,0.052245180375940496],"y":[1.9142780218641535,-0.86559211299437233,-0.16429930069729862,-1.463757406212296,-1.1101598943215245,1.0965787352293477,-0.067606211069143884,-1.4615864587633836,-0.28695824526136737,1.5803994274854269,1.2671652372182225,-0.19805433812126064],"text":["expected_quantiles_lm2:  2.03683<br />std_resid_lm2:  1.91428<br />sex: male<br />sex: male","expected_quantiles_lm2: -0.61029<br />std_resid_lm2: -0.86559<br />sex: male<br />sex: male","expected_quantiles_lm2:  0.15731<br />std_resid_lm2: -0.16430<br />sex: male<br />sex: male","expected_quantiles_lm2: -2.03683<br />std_resid_lm2: -1.46376<br />sex: male<br />sex: male","expected_quantiles_lm2: -1.25816<br />std_resid_lm2: -1.11016<br />sex: male<br />sex: male","expected_quantiles_lm2:  0.74159<br />std_resid_lm2:  1.09658<br />sex: male<br />sex: male","expected_quantiles_lm2:  0.26415<br />std_resid_lm2: -0.06761<br />sex: male<br />sex: male","expected_quantiles_lm2: -1.53412<br />std_resid_lm2: -1.46159<br />sex: male<br />sex: male","expected_quantiles_lm2: -0.05225<br />std_resid_lm2: -0.28696<br />sex: male<br />sex: male","expected_quantiles_lm2:  1.53412<br />std_resid_lm2:  1.58040<br />sex: male<br />sex: male","expected_quantiles_lm2:  1.05447<br />std_resid_lm2:  1.26717<br />sex: male<br />sex: male","expected_quantiles_lm2:  0.05225<br />std_resid_lm2: -0.19805<br />sex: male<br />sex: male"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.6692913385826778,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"male","legendgroup":"male","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-2.2405175448715275,2.2405175448715262],"y":[-3.0948853323309269,3.277437880952851],"text":"intercept: 0.09128<br />slope: 1.422","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Normal Q-Q","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-2.2405175448715275,2.2405175448715262],"tickmode":"array","ticktext":["-2","-1","0","1","2"],"tickvals":[-2,-0.99999999999999978,0,1,2.0000000000000004],"categoryorder":"array","categoryarray":["-2","-1","0","1","2"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"Theoretical Quantiles","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.6326591776161186,2.0831797932679761],"tickmode":"array","ticktext":["-1","0","1","2"],"tickvals":[-1,0,1,2],"categoryorder":"array","categoryarray":["-1","0","1","2"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"Standardized residuals","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"4dd8213e3bc1":{"x":{},"y":{},"colour":{},"shape":{},"type":"scatter"},"4dd81456606e":{"intercept":{},"slope":{}}},"cur_data":"4dd8213e3bc1","visdat":{"4dd8213e3bc1":["function (y) ","x"],"4dd81456606e":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section></section><section id="conditional-distributions-of-residuals" class="level3" data-number="2.7.4"><h3 data-number="2.7.4" class="anchored" data-anchor-id="conditional-distributions-of-residuals">
<span class="header-section-number">2.7.4</span> Conditional distributions of residuals</h3>
<p>If our Gaussian linear regression model is correct, the residuals <span class="math inline">\(e_i\)</span> and standardized residuals <span class="math inline">\(r_i\)</span> should have:</p>
<ul>
<li>an approximately Gaussian distribution, with:</li>
<li>a mean of 0</li>
<li>a constant variance</li>
</ul>
<p>This should be true <strong>regardless</strong> of the value of <span class="math inline">\(X\)</span>.</p>
<p>But if we didn’t correctly guess the functional form of linear component of the mean, <span class="math display">\[\text{E}[Y|X=x] = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p\]</span></p>
<p>Then the the residuals might have nonzero mean or nonconstant variance for some values of <span class="math inline">\(x\)</span>.</p>
<section id="residuals-versus-fitted-values" class="level4"><h4 class="anchored" data-anchor-id="residuals-versus-fitted-values">Residuals versus fitted values</h4>
<p>To look for these issues, we can plot the residuals <span class="math inline">\(e_i\)</span> against the fitted values <span class="math inline">\(\hat y_i\)</span>:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-70_d50b230fffd0dca784f70982face6e78">
<details><summary>Code</summary><div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">bw_lm2</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If the model is correct, the blue line should stay flat and close to 0, and the cloud of dots should have the same vertical spread regardless of the fitted value.</p>
<p>If not, we probably need to change the functional form of linear component of the mean, <span class="math display">\[\text{E}[Y|X=x] = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p\]</span></p>
</section><section id="scale-location-plot" class="level4"><h4 class="anchored" data-anchor-id="scale-location-plot">Scale-location plot</h4>
<p>We can also plot the square roots of the absolute values of the standardized residuals against the fitted values:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-71_88f84100b3dcd2c3df661503c4864b1c">
<details><summary>Code</summary><div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">bw_lm2</span>, which <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, the blue line doesn’t need to be near 0, but it should be flat. If not, the residual variance <span class="math inline">\(\sigma^2\)</span> might not be constant, and we might need to transform our outcome <span class="math inline">\(Y\)</span> (or use a model that allows non-constant variance).</p>
</section><section id="residuals-versus-leverage" class="level4"><h4 class="anchored" data-anchor-id="residuals-versus-leverage">Residuals versus leverage</h4>
<p>We can also plot our standardized residuals against “leverage”, which roughly speaking is a measure of how unusual each <span class="math inline">\(x_i\)</span> value is. Very unusual <span class="math inline">\(x_i\)</span> values can have extreme effects on the model fit, so we might want ot remove those observations as outliers, particularly if they have large residuals.</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-73_6b24884e48b717433088d5ead543c0a1">
<details><summary>Code</summary><div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">bw_lm2</span>, which <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The blue line should be relatively flat and close to 0 here.</p>
</section></section><section id="diagnostics-constructed-by-hand" class="level3" data-number="2.7.5"><h3 data-number="2.7.5" class="anchored" data-anchor-id="diagnostics-constructed-by-hand">
<span class="header-section-number">2.7.5</span> Diagnostics constructed by hand</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-75_87e8f940b49bfc1278f0988700538a6d">
<details><summary>Code</summary><div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predlm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    residlm2 <span class="op">=</span> <span class="va">weight</span> <span class="op">-</span> <span class="va">predlm2</span>,</span>
<span>    std_resid <span class="op">=</span> <span class="va">residlm2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    <span class="co"># std_resid_builtin = rstandard(bw_lm2), # uses leverage</span></span>
<span>    sqrt_abs_std_resid <span class="op">=</span> <span class="va">std_resid</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="residuals-vs-fitted" class="level5"><h5 class="anchored" data-anchor-id="residuals-vs-fitted">Residuals vs fitted</h5>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-76_238a780e924c1e6af133a4dfb1685854">
<details><summary>Code</summary><div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">resid_vs_fit</span> <span class="op">=</span> <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predlm2</span>, y <span class="op">=</span> <span class="va">residlm2</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-77_f64227288b75ee5ab090193854f18001">
<details><summary>Code</summary><div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">resid_vs_fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="standardized-residuals-vs-fitted" class="level5"><h5 class="anchored" data-anchor-id="standardized-residuals-vs-fitted">Standardized residuals vs fitted</h5>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-79_94f7e361903222656fe10853cd4f370a">
<details><summary>Code</summary><div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predlm2</span>, y <span class="op">=</span> <span class="va">std_resid</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="standardized-residuals-vs-gestational-age" class="level5"><h5 class="anchored" data-anchor-id="standardized-residuals-vs-gestational-age">Standardized residuals vs gestational age</h5>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-80_d9f07b0efe6b738de72bbb5aa1826d9c">
<details><summary>Code</summary><div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">std_resid</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="sqrtabsrstandard-vs-fitted" class="level5"><h5 class="anchored" data-anchor-id="sqrtabsrstandard-vs-fitted">
<code>sqrt(abs(rstandard()))</code> vs fitted</h5>
<p>Compare with <code>autoplot(bw_lm2, 3)</code></p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-81_390f6a5754203c2221b1a037f63cf33a">
<details><summary>Code</summary><div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predlm2</span>, y <span class="op">=</span> <span class="va">sqrt_abs_std_resid</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section></section><section id="model-selection" class="level2" data-number="2.8"><h2 data-number="2.8" class="anchored" data-anchor-id="model-selection">
<span class="header-section-number">2.8</span> Model selection</h2>
<p>If we have a lot of covariates in our dataset, we might want to choose a small subset to use in our model.</p>
<p>There are a few possible metrics to consider for choosing a “best” model.</p>
<section id="mean-squared-error" class="level3" data-number="2.8.1"><h3 data-number="2.8.1" class="anchored" data-anchor-id="mean-squared-error">
<span class="header-section-number">2.8.1</span> Mean squared error</h3>
<p>We might want to minimize the <strong>mean squared error</strong>, <span class="math inline">\(\text E[(y-\hat y)^2]\)</span>, for new observations that weren’t in our data set when we fit the model.</p>
<p>Unfortunately, <span class="math display">\[\frac{1}{n}\sum_{i=1}^n (y_i-\hat y_i)^2\]</span> gives a biased estimate of <span class="math inline">\(\text E[(y-\hat y)^2]\)</span> for new data. If we want an unbiased estimate, we will have to be clever.</p>
</section><section id="cross-validation" class="level3" data-number="2.8.2"><h3 data-number="2.8.2" class="anchored" data-anchor-id="cross-validation">
<span class="header-section-number">2.8.2</span> Cross-validation</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-82_0185d110e6dae16ee63a4af70b0475d7">
<details><summary>Code</summary><div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"carbohydrate"</span>, package <span class="op">=</span> <span class="st">"dobson"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cvTools</span><span class="op">)</span></span>
<span><span class="va">full.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">carbohydrate</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">carbohydrate</span><span class="op">)</span></span>
<span><span class="va">temp</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/cvTools/man/cvFit.html">cvFit</a></span><span class="op">(</span><span class="va">full.model</span>, data <span class="op">=</span> <span class="va">carbohydrate</span>, K <span class="op">=</span> <span class="fl">5</span>, R <span class="op">=</span> <span class="fl">10</span>,</span>
<span>y <span class="op">=</span> <span class="va">carbohydrate</span><span class="op">$</span><span class="va">carbohydrate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="categorical-covariates-with-more-than-two-levels" class="level2" data-number="2.9"><h2 data-number="2.9" class="anchored" data-anchor-id="categorical-covariates-with-more-than-two-levels">
<span class="header-section-number">2.9</span> Categorical covariates with more than two levels</h2>
<section id="section-1" class="level3" data-number="2.9.1"><h3 data-number="2.9.1" class="anchored" data-anchor-id="section-1">
<span class="header-section-number">2.9.1</span> </h3>
<p>In the birthweight example, the variable <code>sex</code> had only two observed values:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-83_20f73bfd6a7534e1dcbf0867eb699a3a">
<details><summary>Code</summary><div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">bw</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "female" "male"  </code></pre>
</div>
</div>
<p>If there are more than two observed values, we can’t just use a single variable with 0s and 1s.</p>
</section><section id="section-2" class="level3" data-number="2.9.2"><h3 data-number="2.9.2" class="anchored" data-anchor-id="section-2">
<span class="header-section-number">2.9.2</span> </h3>
<p>For example, here’s the (in)famous <code>iris</code> data:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-84_9537e6f46eb2ca48774e66e216156b44">
<details><summary>Code</summary><div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 5
   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
 1          5.1         3.5          1.4         0.2 setosa 
 2          4.9         3            1.4         0.2 setosa 
 3          4.7         3.2          1.3         0.2 setosa 
 4          4.6         3.1          1.5         0.2 setosa 
 5          5           3.6          1.4         0.2 setosa 
 6          5.4         3.9          1.7         0.4 setosa 
 7          4.6         3.4          1.4         0.3 setosa 
 8          5           3.4          1.5         0.2 setosa 
 9          4.4         2.9          1.4         0.2 setosa 
10          4.9         3.1          1.5         0.1 setosa 
# ℹ 140 more rows</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length   Sepal.Width    Petal.Length   Petal.Width        Species  
 Min.   :4.30   Min.   :2.00   Min.   :1.00   Min.   :0.1   setosa    :50  
 1st Qu.:5.10   1st Qu.:2.80   1st Qu.:1.60   1st Qu.:0.3   versicolor:50  
 Median :5.80   Median :3.00   Median :4.35   Median :1.3   virginica :50  
 Mean   :5.84   Mean   :3.06   Mean   :3.76   Mean   :1.2                  
 3rd Qu.:6.40   3rd Qu.:3.30   3rd Qu.:5.10   3rd Qu.:1.8                  
 Max.   :7.90   Max.   :4.40   Max.   :6.90   Max.   :2.5                  </code></pre>
</div>
</div>
</section><section id="section-3" class="level3" data-number="2.9.3"><h3 data-number="2.9.3" class="anchored" data-anchor-id="section-3">
<span class="header-section-number">2.9.3</span> </h3>
<p>There are three species:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-85_8b0deab103109eb24b0ba4b0cd89686e">
<details><summary>Code</summary><div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] setosa     versicolor virginica 
Levels: setosa versicolor virginica</code></pre>
</div>
</div>
</section><section id="section-4" class="level3" data-number="2.9.4"><h3 data-number="2.9.4" class="anchored" data-anchor-id="section-4">
<span class="header-section-number">2.9.4</span> </h3>
<p>If we want to model <code>Sepal.Length</code> by species, we could create a variable <span class="math inline">\(X\)</span> that represents “setosa” as <span class="math inline">\(X=1\)</span>, “virginica” as <span class="math inline">\(X=2\)</span>, and “versicolor” as <span class="math inline">\(X=3\)</span>.</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-86_0082ccd359f96f027ed2b9cc4630c8e5">
<details><summary>Code</summary><div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span> <span class="co"># this step is not always necessary, but ensures you're starting  </span></span>
<span><span class="co"># from the original version of a dataset stored in a loaded package</span></span>
<span></span>
<span><span class="va">iris</span> <span class="op">=</span> </span>
<span>  <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">Species</span> <span class="op">==</span> <span class="st">"versicolor"</span> <span class="op">~</span> <span class="fl">3</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Species</span>, <span class="va">X</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  Species        X
  &lt;fct&gt;      &lt;dbl&gt;
1 setosa         1
2 versicolor     3
3 virginica      2</code></pre>
</div>
</div>
<p>Then we could fit a model like:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-87_3a4e12075e911596c5669423e3721e54">
<details><summary>Code</summary><div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_lm1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris_lm1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(148)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">4.91</td>
<td style="text-align: center;">0.16</td>
<td style="text-align: center;">(4.60, 5.23)</td>
<td style="text-align: center;">30.83</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">X</td>
<td style="text-align: center;">0.47</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(0.32, 0.61)</td>
<td style="text-align: center;">6.30</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="lets-see-how-that-model-looks" class="level3" data-number="2.9.5"><h3 data-number="2.9.5" class="anchored" data-anchor-id="lets-see-how-that-model-looks">
<span class="header-section-number">2.9.5</span> Let’s see how that model looks:</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-88_793989c9c850be729810d1085c3a6874">
<details><summary>Code</summary><div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_plot1</span> <span class="op">=</span> <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">X</span>, </span>
<span>      y <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>    intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-90_dc722843b71d77ac06bff96e41c115fe">
<details><summary>Code</summary><div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">iris_plot1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f87ba112004a3b46a658" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f87ba112004a3b46a658">{"x":{"data":[{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[5.0999999999999996,4.9000000000000004,4.7000000000000002,4.5999999999999996,5,5.4000000000000004,4.5999999999999996,5,4.4000000000000004,4.9000000000000004,5.4000000000000004,4.7999999999999998,4.7999999999999998,4.2999999999999998,5.7999999999999998,5.7000000000000002,5.4000000000000004,5.0999999999999996,5.7000000000000002,5.0999999999999996,5.4000000000000004,5.0999999999999996,4.5999999999999996,5.0999999999999996,4.7999999999999998,5,5,5.2000000000000002,5.2000000000000002,4.7000000000000002,4.7999999999999998,5.4000000000000004,5.2000000000000002,5.5,4.9000000000000004,5,5.5,4.9000000000000004,4.4000000000000004,5.0999999999999996,5,4.5,4.4000000000000004,5,5.0999999999999996,4.7999999999999998,5.0999999999999996,4.5999999999999996,5.2999999999999998,5,7,6.4000000000000004,6.9000000000000004,5.5,6.5,5.7000000000000002,6.2999999999999998,4.9000000000000004,6.5999999999999996,5.2000000000000002,5,5.9000000000000004,6,6.0999999999999996,5.5999999999999996,6.7000000000000002,5.5999999999999996,5.7999999999999998,6.2000000000000002,5.5999999999999996,5.9000000000000004,6.0999999999999996,6.2999999999999998,6.0999999999999996,6.4000000000000004,6.5999999999999996,6.7999999999999998,6.7000000000000002,6,5.7000000000000002,5.5,5.5,5.7999999999999998,6,5.4000000000000004,6,6.7000000000000002,6.2999999999999998,5.5999999999999996,5.5,5.5,6.0999999999999996,5.7999999999999998,5,5.5999999999999996,5.7000000000000002,5.7000000000000002,6.2000000000000002,5.0999999999999996,5.7000000000000002,6.2999999999999998,5.7999999999999998,7.0999999999999996,6.2999999999999998,6.5,7.5999999999999996,4.9000000000000004,7.2999999999999998,6.7000000000000002,7.2000000000000002,6.5,6.4000000000000004,6.7999999999999998,5.7000000000000002,5.7999999999999998,6.4000000000000004,6.5,7.7000000000000002,7.7000000000000002,6,6.9000000000000004,5.5999999999999996,7.7000000000000002,6.2999999999999998,6.7000000000000002,7.2000000000000002,6.2000000000000002,6.0999999999999996,6.4000000000000004,7.2000000000000002,7.4000000000000004,7.9000000000000004,6.4000000000000004,6.2999999999999998,6.0999999999999996,7.7000000000000002,6.2999999999999998,6.4000000000000004,6,6.9000000000000004,6.7000000000000002,6.9000000000000004,5.7999999999999998,6.7999999999999998,6.7000000000000002,6.7000000000000002,6.2999999999999998,6.5,6.2000000000000002,5.9000000000000004],"text":["X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 4.7","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 4.4","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 4.3","X: 1<br />Sepal.Length: 5.8","X: 1<br />Sepal.Length: 5.7","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 5.7","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.2","X: 1<br />Sepal.Length: 5.2","X: 1<br />Sepal.Length: 4.7","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 5.2","X: 1<br />Sepal.Length: 5.5","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.5","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 4.4","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 4.5","X: 1<br />Sepal.Length: 4.4","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.3","X: 1<br />Sepal.Length: 5.0","X: 3<br />Sepal.Length: 7.0","X: 3<br />Sepal.Length: 6.4","X: 3<br />Sepal.Length: 6.9","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 6.5","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 6.3","X: 3<br />Sepal.Length: 4.9","X: 3<br />Sepal.Length: 6.6","X: 3<br />Sepal.Length: 5.2","X: 3<br />Sepal.Length: 5.0","X: 3<br />Sepal.Length: 5.9","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 6.7","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.8","X: 3<br />Sepal.Length: 6.2","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.9","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 6.3","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 6.4","X: 3<br />Sepal.Length: 6.6","X: 3<br />Sepal.Length: 6.8","X: 3<br />Sepal.Length: 6.7","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 5.8","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 5.4","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 6.7","X: 3<br />Sepal.Length: 6.3","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 5.8","X: 3<br />Sepal.Length: 5.0","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 6.2","X: 3<br />Sepal.Length: 5.1","X: 3<br />Sepal.Length: 5.7","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 5.8","X: 2<br />Sepal.Length: 7.1","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 7.6","X: 2<br />Sepal.Length: 4.9","X: 2<br />Sepal.Length: 7.3","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 7.2","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.8","X: 2<br />Sepal.Length: 5.7","X: 2<br />Sepal.Length: 5.8","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 6.0","X: 2<br />Sepal.Length: 6.9","X: 2<br />Sepal.Length: 5.6","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 7.2","X: 2<br />Sepal.Length: 6.2","X: 2<br />Sepal.Length: 6.1","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 7.2","X: 2<br />Sepal.Length: 7.4","X: 2<br />Sepal.Length: 7.9","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.1","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.0","X: 2<br />Sepal.Length: 6.9","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 6.9","X: 2<br />Sepal.Length: 5.8","X: 2<br />Sepal.Length: 6.8","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 6.2","X: 2<br />Sepal.Length: 5.9"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":0.10000000000000001,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.90000000000000002,3.1000000000000001],"y":[5.3318333333333356,6.354833333333338],"text":"intercept: 4.913<br />slope: 0.465","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":32.73723536737235,"r":11.955168119551683,"b":65.753424657534254,"l":51.407222914072236},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":23.910336239103366},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.90000000000000002,3.1000000000000001],"tickmode":"array","ticktext":["1.0","1.5","2.0","2.5","3.0"],"tickvals":[1,1.5,2,2.5,3],"categoryorder":"array","categoryarray":["1.0","1.5","2.0","2.5","3.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.9775840597758414,"tickwidth":1.0868334654137892,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":19.128268991282692},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":1.0868334654137892,"zeroline":false,"anchor":"y","title":{"text":"X","font":{"color":"rgba(0,0,0,1)","family":"","size":23.910336239103366}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.1200000000000001,8.0800000000000001],"tickmode":"array","ticktext":["5","6","7","8"],"tickvals":[5,6,7,8],"categoryorder":"array","categoryarray":["5","6","7","8"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.9775840597758414,"tickwidth":1.0868334654137897,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":19.128268991282692},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":1.0868334654137897,"zeroline":false,"anchor":"x","title":{"text":"Sepal.Length","font":{"color":"rgba(0,0,0,1)","family":"","size":23.910336239103366}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":1.0868334654137897,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":3.0923407301360055,"font":{"color":"rgba(0,0,0,1)","family":"","size":19.128268991282692}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"3ccc1f966c":{"x":{},"y":{},"type":"scatter"},"3ccc753f646b":{"intercept":{},"slope":{}}},"cur_data":"3ccc1f966c","visdat":{"3ccc1f966c":["function (y) ","x"],"3ccc753f646b":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We have forced the model to use a straight line for the three estimated means. Maybe not a good idea?</p>
</section><section id="lets-see-what-r-does-with-categorical-variables-by-default" class="level3" data-number="2.9.6"><h3 data-number="2.9.6" class="anchored" data-anchor-id="lets-see-what-r-does-with-categorical-variables-by-default">
<span class="header-section-number">2.9.6</span> Let’s see what R does with categorical variables by default:</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-91_99308ad2d038f7e21e8e10d99451a1a3">
<details><summary>Code</summary><div class="sourceCode" id="cb136"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_lm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 20%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(147)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">5.01</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(4.86, 5.15)</td>
<td style="text-align: center;">68.76</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Species (versicolor)</td>
<td style="text-align: center;">0.93</td>
<td style="text-align: center;">0.10</td>
<td style="text-align: center;">(0.73, 1.13)</td>
<td style="text-align: center;">9.03</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Species (virginica)</td>
<td style="text-align: center;">1.58</td>
<td style="text-align: center;">0.10</td>
<td style="text-align: center;">(1.38, 1.79)</td>
<td style="text-align: center;">15.37</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="re-parametrize-with-no-intercept" class="level3" data-number="2.9.7"><h3 data-number="2.9.7" class="anchored" data-anchor-id="re-parametrize-with-no-intercept">
<span class="header-section-number">2.9.7</span> Re-parametrize with no intercept</h3>
<p>If you don’t want the default and offset option, you can use “-1” like we’ve seen previously:</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-92_4e29a20d17809b6f88c6fac0cdd335f4">
<details><summary>Code</summary><div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris.lm2b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris.lm2b</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 20%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(147)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Species (setosa)</td>
<td style="text-align: center;">5.01</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(4.86, 5.15)</td>
<td style="text-align: center;">68.76</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Species (versicolor)</td>
<td style="text-align: center;">5.94</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(5.79, 6.08)</td>
<td style="text-align: center;">81.54</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Species (virginica)</td>
<td style="text-align: center;">6.59</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(6.44, 6.73)</td>
<td style="text-align: center;">90.49</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="lets-see-what-these-new-models-look-like" class="level3" data-number="2.9.8"><h3 data-number="2.9.8" class="anchored" data-anchor-id="lets-see-what-these-new-models-look-like">
<span class="header-section-number">2.9.8</span> Let’s see what these new models look like:</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-93_dfb3cfcab95474435f90519bc2478e40">
<details><summary>Code</summary><div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_plot2</span> <span class="op">=</span> </span>
<span>  <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predlm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">iris_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">predlm2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>    intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-95_361b74ff19913c826a1ae592b7b7bd59">
<details><summary>Code</summary><div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">iris_plot2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4898d240caa1f7c734f4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4898d240caa1f7c734f4">{"x":{"data":[{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],"y":[5.0999999999999996,4.9000000000000004,4.7000000000000002,4.5999999999999996,5,5.4000000000000004,4.5999999999999996,5,4.4000000000000004,4.9000000000000004,5.4000000000000004,4.7999999999999998,4.7999999999999998,4.2999999999999998,5.7999999999999998,5.7000000000000002,5.4000000000000004,5.0999999999999996,5.7000000000000002,5.0999999999999996,5.4000000000000004,5.0999999999999996,4.5999999999999996,5.0999999999999996,4.7999999999999998,5,5,5.2000000000000002,5.2000000000000002,4.7000000000000002,4.7999999999999998,5.4000000000000004,5.2000000000000002,5.5,4.9000000000000004,5,5.5,4.9000000000000004,4.4000000000000004,5.0999999999999996,5,4.5,4.4000000000000004,5,5.0999999999999996,4.7999999999999998,5.0999999999999996,4.5999999999999996,5.2999999999999998,5,6.2999999999999998,5.7999999999999998,7.0999999999999996,6.2999999999999998,6.5,7.5999999999999996,4.9000000000000004,7.2999999999999998,6.7000000000000002,7.2000000000000002,6.5,6.4000000000000004,6.7999999999999998,5.7000000000000002,5.7999999999999998,6.4000000000000004,6.5,7.7000000000000002,7.7000000000000002,6,6.9000000000000004,5.5999999999999996,7.7000000000000002,6.2999999999999998,6.7000000000000002,7.2000000000000002,6.2000000000000002,6.0999999999999996,6.4000000000000004,7.2000000000000002,7.4000000000000004,7.9000000000000004,6.4000000000000004,6.2999999999999998,6.0999999999999996,7.7000000000000002,6.2999999999999998,6.4000000000000004,6,6.9000000000000004,6.7000000000000002,6.9000000000000004,5.7999999999999998,6.7999999999999998,6.7000000000000002,6.7000000000000002,6.2999999999999998,6.5,6.2000000000000002,5.9000000000000004,7,6.4000000000000004,6.9000000000000004,5.5,6.5,5.7000000000000002,6.2999999999999998,4.9000000000000004,6.5999999999999996,5.2000000000000002,5,5.9000000000000004,6,6.0999999999999996,5.5999999999999996,6.7000000000000002,5.5999999999999996,5.7999999999999998,6.2000000000000002,5.5999999999999996,5.9000000000000004,6.0999999999999996,6.2999999999999998,6.0999999999999996,6.4000000000000004,6.5999999999999996,6.7999999999999998,6.7000000000000002,6,5.7000000000000002,5.5,5.5,5.7999999999999998,6,5.4000000000000004,6,6.7000000000000002,6.2999999999999998,5.5999999999999996,5.5,5.5,6.0999999999999996,5.7999999999999998,5,5.5999999999999996,5.7000000000000002,5.7000000000000002,6.2000000000000002,5.0999999999999996,5.7000000000000002],"text":["X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 4.7","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 4.4","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 4.3","X: 1<br />Sepal.Length: 5.8","X: 1<br />Sepal.Length: 5.7","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 5.7","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.2","X: 1<br />Sepal.Length: 5.2","X: 1<br />Sepal.Length: 4.7","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 5.4","X: 1<br />Sepal.Length: 5.2","X: 1<br />Sepal.Length: 5.5","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.5","X: 1<br />Sepal.Length: 4.9","X: 1<br />Sepal.Length: 4.4","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 4.5","X: 1<br />Sepal.Length: 4.4","X: 1<br />Sepal.Length: 5.0","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.8","X: 1<br />Sepal.Length: 5.1","X: 1<br />Sepal.Length: 4.6","X: 1<br />Sepal.Length: 5.3","X: 1<br />Sepal.Length: 5.0","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 5.8","X: 2<br />Sepal.Length: 7.1","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 7.6","X: 2<br />Sepal.Length: 4.9","X: 2<br />Sepal.Length: 7.3","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 7.2","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.8","X: 2<br />Sepal.Length: 5.7","X: 2<br />Sepal.Length: 5.8","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 6.0","X: 2<br />Sepal.Length: 6.9","X: 2<br />Sepal.Length: 5.6","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 7.2","X: 2<br />Sepal.Length: 6.2","X: 2<br />Sepal.Length: 6.1","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 7.2","X: 2<br />Sepal.Length: 7.4","X: 2<br />Sepal.Length: 7.9","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.1","X: 2<br />Sepal.Length: 7.7","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.4","X: 2<br />Sepal.Length: 6.0","X: 2<br />Sepal.Length: 6.9","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 6.9","X: 2<br />Sepal.Length: 5.8","X: 2<br />Sepal.Length: 6.8","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 6.7","X: 2<br />Sepal.Length: 6.3","X: 2<br />Sepal.Length: 6.5","X: 2<br />Sepal.Length: 6.2","X: 2<br />Sepal.Length: 5.9","X: 3<br />Sepal.Length: 7.0","X: 3<br />Sepal.Length: 6.4","X: 3<br />Sepal.Length: 6.9","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 6.5","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 6.3","X: 3<br />Sepal.Length: 4.9","X: 3<br />Sepal.Length: 6.6","X: 3<br />Sepal.Length: 5.2","X: 3<br />Sepal.Length: 5.0","X: 3<br />Sepal.Length: 5.9","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 6.7","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.8","X: 3<br />Sepal.Length: 6.2","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.9","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 6.3","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 6.4","X: 3<br />Sepal.Length: 6.6","X: 3<br />Sepal.Length: 6.8","X: 3<br />Sepal.Length: 6.7","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 5.8","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 5.4","X: 3<br />Sepal.Length: 6.0","X: 3<br />Sepal.Length: 6.7","X: 3<br />Sepal.Length: 6.3","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 5.5","X: 3<br />Sepal.Length: 6.1","X: 3<br />Sepal.Length: 5.8","X: 3<br />Sepal.Length: 5.0","X: 3<br />Sepal.Length: 5.6","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 5.7","X: 3<br />Sepal.Length: 6.2","X: 3<br />Sepal.Length: 5.1","X: 3<br />Sepal.Length: 5.7"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":0.10000000000000001,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],"y":[5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,5.0059999999999993,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,6.5880000000000001,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991,5.9359999999999991],"text":["X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 1<br />predlm2: 5.006","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 2<br />predlm2: 6.588","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936","X: 3<br />predlm2: 5.936"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.90000000000000002,3.1000000000000001],"y":[5.3318333333333356,6.354833333333338],"text":"intercept: 4.913<br />slope: 0.465","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":32.73723536737235,"r":11.955168119551683,"b":65.753424657534254,"l":51.407222914072236},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":23.910336239103366},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.90000000000000002,3.1000000000000001],"tickmode":"array","ticktext":["1.0","1.5","2.0","2.5","3.0"],"tickvals":[1,1.5,2,2.5,3],"categoryorder":"array","categoryarray":["1.0","1.5","2.0","2.5","3.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.9775840597758414,"tickwidth":1.0868334654137892,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":19.128268991282692},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":1.0868334654137892,"zeroline":false,"anchor":"y","title":{"text":"X","font":{"color":"rgba(0,0,0,1)","family":"","size":23.910336239103366}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.1200000000000001,8.0800000000000001],"tickmode":"array","ticktext":["5","6","7","8"],"tickvals":[5,6,7,8],"categoryorder":"array","categoryarray":["5","6","7","8"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.9775840597758414,"tickwidth":1.0868334654137897,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":19.128268991282692},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":1.0868334654137897,"zeroline":false,"anchor":"x","title":{"text":"Sepal.Length","font":{"color":"rgba(0,0,0,1)","family":"","size":23.910336239103366}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":1.0868334654137897,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":3.0923407301360055,"font":{"color":"rgba(0,0,0,1)","family":"","size":19.128268991282692}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"3ccc10904f77":{"x":{},"y":{},"type":"scatter"},"3ccc3a8936b3":{"x":{},"y":{}},"3ccc2c0668c9":{"intercept":{},"slope":{}}},"cur_data":"3ccc10904f77","visdat":{"3ccc10904f77":["function (y) ","x"],"3ccc3a8936b3":["function (y) ","x"],"3ccc2c0668c9":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section id="lets-see-how-r-did-that" class="level3" data-number="2.9.9"><h3 data-number="2.9.9" class="anchored" data-anchor-id="lets-see-how-r-did-that">
<span class="header-section-number">2.9.9</span> Let’s see how R did that:</h3>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-96_00132b995c515f165bc1978ac8ad276d">
<details><summary>Code</summary><div class="sourceCode" id="cb140"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">iris_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length ~ Species</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">iris_lm2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  `(Intercept)` Speciesversicolor Speciesvirginica
          &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;
1             1                 0                0
2             1                 1                0
3             1                 0                1</code></pre>
</div>
</div>
<p>This is called a “corner point parametrization”.</p>
<div class="cell" data-hash="Linear-models-overview_cache/html/unnamed-chunk-97_2d0c117291f1cb131a857c9a452a755d">
<details><summary>Code</summary><div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">iris.lm2b</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length ~ Species - 1</code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">iris.lm2b</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Speciessetosa Speciesversicolor Speciesvirginica
          &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;
1             1                 0                0
2             0                 1                0
3             0                 0                1</code></pre>
</div>
</div>
<p>This can be called a “group point parametrization”.</p>
<p>There are more options; see Dobson &amp; Barnett §6.4.1.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-fieller2018basics" class="csl-entry" role="listitem">
Fieller, Nick. 2016. <em>Basics of Matrix Algebra for Statistics with r</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9781315370200">https://doi.org/10.1201/9781315370200</a>.
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>using the definite article “the” would mean there is only one slope.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./glms.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Generalized Linear Models</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./logistic-regression.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb148" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Linear (Gaussian) Models"</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>{{&lt; include shared-config.qmd &gt;}}</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>This content is adapted from Dobson &amp; Barnett, An Introduction to Generalized Linear Models, 4th edition, Chapters 2-6<span class="sc">\]</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'digits'</span> <span class="ot">=</span> <span class="dv">4</span>)</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">panderOptions</span>(<span class="st">"table.emphasize.rownames"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>Functions from these packages will be used throughout this document:</span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander) <span class="co"># format tables for markdown</span></span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># graphics</span></span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeasy) <span class="co"># help with graphics</span></span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># manipulate data</span></span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># import Stata files</span></span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) <span class="co"># format R output for markdown</span></span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># Tools to help to create tidy data</span></span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly) <span class="co"># interactive graphics</span></span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dobson) <span class="co"># datasets from Dobson and Barnett 2018</span></span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters) <span class="co"># format model output tables for markdown</span></span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted) <span class="co"># check for conflicting function definitions</span></span>
<span id="cb148-36"><a href="#cb148-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-37"><a href="#cb148-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-38"><a href="#cb148-38" aria-hidden="true" tabindex="-1"></a><span class="fu"># Understanding Gaussian Linear Regression Models</span></span>
<span id="cb148-39"><a href="#cb148-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-40"><a href="#cb148-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Motivating example: birthweights and gestational age</span></span>
<span id="cb148-41"><a href="#cb148-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-42"><a href="#cb148-42" aria-hidden="true" tabindex="-1"></a>Suppose we want to learn about the distributions of birthweights for (human) babies born at different gestational ages and with different chromosomal sexes (Dobson and Barnett, Example 2.2.2):</span>
<span id="cb148-43"><a href="#cb148-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-46"><a href="#cb148-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-47"><a href="#cb148-47" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"birthweight"</span>, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb148-48"><a href="#cb148-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-49"><a href="#cb148-49" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb148-50"><a href="#cb148-50" aria-hidden="true" tabindex="-1"></a>  birthweight <span class="sc">|&gt;</span> </span>
<span id="cb148-51"><a href="#cb148-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb148-52"><a href="#cb148-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb148-53"><a href="#cb148-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">".value"</span>),</span>
<span id="cb148-54"><a href="#cb148-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"s "</span></span>
<span id="cb148-55"><a href="#cb148-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb148-56"><a href="#cb148-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-57"><a href="#cb148-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"boy"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>),</span>
<span id="cb148-58"><a href="#cb148-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">male =</span> (sex <span class="sc">==</span> <span class="st">"male"</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>())  <span class="sc">|&gt;</span> </span>
<span id="cb148-59"><a href="#cb148-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">age =</span> <span class="st">`</span><span class="at">gestational age</span><span class="st">`</span>)</span>
<span id="cb148-60"><a href="#cb148-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-61"><a href="#cb148-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-64"><a href="#cb148-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-65"><a href="#cb148-65" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">=</span> bw <span class="sc">|&gt;</span> </span>
<span id="cb148-66"><a href="#cb148-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb148-67"><a href="#cb148-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> age, </span>
<span id="cb148-68"><a href="#cb148-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> weight,</span>
<span id="cb148-69"><a href="#cb148-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> sex,</span>
<span id="cb148-70"><a href="#cb148-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> sex,</span>
<span id="cb148-71"><a href="#cb148-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> sex))  <span class="sc">+</span></span>
<span id="cb148-72"><a href="#cb148-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb148-73"><a href="#cb148-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Gestational age (weeks)"</span>) <span class="sc">+</span></span>
<span id="cb148-74"><a href="#cb148-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Birthweight (grams)"</span>) <span class="sc">+</span></span>
<span id="cb148-75"><a href="#cb148-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand_limits(y = 0, x = 0) +</span></span>
<span id="cb148-76"><a href="#cb148-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">7</span>)</span>
<span id="cb148-77"><a href="#cb148-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-78"><a href="#cb148-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-79"><a href="#cb148-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-80"><a href="#cb148-80" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-83"><a href="#cb148-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-84"><a href="#cb148-84" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(plot1 <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> sex))</span>
<span id="cb148-85"><a href="#cb148-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-86"><a href="#cb148-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-87"><a href="#cb148-87" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-88"><a href="#cb148-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-89"><a href="#cb148-89" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-92"><a href="#cb148-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-93"><a href="#cb148-93" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1 <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> sex))</span>
<span id="cb148-94"><a href="#cb148-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-95"><a href="#cb148-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-96"><a href="#cb148-96" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-97"><a href="#cb148-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-98"><a href="#cb148-98" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parallel lines regression</span></span>
<span id="cb148-99"><a href="#cb148-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-100"><a href="#cb148-100" aria-hidden="true" tabindex="-1"></a>We don't have enough data to model the distribution of birth weight separately for each combination of gestational age and sex, so let's instead consider a (relatively) simple model for how that distribution varies with gestational age and sex.</span>
<span id="cb148-101"><a href="#cb148-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-102"><a href="#cb148-102" aria-hidden="true" tabindex="-1"></a><span class="fu">### Notation</span></span>
<span id="cb148-103"><a href="#cb148-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-104"><a href="#cb148-104" aria-hidden="true" tabindex="-1"></a>Let:</span>
<span id="cb148-105"><a href="#cb148-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-106"><a href="#cb148-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Y$ represent birthweight (measured in grams)</span>
<span id="cb148-107"><a href="#cb148-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X_1$ represent chromosomal sex:</span>
<span id="cb148-108"><a href="#cb148-108" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$X_1 = 0$ if female (XX)</span>
<span id="cb148-109"><a href="#cb148-109" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$X_1 = 1$ if male (XY)</span>
<span id="cb148-110"><a href="#cb148-110" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X_2$ represent gestational age at birth (measured in weeks).</span>
<span id="cb148-111"><a href="#cb148-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-112"><a href="#cb148-112" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb148-113"><a href="#cb148-113" aria-hidden="true" tabindex="-1"></a>Female is the **reference level** for the categorical variable $X_1$ (chromosomal sex). The choice of a reference level is arbitrary and does not limit what we can do with the resulting model; it only makes it more computationally convenient to make inferences about comparisons involving that reference group.</span>
<span id="cb148-114"><a href="#cb148-114" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-115"><a href="#cb148-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-116"><a href="#cb148-116" aria-hidden="true" tabindex="-1"></a>Now, consider the following model:</span>
<span id="cb148-117"><a href="#cb148-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-118"><a href="#cb148-118" aria-hidden="true" tabindex="-1"></a>$$Y \sim N(\mu(X_1,X_2), \sigma^2)$$</span>
<span id="cb148-119"><a href="#cb148-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-120"><a href="#cb148-120" aria-hidden="true" tabindex="-1"></a>$$\mu(X_1,X_2)\eqdef E<span class="co">[</span><span class="ot">Y|X_1, X_2</span><span class="co">]</span> = \beta_0 + \beta_1 X_1+ \beta_2 X_2$$</span>
<span id="cb148-121"><a href="#cb148-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-122"><a href="#cb148-122" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implementing the Model in R</span></span>
<span id="cb148-123"><a href="#cb148-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-124"><a href="#cb148-124" aria-hidden="true" tabindex="-1"></a>Here's how we can implement this model in R:</span>
<span id="cb148-125"><a href="#cb148-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-128"><a href="#cb148-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-129"><a href="#cb148-129" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="ot">=</span> <span class="fu">lm</span>(</span>
<span id="cb148-130"><a href="#cb148-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> weight <span class="sc">~</span> sex <span class="sc">+</span> age, </span>
<span id="cb148-131"><a href="#cb148-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> bw)</span>
<span id="cb148-132"><a href="#cb148-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-133"><a href="#cb148-133" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="sc">|&gt;</span> </span>
<span id="cb148-134"><a href="#cb148-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">show_sigma =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb148-135"><a href="#cb148-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb148-136"><a href="#cb148-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-137"><a href="#cb148-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-138"><a href="#cb148-138" aria-hidden="true" tabindex="-1"></a>Here's how this model looks, superimposed on the data:</span>
<span id="cb148-139"><a href="#cb148-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-142"><a href="#cb148-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-143"><a href="#cb148-143" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb148-144"><a href="#cb148-144" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-145"><a href="#cb148-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">E[Y|X=x]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">fitted</span>(bw_lm1)) <span class="sc">|&gt;</span> </span>
<span id="cb148-146"><a href="#cb148-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex, age)</span>
<span id="cb148-147"><a href="#cb148-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-148"><a href="#cb148-148" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">=</span> </span>
<span id="cb148-149"><a href="#cb148-149" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">%+%</span> bw <span class="sc">+</span></span>
<span id="cb148-150"><a href="#cb148-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">E[Y|X=x]</span><span class="st">`</span>))</span>
<span id="cb148-151"><a href="#cb148-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-152"><a href="#cb148-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-153"><a href="#cb148-153" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-156"><a href="#cb148-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-157"><a href="#cb148-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Parallel-slopes model of birthweight"</span></span>
<span id="cb148-158"><a href="#cb148-158" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot2)</span>
<span id="cb148-159"><a href="#cb148-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-160"><a href="#cb148-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-161"><a href="#cb148-161" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-162"><a href="#cb148-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-163"><a href="#cb148-163" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-166"><a href="#cb148-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-167"><a href="#cb148-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Parallel-slopes model of birthweight"</span></span>
<span id="cb148-168"><a href="#cb148-168" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(plot2)</span>
<span id="cb148-169"><a href="#cb148-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-170"><a href="#cb148-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-171"><a href="#cb148-171" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-172"><a href="#cb148-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-173"><a href="#cb148-173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model assumptions and predictions</span></span>
<span id="cb148-174"><a href="#cb148-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-175"><a href="#cb148-175" aria-hidden="true" tabindex="-1"></a>To learn what this model is assuming, let's plug in a few values.</span>
<span id="cb148-176"><a href="#cb148-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-177"><a href="#cb148-177" aria-hidden="true" tabindex="-1"></a>According to this model, what's the mean birthweight for a female born at 36 weeks?</span>
<span id="cb148-178"><a href="#cb148-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-181"><a href="#cb148-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-182"><a href="#cb148-182" aria-hidden="true" tabindex="-1"></a>pred_female <span class="ot">=</span> <span class="fu">coef</span>(bw_lm1)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> <span class="fu">coef</span>(bw_lm1)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span></span>
<span id="cb148-183"><a href="#cb148-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-184"><a href="#cb148-184" aria-hidden="true" tabindex="-1"></a><span class="co"># print(pred_female)</span></span>
<span id="cb148-185"><a href="#cb148-185" aria-hidden="true" tabindex="-1"></a><span class="do">## built-in prediction: </span></span>
<span id="cb148-186"><a href="#cb148-186" aria-hidden="true" tabindex="-1"></a><span class="co"># predict(bw_lm1, newdata = tibble(sex = "female", age = 36))</span></span>
<span id="cb148-187"><a href="#cb148-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-188"><a href="#cb148-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-189"><a href="#cb148-189" aria-hidden="true" tabindex="-1"></a>$$E<span class="co">[</span><span class="ot">Y|X_1 = 0, X_2 = 36</span><span class="co">]</span> = \beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36 =  <span class="in">`r pred_female`</span>$$</span>
<span id="cb148-190"><a href="#cb148-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-191"><a href="#cb148-191" aria-hidden="true" tabindex="-1"></a>What's the mean birthweight for a male born at 36 weeks?</span>
<span id="cb148-192"><a href="#cb148-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-195"><a href="#cb148-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-196"><a href="#cb148-196" aria-hidden="true" tabindex="-1"></a>pred_male <span class="ot">=</span> </span>
<span id="cb148-197"><a href="#cb148-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm1)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> </span>
<span id="cb148-198"><a href="#cb148-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm1)[<span class="st">"sexmale"</span>] <span class="sc">+</span> </span>
<span id="cb148-199"><a href="#cb148-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm1)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span></span>
<span id="cb148-200"><a href="#cb148-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-201"><a href="#cb148-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-202"><a href="#cb148-202" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-203"><a href="#cb148-203" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|X_1 = 1, X_2 = 36</span><span class="co">]</span> = \beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36 =  <span class="in">`r pred_male`</span></span>
<span id="cb148-204"><a href="#cb148-204" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-205"><a href="#cb148-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-206"><a href="#cb148-206" aria-hidden="true" tabindex="-1"></a>What's the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</span>
<span id="cb148-207"><a href="#cb148-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-208"><a href="#cb148-208" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-209"><a href="#cb148-209" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-210"><a href="#cb148-210" aria-hidden="true" tabindex="-1"></a>&amp; E<span class="co">[</span><span class="ot">Y|X_1 = 1, X_2 = 36</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">Y|X_1 = 0, X_2 = 36</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb148-211"><a href="#cb148-211" aria-hidden="true" tabindex="-1"></a>&amp;= </span>
<span id="cb148-212"><a href="#cb148-212" aria-hidden="true" tabindex="-1"></a><span class="in">`r pred_male`</span> - <span class="in">`r pred_female`</span><span class="sc">\\</span></span>
<span id="cb148-213"><a href="#cb148-213" aria-hidden="true" tabindex="-1"></a>&amp;=</span>
<span id="cb148-214"><a href="#cb148-214" aria-hidden="true" tabindex="-1"></a><span class="in">`r pred_male - pred_female`</span></span>
<span id="cb148-215"><a href="#cb148-215" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-216"><a href="#cb148-216" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-217"><a href="#cb148-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-218"><a href="#cb148-218" aria-hidden="true" tabindex="-1"></a>Shortcut:</span>
<span id="cb148-219"><a href="#cb148-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-220"><a href="#cb148-220" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-221"><a href="#cb148-221" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-222"><a href="#cb148-222" aria-hidden="true" tabindex="-1"></a>&amp; E<span class="co">[</span><span class="ot">Y|X_1 = 1, X_2 = 36</span><span class="co">]</span> - </span>
<span id="cb148-223"><a href="#cb148-223" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|X_1 = 0, X_2 = 36</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb148-224"><a href="#cb148-224" aria-hidden="true" tabindex="-1"></a>&amp;= (\beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36) - (\beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36) <span class="sc">\\</span></span>
<span id="cb148-225"><a href="#cb148-225" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_1 <span class="sc">\\</span> </span>
<span id="cb148-226"><a href="#cb148-226" aria-hidden="true" tabindex="-1"></a>&amp;=  <span class="in">`r coef(bw_lm1)["sexmale"]`</span></span>
<span id="cb148-227"><a href="#cb148-227" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-228"><a href="#cb148-228" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-229"><a href="#cb148-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-230"><a href="#cb148-230" aria-hidden="true" tabindex="-1"></a>Note that age doesn't show up in this difference: in other words, according to this model, the difference between females and males with the same gestational age is the same for every age.</span>
<span id="cb148-231"><a href="#cb148-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-232"><a href="#cb148-232" aria-hidden="true" tabindex="-1"></a>That's an assumption of the model; it's built-in to the parametric structure, even before we plug in the estimated values of those parameters.</span>
<span id="cb148-233"><a href="#cb148-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-234"><a href="#cb148-234" aria-hidden="true" tabindex="-1"></a>That's why the lines are parallel.</span>
<span id="cb148-235"><a href="#cb148-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-236"><a href="#cb148-236" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactions</span></span>
<span id="cb148-237"><a href="#cb148-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-238"><a href="#cb148-238" aria-hidden="true" tabindex="-1"></a>What if we don't like that parallel lines assumption?</span>
<span id="cb148-239"><a href="#cb148-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-240"><a href="#cb148-240" aria-hidden="true" tabindex="-1"></a>Then we need to allow an "interaction" between age and sex:</span>
<span id="cb148-241"><a href="#cb148-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-242"><a href="#cb148-242" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-243"><a href="#cb148-243" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|X_1, X_2</span><span class="co">]</span> = \beta_0 + \beta_1 X_1+ \beta_2 X_2 + \beta_3 (X_1 \cdot X_2)</span>
<span id="cb148-244"><a href="#cb148-244" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-245"><a href="#cb148-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-248"><a href="#cb148-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-249"><a href="#cb148-249" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> sex<span class="sc">:</span>age, <span class="at">data =</span> bw)</span>
<span id="cb148-250"><a href="#cb148-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-251"><a href="#cb148-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-252"><a href="#cb148-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-253"><a href="#cb148-253" aria-hidden="true" tabindex="-1"></a>Here are the estimated parameters ($\beta$s):</span>
<span id="cb148-254"><a href="#cb148-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-257"><a href="#cb148-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-258"><a href="#cb148-258" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb148-259"><a href="#cb148-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb148-260"><a href="#cb148-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb148-261"><a href="#cb148-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-262"><a href="#cb148-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-263"><a href="#cb148-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-264"><a href="#cb148-264" aria-hidden="true" tabindex="-1"></a>Here's another way we could rewrite this model (by collecting terms involving $X_2$):</span>
<span id="cb148-265"><a href="#cb148-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-266"><a href="#cb148-266" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-267"><a href="#cb148-267" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|X_1, X_2</span><span class="co">]</span> = \beta_0 + \beta_1 X_1+ (\beta_2 + \beta_3 X_1) X_2</span>
<span id="cb148-268"><a href="#cb148-268" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-269"><a href="#cb148-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-270"><a href="#cb148-270" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb148-271"><a href="#cb148-271" aria-hidden="true" tabindex="-1"></a>If you want to understand a coefficient in a model with interactions, collect terms for the corresponding variable, and you will see what other variables are interacting with the variable you are interested in.</span>
<span id="cb148-272"><a href="#cb148-272" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-273"><a href="#cb148-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-274"><a href="#cb148-274" aria-hidden="true" tabindex="-1"></a>In this case, the coefficient $X_2$ is interacting with $X_1$. So the slope of $Y$ with respect to $X_2$ depends on the value of $X_2$.</span>
<span id="cb148-275"><a href="#cb148-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-276"><a href="#cb148-276" aria-hidden="true" tabindex="-1"></a>According to this model, there is no such thing as "*the* slope of birthweight with respect to age". There are two slopes, one for each sex.^<span class="co">[</span><span class="ot">using the definite article "the" would mean there is only one slope.</span><span class="co">]</span> We can only talk about "the slope of birthweight with respect to age among males" and "the slope of birthweight with respect to age among females".</span>
<span id="cb148-277"><a href="#cb148-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-278"><a href="#cb148-278" aria-hidden="true" tabindex="-1"></a>Then: that coefficient is the difference in means per unit change in its corresponding coefficient, when the other collected variables are set to 0.</span>
<span id="cb148-279"><a href="#cb148-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-280"><a href="#cb148-280" aria-hidden="true" tabindex="-1"></a>Here's how this model looks, superimposed on the data:</span>
<span id="cb148-281"><a href="#cb148-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-284"><a href="#cb148-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-285"><a href="#cb148-285" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb148-286"><a href="#cb148-286" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-287"><a href="#cb148-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-288"><a href="#cb148-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">predlm2 =</span> <span class="fu">predict</span>(bw_lm2)</span>
<span id="cb148-289"><a href="#cb148-289" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb148-290"><a href="#cb148-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex, age)</span>
<span id="cb148-291"><a href="#cb148-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-292"><a href="#cb148-292" aria-hidden="true" tabindex="-1"></a>plot1_interact <span class="ot">=</span> </span>
<span id="cb148-293"><a href="#cb148-293" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">%+%</span> bw <span class="sc">+</span></span>
<span id="cb148-294"><a href="#cb148-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predlm2))</span>
<span id="cb148-295"><a href="#cb148-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-296"><a href="#cb148-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-297"><a href="#cb148-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-298"><a href="#cb148-298" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-301"><a href="#cb148-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-302"><a href="#cb148-302" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1_interact)</span>
<span id="cb148-303"><a href="#cb148-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-304"><a href="#cb148-304" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-305"><a href="#cb148-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-306"><a href="#cb148-306" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-309"><a href="#cb148-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-310"><a href="#cb148-310" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(plot1_interact)</span>
<span id="cb148-311"><a href="#cb148-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-312"><a href="#cb148-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-313"><a href="#cb148-313" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-314"><a href="#cb148-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-315"><a href="#cb148-315" aria-hidden="true" tabindex="-1"></a>Now we can see that the lines aren't parallel.</span>
<span id="cb148-316"><a href="#cb148-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-317"><a href="#cb148-317" aria-hidden="true" tabindex="-1"></a>To learn what this model is assuming, let's plug in a few values.</span>
<span id="cb148-318"><a href="#cb148-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-319"><a href="#cb148-319" aria-hidden="true" tabindex="-1"></a>According to this model, what's the mean birthweight for a female born at 36 weeks?</span>
<span id="cb148-320"><a href="#cb148-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-323"><a href="#cb148-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-324"><a href="#cb148-324" aria-hidden="true" tabindex="-1"></a>pred_female <span class="ot">=</span> <span class="fu">coef</span>(bw_lm2)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> <span class="fu">coef</span>(bw_lm2)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span></span>
<span id="cb148-325"><a href="#cb148-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-326"><a href="#cb148-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-327"><a href="#cb148-327" aria-hidden="true" tabindex="-1"></a>$$E<span class="co">[</span><span class="ot">Y|X_1 = 0, X_2 = 36</span><span class="co">]</span> = \beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36 + \beta_3 \cdot (0 * 36) =  <span class="in">`r pred_female`</span>$$ What's the mean birthweight for a male born at 36 weeks?</span>
<span id="cb148-328"><a href="#cb148-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-331"><a href="#cb148-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-332"><a href="#cb148-332" aria-hidden="true" tabindex="-1"></a>pred_male <span class="ot">=</span> </span>
<span id="cb148-333"><a href="#cb148-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> </span>
<span id="cb148-334"><a href="#cb148-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"sexmale"</span>] <span class="sc">+</span> </span>
<span id="cb148-335"><a href="#cb148-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span> <span class="sc">+</span> </span>
<span id="cb148-336"><a href="#cb148-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"sexmale:age"</span>] <span class="sc">*</span> <span class="dv">36</span></span>
<span id="cb148-337"><a href="#cb148-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-338"><a href="#cb148-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-339"><a href="#cb148-339" aria-hidden="true" tabindex="-1"></a>$$E<span class="co">[</span><span class="ot">Y|X_1 = 0, X_2 = 36</span><span class="co">]</span> = \beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36 + \beta_3 \cdot 1 \cdot 36 =  <span class="in">`r pred_male`</span>$$</span>
<span id="cb148-340"><a href="#cb148-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-341"><a href="#cb148-341" aria-hidden="true" tabindex="-1"></a>What's the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</span>
<span id="cb148-342"><a href="#cb148-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-343"><a href="#cb148-343" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-344"><a href="#cb148-344" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-345"><a href="#cb148-345" aria-hidden="true" tabindex="-1"></a>&amp; E<span class="co">[</span><span class="ot">Y|X_1 = 1, X_2 = 36</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">Y|X_1 = 0, X_2 = 36</span><span class="co">]</span><span class="sc">\\</span> </span>
<span id="cb148-346"><a href="#cb148-346" aria-hidden="true" tabindex="-1"></a>&amp;= (\beta_0 + \beta_1 \cdot 1+ \beta_2 \cdot 36 + \beta_3 \cdot 1 \cdot 36)<span class="sc">\\</span> </span>
<span id="cb148-347"><a href="#cb148-347" aria-hidden="true" tabindex="-1"></a>&amp;\ \ \ \ \  -(\beta_0 + \beta_1 \cdot 0+ \beta_2 \cdot 36 + \beta_3 \cdot 0 \cdot 36) <span class="sc">\\</span></span>
<span id="cb148-348"><a href="#cb148-348" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_2 + \beta_3\cdot 36<span class="sc">\\</span></span>
<span id="cb148-349"><a href="#cb148-349" aria-hidden="true" tabindex="-1"></a>&amp;=  <span class="in">`r pred_male - pred_female`</span></span>
<span id="cb148-350"><a href="#cb148-350" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-351"><a href="#cb148-351" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-352"><a href="#cb148-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-353"><a href="#cb148-353" aria-hidden="true" tabindex="-1"></a>Note that age now does show up in the difference: in other words, according to this model, the difference in mean birthweights between females and males with the same gestational age can vary by gestational age.</span>
<span id="cb148-354"><a href="#cb148-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-355"><a href="#cb148-355" aria-hidden="true" tabindex="-1"></a>That's how the lines in the graph ended up non-parallel.</span>
<span id="cb148-356"><a href="#cb148-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-357"><a href="#cb148-357" aria-hidden="true" tabindex="-1"></a><span class="fu">## Stratified regression</span></span>
<span id="cb148-358"><a href="#cb148-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-359"><a href="#cb148-359" aria-hidden="true" tabindex="-1"></a>We could re-write the interaction model as a stratified model, with a slope and intercept for each sex:</span>
<span id="cb148-360"><a href="#cb148-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-363"><a href="#cb148-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-364"><a href="#cb148-364" aria-hidden="true" tabindex="-1"></a>bw_lm_strat <span class="ot">=</span> </span>
<span id="cb148-365"><a href="#cb148-365" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-366"><a href="#cb148-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb148-367"><a href="#cb148-367" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> weight <span class="sc">~</span> sex <span class="sc">+</span> sex<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb148-368"><a href="#cb148-368" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb148-369"><a href="#cb148-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-370"><a href="#cb148-370" aria-hidden="true" tabindex="-1"></a>bw_lm_strat <span class="sc">|&gt;</span> </span>
<span id="cb148-371"><a href="#cb148-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb148-372"><a href="#cb148-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb148-373"><a href="#cb148-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-374"><a href="#cb148-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-375"><a href="#cb148-375" aria-hidden="true" tabindex="-1"></a><span class="fu">## Curved-line regression</span></span>
<span id="cb148-376"><a href="#cb148-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-377"><a href="#cb148-377" aria-hidden="true" tabindex="-1"></a>If we transform some of our covariates ($X$s) and plot the resulting model on the original covariate scale, we end up with curved regression lines:</span>
<span id="cb148-378"><a href="#cb148-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-381"><a href="#cb148-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-382"><a href="#cb148-382" aria-hidden="true" tabindex="-1"></a>bw_lm3 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex<span class="sc">:</span><span class="fu">log</span>(age) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> bw)</span>
<span id="cb148-383"><a href="#cb148-383" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb148-384"><a href="#cb148-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-385"><a href="#cb148-385" aria-hidden="true" tabindex="-1"></a>ggpenguins <span class="ot">&lt;-</span> </span>
<span id="cb148-386"><a href="#cb148-386" aria-hidden="true" tabindex="-1"></a>  palmerpenguins<span class="sc">::</span>penguins <span class="sc">|&gt;</span> </span>
<span id="cb148-387"><a href="#cb148-387" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Adelie"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb148-388"><a href="#cb148-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb148-389"><a href="#cb148-389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm , <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<span id="cb148-390"><a href="#cb148-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb148-391"><a href="#cb148-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bill length (mm)"</span>) <span class="sc">+</span> </span>
<span id="cb148-392"><a href="#cb148-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Body mass (g)"</span>)</span>
<span id="cb148-393"><a href="#cb148-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-394"><a href="#cb148-394" aria-hidden="true" tabindex="-1"></a>ggpenguins2 <span class="ot">=</span> ggpenguins <span class="sc">+</span></span>
<span id="cb148-395"><a href="#cb148-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb148-396"><a href="#cb148-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb148-397"><a href="#cb148-397" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">log</span>(x),</span>
<span id="cb148-398"><a href="#cb148-398" aria-hidden="true" tabindex="-1"></a>              <span class="at">geom =</span> <span class="st">"smooth"</span>) <span class="sc">+</span></span>
<span id="cb148-399"><a href="#cb148-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bill length (mm)"</span>) <span class="sc">+</span> </span>
<span id="cb148-400"><a href="#cb148-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Body mass (g)"</span>)</span>
<span id="cb148-401"><a href="#cb148-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-402"><a href="#cb148-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-403"><a href="#cb148-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-404"><a href="#cb148-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-405"><a href="#cb148-405" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-408"><a href="#cb148-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-409"><a href="#cb148-409" aria-hidden="true" tabindex="-1"></a>ggpenguins2 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-410"><a href="#cb148-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-411"><a href="#cb148-411" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-412"><a href="#cb148-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-413"><a href="#cb148-413" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-416"><a href="#cb148-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-417"><a href="#cb148-417" aria-hidden="true" tabindex="-1"></a>ggpenguins2 <span class="sc">|&gt;</span>  <span class="fu">ggplotly</span>()</span>
<span id="cb148-418"><a href="#cb148-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-419"><a href="#cb148-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-420"><a href="#cb148-420" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-421"><a href="#cb148-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-422"><a href="#cb148-422" aria-hidden="true" tabindex="-1"></a><span class="fu"># Estimating Linear Models via Maximum Likelihood</span></span>
<span id="cb148-423"><a href="#cb148-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-424"><a href="#cb148-424" aria-hidden="true" tabindex="-1"></a><span class="fu">## Review of one-sample inference</span></span>
<span id="cb148-425"><a href="#cb148-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-426"><a href="#cb148-426" aria-hidden="true" tabindex="-1"></a>Previously, we learned how to fit outcome-only models of the form $p(X=x|\theta)$ to iid data $\mathbf x = (x_1,…,x_n)$ using maximum likelihood estimation:</span>
<span id="cb148-427"><a href="#cb148-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-428"><a href="#cb148-428" aria-hidden="true" tabindex="-1"></a>$$\mathcal L(\mathbf x|\theta) = p(X_1 = x_1, …,X_n =x_n|\theta) = \prod_{i=1}^n p(X=x_i|\theta)$$</span>
<span id="cb148-429"><a href="#cb148-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-430"><a href="#cb148-430" aria-hidden="true" tabindex="-1"></a>$$\ell(x|\theta) = \log{\mathcal L(x|\theta)}$$</span>
<span id="cb148-431"><a href="#cb148-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-432"><a href="#cb148-432" aria-hidden="true" tabindex="-1"></a>$$\hat \theta_{ML} = \arg \max_\theta \ell(x|\theta)$$</span>
<span id="cb148-433"><a href="#cb148-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-434"><a href="#cb148-434" aria-hidden="true" tabindex="-1"></a>We learned how to quantify our uncertainty about these maximum likelihood estimates; with sufficient sample size, $\hat \theta_{ML}$ has the approximate distribution:</span>
<span id="cb148-435"><a href="#cb148-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-436"><a href="#cb148-436" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-437"><a href="#cb148-437" aria-hidden="true" tabindex="-1"></a>\hat\theta_{ML} \dot \sim N(\theta,\mathcal I(\theta)^{-1})</span>
<span id="cb148-438"><a href="#cb148-438" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-439"><a href="#cb148-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-440"><a href="#cb148-440" aria-hidden="true" tabindex="-1"></a>For models in the "exponential family" of distributions, which includes the Gaussian, Poisson, Bernoulli, Binomial, Exponential, and Gamma distributions, $\mathcal I(\theta) = \text -E<span class="co">[</span><span class="ot">\mathcal{l}''(X|\theta)</span><span class="co">]</span>$, so we estimated $\mathcal I(\theta)$ using either $\mathcal I(\theta)|_{\theta = \hat \theta_{ML}}$ or $\mathcal{l}''(\mathbf x |\theta)|_{\theta = \hat \theta_{ML}}$.</span>
<span id="cb148-441"><a href="#cb148-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-442"><a href="#cb148-442" aria-hidden="true" tabindex="-1"></a>Then an asymptotic approximation of a 95% confidence interval for $\theta_k$ is</span>
<span id="cb148-443"><a href="#cb148-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-444"><a href="#cb148-444" aria-hidden="true" tabindex="-1"></a>$$\hat \theta_{ML} \pm z_{0.975} \times \left<span class="co">[</span><span class="ot">\left(\hat{\mathcal I}(\hat \theta_{ML})\right)^{-1}\right</span><span class="co">]</span>_{kk}$$</span>
<span id="cb148-445"><a href="#cb148-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-446"><a href="#cb148-446" aria-hidden="true" tabindex="-1"></a>where $z_\beta$ the $\beta$ quantile of the standard Gaussian distribution.</span>
<span id="cb148-447"><a href="#cb148-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-448"><a href="#cb148-448" aria-hidden="true" tabindex="-1"></a><span class="fu">## MLEs for Linear Regression</span></span>
<span id="cb148-449"><a href="#cb148-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-450"><a href="#cb148-450" aria-hidden="true" tabindex="-1"></a>Let's use maximum likelihood again:</span>
<span id="cb148-451"><a href="#cb148-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-452"><a href="#cb148-452" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-453"><a href="#cb148-453" aria-hidden="true" tabindex="-1"></a>\mathcal L(\mathbf y|\mathbf x,\beta, \sigma^2) = </span>
<span id="cb148-454"><a href="#cb148-454" aria-hidden="true" tabindex="-1"></a>\prod_{i=1}^n (2\pi\sigma^2)^{-1/2} </span>
<span id="cb148-455"><a href="#cb148-455" aria-hidden="true" tabindex="-1"></a>\exp{-\frac{1}{2\sigma^2}(y_i - x_i'\beta)^2}</span>
<span id="cb148-456"><a href="#cb148-456" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-457"><a href="#cb148-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-458"><a href="#cb148-458" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-459"><a href="#cb148-459" aria-hidden="true" tabindex="-1"></a>\ell(\mathbf y|\mathbf x,\beta, \sigma^2) \propto -\frac{n}{2}\log{\sigma^2} - \frac{1}{2\sigma^2}\sum_{i=1}^n (y_i - x_i' \beta)^2</span>
<span id="cb148-460"><a href="#cb148-460" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-461"><a href="#cb148-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-462"><a href="#cb148-462" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-463"><a href="#cb148-463" aria-hidden="true" tabindex="-1"></a>\ell'(\mathbf y|\mathbf x,\beta, \sigma^2) \propto -\frac{n}{2}\log{\sigma^2} - \frac{1}{2\sigma^2}\frac{d}{d\beta}\left(\sum_{i=1}^n (y_i - x_i' \beta)^2\right)</span>
<span id="cb148-464"><a href="#cb148-464" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-465"><a href="#cb148-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-466"><a href="#cb148-466" aria-hidden="true" tabindex="-1"></a>A few tools from linear algebra will make this analysis go easier (see @fieller2018basics, Section 7.2 for details).</span>
<span id="cb148-467"><a href="#cb148-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-468"><a href="#cb148-468" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-469"><a href="#cb148-469" aria-hidden="true" tabindex="-1"></a>f_{\beta}(\mathbf x) = (f_{\beta}(x_1), f_{\beta}(x_2), ..., f_{\beta}(x_n))^\top</span>
<span id="cb148-470"><a href="#cb148-470" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-471"><a href="#cb148-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-472"><a href="#cb148-472" aria-hidden="true" tabindex="-1"></a>Let $\mathbf x$ and $\beta$ be vectors of length $p$, or in other words, matrices of length $p\times 1$:</span>
<span id="cb148-473"><a href="#cb148-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-474"><a href="#cb148-474" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-475"><a href="#cb148-475" aria-hidden="true" tabindex="-1"></a>x = \begin{bmatrix}</span>
<span id="cb148-476"><a href="#cb148-476" aria-hidden="true" tabindex="-1"></a>x_{1} <span class="sc">\\</span></span>
<span id="cb148-477"><a href="#cb148-477" aria-hidden="true" tabindex="-1"></a>x_{2} <span class="sc">\\</span></span>
<span id="cb148-478"><a href="#cb148-478" aria-hidden="true" tabindex="-1"></a>\vdots <span class="sc">\\</span></span>
<span id="cb148-479"><a href="#cb148-479" aria-hidden="true" tabindex="-1"></a>x_{p}</span>
<span id="cb148-480"><a href="#cb148-480" aria-hidden="true" tabindex="-1"></a>\end{bmatrix} <span class="sc">\\</span></span>
<span id="cb148-481"><a href="#cb148-481" aria-hidden="true" tabindex="-1"></a>\beta = \begin{bmatrix}</span>
<span id="cb148-482"><a href="#cb148-482" aria-hidden="true" tabindex="-1"></a>\beta_{1} <span class="sc">\\</span></span>
<span id="cb148-483"><a href="#cb148-483" aria-hidden="true" tabindex="-1"></a>\beta_{2} <span class="sc">\\</span></span>
<span id="cb148-484"><a href="#cb148-484" aria-hidden="true" tabindex="-1"></a>\vdots <span class="sc">\\</span></span>
<span id="cb148-485"><a href="#cb148-485" aria-hidden="true" tabindex="-1"></a>\beta_{p}</span>
<span id="cb148-486"><a href="#cb148-486" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb148-487"><a href="#cb148-487" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-488"><a href="#cb148-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-489"><a href="#cb148-489" aria-hidden="true" tabindex="-1"></a>Then</span>
<span id="cb148-490"><a href="#cb148-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-491"><a href="#cb148-491" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-492"><a href="#cb148-492" aria-hidden="true" tabindex="-1"></a>x' \equiv x^\top \equiv <span class="co">[</span><span class="ot">x_1, x_2, ..., x_p</span><span class="co">]</span></span>
<span id="cb148-493"><a href="#cb148-493" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-494"><a href="#cb148-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-495"><a href="#cb148-495" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb148-496"><a href="#cb148-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-497"><a href="#cb148-497" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-498"><a href="#cb148-498" aria-hidden="true" tabindex="-1"></a>x'\beta = <span class="co">[</span><span class="ot">x_1, x_2, ..., x_p</span><span class="co">]</span> </span>
<span id="cb148-499"><a href="#cb148-499" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb148-500"><a href="#cb148-500" aria-hidden="true" tabindex="-1"></a>\beta_{1} <span class="sc">\\</span></span>
<span id="cb148-501"><a href="#cb148-501" aria-hidden="true" tabindex="-1"></a>\beta_{2} <span class="sc">\\</span></span>
<span id="cb148-502"><a href="#cb148-502" aria-hidden="true" tabindex="-1"></a>\vdots <span class="sc">\\</span></span>
<span id="cb148-503"><a href="#cb148-503" aria-hidden="true" tabindex="-1"></a>\beta_{p}</span>
<span id="cb148-504"><a href="#cb148-504" aria-hidden="true" tabindex="-1"></a>\end{bmatrix} = </span>
<span id="cb148-505"><a href="#cb148-505" aria-hidden="true" tabindex="-1"></a>x_1\beta_1+x_2\beta_2 +...+x_p \beta_p </span>
<span id="cb148-506"><a href="#cb148-506" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-507"><a href="#cb148-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-508"><a href="#cb148-508" aria-hidden="true" tabindex="-1"></a>If $f(\beta)$ is a function that takes $\beta$ as input and outputs a scalar, such as $f(\beta) = x'\beta$, then:</span>
<span id="cb148-509"><a href="#cb148-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-510"><a href="#cb148-510" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-511"><a href="#cb148-511" aria-hidden="true" tabindex="-1"></a>\frac{d}{d \beta} f(\beta)= </span>
<span id="cb148-512"><a href="#cb148-512" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb148-513"><a href="#cb148-513" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta_1}f(\beta) <span class="sc">\\</span></span>
<span id="cb148-514"><a href="#cb148-514" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta_2}f(\beta) <span class="sc">\\</span></span>
<span id="cb148-515"><a href="#cb148-515" aria-hidden="true" tabindex="-1"></a>\vdots <span class="sc">\\</span></span>
<span id="cb148-516"><a href="#cb148-516" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta_p}f(\beta)</span>
<span id="cb148-517"><a href="#cb148-517" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb148-518"><a href="#cb148-518" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-519"><a href="#cb148-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-520"><a href="#cb148-520" aria-hidden="true" tabindex="-1"></a>In particular, if $f(\beta) = x'\beta$, then:</span>
<span id="cb148-521"><a href="#cb148-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-522"><a href="#cb148-522" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb148-523"><a href="#cb148-523" aria-hidden="true" tabindex="-1"></a>\frac{d}{d \beta} x'\beta= </span>
<span id="cb148-524"><a href="#cb148-524" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb148-525"><a href="#cb148-525" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta_1}(x_1\beta_1+x_2\beta_2 +...+x_p \beta_p ) <span class="sc">\\</span></span>
<span id="cb148-526"><a href="#cb148-526" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta_2}(x_1\beta_1+x_2\beta_2 +...+x_p \beta_p ) <span class="sc">\\</span></span>
<span id="cb148-527"><a href="#cb148-527" aria-hidden="true" tabindex="-1"></a>\vdots <span class="sc">\\</span></span>
<span id="cb148-528"><a href="#cb148-528" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta_p}(x_1\beta_1+x_2\beta_2 +...+x_p \beta_p )</span>
<span id="cb148-529"><a href="#cb148-529" aria-hidden="true" tabindex="-1"></a>\end{bmatrix} </span>
<span id="cb148-530"><a href="#cb148-530" aria-hidden="true" tabindex="-1"></a>=</span>
<span id="cb148-531"><a href="#cb148-531" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb148-532"><a href="#cb148-532" aria-hidden="true" tabindex="-1"></a>x_{1} <span class="sc">\\</span></span>
<span id="cb148-533"><a href="#cb148-533" aria-hidden="true" tabindex="-1"></a>x_{2} <span class="sc">\\</span></span>
<span id="cb148-534"><a href="#cb148-534" aria-hidden="true" tabindex="-1"></a>\vdots <span class="sc">\\</span></span>
<span id="cb148-535"><a href="#cb148-535" aria-hidden="true" tabindex="-1"></a>x_{p}</span>
<span id="cb148-536"><a href="#cb148-536" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb148-537"><a href="#cb148-537" aria-hidden="true" tabindex="-1"></a>= \mathbf x</span>
<span id="cb148-538"><a href="#cb148-538" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-539"><a href="#cb148-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-540"><a href="#cb148-540" aria-hidden="true" tabindex="-1"></a>In general:</span>
<span id="cb148-541"><a href="#cb148-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-542"><a href="#cb148-542" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-543"><a href="#cb148-543" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta} x'\beta = x</span>
<span id="cb148-544"><a href="#cb148-544" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-545"><a href="#cb148-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-546"><a href="#cb148-546" aria-hidden="true" tabindex="-1"></a>This looks a lot like non-vector calculus, except that you have to transpose the coefficient.</span>
<span id="cb148-547"><a href="#cb148-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-548"><a href="#cb148-548" aria-hidden="true" tabindex="-1"></a>Similarly,</span>
<span id="cb148-549"><a href="#cb148-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-550"><a href="#cb148-550" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-551"><a href="#cb148-551" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta} \beta'\beta = 2\beta</span>
<span id="cb148-552"><a href="#cb148-552" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-553"><a href="#cb148-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-554"><a href="#cb148-554" aria-hidden="true" tabindex="-1"></a>This is like taking the derivative of $x^2$.</span>
<span id="cb148-555"><a href="#cb148-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-556"><a href="#cb148-556" aria-hidden="true" tabindex="-1"></a>And finally, if $S$ is a $p\times p$ matrix, then:</span>
<span id="cb148-557"><a href="#cb148-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-558"><a href="#cb148-558" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-559"><a href="#cb148-559" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta} \beta'S\beta = 2S\beta</span>
<span id="cb148-560"><a href="#cb148-560" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-561"><a href="#cb148-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-562"><a href="#cb148-562" aria-hidden="true" tabindex="-1"></a>Again, this is like taking the derivative of $cx^2$ with respect to $c$ in non-vector calculus.</span>
<span id="cb148-563"><a href="#cb148-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-564"><a href="#cb148-564" aria-hidden="true" tabindex="-1"></a>Thus:</span>
<span id="cb148-565"><a href="#cb148-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-566"><a href="#cb148-566" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-567"><a href="#cb148-567" aria-hidden="true" tabindex="-1"></a>\sum_{i=1}^n (y_i - f_\beta(x_i))^2 = (\mathbf y - X\beta)'(\mathbf y - X\beta)</span>
<span id="cb148-568"><a href="#cb148-568" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-569"><a href="#cb148-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-570"><a href="#cb148-570" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-571"><a href="#cb148-571" aria-hidden="true" tabindex="-1"></a>(\mathbf y - X\beta)' = (\mathbf y' - (X\beta)') = (\mathbf y' - \beta'X')</span>
<span id="cb148-572"><a href="#cb148-572" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-573"><a href="#cb148-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-574"><a href="#cb148-574" aria-hidden="true" tabindex="-1"></a>So</span>
<span id="cb148-575"><a href="#cb148-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-576"><a href="#cb148-576" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-577"><a href="#cb148-577" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-578"><a href="#cb148-578" aria-hidden="true" tabindex="-1"></a>(\mathbf y - X\beta)'(\mathbf y - X\beta) &amp;= (\mathbf y' - \beta'X')(\mathbf y - X\beta)<span class="sc">\\</span></span>
<span id="cb148-579"><a href="#cb148-579" aria-hidden="true" tabindex="-1"></a>&amp;= y'y - \beta'X'y - y'X\beta +\beta'X'X\beta<span class="sc">\\</span></span>
<span id="cb148-580"><a href="#cb148-580" aria-hidden="true" tabindex="-1"></a>&amp;= y'y - 2y'X\beta +\beta'X'X\beta</span>
<span id="cb148-581"><a href="#cb148-581" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-582"><a href="#cb148-582" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-583"><a href="#cb148-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-584"><a href="#cb148-584" aria-hidden="true" tabindex="-1"></a>So</span>
<span id="cb148-585"><a href="#cb148-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-586"><a href="#cb148-586" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-587"><a href="#cb148-587" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-588"><a href="#cb148-588" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta}\left(\sum_{i=1}^n (y_i - x_i' \beta)^2\right) &amp;= </span>
<span id="cb148-589"><a href="#cb148-589" aria-hidden="true" tabindex="-1"></a>\frac{d}{d\beta}(\mathbf y - X\beta)'(\mathbf y - X\beta)<span class="sc">\\</span></span>
<span id="cb148-590"><a href="#cb148-590" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{d}{d\beta} (y'y - 2y'X\beta +\beta'X'X\beta)<span class="sc">\\</span></span>
<span id="cb148-591"><a href="#cb148-591" aria-hidden="true" tabindex="-1"></a>&amp;= (- 2X'y +2X'X\beta)</span>
<span id="cb148-592"><a href="#cb148-592" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-593"><a href="#cb148-593" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-594"><a href="#cb148-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-595"><a href="#cb148-595" aria-hidden="true" tabindex="-1"></a>So if $\ell(\beta,\sigma^2) =0$, then</span>
<span id="cb148-596"><a href="#cb148-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-597"><a href="#cb148-597" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-598"><a href="#cb148-598" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-599"><a href="#cb148-599" aria-hidden="true" tabindex="-1"></a>0 &amp;= (- 2X'y +2X'X\beta)<span class="sc">\\</span></span>
<span id="cb148-600"><a href="#cb148-600" aria-hidden="true" tabindex="-1"></a>2X'y &amp;= 2X'X\beta<span class="sc">\\</span></span>
<span id="cb148-601"><a href="#cb148-601" aria-hidden="true" tabindex="-1"></a>X'y &amp;= X'X\beta<span class="sc">\\</span></span>
<span id="cb148-602"><a href="#cb148-602" aria-hidden="true" tabindex="-1"></a>(X'X)^{-1}X'y &amp;= \beta</span>
<span id="cb148-603"><a href="#cb148-603" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-604"><a href="#cb148-604" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-605"><a href="#cb148-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-606"><a href="#cb148-606" aria-hidden="true" tabindex="-1"></a>The second derivative matrix $\ell_{\beta, \beta'} ''(\beta, \sigma^2;\mathbf X,\mathbf y)$ is negative definite at $\beta = (X'X)^{-1}X'y$, so $\hat \beta_{ML} = (X'X)^{-1}X'y$ is the MLE for $\beta$.</span>
<span id="cb148-607"><a href="#cb148-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-608"><a href="#cb148-608" aria-hidden="true" tabindex="-1"></a>Similarly (not shown):</span>
<span id="cb148-609"><a href="#cb148-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-610"><a href="#cb148-610" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-611"><a href="#cb148-611" aria-hidden="true" tabindex="-1"></a>\hat\sigma^2_{ML} = \frac{1}{n} (Y-X\hat\beta)'(Y-X\hat\beta)</span>
<span id="cb148-612"><a href="#cb148-612" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-613"><a href="#cb148-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-614"><a href="#cb148-614" aria-hidden="true" tabindex="-1"></a>And</span>
<span id="cb148-615"><a href="#cb148-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-616"><a href="#cb148-616" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-617"><a href="#cb148-617" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-618"><a href="#cb148-618" aria-hidden="true" tabindex="-1"></a>\mathcal I_{\beta} &amp;= E<span class="co">[</span><span class="ot">-\ell_{\beta, \beta'} ''(Y|X,\beta, \sigma^2)</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb148-619"><a href="#cb148-619" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{\sigma^2}X'X</span>
<span id="cb148-620"><a href="#cb148-620" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-621"><a href="#cb148-621" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-622"><a href="#cb148-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-623"><a href="#cb148-623" aria-hidden="true" tabindex="-1"></a>So:</span>
<span id="cb148-624"><a href="#cb148-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-625"><a href="#cb148-625" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-626"><a href="#cb148-626" aria-hidden="true" tabindex="-1"></a>Var(\hat \beta) \approx (\mathcal I_{\beta})^{-1} = \sigma^2 (X'X)^{-1}</span>
<span id="cb148-627"><a href="#cb148-627" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-628"><a href="#cb148-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-629"><a href="#cb148-629" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb148-630"><a href="#cb148-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-631"><a href="#cb148-631" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-632"><a href="#cb148-632" aria-hidden="true" tabindex="-1"></a>\hat\beta \dot \sim N(\beta, \mathcal I_{\beta}^{-1})</span>
<span id="cb148-633"><a href="#cb148-633" aria-hidden="true" tabindex="-1"></a>$$ These are all results you have hopefully seen before, and in the Gaussian linear regression case they are exact, not just approximate.</span>
<span id="cb148-634"><a href="#cb148-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-635"><a href="#cb148-635" aria-hidden="true" tabindex="-1"></a>In our model 2 above, this matrix is:</span>
<span id="cb148-636"><a href="#cb148-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-639"><a href="#cb148-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-640"><a href="#cb148-640" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> <span class="fu">vcov</span>()</span>
<span id="cb148-641"><a href="#cb148-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-642"><a href="#cb148-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-643"><a href="#cb148-643" aria-hidden="true" tabindex="-1"></a>Note that if we take the square roots of the diagonals, we get the standard errors listed in the model output:</span>
<span id="cb148-644"><a href="#cb148-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-647"><a href="#cb148-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-648"><a href="#cb148-648" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> <span class="fu">vcov</span>() <span class="sc">|&gt;</span> <span class="fu">diag</span>() <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span>
<span id="cb148-649"><a href="#cb148-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-650"><a href="#cb148-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-651"><a href="#cb148-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-654"><a href="#cb148-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-655"><a href="#cb148-655" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> <span class="fu">coef</span>() <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span>
<span id="cb148-656"><a href="#cb148-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-657"><a href="#cb148-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-658"><a href="#cb148-658" aria-hidden="true" tabindex="-1"></a>So we can do confidence intervals, hypothesis tests, and p-values exactly as in the one-variable case we looked at previously.</span>
<span id="cb148-659"><a href="#cb148-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-660"><a href="#cb148-660" aria-hidden="true" tabindex="-1"></a><span class="fu"># Inference about Gaussian Linear Regression Models</span></span>
<span id="cb148-661"><a href="#cb148-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-662"><a href="#cb148-662" aria-hidden="true" tabindex="-1"></a>Research question: is there really an interaction between sex and age?</span>
<span id="cb148-663"><a href="#cb148-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-664"><a href="#cb148-664" aria-hidden="true" tabindex="-1"></a>$H_0: \beta_3 = 0$</span>
<span id="cb148-665"><a href="#cb148-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-666"><a href="#cb148-666" aria-hidden="true" tabindex="-1"></a>$H_A: \beta_3 \neq 0$</span>
<span id="cb148-667"><a href="#cb148-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-668"><a href="#cb148-668" aria-hidden="true" tabindex="-1"></a>$P(|\hat\beta_3| &gt; |<span class="in">`r coef(bw_lm2)["sexmale:age"]`</span>| \mid H_0)$ = ?</span>
<span id="cb148-669"><a href="#cb148-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-670"><a href="#cb148-670" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wald tests and CIs</span></span>
<span id="cb148-671"><a href="#cb148-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-672"><a href="#cb148-672" aria-hidden="true" tabindex="-1"></a>R can give you Wald tests for single coefficients and corresponding CIs:</span>
<span id="cb148-673"><a href="#cb148-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-674"><a href="#cb148-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r "wald tests bw_lm2"}</span></span>
<span id="cb148-675"><a href="#cb148-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-676"><a href="#cb148-676" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb148-677"><a href="#cb148-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">ci_method =</span> <span class="st">"wald"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb148-678"><a href="#cb148-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb148-679"><a href="#cb148-679" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-680"><a href="#cb148-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-681"><a href="#cb148-681" aria-hidden="true" tabindex="-1"></a><span class="fu">## One-parameter inference by hand</span></span>
<span id="cb148-682"><a href="#cb148-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-683"><a href="#cb148-683" aria-hidden="true" tabindex="-1"></a>To understand what's happening, let's replicate these results by hand for the interaction term.</span>
<span id="cb148-684"><a href="#cb148-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-685"><a href="#cb148-685" aria-hidden="true" tabindex="-1"></a><span class="fu">### P-value</span></span>
<span id="cb148-686"><a href="#cb148-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-689"><a href="#cb148-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-690"><a href="#cb148-690" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">=</span> <span class="fu">coef</span>(<span class="fu">summary</span>(bw_lm2))[<span class="st">"sexmale:age"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb148-691"><a href="#cb148-691" aria-hidden="true" tabindex="-1"></a>se_hat <span class="ot">=</span> <span class="fu">coef</span>(<span class="fu">summary</span>(bw_lm2))[<span class="st">"sexmale:age"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb148-692"><a href="#cb148-692" aria-hidden="true" tabindex="-1"></a>dfresid <span class="ot">=</span> bw_lm2<span class="sc">$</span>df.residual</span>
<span id="cb148-693"><a href="#cb148-693" aria-hidden="true" tabindex="-1"></a>t_stat <span class="ot">=</span> <span class="fu">abs</span>(beta_hat)<span class="sc">/</span>se_hat</span>
<span id="cb148-694"><a href="#cb148-694" aria-hidden="true" tabindex="-1"></a>pval_t <span class="ot">=</span> <span class="fu">pt</span>(<span class="fu">abs</span>(t_stat), <span class="at">df =</span> dfresid, <span class="at">lower =</span> <span class="cn">FALSE</span>) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb148-695"><a href="#cb148-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-696"><a href="#cb148-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-697"><a href="#cb148-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-698"><a href="#cb148-698" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-699"><a href="#cb148-699" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-700"><a href="#cb148-700" aria-hidden="true" tabindex="-1"></a>&amp;P\left(</span>
<span id="cb148-701"><a href="#cb148-701" aria-hidden="true" tabindex="-1"></a>| \hat \beta_3  | &gt; </span>
<span id="cb148-702"><a href="#cb148-702" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r coef(bw_lm2)["sexmale:age"]`</span>| \middle| H_0</span>
<span id="cb148-703"><a href="#cb148-703" aria-hidden="true" tabindex="-1"></a>\right) </span>
<span id="cb148-704"><a href="#cb148-704" aria-hidden="true" tabindex="-1"></a>&amp;= P\left(</span>
<span id="cb148-705"><a href="#cb148-705" aria-hidden="true" tabindex="-1"></a>\left| \frac{\hat\beta_3}{\hat{SE}(\hat\beta_3)} \right| &gt; </span>
<span id="cb148-706"><a href="#cb148-706" aria-hidden="true" tabindex="-1"></a>\left| \frac{<span class="in">`r beta_hat`</span>}{<span class="in">`r se_hat`</span>} \right| \middle| H_0</span>
<span id="cb148-707"><a href="#cb148-707" aria-hidden="true" tabindex="-1"></a>\right)<span class="sc">\\</span> </span>
<span id="cb148-708"><a href="#cb148-708" aria-hidden="true" tabindex="-1"></a>&amp;= P\left(</span>
<span id="cb148-709"><a href="#cb148-709" aria-hidden="true" tabindex="-1"></a>| T_{<span class="in">`r dfresid`</span>} | &gt;  <span class="in">`r t_stat`</span> \middle| H_0</span>
<span id="cb148-710"><a href="#cb148-710" aria-hidden="true" tabindex="-1"></a>\right)<span class="sc">\\</span></span>
<span id="cb148-711"><a href="#cb148-711" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r pval_t`</span></span>
<span id="cb148-712"><a href="#cb148-712" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-713"><a href="#cb148-713" aria-hidden="true" tabindex="-1"></a>$$ This matches the result in the table above.</span>
<span id="cb148-714"><a href="#cb148-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-715"><a href="#cb148-715" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confidence interval</span></span>
<span id="cb148-716"><a href="#cb148-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-719"><a href="#cb148-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-720"><a href="#cb148-720" aria-hidden="true" tabindex="-1"></a>confint_radius_t <span class="ot">=</span> se_hat <span class="sc">*</span> <span class="fu">qt</span>(<span class="at">p =</span> <span class="fl">0.975</span>, <span class="at">df =</span> dfresid, <span class="at">lower =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-721"><a href="#cb148-721" aria-hidden="true" tabindex="-1"></a>confint_t <span class="ot">=</span> beta_hat <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> confint_radius_t</span>
<span id="cb148-722"><a href="#cb148-722" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confint_t)</span>
<span id="cb148-723"><a href="#cb148-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-724"><a href="#cb148-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-725"><a href="#cb148-725" aria-hidden="true" tabindex="-1"></a>This also matches.</span>
<span id="cb148-726"><a href="#cb148-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-727"><a href="#cb148-727" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gaussian approximations</span></span>
<span id="cb148-728"><a href="#cb148-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-729"><a href="#cb148-729" aria-hidden="true" tabindex="-1"></a>Here are the asymptotic (Gaussian approximation) equivalents:</span>
<span id="cb148-730"><a href="#cb148-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-731"><a href="#cb148-731" aria-hidden="true" tabindex="-1"></a><span class="fu">### P-value</span></span>
<span id="cb148-732"><a href="#cb148-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-735"><a href="#cb148-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-736"><a href="#cb148-736" aria-hidden="true" tabindex="-1"></a>pval_z <span class="ot">=</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(t_stat), <span class="at">lower =</span> <span class="cn">FALSE</span>) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb148-737"><a href="#cb148-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-738"><a href="#cb148-738" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pval_z)</span>
<span id="cb148-739"><a href="#cb148-739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-740"><a href="#cb148-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-741"><a href="#cb148-741" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confidence interval</span></span>
<span id="cb148-742"><a href="#cb148-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-745"><a href="#cb148-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-746"><a href="#cb148-746" aria-hidden="true" tabindex="-1"></a>confint_radius_z <span class="ot">=</span> se_hat <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, <span class="at">lower =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-747"><a href="#cb148-747" aria-hidden="true" tabindex="-1"></a>confint_z <span class="ot">=</span> </span>
<span id="cb148-748"><a href="#cb148-748" aria-hidden="true" tabindex="-1"></a>  beta_hat <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> confint_radius_z</span>
<span id="cb148-749"><a href="#cb148-749" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confint_z)</span>
<span id="cb148-750"><a href="#cb148-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-751"><a href="#cb148-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-752"><a href="#cb148-752" aria-hidden="true" tabindex="-1"></a><span class="fu">## Likelihood ratio statistics</span></span>
<span id="cb148-753"><a href="#cb148-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-756"><a href="#cb148-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-757"><a href="#cb148-757" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(bw_lm2)</span>
<span id="cb148-758"><a href="#cb148-758" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(bw_lm1)</span>
<span id="cb148-759"><a href="#cb148-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-760"><a href="#cb148-760" aria-hidden="true" tabindex="-1"></a>lLR <span class="ot">=</span> (<span class="fu">logLik</span>(bw_lm2) <span class="sc">-</span> <span class="fu">logLik</span>(bw_lm1)) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb148-761"><a href="#cb148-761" aria-hidden="true" tabindex="-1"></a>delta_df <span class="ot">=</span> (bw_lm1<span class="sc">$</span>df.residual <span class="sc">-</span> <span class="fu">df.residual</span>(bw_lm2))</span>
<span id="cb148-762"><a href="#cb148-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-763"><a href="#cb148-763" aria-hidden="true" tabindex="-1"></a>d_lLR <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">df =</span> delta_df) <span class="fu">dchisq</span>(x, <span class="at">df =</span> df)</span>
<span id="cb148-764"><a href="#cb148-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-765"><a href="#cb148-765" aria-hidden="true" tabindex="-1"></a>x_max <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb148-766"><a href="#cb148-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-767"><a href="#cb148-767" aria-hidden="true" tabindex="-1"></a>chisq_plot <span class="ot">=</span> </span>
<span id="cb148-768"><a href="#cb148-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb148-769"><a href="#cb148-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> d_lLR) <span class="sc">+</span></span>
<span id="cb148-770"><a href="#cb148-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>( <span class="at">fun =</span> d_lLR, <span class="at">xlim =</span> <span class="fu">c</span>(lLR, x_max), <span class="at">geom =</span> <span class="st">"area"</span>, <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb148-771"><a href="#cb148-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> lLR, <span class="at">xend =</span> lLR, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="fu">d_lLR</span>(lLR)), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb148-772"><a href="#cb148-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.0001</span>,x_max) <span class="sc">+</span> </span>
<span id="cb148-773"><a href="#cb148-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb148-774"><a href="#cb148-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"p(X=x)"</span>) <span class="sc">+</span> </span>
<span id="cb148-775"><a href="#cb148-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(likelihood ratio) statistic [x]"</span>) <span class="sc">+</span></span>
<span id="cb148-776"><a href="#cb148-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb148-777"><a href="#cb148-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-778"><a href="#cb148-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-781"><a href="#cb148-781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-782"><a href="#cb148-782" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(</span>
<span id="cb148-783"><a href="#cb148-783" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="dv">2</span><span class="sc">*</span>lLR, </span>
<span id="cb148-784"><a href="#cb148-784" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> delta_df, </span>
<span id="cb148-785"><a href="#cb148-785" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-786"><a href="#cb148-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-787"><a href="#cb148-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-788"><a href="#cb148-788" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-791"><a href="#cb148-791" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-792"><a href="#cb148-792" aria-hidden="true" tabindex="-1"></a>chisq_plot <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-793"><a href="#cb148-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-794"><a href="#cb148-794" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-795"><a href="#cb148-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-796"><a href="#cb148-796" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-799"><a href="#cb148-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-800"><a href="#cb148-800" aria-hidden="true" tabindex="-1"></a>chisq_plot <span class="sc">|&gt;</span>  <span class="fu">ggplotly</span>()</span>
<span id="cb148-801"><a href="#cb148-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-802"><a href="#cb148-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-803"><a href="#cb148-803" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-804"><a href="#cb148-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-805"><a href="#cb148-805" aria-hidden="true" tabindex="-1"></a>Now we can get the p-value:</span>
<span id="cb148-806"><a href="#cb148-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-809"><a href="#cb148-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-810"><a href="#cb148-810" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="dv">2</span><span class="sc">*</span>lLR, <span class="at">df =</span> delta_df, <span class="at">lower =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-811"><a href="#cb148-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-812"><a href="#cb148-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-813"><a href="#cb148-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-814"><a href="#cb148-814" aria-hidden="true" tabindex="-1"></a><span class="fu">## </span></span>
<span id="cb148-815"><a href="#cb148-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-816"><a href="#cb148-816" aria-hidden="true" tabindex="-1"></a>In practice you don't have to do this by hand; there are functions to do it for you:</span>
<span id="cb148-817"><a href="#cb148-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-820"><a href="#cb148-820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-821"><a href="#cb148-821" aria-hidden="true" tabindex="-1"></a><span class="co"># built in</span></span>
<span id="cb148-822"><a href="#cb148-822" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb148-823"><a href="#cb148-823" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(bw_lm2, bw_lm1)</span>
<span id="cb148-824"><a href="#cb148-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-825"><a href="#cb148-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-826"><a href="#cb148-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-827"><a href="#cb148-827" aria-hidden="true" tabindex="-1"></a><span class="fu"># Goodness of fit</span></span>
<span id="cb148-828"><a href="#cb148-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-829"><a href="#cb148-829" aria-hidden="true" tabindex="-1"></a><span class="fu">## AIC and BIC</span></span>
<span id="cb148-830"><a href="#cb148-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-831"><a href="#cb148-831" aria-hidden="true" tabindex="-1"></a>When we use likelihood ratio tests, we are comparing how well different models fit the data.</span>
<span id="cb148-832"><a href="#cb148-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-833"><a href="#cb148-833" aria-hidden="true" tabindex="-1"></a>Likelihood ratio tests require "nested" models: one must be a special case of the other.</span>
<span id="cb148-834"><a href="#cb148-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-835"><a href="#cb148-835" aria-hidden="true" tabindex="-1"></a>If we have non-nested models, we can instead use the Akaike Information Criterion (AIC) or Bayesian Information Criterion (BIC):</span>
<span id="cb148-836"><a href="#cb148-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-837"><a href="#cb148-837" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>AIC = $-2 * \ell(\hat\theta) + 2 * p$</span>
<span id="cb148-838"><a href="#cb148-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-839"><a href="#cb148-839" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BIC = $-2 * \ell(\hat\theta) + p * \text{log}(n)$</span>
<span id="cb148-840"><a href="#cb148-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-841"><a href="#cb148-841" aria-hidden="true" tabindex="-1"></a>where $\ell$ is the log-likelihood of the data evaluated using the parameter estimates $\hat\theta$, $p$ is the number of estimated parameters in the model (including $\hat\sigma^2$), and $n$ is the number of observations.</span>
<span id="cb148-842"><a href="#cb148-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-843"><a href="#cb148-843" aria-hidden="true" tabindex="-1"></a>You can calculate these criteria using the <span class="in">`logLik()`</span> function, or use the built-in R functions:</span>
<span id="cb148-844"><a href="#cb148-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-845"><a href="#cb148-845" aria-hidden="true" tabindex="-1"></a><span class="fu">### AIC in R</span></span>
<span id="cb148-846"><a href="#cb148-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-849"><a href="#cb148-849" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-850"><a href="#cb148-850" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(bw_lm2) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>() <span class="sc">+</span> </span>
<span id="cb148-851"><a href="#cb148-851" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span><span class="sc">*</span>(<span class="fu">length</span>(<span class="fu">coef</span>(bw_lm2))<span class="sc">+</span><span class="dv">1</span>) <span class="co"># sigma counts as a parameter here</span></span>
<span id="cb148-852"><a href="#cb148-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-853"><a href="#cb148-853" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(bw_lm2)</span>
<span id="cb148-854"><a href="#cb148-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-855"><a href="#cb148-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-856"><a href="#cb148-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-857"><a href="#cb148-857" aria-hidden="true" tabindex="-1"></a><span class="fu">### BIC in R</span></span>
<span id="cb148-858"><a href="#cb148-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-861"><a href="#cb148-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-862"><a href="#cb148-862" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(bw_lm2) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>() <span class="sc">+</span> </span>
<span id="cb148-863"><a href="#cb148-863" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">length</span>(<span class="fu">coef</span>(bw_lm2))<span class="sc">+</span><span class="dv">1</span>) <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">nobs</span>(bw_lm2))</span>
<span id="cb148-864"><a href="#cb148-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-865"><a href="#cb148-865" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(bw_lm2)</span>
<span id="cb148-866"><a href="#cb148-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-867"><a href="#cb148-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-868"><a href="#cb148-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-869"><a href="#cb148-869" aria-hidden="true" tabindex="-1"></a>Large values of AIC and BIC are worse than small values. There are no hypothesis tests or p-values associated with these criteria.</span>
<span id="cb148-870"><a href="#cb148-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-871"><a href="#cb148-871" aria-hidden="true" tabindex="-1"></a><span class="fu">## (Residual) Deviance</span></span>
<span id="cb148-872"><a href="#cb148-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-873"><a href="#cb148-873" aria-hidden="true" tabindex="-1"></a>Let $q$ be the number of distinct covariate combinations in a data set.</span>
<span id="cb148-874"><a href="#cb148-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-877"><a href="#cb148-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-878"><a href="#cb148-878" aria-hidden="true" tabindex="-1"></a>bw.X.unique <span class="ot">=</span> </span>
<span id="cb148-879"><a href="#cb148-879" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-880"><a href="#cb148-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, age)</span>
<span id="cb148-881"><a href="#cb148-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-882"><a href="#cb148-882" aria-hidden="true" tabindex="-1"></a>n_unique.bw  <span class="ot">=</span> <span class="fu">nrow</span>(bw.X.unique)</span>
<span id="cb148-883"><a href="#cb148-883" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-884"><a href="#cb148-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-885"><a href="#cb148-885" aria-hidden="true" tabindex="-1"></a>For example, in the <span class="in">`birthweight`</span> data, there are $q = <span class="in">`r n_unique.bw`</span>$ unique patterns:</span>
<span id="cb148-886"><a href="#cb148-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-889"><a href="#cb148-889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-890"><a href="#cb148-890" aria-hidden="true" tabindex="-1"></a>bw.X.unique <span class="sc">|&gt;</span> </span>
<span id="cb148-891"><a href="#cb148-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pander</span>(</span>
<span id="cb148-892"><a href="#cb148-892" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="fu">rownames</span>(bw.X.unique))</span>
<span id="cb148-893"><a href="#cb148-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-894"><a href="#cb148-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-895"><a href="#cb148-895" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb148-896"><a href="#cb148-896" aria-hidden="true" tabindex="-1"></a>If a given covariate pattern has more than one observation in a dataset, those observations are called **replicates**.</span>
<span id="cb148-897"><a href="#cb148-897" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-898"><a href="#cb148-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-899"><a href="#cb148-899" aria-hidden="true" tabindex="-1"></a>Then the most complicated model we could fit would have one parameter (a mean) for each of these combinations, plus a variance parameter:</span>
<span id="cb148-900"><a href="#cb148-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-903"><a href="#cb148-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-904"><a href="#cb148-904" aria-hidden="true" tabindex="-1"></a>lm_max <span class="ot">=</span> </span>
<span id="cb148-905"><a href="#cb148-905" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-906"><a href="#cb148-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">factor</span>(age)) <span class="sc">|&gt;</span> </span>
<span id="cb148-907"><a href="#cb148-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb148-908"><a href="#cb148-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> weight <span class="sc">~</span> sex<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb148-909"><a href="#cb148-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb148-910"><a href="#cb148-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-911"><a href="#cb148-911" aria-hidden="true" tabindex="-1"></a>lm_max <span class="sc">|&gt;</span> </span>
<span id="cb148-912"><a href="#cb148-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb148-913"><a href="#cb148-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb148-914"><a href="#cb148-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-915"><a href="#cb148-915" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-916"><a href="#cb148-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-917"><a href="#cb148-917" aria-hidden="true" tabindex="-1"></a>We call this model the **full**, **maximal**, or **saturated** model for this dataset.</span>
<span id="cb148-918"><a href="#cb148-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-919"><a href="#cb148-919" aria-hidden="true" tabindex="-1"></a>We can calculate the log-likelihood of this model as usual:</span>
<span id="cb148-920"><a href="#cb148-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-923"><a href="#cb148-923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-924"><a href="#cb148-924" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(lm_max)</span>
<span id="cb148-925"><a href="#cb148-925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-926"><a href="#cb148-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-927"><a href="#cb148-927" aria-hidden="true" tabindex="-1"></a>We can compare this model to our other models using chi-square tests, as usual:</span>
<span id="cb148-928"><a href="#cb148-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-931"><a href="#cb148-931" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-932"><a href="#cb148-932" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(lm_max, bw_lm2)</span>
<span id="cb148-933"><a href="#cb148-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-934"><a href="#cb148-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-935"><a href="#cb148-935" aria-hidden="true" tabindex="-1"></a>The likelihood ratio statistic for this test is $$\lambda = 2 * (\ell_{\text{full}} - \ell) = <span class="in">`r 2 * (logLik(lm_max) - logLik(bw_lm2))`</span>$$ where:</span>
<span id="cb148-936"><a href="#cb148-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-937"><a href="#cb148-937" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell_{\text{max}}$ is the log-likelihood of the full model: <span class="in">`r logLik(lm_max)`</span></span>
<span id="cb148-938"><a href="#cb148-938" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell$ is the log-likelihood of our comparison model (two slopes, two intercepts): <span class="in">`r logLik(bw_lm2)`</span></span>
<span id="cb148-939"><a href="#cb148-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-940"><a href="#cb148-940" aria-hidden="true" tabindex="-1"></a>This statistic is called the **deviance** or **residual deviance** for our two-slopes and two-intercepts model; it tells us how much the likelihood of that model deviates from the likelihood of the maximal model.</span>
<span id="cb148-941"><a href="#cb148-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-942"><a href="#cb148-942" aria-hidden="true" tabindex="-1"></a>The corresponding p-value tells us whether there we have enough evidence to detect that our two-slopes, two-intercepts model is a worse fit for the data than the maximal model; in other words, it tells us if there's evidence that we missed any important patterns. (Remember, a nonsignificant p-value could mean that we didn't miss anything and a more complicated model is unnecessary, or it could mean we just don't have enough data to tell the difference between these models.)</span>
<span id="cb148-943"><a href="#cb148-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-944"><a href="#cb148-944" aria-hidden="true" tabindex="-1"></a><span class="fu">## Null Deviance</span></span>
<span id="cb148-945"><a href="#cb148-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-946"><a href="#cb148-946" aria-hidden="true" tabindex="-1"></a>Similarly, the *least* complicated model we could fit would have only one mean parameter, an intercept:</span>
<span id="cb148-947"><a href="#cb148-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-948"><a href="#cb148-948" aria-hidden="true" tabindex="-1"></a>$$\text E<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> = \beta_0$$ We can fit this model in R like so:</span>
<span id="cb148-949"><a href="#cb148-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-952"><a href="#cb148-952" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-953"><a href="#cb148-953" aria-hidden="true" tabindex="-1"></a>lm0 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> bw)</span>
<span id="cb148-954"><a href="#cb148-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-955"><a href="#cb148-955" aria-hidden="true" tabindex="-1"></a>lm0 <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb148-956"><a href="#cb148-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-957"><a href="#cb148-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-958"><a href="#cb148-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-959"><a href="#cb148-959" aria-hidden="true" tabindex="-1"></a>This model also has a likelihood:</span>
<span id="cb148-960"><a href="#cb148-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-963"><a href="#cb148-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-964"><a href="#cb148-964" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(lm0)</span>
<span id="cb148-965"><a href="#cb148-965" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-966"><a href="#cb148-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-967"><a href="#cb148-967" aria-hidden="true" tabindex="-1"></a>And we can compare it to more complicated models using a likelihood ratio test:</span>
<span id="cb148-968"><a href="#cb148-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-971"><a href="#cb148-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-972"><a href="#cb148-972" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(bw_lm2, lm0)</span>
<span id="cb148-973"><a href="#cb148-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-974"><a href="#cb148-974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-975"><a href="#cb148-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-976"><a href="#cb148-976" aria-hidden="true" tabindex="-1"></a>The likelihood ratio statistic for the test comparing the null model to the maximal model is $$\lambda = 2 * (\ell_{\text{full}} - \ell_{0}) = <span class="in">`r 2 * (logLik(lm_max) - logLik(lm0))`</span>$$ where:</span>
<span id="cb148-977"><a href="#cb148-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-978"><a href="#cb148-978" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell_{\text{0}}$ is the log-likelihood of the null model: <span class="in">`r logLik(lm0)`</span></span>
<span id="cb148-979"><a href="#cb148-979" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell_{\text{full}}$ is the log-likelihood of the maximal model: <span class="in">`r logLik(lm_max)`</span></span>
<span id="cb148-980"><a href="#cb148-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-981"><a href="#cb148-981" aria-hidden="true" tabindex="-1"></a>In R, this test is:</span>
<span id="cb148-982"><a href="#cb148-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-985"><a href="#cb148-985" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-986"><a href="#cb148-986" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(lm_max, lm0)</span>
<span id="cb148-987"><a href="#cb148-987" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-988"><a href="#cb148-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-989"><a href="#cb148-989" aria-hidden="true" tabindex="-1"></a>This log-likelihood ratio statistic is called the **null deviance**. It tells us whether we have enough data to detect a difference between the null and full models.</span>
<span id="cb148-990"><a href="#cb148-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-991"><a href="#cb148-991" aria-hidden="true" tabindex="-1"></a><span class="fu"># Rescaling</span></span>
<span id="cb148-992"><a href="#cb148-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-993"><a href="#cb148-993" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rescale age {.smaller}</span></span>
<span id="cb148-994"><a href="#cb148-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-997"><a href="#cb148-997" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-998"><a href="#cb148-998" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb148-999"><a href="#cb148-999" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span></span>
<span id="cb148-1000"><a href="#cb148-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1001"><a href="#cb148-1001" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">age - mean</span><span class="st">`</span> <span class="ot">=</span> age <span class="sc">-</span> <span class="fu">mean</span>(age),</span>
<span id="cb148-1002"><a href="#cb148-1002" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span> <span class="ot">=</span> age <span class="sc">-</span> <span class="dv">36</span></span>
<span id="cb148-1003"><a href="#cb148-1003" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1004"><a href="#cb148-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1005"><a href="#cb148-1005" aria-hidden="true" tabindex="-1"></a>lm1c <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex <span class="sc">+</span> <span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span>, <span class="at">data =</span> bw)</span>
<span id="cb148-1006"><a href="#cb148-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1007"><a href="#cb148-1007" aria-hidden="true" tabindex="-1"></a>lm2c <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex <span class="sc">+</span> <span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span> <span class="sc">+</span> sex<span class="sc">:</span><span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span>, <span class="at">data =</span> bw)</span>
<span id="cb148-1008"><a href="#cb148-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1009"><a href="#cb148-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(lm2c, <span class="at">ci_method =</span> <span class="st">"wald"</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb148-1010"><a href="#cb148-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1011"><a href="#cb148-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1012"><a href="#cb148-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1013"><a href="#cb148-1013" aria-hidden="true" tabindex="-1"></a>Compare with what we got without rescaling:</span>
<span id="cb148-1014"><a href="#cb148-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1017"><a href="#cb148-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1018"><a href="#cb148-1018" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(bw_lm2, <span class="at">ci_method =</span> <span class="st">"wald"</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb148-1019"><a href="#cb148-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1020"><a href="#cb148-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1021"><a href="#cb148-1021" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prediction</span></span>
<span id="cb148-1022"><a href="#cb148-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1023"><a href="#cb148-1023" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prediction for linear models</span></span>
<span id="cb148-1024"><a href="#cb148-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1025"><a href="#cb148-1025" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-1026"><a href="#cb148-1026" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb148-1027"><a href="#cb148-1027" aria-hidden="true" tabindex="-1"></a>\hat Y &amp;= \hat E<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb148-1028"><a href="#cb148-1028" aria-hidden="true" tabindex="-1"></a>&amp;= x'\hat\beta <span class="sc">\\</span></span>
<span id="cb148-1029"><a href="#cb148-1029" aria-hidden="true" tabindex="-1"></a>&amp;= \hat\beta_0\cdot 1 + \hat\beta_1 x_1 + ... + \hat\beta_p x_p</span>
<span id="cb148-1030"><a href="#cb148-1030" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb148-1031"><a href="#cb148-1031" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-1032"><a href="#cb148-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1033"><a href="#cb148-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">## prediction in R</span></span>
<span id="cb148-1034"><a href="#cb148-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1037"><a href="#cb148-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1038"><a href="#cb148-1038" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">model.matrix</span>(bw_lm1)</span>
<span id="cb148-1039"><a href="#cb148-1039" aria-hidden="true" tabindex="-1"></a>X <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-1040"><a href="#cb148-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1041"><a href="#cb148-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X[<span class="dv">1</span>,])</span>
<span id="cb148-1042"><a href="#cb148-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">coef</span>(bw_lm1))</span>
<span id="cb148-1043"><a href="#cb148-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X[<span class="dv">1</span>,] <span class="sc">*</span> <span class="fu">coef</span>(bw_lm1))</span>
<span id="cb148-1044"><a href="#cb148-1044" aria-hidden="true" tabindex="-1"></a>{X[<span class="dv">1</span>,] <span class="sc">*</span> <span class="fu">coef</span>(bw_lm1)} <span class="sc">|&gt;</span> <span class="fu">sum</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-1045"><a href="#cb148-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1046"><a href="#cb148-1046" aria-hidden="true" tabindex="-1"></a>X <span class="sc">%*%</span> <span class="fu">coef</span>(bw_lm1) <span class="sc">|&gt;</span> <span class="fu">as.vector</span>()</span>
<span id="cb148-1047"><a href="#cb148-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1048"><a href="#cb148-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(bw_lm1)</span>
<span id="cb148-1049"><a href="#cb148-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1050"><a href="#cb148-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(bw_lm1, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1051"><a href="#cb148-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1052"><a href="#cb148-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(bw_lm1, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>fit</span>
<span id="cb148-1053"><a href="#cb148-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(bw_lm1, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>se.fit</span>
<span id="cb148-1054"><a href="#cb148-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1055"><a href="#cb148-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(bw_lm1, <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">interval =</span> <span class="st">"confidence"</span>)<span class="sc">$</span>fit <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb148-1056"><a href="#cb148-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1057"><a href="#cb148-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(bw_lm1, <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">interval =</span> <span class="st">"predict"</span>)<span class="sc">$</span>fit <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb148-1058"><a href="#cb148-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1059"><a href="#cb148-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1060"><a href="#cb148-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1061"><a href="#cb148-1061" aria-hidden="true" tabindex="-1"></a>The warning from the last command is: "predictions on current data refer to *future* responses" (since you already know what happened to the current data, and thus don't need to predict it). You could also supply <span class="in">`newdata`</span> to get predictions for new combinations of predictors that you didn't see in your original dataset. See <span class="in">`?predict.lm`</span> for more.</span>
<span id="cb148-1062"><a href="#cb148-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1063"><a href="#cb148-1063" aria-hidden="true" tabindex="-1"></a><span class="fu"># Diagnostics</span></span>
<span id="cb148-1064"><a href="#cb148-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1065"><a href="#cb148-1065" aria-hidden="true" tabindex="-1"></a><span class="fu">## Residuals</span></span>
<span id="cb148-1066"><a href="#cb148-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1067"><a href="#cb148-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">### Definitions of residuals</span></span>
<span id="cb148-1068"><a href="#cb148-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1069"><a href="#cb148-1069" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Residuals: $$e_i = y_i - \hat E<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span>$$</span>
<span id="cb148-1070"><a href="#cb148-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1071"><a href="#cb148-1071" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For Gaussian models, $e_i$ can be seen as an estimate of $$\epsilon_i = Y_i - \text{E}<span class="co">[</span><span class="ot">Y|X=x_i</span><span class="co">]</span>$$</span>
<span id="cb148-1072"><a href="#cb148-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1073"><a href="#cb148-1073" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Standardized residuals: $$r_i = \frac{e_i}{\hat{SD}(e_i)}$$</span>
<span id="cb148-1074"><a href="#cb148-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1075"><a href="#cb148-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For Gaussian models: $$\hat{SD}(e_i) \approx \frac{e_i}{\hat{\sigma}}$$</span>
<span id="cb148-1076"><a href="#cb148-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1077"><a href="#cb148-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">### Characteristics of residuals</span></span>
<span id="cb148-1078"><a href="#cb148-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1079"><a href="#cb148-1079" aria-hidden="true" tabindex="-1"></a>With enough data and a correct model, the residuals will be approximately Guassian distributed, with variance $\sigma^2$, which we can estimate using $\hat\sigma^2$: that is:</span>
<span id="cb148-1080"><a href="#cb148-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1081"><a href="#cb148-1081" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-1082"><a href="#cb148-1082" aria-hidden="true" tabindex="-1"></a>e_i\ \dot \sim_{iid}\ N(0, \hat\sigma^2)</span>
<span id="cb148-1083"><a href="#cb148-1083" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-1084"><a href="#cb148-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1085"><a href="#cb148-1085" aria-hidden="true" tabindex="-1"></a>Hence, with enough data and a correct model, the standardized residuals will be approximately standard Gaussian; that is,</span>
<span id="cb148-1086"><a href="#cb148-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1087"><a href="#cb148-1087" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-1088"><a href="#cb148-1088" aria-hidden="true" tabindex="-1"></a>r_i\ \dot \sim_{iid}\ N(0,1)</span>
<span id="cb148-1089"><a href="#cb148-1089" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb148-1090"><a href="#cb148-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1091"><a href="#cb148-1091" aria-hidden="true" tabindex="-1"></a><span class="fu">## Marginal distributions of residuals</span></span>
<span id="cb148-1092"><a href="#cb148-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1093"><a href="#cb148-1093" aria-hidden="true" tabindex="-1"></a>To look for problems with our model, we can check whether the residuals $e_i$ and standardized residuals $r_i$ look like they have the distributions that they are supposed to have, according to the model.</span>
<span id="cb148-1094"><a href="#cb148-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1095"><a href="#cb148-1095" aria-hidden="true" tabindex="-1"></a>First, we need to compute the residuals. R makes this easy:</span>
<span id="cb148-1096"><a href="#cb148-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1097"><a href="#cb148-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">### (non-standardized) residuals in R</span></span>
<span id="cb148-1098"><a href="#cb148-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1101"><a href="#cb148-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1102"><a href="#cb148-1102" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(bw_lm2)</span>
<span id="cb148-1103"><a href="#cb148-1103" aria-hidden="true" tabindex="-1"></a><span class="co"># check by hand</span></span>
<span id="cb148-1104"><a href="#cb148-1104" aria-hidden="true" tabindex="-1"></a>bw<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">fitted</span>(bw_lm2)</span>
<span id="cb148-1105"><a href="#cb148-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1106"><a href="#cb148-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1107"><a href="#cb148-1107" aria-hidden="true" tabindex="-1"></a>Success!</span>
<span id="cb148-1108"><a href="#cb148-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1109"><a href="#cb148-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">### Standardized residuals in R</span></span>
<span id="cb148-1110"><a href="#cb148-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1113"><a href="#cb148-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1114"><a href="#cb148-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">rstandard</span>(bw_lm2)</span>
<span id="cb148-1115"><a href="#cb148-1115" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(bw_lm2)<span class="sc">/</span><span class="fu">sigma</span>(bw_lm2)</span>
<span id="cb148-1116"><a href="#cb148-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1117"><a href="#cb148-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1118"><a href="#cb148-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1119"><a href="#cb148-1119" aria-hidden="true" tabindex="-1"></a>These are not quite the same, because R is doing something more complicated and precise to get the standard errors. Let's not worry about those details for now; the difference is pretty small in this case:</span>
<span id="cb148-1120"><a href="#cb148-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1123"><a href="#cb148-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1124"><a href="#cb148-1124" aria-hidden="true" tabindex="-1"></a>rstandard_compare_plot <span class="ot">=</span> </span>
<span id="cb148-1125"><a href="#cb148-1125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb148-1126"><a href="#cb148-1126" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">resid</span>(bw_lm2)<span class="sc">/</span><span class="fu">sigma</span>(bw_lm2), </span>
<span id="cb148-1127"><a href="#cb148-1127" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">rstandard</span>(bw_lm2)) <span class="sc">|&gt;</span> </span>
<span id="cb148-1128"><a href="#cb148-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb148-1129"><a href="#cb148-1129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb148-1130"><a href="#cb148-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb148-1131"><a href="#cb148-1131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb148-1132"><a href="#cb148-1132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"resid(bw_lm2)/sigma(bw_lm2)"</span>) <span class="sc">+</span></span>
<span id="cb148-1133"><a href="#cb148-1133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"rstandard(bw_lm2)"</span>) <span class="sc">+</span></span>
<span id="cb148-1134"><a href="#cb148-1134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb148-1135"><a href="#cb148-1135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb148-1136"><a href="#cb148-1136" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb148-1137"><a href="#cb148-1137" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="dv">1</span>, </span>
<span id="cb148-1138"><a href="#cb148-1138" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"x=y"</span>)) <span class="sc">+</span></span>
<span id="cb148-1139"><a href="#cb148-1139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb148-1140"><a href="#cb148-1140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="st">"red"</span>)</span>
<span id="cb148-1141"><a href="#cb148-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1142"><a href="#cb148-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1143"><a href="#cb148-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1144"><a href="#cb148-1144" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1147"><a href="#cb148-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1148"><a href="#cb148-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(rstandard_compare_plot)</span>
<span id="cb148-1149"><a href="#cb148-1149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1150"><a href="#cb148-1150" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1151"><a href="#cb148-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1152"><a href="#cb148-1152" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1155"><a href="#cb148-1155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1156"><a href="#cb148-1156" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rstandard_compare_plot)</span>
<span id="cb148-1157"><a href="#cb148-1157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1158"><a href="#cb148-1158" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1159"><a href="#cb148-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1160"><a href="#cb148-1160" aria-hidden="true" tabindex="-1"></a>Let's add these residuals to the <span class="in">`tibble`</span> of our dataset:</span>
<span id="cb148-1161"><a href="#cb148-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1164"><a href="#cb148-1164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1165"><a href="#cb148-1165" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb148-1166"><a href="#cb148-1166" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1167"><a href="#cb148-1167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1168"><a href="#cb148-1168" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_lm2 =</span> <span class="fu">fitted</span>(bw_lm2),</span>
<span id="cb148-1169"><a href="#cb148-1169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-1170"><a href="#cb148-1170" aria-hidden="true" tabindex="-1"></a>    <span class="at">resid_lm2 =</span> <span class="fu">resid</span>(bw_lm2),</span>
<span id="cb148-1171"><a href="#cb148-1171" aria-hidden="true" tabindex="-1"></a>    <span class="co"># resid_lm2 = weight - fitted_lm2,</span></span>
<span id="cb148-1172"><a href="#cb148-1172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-1173"><a href="#cb148-1173" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_resid_lm2 =</span> <span class="fu">rstandard</span>(bw_lm2),</span>
<span id="cb148-1174"><a href="#cb148-1174" aria-hidden="true" tabindex="-1"></a>    <span class="co"># std_resid_lm2 = resid_lm2 / sigma(bw_lm2)</span></span>
<span id="cb148-1175"><a href="#cb148-1175" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1176"><a href="#cb148-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1177"><a href="#cb148-1177" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1178"><a href="#cb148-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb148-1179"><a href="#cb148-1179" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb148-1180"><a href="#cb148-1180" aria-hidden="true" tabindex="-1"></a>    age,</span>
<span id="cb148-1181"><a href="#cb148-1181" aria-hidden="true" tabindex="-1"></a>    weight,</span>
<span id="cb148-1182"><a href="#cb148-1182" aria-hidden="true" tabindex="-1"></a>    fitted_lm2,</span>
<span id="cb148-1183"><a href="#cb148-1183" aria-hidden="true" tabindex="-1"></a>    resid_lm2,</span>
<span id="cb148-1184"><a href="#cb148-1184" aria-hidden="true" tabindex="-1"></a>    std_resid_lm2</span>
<span id="cb148-1185"><a href="#cb148-1185" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1186"><a href="#cb148-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1187"><a href="#cb148-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1188"><a href="#cb148-1188" aria-hidden="true" tabindex="-1"></a>Now let's build histograms:</span>
<span id="cb148-1189"><a href="#cb148-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1190"><a href="#cb148-1190" aria-hidden="true" tabindex="-1"></a><span class="fu">### Marginal distribution of (nonstandardized) residuals</span></span>
<span id="cb148-1191"><a href="#cb148-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1194"><a href="#cb148-1194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1195"><a href="#cb148-1195" aria-hidden="true" tabindex="-1"></a>resid_marginal_hist <span class="ot">=</span> </span>
<span id="cb148-1196"><a href="#cb148-1196" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1197"><a href="#cb148-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> resid_lm2)) <span class="sc">+</span></span>
<span id="cb148-1198"><a href="#cb148-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb148-1199"><a href="#cb148-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1200"><a href="#cb148-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1201"><a href="#cb148-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1202"><a href="#cb148-1202" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1205"><a href="#cb148-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1206"><a href="#cb148-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(resid_marginal_hist)</span>
<span id="cb148-1207"><a href="#cb148-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1208"><a href="#cb148-1208" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1209"><a href="#cb148-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1210"><a href="#cb148-1210" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1213"><a href="#cb148-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1214"><a href="#cb148-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resid_marginal_hist)</span>
<span id="cb148-1215"><a href="#cb148-1215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1216"><a href="#cb148-1216" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1217"><a href="#cb148-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1218"><a href="#cb148-1218" aria-hidden="true" tabindex="-1"></a>Hard to tell with this small amount of data, but I'm a bit concerned that the histogram doesn't show a bell-curve shape.</span>
<span id="cb148-1219"><a href="#cb148-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1220"><a href="#cb148-1220" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Marginal distribution of standardized residuals</span></span>
<span id="cb148-1221"><a href="#cb148-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1224"><a href="#cb148-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1225"><a href="#cb148-1225" aria-hidden="true" tabindex="-1"></a>std_resid_marginal_hist <span class="ot">=</span> </span>
<span id="cb148-1226"><a href="#cb148-1226" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1227"><a href="#cb148-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> std_resid_lm2)) <span class="sc">+</span></span>
<span id="cb148-1228"><a href="#cb148-1228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb148-1229"><a href="#cb148-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1230"><a href="#cb148-1230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1231"><a href="#cb148-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1232"><a href="#cb148-1232" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1235"><a href="#cb148-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1236"><a href="#cb148-1236" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(std_resid_marginal_hist)</span>
<span id="cb148-1237"><a href="#cb148-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1238"><a href="#cb148-1238" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1239"><a href="#cb148-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1240"><a href="#cb148-1240" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1243"><a href="#cb148-1243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1244"><a href="#cb148-1244" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(std_resid_marginal_hist)</span>
<span id="cb148-1245"><a href="#cb148-1245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1246"><a href="#cb148-1246" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1247"><a href="#cb148-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1248"><a href="#cb148-1248" aria-hidden="true" tabindex="-1"></a>This looks similar, although the scale of the x-axis got narrower, because we divided by $\hat\sigma$ (roughly speaking).</span>
<span id="cb148-1249"><a href="#cb148-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1250"><a href="#cb148-1250" aria-hidden="true" tabindex="-1"></a>Still hard to tell if the distribution is Gaussian.</span>
<span id="cb148-1251"><a href="#cb148-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1252"><a href="#cb148-1252" aria-hidden="true" tabindex="-1"></a><span class="fu">## QQ plot of standardized residuals</span></span>
<span id="cb148-1253"><a href="#cb148-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1254"><a href="#cb148-1254" aria-hidden="true" tabindex="-1"></a>Another way to assess normality is the QQ plot of the standardized residuals versus normal quantiles:</span>
<span id="cb148-1255"><a href="#cb148-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1258"><a href="#cb148-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1259"><a href="#cb148-1259" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify) </span>
<span id="cb148-1260"><a href="#cb148-1260" aria-hidden="true" tabindex="-1"></a><span class="co"># needed to make ggplot2::autoplot() work for `lm` objects</span></span>
<span id="cb148-1261"><a href="#cb148-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1262"><a href="#cb148-1262" aria-hidden="true" tabindex="-1"></a>qqplot_lm2_auto <span class="ot">=</span> </span>
<span id="cb148-1263"><a href="#cb148-1263" aria-hidden="true" tabindex="-1"></a>  bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb148-1264"><a href="#cb148-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(</span>
<span id="cb148-1265"><a href="#cb148-1265" aria-hidden="true" tabindex="-1"></a>    <span class="at">which =</span> <span class="dv">2</span>, <span class="co"># options are 1:6; can do multiple at once</span></span>
<span id="cb148-1266"><a href="#cb148-1266" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb148-1267"><a href="#cb148-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb148-1268"><a href="#cb148-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1269"><a href="#cb148-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1270"><a href="#cb148-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1271"><a href="#cb148-1271" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1274"><a href="#cb148-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1275"><a href="#cb148-1275" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(qqplot_lm2_auto)</span>
<span id="cb148-1276"><a href="#cb148-1276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1277"><a href="#cb148-1277" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1278"><a href="#cb148-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1279"><a href="#cb148-1279" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1282"><a href="#cb148-1282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1283"><a href="#cb148-1283" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(qqplot_lm2_auto)</span>
<span id="cb148-1284"><a href="#cb148-1284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1285"><a href="#cb148-1285" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1286"><a href="#cb148-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1287"><a href="#cb148-1287" aria-hidden="true" tabindex="-1"></a>If the Gaussian model were correct, these points should follow the dotted line.</span>
<span id="cb148-1288"><a href="#cb148-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1289"><a href="#cb148-1289" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb148-1290"><a href="#cb148-1290" aria-hidden="true" tabindex="-1"></a>Fig 2.4 panel (c) in Dobson is a little different; they didn't specify how they produced it, but other statistical analysis systems do things differently from R.</span>
<span id="cb148-1291"><a href="#cb148-1291" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1292"><a href="#cb148-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1293"><a href="#cb148-1293" aria-hidden="true" tabindex="-1"></a><span class="fu">### QQ plot - how it's built</span></span>
<span id="cb148-1294"><a href="#cb148-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1295"><a href="#cb148-1295" aria-hidden="true" tabindex="-1"></a>Let's construct it by hand:</span>
<span id="cb148-1296"><a href="#cb148-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1299"><a href="#cb148-1299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1300"><a href="#cb148-1300" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1301"><a href="#cb148-1301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1302"><a href="#cb148-1302" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> (<span class="fu">rank</span>(std_resid_lm2) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">n</span>(), <span class="co"># "Blom's method"</span></span>
<span id="cb148-1303"><a href="#cb148-1303" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected_quantiles_lm2 =</span> <span class="fu">qnorm</span>(p)</span>
<span id="cb148-1304"><a href="#cb148-1304" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1305"><a href="#cb148-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1306"><a href="#cb148-1306" aria-hidden="true" tabindex="-1"></a>qqplot_lm2 <span class="ot">=</span> </span>
<span id="cb148-1307"><a href="#cb148-1307" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1308"><a href="#cb148-1308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb148-1309"><a href="#cb148-1309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb148-1310"><a href="#cb148-1310" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> expected_quantiles_lm2, </span>
<span id="cb148-1311"><a href="#cb148-1311" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> std_resid_lm2, </span>
<span id="cb148-1312"><a href="#cb148-1312" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> sex, </span>
<span id="cb148-1313"><a href="#cb148-1313" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape =</span> sex)</span>
<span id="cb148-1314"><a href="#cb148-1314" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb148-1315"><a href="#cb148-1315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb148-1316"><a href="#cb148-1316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb148-1317"><a href="#cb148-1317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">'none'</span>) <span class="sc">+</span> <span class="co"># removing the plot legend</span></span>
<span id="cb148-1318"><a href="#cb148-1318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Normal Q-Q"</span>) <span class="sc">+</span></span>
<span id="cb148-1319"><a href="#cb148-1319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Theoretical Quantiles"</span>) <span class="sc">+</span> </span>
<span id="cb148-1320"><a href="#cb148-1320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standardized residuals"</span>)</span>
<span id="cb148-1321"><a href="#cb148-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1322"><a href="#cb148-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1323"><a href="#cb148-1323" aria-hidden="true" tabindex="-1"></a>We find the expected line like so:</span>
<span id="cb148-1324"><a href="#cb148-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1327"><a href="#cb148-1327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1328"><a href="#cb148-1328" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">75</span>)                  <span class="co"># reference probabilities</span></span>
<span id="cb148-1329"><a href="#cb148-1329" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">rstandard</span>(bw_lm2), ps)  <span class="co"># empirical quantiles</span></span>
<span id="cb148-1330"><a href="#cb148-1330" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(ps)                     <span class="co"># theoretical quantiles</span></span>
<span id="cb148-1331"><a href="#cb148-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1332"><a href="#cb148-1332" aria-hidden="true" tabindex="-1"></a>qq_slope <span class="ot">=</span> <span class="fu">diff</span>(a)<span class="sc">/</span><span class="fu">diff</span>(b)</span>
<span id="cb148-1333"><a href="#cb148-1333" aria-hidden="true" tabindex="-1"></a>qq_intcpt <span class="ot">=</span> a[<span class="dv">1</span>] <span class="sc">-</span> b[<span class="dv">1</span>] <span class="sc">*</span> qq_slope</span>
<span id="cb148-1334"><a href="#cb148-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1335"><a href="#cb148-1335" aria-hidden="true" tabindex="-1"></a>qqplot_lm2 <span class="ot">=</span> </span>
<span id="cb148-1336"><a href="#cb148-1336" aria-hidden="true" tabindex="-1"></a>  qqplot_lm2 <span class="sc">+</span></span>
<span id="cb148-1337"><a href="#cb148-1337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> qq_slope, <span class="at">intercept =</span> qq_intcpt)</span>
<span id="cb148-1338"><a href="#cb148-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1339"><a href="#cb148-1339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1340"><a href="#cb148-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1341"><a href="#cb148-1341" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1344"><a href="#cb148-1344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1345"><a href="#cb148-1345" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(qqplot_lm2)</span>
<span id="cb148-1346"><a href="#cb148-1346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1347"><a href="#cb148-1347" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1348"><a href="#cb148-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1349"><a href="#cb148-1349" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1352"><a href="#cb148-1352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1353"><a href="#cb148-1353" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(qqplot_lm2)</span>
<span id="cb148-1354"><a href="#cb148-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1355"><a href="#cb148-1355" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1356"><a href="#cb148-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1357"><a href="#cb148-1357" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conditional distributions of residuals</span></span>
<span id="cb148-1358"><a href="#cb148-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1359"><a href="#cb148-1359" aria-hidden="true" tabindex="-1"></a>If our Gaussian linear regression model is correct, the residuals $e_i$ and standardized residuals $r_i$ should have:</span>
<span id="cb148-1360"><a href="#cb148-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1361"><a href="#cb148-1361" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>an approximately Gaussian distribution, with:</span>
<span id="cb148-1362"><a href="#cb148-1362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>a mean of 0</span>
<span id="cb148-1363"><a href="#cb148-1363" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>a constant variance</span>
<span id="cb148-1364"><a href="#cb148-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1365"><a href="#cb148-1365" aria-hidden="true" tabindex="-1"></a>This should be true **regardless** of the value of $X$.</span>
<span id="cb148-1366"><a href="#cb148-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1367"><a href="#cb148-1367" aria-hidden="true" tabindex="-1"></a>But if we didn't correctly guess the functional form of linear component of the mean, $$\text{E}<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p$$</span>
<span id="cb148-1368"><a href="#cb148-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1369"><a href="#cb148-1369" aria-hidden="true" tabindex="-1"></a>Then the the residuals might have nonzero mean or nonconstant variance for some values of $x$.</span>
<span id="cb148-1370"><a href="#cb148-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1371"><a href="#cb148-1371" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residuals versus fitted values</span></span>
<span id="cb148-1372"><a href="#cb148-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1373"><a href="#cb148-1373" aria-hidden="true" tabindex="-1"></a>To look for these issues, we can plot the residuals $e_i$ against the fitted values $\hat y_i$:</span>
<span id="cb148-1374"><a href="#cb148-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1377"><a href="#cb148-1377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1378"><a href="#cb148-1378" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-1379"><a href="#cb148-1379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1380"><a href="#cb148-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1381"><a href="#cb148-1381" aria-hidden="true" tabindex="-1"></a>If the model is correct, the blue line should stay flat and close to 0, and the cloud of dots should have the same vertical spread regardless of the fitted value.</span>
<span id="cb148-1382"><a href="#cb148-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1383"><a href="#cb148-1383" aria-hidden="true" tabindex="-1"></a>If not, we probably need to change the functional form of linear component of the mean, $$\text{E}<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p$$</span>
<span id="cb148-1384"><a href="#cb148-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1385"><a href="#cb148-1385" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scale-location plot</span></span>
<span id="cb148-1386"><a href="#cb148-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1387"><a href="#cb148-1387" aria-hidden="true" tabindex="-1"></a>We can also plot the square roots of the absolute values of the standardized residuals against the fitted values:</span>
<span id="cb148-1388"><a href="#cb148-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1389"><a href="#cb148-1389" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1392"><a href="#cb148-1392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1393"><a href="#cb148-1393" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-1394"><a href="#cb148-1394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1395"><a href="#cb148-1395" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1396"><a href="#cb148-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1397"><a href="#cb148-1397" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1400"><a href="#cb148-1400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1401"><a href="#cb148-1401" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-1402"><a href="#cb148-1402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1403"><a href="#cb148-1403" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1404"><a href="#cb148-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1405"><a href="#cb148-1405" aria-hidden="true" tabindex="-1"></a>Here, the blue line doesn't need to be near 0, but it should be flat. If not, the residual variance $\sigma^2$ might not be constant, and we might need to transform our outcome $Y$ (or use a model that allows non-constant variance).</span>
<span id="cb148-1406"><a href="#cb148-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1407"><a href="#cb148-1407" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residuals versus leverage</span></span>
<span id="cb148-1408"><a href="#cb148-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1409"><a href="#cb148-1409" aria-hidden="true" tabindex="-1"></a>We can also plot our standardized residuals against "leverage", which roughly speaking is a measure of how unusual each $x_i$ value is. Very unusual $x_i$ values can have extreme effects on the model fit, so we might want ot remove those observations as outliers, particularly if they have large residuals.</span>
<span id="cb148-1410"><a href="#cb148-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1411"><a href="#cb148-1411" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1414"><a href="#cb148-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1415"><a href="#cb148-1415" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-1416"><a href="#cb148-1416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1417"><a href="#cb148-1417" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1418"><a href="#cb148-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1419"><a href="#cb148-1419" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1422"><a href="#cb148-1422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1423"><a href="#cb148-1423" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb148-1424"><a href="#cb148-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1425"><a href="#cb148-1425" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1426"><a href="#cb148-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1427"><a href="#cb148-1427" aria-hidden="true" tabindex="-1"></a>The blue line should be relatively flat and close to 0 here.</span>
<span id="cb148-1428"><a href="#cb148-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1429"><a href="#cb148-1429" aria-hidden="true" tabindex="-1"></a><span class="fu">## Diagnostics constructed by hand</span></span>
<span id="cb148-1430"><a href="#cb148-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1433"><a href="#cb148-1433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1434"><a href="#cb148-1434" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb148-1435"><a href="#cb148-1435" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1436"><a href="#cb148-1436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1437"><a href="#cb148-1437" aria-hidden="true" tabindex="-1"></a>    <span class="at">predlm2 =</span> <span class="fu">predict</span>(bw_lm2),</span>
<span id="cb148-1438"><a href="#cb148-1438" aria-hidden="true" tabindex="-1"></a>    <span class="at">residlm2 =</span> weight <span class="sc">-</span> predlm2,</span>
<span id="cb148-1439"><a href="#cb148-1439" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_resid =</span> residlm2 <span class="sc">/</span> <span class="fu">sigma</span>(bw_lm2),</span>
<span id="cb148-1440"><a href="#cb148-1440" aria-hidden="true" tabindex="-1"></a>    <span class="co"># std_resid_builtin = rstandard(bw_lm2), # uses leverage</span></span>
<span id="cb148-1441"><a href="#cb148-1441" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrt_abs_std_resid =</span> std_resid <span class="sc">|&gt;</span> <span class="fu">abs</span>() <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span>
<span id="cb148-1442"><a href="#cb148-1442" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-1443"><a href="#cb148-1443" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1444"><a href="#cb148-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1445"><a href="#cb148-1445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1446"><a href="#cb148-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1447"><a href="#cb148-1447" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residuals vs fitted</span></span>
<span id="cb148-1448"><a href="#cb148-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1451"><a href="#cb148-1451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1452"><a href="#cb148-1452" aria-hidden="true" tabindex="-1"></a>resid_vs_fit <span class="ot">=</span> bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1453"><a href="#cb148-1453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb148-1454"><a href="#cb148-1454" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> predlm2, <span class="at">y =</span> residlm2, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb148-1455"><a href="#cb148-1455" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb148-1456"><a href="#cb148-1456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb148-1457"><a href="#cb148-1457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb148-1458"><a href="#cb148-1458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb148-1459"><a href="#cb148-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1460"><a href="#cb148-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1461"><a href="#cb148-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1462"><a href="#cb148-1462" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1465"><a href="#cb148-1465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1466"><a href="#cb148-1466" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resid_vs_fit)</span>
<span id="cb148-1467"><a href="#cb148-1467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1468"><a href="#cb148-1468" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1469"><a href="#cb148-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1470"><a href="#cb148-1470" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1473"><a href="#cb148-1473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1474"><a href="#cb148-1474" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resid_vs_fit)</span>
<span id="cb148-1475"><a href="#cb148-1475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1476"><a href="#cb148-1476" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1477"><a href="#cb148-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1478"><a href="#cb148-1478" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized residuals vs fitted</span></span>
<span id="cb148-1479"><a href="#cb148-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1482"><a href="#cb148-1482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1483"><a href="#cb148-1483" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1484"><a href="#cb148-1484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb148-1485"><a href="#cb148-1485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> predlm2, <span class="at">y =</span> std_resid, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb148-1486"><a href="#cb148-1486" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb148-1487"><a href="#cb148-1487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb148-1488"><a href="#cb148-1488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb148-1489"><a href="#cb148-1489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb148-1490"><a href="#cb148-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1491"><a href="#cb148-1491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1492"><a href="#cb148-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1493"><a href="#cb148-1493" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized residuals vs gestational age</span></span>
<span id="cb148-1494"><a href="#cb148-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1497"><a href="#cb148-1497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1498"><a href="#cb148-1498" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1499"><a href="#cb148-1499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb148-1500"><a href="#cb148-1500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> std_resid, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb148-1501"><a href="#cb148-1501" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb148-1502"><a href="#cb148-1502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb148-1503"><a href="#cb148-1503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb148-1504"><a href="#cb148-1504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb148-1505"><a href="#cb148-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1506"><a href="#cb148-1506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1507"><a href="#cb148-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1508"><a href="#cb148-1508" aria-hidden="true" tabindex="-1"></a><span class="fu">#### `sqrt(abs(rstandard()))` vs fitted</span></span>
<span id="cb148-1509"><a href="#cb148-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1510"><a href="#cb148-1510" aria-hidden="true" tabindex="-1"></a>Compare with <span class="in">`autoplot(bw_lm2, 3)`</span></span>
<span id="cb148-1511"><a href="#cb148-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1514"><a href="#cb148-1514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1515"><a href="#cb148-1515" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb148-1516"><a href="#cb148-1516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb148-1517"><a href="#cb148-1517" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> predlm2, <span class="at">y =</span> sqrt_abs_std_resid, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb148-1518"><a href="#cb148-1518" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb148-1519"><a href="#cb148-1519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb148-1520"><a href="#cb148-1520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb148-1521"><a href="#cb148-1521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb148-1522"><a href="#cb148-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1523"><a href="#cb148-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1524"><a href="#cb148-1524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1525"><a href="#cb148-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1526"><a href="#cb148-1526" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model selection</span></span>
<span id="cb148-1527"><a href="#cb148-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1528"><a href="#cb148-1528" aria-hidden="true" tabindex="-1"></a>If we have a lot of covariates in our dataset, we might want to choose a small subset to use in our model.</span>
<span id="cb148-1529"><a href="#cb148-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1530"><a href="#cb148-1530" aria-hidden="true" tabindex="-1"></a>There are a few possible metrics to consider for choosing a "best" model.</span>
<span id="cb148-1531"><a href="#cb148-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1532"><a href="#cb148-1532" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mean squared error</span></span>
<span id="cb148-1533"><a href="#cb148-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1534"><a href="#cb148-1534" aria-hidden="true" tabindex="-1"></a>We might want to minimize the **mean squared error**, $\text E<span class="co">[</span><span class="ot">(y-\hat y)^2</span><span class="co">]</span>$, for new observations that weren't in our data set when we fit the model.</span>
<span id="cb148-1535"><a href="#cb148-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1536"><a href="#cb148-1536" aria-hidden="true" tabindex="-1"></a>Unfortunately, $$\frac{1}{n}\sum_{i=1}^n (y_i-\hat y_i)^2$$ gives a biased estimate of $\text E<span class="co">[</span><span class="ot">(y-\hat y)^2</span><span class="co">]</span>$ for new data. If we want an unbiased estimate, we will have to be clever.</span>
<span id="cb148-1537"><a href="#cb148-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1538"><a href="#cb148-1538" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cross-validation</span></span>
<span id="cb148-1539"><a href="#cb148-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1542"><a href="#cb148-1542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1543"><a href="#cb148-1543" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"carbohydrate"</span>, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb148-1544"><a href="#cb148-1544" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cvTools)</span>
<span id="cb148-1545"><a href="#cb148-1545" aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(carbohydrate <span class="sc">~</span> ., <span class="at">data =</span> carbohydrate)</span>
<span id="cb148-1546"><a href="#cb148-1546" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> </span>
<span id="cb148-1547"><a href="#cb148-1547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cvFit</span>(full.model, <span class="at">data =</span> carbohydrate, <span class="at">K =</span> <span class="dv">5</span>, <span class="at">R =</span> <span class="dv">10</span>,</span>
<span id="cb148-1548"><a href="#cb148-1548" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> carbohydrate<span class="sc">$</span>carbohydrate)</span>
<span id="cb148-1549"><a href="#cb148-1549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1550"><a href="#cb148-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1551"><a href="#cb148-1551" aria-hidden="true" tabindex="-1"></a><span class="fu"># Categorical covariates with more than two levels</span></span>
<span id="cb148-1552"><a href="#cb148-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1553"><a href="#cb148-1553" aria-hidden="true" tabindex="-1"></a><span class="fu">## </span></span>
<span id="cb148-1554"><a href="#cb148-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1555"><a href="#cb148-1555" aria-hidden="true" tabindex="-1"></a>In the birthweight example, the variable <span class="in">`sex`</span> had only two observed values:</span>
<span id="cb148-1556"><a href="#cb148-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1559"><a href="#cb148-1559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1560"><a href="#cb148-1560" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(bw<span class="sc">$</span>sex)</span>
<span id="cb148-1561"><a href="#cb148-1561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1562"><a href="#cb148-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1563"><a href="#cb148-1563" aria-hidden="true" tabindex="-1"></a>If there are more than two observed values, we can't just use a single variable with 0s and 1s.</span>
<span id="cb148-1564"><a href="#cb148-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1565"><a href="#cb148-1565" aria-hidden="true" tabindex="-1"></a><span class="fu">## </span></span>
<span id="cb148-1566"><a href="#cb148-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1567"><a href="#cb148-1567" aria-hidden="true" tabindex="-1"></a>For example, here's the (in)famous <span class="in">`iris`</span> data:</span>
<span id="cb148-1568"><a href="#cb148-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1571"><a href="#cb148-1571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1572"><a href="#cb148-1572" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> <span class="fu">tibble</span>()</span>
<span id="cb148-1573"><a href="#cb148-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1574"><a href="#cb148-1574" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iris)</span>
<span id="cb148-1575"><a href="#cb148-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1576"><a href="#cb148-1576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1577"><a href="#cb148-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1578"><a href="#cb148-1578" aria-hidden="true" tabindex="-1"></a><span class="fu">## </span></span>
<span id="cb148-1579"><a href="#cb148-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1580"><a href="#cb148-1580" aria-hidden="true" tabindex="-1"></a>There are three species:</span>
<span id="cb148-1581"><a href="#cb148-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1584"><a href="#cb148-1584" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1585"><a href="#cb148-1585" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>Species <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb148-1586"><a href="#cb148-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1587"><a href="#cb148-1587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1588"><a href="#cb148-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1589"><a href="#cb148-1589" aria-hidden="true" tabindex="-1"></a><span class="fu">## </span></span>
<span id="cb148-1590"><a href="#cb148-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1591"><a href="#cb148-1591" aria-hidden="true" tabindex="-1"></a>If we want to model <span class="in">`Sepal.Length`</span> by species, we could create a variable $X$ that represents "setosa" as $X=1$, "virginica" as $X=2$, and "versicolor" as $X=3$.</span>
<span id="cb148-1592"><a href="#cb148-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1595"><a href="#cb148-1595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1596"><a href="#cb148-1596" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris) <span class="co"># this step is not always necessary, but ensures you're starting  </span></span>
<span id="cb148-1597"><a href="#cb148-1597" aria-hidden="true" tabindex="-1"></a><span class="co"># from the original version of a dataset stored in a loaded package</span></span>
<span id="cb148-1598"><a href="#cb148-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1599"><a href="#cb148-1599" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">=</span> </span>
<span id="cb148-1600"><a href="#cb148-1600" aria-hidden="true" tabindex="-1"></a>  iris <span class="sc">|&gt;</span> </span>
<span id="cb148-1601"><a href="#cb148-1601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-1602"><a href="#cb148-1602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1603"><a href="#cb148-1603" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">case_when</span>(</span>
<span id="cb148-1604"><a href="#cb148-1604" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"setosa"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb148-1605"><a href="#cb148-1605" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"virginica"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb148-1606"><a href="#cb148-1606" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"versicolor"</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb148-1607"><a href="#cb148-1607" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb148-1608"><a href="#cb148-1608" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-1609"><a href="#cb148-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1610"><a href="#cb148-1610" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb148-1611"><a href="#cb148-1611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Species, X) <span class="sc">|&gt;</span> </span>
<span id="cb148-1612"><a href="#cb148-1612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb148-1613"><a href="#cb148-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1614"><a href="#cb148-1614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1615"><a href="#cb148-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1616"><a href="#cb148-1616" aria-hidden="true" tabindex="-1"></a>Then we could fit a model like:</span>
<span id="cb148-1617"><a href="#cb148-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1620"><a href="#cb148-1620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1621"><a href="#cb148-1621" aria-hidden="true" tabindex="-1"></a>iris_lm1 <span class="ot">=</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> X, <span class="at">data =</span> iris)</span>
<span id="cb148-1622"><a href="#cb148-1622" aria-hidden="true" tabindex="-1"></a>iris_lm1 <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb148-1623"><a href="#cb148-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1624"><a href="#cb148-1624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1625"><a href="#cb148-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1626"><a href="#cb148-1626" aria-hidden="true" tabindex="-1"></a><span class="fu">## Let's see how that model looks:</span></span>
<span id="cb148-1627"><a href="#cb148-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1630"><a href="#cb148-1630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1631"><a href="#cb148-1631" aria-hidden="true" tabindex="-1"></a>iris_plot1 <span class="ot">=</span> iris <span class="sc">|&gt;</span> </span>
<span id="cb148-1632"><a href="#cb148-1632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb148-1633"><a href="#cb148-1633" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb148-1634"><a href="#cb148-1634" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> X, </span>
<span id="cb148-1635"><a href="#cb148-1635" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> Sepal.Length)</span>
<span id="cb148-1636"><a href="#cb148-1636" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb148-1637"><a href="#cb148-1637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb148-1638"><a href="#cb148-1638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb148-1639"><a href="#cb148-1639" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">1</span>], </span>
<span id="cb148-1640"><a href="#cb148-1640" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb148-1641"><a href="#cb148-1641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb148-1642"><a href="#cb148-1642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1643"><a href="#cb148-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1644"><a href="#cb148-1644" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1647"><a href="#cb148-1647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1648"><a href="#cb148-1648" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(iris_plot1)</span>
<span id="cb148-1649"><a href="#cb148-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1650"><a href="#cb148-1650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1651"><a href="#cb148-1651" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1652"><a href="#cb148-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1653"><a href="#cb148-1653" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1656"><a href="#cb148-1656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1657"><a href="#cb148-1657" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(iris_plot1)</span>
<span id="cb148-1658"><a href="#cb148-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1659"><a href="#cb148-1659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1660"><a href="#cb148-1660" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1661"><a href="#cb148-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1662"><a href="#cb148-1662" aria-hidden="true" tabindex="-1"></a>We have forced the model to use a straight line for the three estimated means. Maybe not a good idea?</span>
<span id="cb148-1663"><a href="#cb148-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1664"><a href="#cb148-1664" aria-hidden="true" tabindex="-1"></a><span class="fu">## Let's see what R does with categorical variables by default:</span></span>
<span id="cb148-1665"><a href="#cb148-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1668"><a href="#cb148-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1669"><a href="#cb148-1669" aria-hidden="true" tabindex="-1"></a>iris_lm2 <span class="ot">=</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Species, <span class="at">data =</span> iris)</span>
<span id="cb148-1670"><a href="#cb148-1670" aria-hidden="true" tabindex="-1"></a>iris_lm2 <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb148-1671"><a href="#cb148-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1672"><a href="#cb148-1672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1673"><a href="#cb148-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1674"><a href="#cb148-1674" aria-hidden="true" tabindex="-1"></a><span class="fu">## Re-parametrize with no intercept</span></span>
<span id="cb148-1675"><a href="#cb148-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1676"><a href="#cb148-1676" aria-hidden="true" tabindex="-1"></a>If you don't want the default and offset option, you can use "-1" like we've seen previously:</span>
<span id="cb148-1677"><a href="#cb148-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1680"><a href="#cb148-1680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1681"><a href="#cb148-1681" aria-hidden="true" tabindex="-1"></a>iris.lm2b <span class="ot">=</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Species <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> iris)</span>
<span id="cb148-1682"><a href="#cb148-1682" aria-hidden="true" tabindex="-1"></a>iris.lm2b <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb148-1683"><a href="#cb148-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1684"><a href="#cb148-1684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1685"><a href="#cb148-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1686"><a href="#cb148-1686" aria-hidden="true" tabindex="-1"></a><span class="fu">## Let's see what these new models look like:</span></span>
<span id="cb148-1687"><a href="#cb148-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1690"><a href="#cb148-1690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1691"><a href="#cb148-1691" aria-hidden="true" tabindex="-1"></a>iris_plot2 <span class="ot">=</span> </span>
<span id="cb148-1692"><a href="#cb148-1692" aria-hidden="true" tabindex="-1"></a>  iris <span class="sc">|&gt;</span> </span>
<span id="cb148-1693"><a href="#cb148-1693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-1694"><a href="#cb148-1694" aria-hidden="true" tabindex="-1"></a>    <span class="at">predlm2 =</span> <span class="fu">predict</span>(iris_lm2)) <span class="sc">|&gt;</span> </span>
<span id="cb148-1695"><a href="#cb148-1695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(X) <span class="sc">|&gt;</span> </span>
<span id="cb148-1696"><a href="#cb148-1696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb148-1697"><a href="#cb148-1697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb148-1698"><a href="#cb148-1698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predlm2), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb148-1699"><a href="#cb148-1699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb148-1700"><a href="#cb148-1700" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">1</span>], </span>
<span id="cb148-1701"><a href="#cb148-1701" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">2</span>]) <span class="sc">+</span> </span>
<span id="cb148-1702"><a href="#cb148-1702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb148-1703"><a href="#cb148-1703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1704"><a href="#cb148-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1705"><a href="#cb148-1705" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb148-1708"><a href="#cb148-1708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1709"><a href="#cb148-1709" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(iris_plot2)</span>
<span id="cb148-1710"><a href="#cb148-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1711"><a href="#cb148-1711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1712"><a href="#cb148-1712" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1713"><a href="#cb148-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1714"><a href="#cb148-1714" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb148-1717"><a href="#cb148-1717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1718"><a href="#cb148-1718" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(iris_plot2)</span>
<span id="cb148-1719"><a href="#cb148-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1720"><a href="#cb148-1720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1721"><a href="#cb148-1721" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb148-1722"><a href="#cb148-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1723"><a href="#cb148-1723" aria-hidden="true" tabindex="-1"></a><span class="fu">## Let's see how R did that:</span></span>
<span id="cb148-1724"><a href="#cb148-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1727"><a href="#cb148-1727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1728"><a href="#cb148-1728" aria-hidden="true" tabindex="-1"></a><span class="fu">formula</span>(iris_lm2)</span>
<span id="cb148-1729"><a href="#cb148-1729" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(iris_lm2) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb148-1730"><a href="#cb148-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1731"><a href="#cb148-1731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1732"><a href="#cb148-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1733"><a href="#cb148-1733" aria-hidden="true" tabindex="-1"></a>This is called a "corner point parametrization".</span>
<span id="cb148-1734"><a href="#cb148-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1737"><a href="#cb148-1737" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb148-1738"><a href="#cb148-1738" aria-hidden="true" tabindex="-1"></a><span class="fu">formula</span>(iris.lm2b)</span>
<span id="cb148-1739"><a href="#cb148-1739" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(iris.lm2b) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb148-1740"><a href="#cb148-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1741"><a href="#cb148-1741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb148-1742"><a href="#cb148-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1743"><a href="#cb148-1743" aria-hidden="true" tabindex="-1"></a>This can be called a "group point parametrization".</span>
<span id="cb148-1744"><a href="#cb148-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-1745"><a href="#cb148-1745" aria-hidden="true" tabindex="-1"></a>There are more options; see Dobson &amp; Barnett §6.4.1.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
 Copyright 2023, Douglas Ezra Morrison
  </li>  
</ul>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>